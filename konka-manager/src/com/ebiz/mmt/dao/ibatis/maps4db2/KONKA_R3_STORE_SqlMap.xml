<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_R3_STORE">

	<typeAlias alias="konkaR3Store" type="com.ebiz.mmt.domain.KonkaR3Store" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaR3Store" />
		<flushOnExecute statement="updateKonkaR3Store" />
		<flushOnExecute statement="deleteKonkaR3Store" />
	</cacheModel>

	<resultMap id="konkaR3StoreResultForList" class="konkaR3Store">
		<result column="STORE_ID" property="store_id" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="DEPT_NAME" property="dept_name" jdbcType="VARCHAR" />
		<result column="R3_CODE" property="r3_code" jdbcType="VARCHAR" />
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="ADDR" property="addr" jdbcType="VARCHAR" />
		<result column="LINKA_TEL" property="linka_tel" jdbcType="VARCHAR" />
		<result column="LINK_MAN" property="link_man" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="MF_SN" property="mf_sn" jdbcType="VARCHAR" />
		<result column="ZXY_JOB_ID" property="zxy_job_id" jdbcType="VARCHAR" />
		<result column="ZXY_NAME" property="zxy_name" jdbcType="VARCHAR" />
		<result column="ZXY_TEL" property="zxy_tel" jdbcType="VARCHAR" />
		<result column="YWY_JOB_ID" property="ywy_job_id" jdbcType="VARCHAR" />
		<result column="YWY_NAME" property="ywy_name" jdbcType="VARCHAR" />
		<result column="JB_JOB_ID" property="jb_job_id" jdbcType="VARCHAR" />
		<result column="JB_NAME" property="jb_name" jdbcType="VARCHAR" />
		<result column="JB_TEL" property="jb_tel" jdbcType="VARCHAR" />
		<result column="PROVINCE" property="province" jdbcType="VARCHAR" />
		<result column="CITY" property="city" jdbcType="VARCHAR" />
		<result column="COUNTRY" property="country" jdbcType="VARCHAR" />
		<result column="TOWN" property="town" jdbcType="VARCHAR" />
		<result column="MD_JB" property="md_jb" jdbcType="VARCHAR" />
		<result column="KH_NAME" property="kh_name" jdbcType="VARCHAR" />
		<result column="R3_SHSDF_SN" property="r3_shsdf_sn" jdbcType="VARCHAR" />
		<result column="R3_SDF_SN" property="r3_sdf_sn" jdbcType="VARCHAR" />
		<result column="XSZZ" property="xszz" jdbcType="VARCHAR" />
		<result column="YWZG_JOB_ID" property="ywzg_job_id" jdbcType="VARCHAR" />
		<result column="YWZG_NAME" property="ywzg_name" jdbcType="VARCHAR" />
		<result column="YWZG_TEL" property="ywzg_tel" jdbcType="VARCHAR" />
		<result column="JBJL_JOB_ID" property="jbjl_job_id" jdbcType="VARCHAR" />
		<result column="JBJL_NAME" property="jbjl_name" jdbcType="VARCHAR" />
		<result property="havaman" column="HAVAMAN" jdbcType="VARCHAR" />
		<result column="CK_ID" property="ck_id" jdbcType="BIGINT" />
		<result column="CK_NAME" property="ck_name" jdbcType="VARCHAR" />
		<result column="STORE_LEVEL" property="store_level" jdbcType="INTEGER" />
		<result column="YEAR_SALE_COUNT" property="year_sale_count"
			jdbcType="DECIMAL" />
		<result column="BUSINESS_AREA" property="business_area"
			jdbcType="DECIMAL" />
		<result column="TV_BUSINESS_AREA" property="tv_business_area"
			jdbcType="DECIMAL" />
		<result column="KONKA_SITE" property="konka_site" jdbcType="INTEGER" />
		<result column="COMPETITIONS" property="competitions" jdbcType="VARCHAR" />
		<result column="IS_IMPORTANT" property="is_important" jdbcType="INTEGER" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="STOP_DATE" property="stop_date" jdbcType="TIMESTAMP" />
		<result column="CREATE_USER_ID" property="create_user_id"
			jdbcType="DECIMAL" />
		<result column="MODIFY_USER_ID" property="modify_user_id"
			jdbcType="DECIMAL" />
		<result column="MODIFY_DATE" property="modify_date" jdbcType="DATETIME" />
	</resultMap>

	<resultMap id="konkaR3StoreResult" class="konkaR3Store"
		extends="konkaR3StoreResultForList">
	</resultMap>
	
	<resultMap id="konkaR3StoreResult-edit" class="konkaR3Store" extends="konkaR3StoreResultForList">
	    <result column="CREATE_MAN" property="map.create_man" jdbcType="VARCHAR" />
	    <result column="MODIFY_MAN" property="map.modify_man" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaR3StoreResultWithKhName" class="konkaR3Store"
		extends="konkaR3StoreResultForList">
		<result column="CUSTOMER_NAME" property="map.customer_name"
			jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaR3StoreAndYwyName" class="konkaR3Store"
		extends="konkaR3StoreResultForList">
		<result column="CXY_NAME_ALL" property="map.cxy_name_all"
			jdbcType="VARCHAR" />
		<result column="CXY_ID_ALL" property="map.cxy_id_all" jdbcType="VARCHAR" />
		<result column="CUSTOMER_TYPE1" property="map.customer_type1"
			jdbcType="VARCHAR" />
		<result column="CUSTOMER_TYPE2" property="map.customer_type2"
			jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="KonkaR3StoreSaleResult" class="konkaR3Store"
		extends="konkaR3StoreResultForList">
		<result column="EXT_DEPT_ID" property="map.ext_dept_id"
			jdbcType="DECIMAL" />
		<result column="EXT_DEPT_NAME" property="map.ext_dept_name"
			jdbcType="VARCHAR" />
		<result column="EXT_CUSTOMER_NAME" property="map.ext_customer_name"
			jdbcType="VARCHAR" />
		<result column="EXT_PAR_CUSTOMER_TYPE" property="map.ext_par_customer_type"
			jdbcType="VARCHAR" />
		<result column="EXT_PAR_CUSTOMER_TYPE_NAME" property="map.ext_par_customer_type_name"
			jdbcType="VARCHAR" />
		<result column="EXT_CUSTOMER_TYPE" property="map.ext_customer_type"
			jdbcType="VARCHAR" />
		<result column="EXT_CUSTOMER_TYPE_NAME" property="map.ext_customer_type_name"
			jdbcType="VARCHAR" />
		<result column="EXT_YWY_NAME" property="map.ext_ywy_name"
			jdbcType="VARCHAR" />
		<result column="EXT_CXY_NAME" property="map.ext_cxy_name"
			jdbcType="VARCHAR" />
		<result column="LAST_ALL_NUM" property="map.last_all_num"
			jdbcType="DECIMAL" />
		<result column="LAST_ALL_PRICE" property="map.last_all_price"
			jdbcType="DECIMAL" />
		<result column="ALL_NUM" property="map.cur_all_num" jdbcType="DECIMAL" />
		<result column="ALL_PRICE" property="map.cur_all_price"
			jdbcType="DECIMAL" />
		<result column="YTV_NUM" property="map.ytv_num" jdbcType="DECIMAL" />
		<result column="YTV_PRICE" property="map.ytv_price" jdbcType="DECIMAL" />
		<result column="K_NUM" property="map.k_num" jdbcType="DECIMAL" />
		<result column="K_PRICE" property="map.k_price" jdbcType="DECIMAL" />
		<result column="DB_NUM" property="map.db_num" jdbcType="DECIMAL" />
		<result column="DB_PRICE" property="map.db_price" jdbcType="DECIMAL" />
		<result column="FILE_DESC" property="map.file_desc" jdbcType="VARCHAR" />
		<result column="SAVE_PATH" property="map.save_path" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaR3StoreResultCountByPIndex" class="konkaR3Store">
		<result column="P_INDEX" property="map.p_index" jdbcType="DECIMAL" />
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
		<result column="NUM" property="map.num" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="konkaR3StoreResultForYwyAndCxyList" class="konkaR3Store">
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="STORE_NAME" property="map.store_name" jdbcType="VARCHAR" />
		<result column="CXY_NAME" property="map.cxy_name" jdbcType="VARCHAR" />
		<result column="CXY_PHONE" property="map.cxy_phone" jdbcType="VARCHAR" />
		<result column="YWY_NAME" property="map.ywy_name" jdbcType="VARCHAR" />
		<result column="YWY_PHONE" property="map.ywy_phone" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaR3StoreResultListByPIndex" class="konkaR3Store">
		<result column="STORE_ID" property="store_id" jdbcType="DECIMAL" />
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
		<result column="SALE_MONEY" property="map.sale_money" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-konkaR3Store">
		<isNotEmpty prepend=" and " property="store_id">STORE_ID =
			#store_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">DEPT_NAME =
			#dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_code">R3_CODE =
			#r3_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_name">STORE_NAME like '%'||
			#store_name:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX =
			#p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr">ADDR = #addr:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="linka_tel">LINKA_TEL =
			#linka_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_man">LINK_MAN =
			#link_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE =
			#add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL =
			#is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mf_sn">MF_SN =
			#mf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_job_id">ZXY_JOB_ID =
			#zxy_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_name">ZXY_NAME =
			#zxy_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_tel">ZXY_TEL =
			#zxy_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_job_id">YWY_JOB_ID =
			#ywy_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_name">YWY_NAME =
			#ywy_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jb_job_id">JB_JOB_ID =
			#jb_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jb_name">JB_NAME =
			#jb_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jb_tel">JB_TEL =
			#jb_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="province">PROVINCE =
			#province:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="city">CITY = #city:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="country">COUNTRY =
			#country:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="town">TOWN = #town:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_jb">MD_JB =
			#md_jb:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="kh_name">KH_NAME =
			#kh_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_shsdf_sn">R3_SHSDF_SN =
			#r3_shsdf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_sdf_sn">R3_SDF_SN =
			#r3_sdf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xszz">XSZZ = #xszz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_job_id">YWZG_JOB_ID =
			#ywzg_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_name">YWZG_NAME =
			#ywzg_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_tel">YWZG_TEL =
			#ywzg_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jbjl_job_id">JBJL_JOB_ID =
			#jbjl_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jbjl_name">JBJL_NAME =
			#jbjl_name:VARCHAR#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.eq_store_name">STORE_NAME =
			#map.eq_store_name:VARCHAR#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.filter_by_ywy_job_id_eq">
			(ywy_job_id =
			#map.filter_by_ywy_job_id_eq# or ywzg_job_id =
			#map.filter_by_ywy_job_id_eq# or jbjl_job_id =
			#map.filter_by_ywy_job_id_eq#)
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.store_name_like">STORE_NAME like '%'||
			#map.store_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.code_like">R3_CODE like '%'||
			#map.code_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_like">R3_CODE like '%'||
			#map.r3_code_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_null">R3_CODE is null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_not_null">R3_CODE is not null
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(
			ywy_job_id in (
			select job_id from konka_pe_prod_user u
			where u.dept_id in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
			<isNotEmpty prepend=" " property="map.filter_by_job_id_eq">
				or ywy_job_id = #map.filter_by_job_id_eq#
				or ywzg_job_id = #map.filter_by_job_id_eq#
				or jbjl_job_id = #map.filter_by_job_id_eq#
			</isNotEmpty>
			or dept_id = (select dept_id from konka_pe_prod_user where id =
			#map.session_user_id#)
			or jb_job_id in (select dept_id from konka_dept start with dept_id =
			#map.dept_id_start# connect by prior dept_id = par_id )
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ck_id">CK_ID = #ck_id:BIGINT#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ck_name">CK_NAME =
			#ck_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_level">STORE_LEVEL =
			#store_level:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="year_sale_count">YEAR_SALE_COUNT =
			#year_sale_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="business_area">BUSINESS_AREA =
			#business_area:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="tv_business_area">TV_BUSINESS_AREA =
			#tv_business_area:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="konka_site">KONKA_SITE =
			#konka_site:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="competitions">COMPETITIONS =
			#competitions:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_important">IS_IMPORTANT =
			#is_important:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">MEMO = #memo:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stop_date">STOP_DATE =
			#stop_date:TIMESTAMP#</isNotEmpty>
	</sql>

	<sql id="sf-konkaR3Store-t">
		<isNotEmpty prepend=" and " property="store_id">t.STORE_ID =
			#store_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">t.DEPT_NAME =
			#dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_code">t.R3_CODE =
			#r3_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_name">t.STORE_NAME like
			'%'|| #store_name:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">t.P_INDEX =
			#p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr">t.ADDR =
			#addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="linka_tel">t.LINKA_TEL =
			#linka_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_man">t.LINK_MAN =
			#link_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">t.ADD_DATE =
			#add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">t.IS_DEL =
			#is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mf_sn">t.MF_SN =
			#mf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_job_id">t.ZXY_JOB_ID =
			#zxy_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_name">t.ZXY_NAME =
			#zxy_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zxy_tel">t.ZXY_TEL =
			#zxy_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_job_id">t.YWY_JOB_ID =
			#ywy_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_name">t.YWY_NAME =
			#ywy_name:VARCHAR#</isNotEmpty>

		<!--促销员模糊查询 -->
		<isNotEmpty prepend=" and " property="map.zxy_name_like">dd.CXY_NAME like '%'||
			#map.zxy_name_like:VARCHAR# ||'%'</isNotEmpty>
		<!--业务销员模糊查询 -->
		<isNotEmpty prepend=" and " property="map.ywy_name_like">t.YWY_NAME like '%'||
			#map.ywy_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.ywy_user_name_like">uu.user_name like '%'||
			#map.ywy_user_name_like:VARCHAR# ||'%'</isNotEmpty>


		<isNotEmpty prepend=" and " property="jb_job_id">t.JB_JOB_ID =
			#jb_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jb_name">t.JB_NAME like '%'||
			#jb_name:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="jb_tel">t.JB_TEL =
			#jb_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="province">t.PROVINCE =
			#province:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="city">t.CITY =
			#city:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="country">t.COUNTRY =
			#country:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="town">t.TOWN =
			#town:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_jb">t.MD_JB =
			#md_jb:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="kh_name">t.KH_NAME =
			#kh_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_shsdf_sn">t.R3_SHSDF_SN =
			#r3_shsdf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_sdf_sn">t.R3_SDF_SN =
			#r3_sdf_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xszz">t.XSZZ =
			#xszz:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_job_id">t.YWZG_JOB_ID =
			#ywzg_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_name">t.YWZG_NAME =
			#ywzg_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywzg_tel">t.YWZG_TEL =
			#ywzg_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jbjl_job_id">t.JBJL_JOB_ID =
			#jbjl_job_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jbjl_name">t.JBJL_NAME =
			#jbjl_name:VARCHAR#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.filter_by_ywy_job_id_eq">
			(t.ywy_job_id = #map.filter_by_ywy_job_id_eq# or t.ywzg_job_id =
			#map.filter_by_ywy_job_id_eq# or t.jbjl_job_id =
			#map.filter_by_ywy_job_id_eq#
			<isNotEmpty prepend=" or " property="map.only_cxy">
				sr.seller_id =
				#map.only_cxy#
			</isNotEmpty>

			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.store_name_like">t.STORE_NAME like
			'%'|| #map.store_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.code_like">t.R3_CODE like '%'||
			#map.code_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_like">t.R3_CODE like '%'||
			#map.r3_code_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_null">t.R3_CODE is null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_not_null">t.R3_CODE is not null
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(
			t.ywy_job_id in (
			select job_id from konka_pe_prod_user u
			where u.dept_id in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
			<isNotEmpty prepend=" " property="map.filter_by_job_id_eq">
				or t.ywy_job_id =
				#map.filter_by_job_id_eq#
				or t.ywzg_job_id =
				#map.filter_by_job_id_eq#
				or t.jbjl_job_id =
				#map.filter_by_job_id_eq#
			</isNotEmpty>
			or t.dept_id = (select dept_id from konka_pe_prod_user where id =
			#map.session_user_id#)
			or t.jb_job_id in (select dept_id from konka_dept start with dept_id =
			#map.dept_id_start# connect by prior dept_id = par_id )
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ck_id">t.CK_ID =
			#ck_id:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ck_name">t.CK_NAME =
			#ck_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_level">t.STORE_LEVEL =
			#store_level:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="year_sale_count">t.YEAR_SALE_COUNT =
			#year_sale_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="business_area">t.BUSINESS_AREA =
			#business_area:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="tv_business_area">t.TV_BUSINESS_AREA =
			#tv_business_area:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="konka_site">t.KONKA_SITE =
			#konka_site:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="competitions">t.COMPETITIONS =
			#competitions:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_important">t.IS_IMPORTANT =
			#is_important:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">t.MEMO =
			#memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="stop_date">t.STOP_DATE =
			#stop_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="havaman">t.HAVAMAN =
			#havaman:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.kh_name_like">t.KH_NAME like '%'||
			#map.kh_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.link_man_like">
		    t.link_man like '%'||#map.link_man_like:VARCHAR# ||'%'
		</isNotEmpty>
	</sql>

	<select id="selectKonkaR3Store" resultMap="konkaR3StoreResult-edit" parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select t.*,u1.user_name as create_man,u2.user_name as modify_man from KONKA_R3_STORE t 
		left join konka_pe_prod_user u1 on t.CREATE_USER_ID=u1.id
		left join konka_pe_prod_user u2 on t.MODIFY_USER_ID=u2.id
		where 1 = 1
		<include refid="sf-konkaR3Store-t" />
	</select>

	<select id="selectKonkaR3StoreList" resultMap="konkaR3StoreResultForList"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_R3_STORE where 1 = 1
		<include refid="sf-konkaR3Store" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaR3StoreForYwyAndCxyList" resultMap="konkaR3StoreResultForYwyAndCxyList"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		SELECT (SELECT dept_name
		FROM konka_dept
		WHERE dept_id = t.dept_id)
		AS dept_name,
		t.STORE_NAME,
		decode (dd.CXY_NAME,
		NULL,
		'未维护',
		dd.CXY_NAME)
		AS cxy_name,
		decode (dd.CXY_PHONE,
		NULL,
		'未维护',
		dd.CXY_PHONE)
		AS cxy_phone,
		ee.USER_NAME as ywy_name,
		decode (ee.LINK_PHONE,
		NULL,
		decode(ee.LINK_TEL,null,'未维护',ee.LINK_TEL),
		ee.LINK_PHONE)
		AS ywy_phone
		FROM KONKA_R3_STORE t
		LEFT JOIN (SELECT bb.SHOP_ID,
		to_char (listagg (cc.user_name, ',')) AS cxy_name,
		to_char (
		listagg
		(decode(cc.LINK_PHONE,null,decode(cc.LINK_TEL,null,'未维护',cc.LINK_TEL),cc.LINK_PHONE),
		','))
		AS cxy_phone
		FROM Konka_Mobile_Sp_Relation bb
		LEFT JOIN
		konka_pe_prod_user cc
		ON bb.SELLER_ID = cc.ID
		WHERE cc.IS_DEL = 0 AND bb.SHOP_ID IS NOT NULL
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		LEFT JOIN konka_pe_prod_user ee
		ON t.YWY_JOB_ID = ee.JOB_ID
		LEFT JOIN MV_ORG_OF_CUSTOMER_ALL cus
		ON t.r3_code = cus.r3_code
		WHERE t.IS_DEL = 0 and 1 = 1
		<include refid="sf-konkaR3Store-t" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaR3StoreListWithYwyUserId" resultMap="konkaR3StoreResultWithKhName"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select t.*, t1.customer_name from konka_r3_store t
		left join
		konka_r3_shop t1 on t1.r3_code= t.r3_code
		where (t.YWY_JOB_ID in
		(select job_id from konka_pe_prod_user where id=#map.user_id:DECIMAL#)
		and t.is_del = 0)
		<isNotEmpty prepend=" or " property="map.ywy_job_id">(t.YWY_JOB_ID =
			#map.ywy_job_id# AND t.is_del = 0)</isNotEmpty>
		order by t.r3_code, t.store_name
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaR3StoreCount" resultClass="long"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select count(*) from KONKA_R3_STORE where 1 = 1
		<include refid="sf-konkaR3Store" />
	</select>

	<select id="selectKonkaR3StorePaginatedList" resultMap="konkaR3StoreResult"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_R3_STORE where 1 = 1
		<include refid="sf-konkaR3Store" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaR3StoreAndYwyNamePaginatedList"
		resultMap="konkaR3StoreAndYwyName" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT t.*,
		cus.PAR_CUSTOMER_TYPE_NAME as customer_type1,cus.CUSTOMER_TYPE_NAME as customer_type2,
		dd.cxy_name as cxy_name_all, dd.cxy_id as cxy_id_all, ee.REAL_NAME
		YWY_NAME
		FROM konka_r3_store t
		LEFT JOIN (SELECT bb.SHOP_ID, to_char(listagg(cc.user_name, ',')) AS
		cxy_name, to_char(listagg(cc.job_id, ',')) as cxy_id
		FROM Konka_Mobile_Sp_Relation bb LEFT JOIN konka_pe_prod_user cc ON
		bb.SELLER_ID = cc.ID
		where cc.IS_DEL = 0
		and bb.SHOP_ID is not null
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		left join KONKA_PE_PROD_USER ee
		on t.YWY_JOB_ID = ee.JOB_ID
		left join V_ORG_OF_CXY_ALL_BY_STORE cus on t.r3_code = cus.r3_code
		where 1 = 1
		<include refid="sf-konkaR3Store-t" />
		<isNotEmpty prepend=" and " property="map.customer_type1">cus.PAR_CUSTOMER_TYPE
			= #map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">cus.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>


	<!-- 门店销售信息表 开始 -->
	<select id="selectKonkaR3StoreSaleCount" resultClass="Long"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<![CDATA[  SELECT		 count(*)				FROM		    konka_r3_store t]]>
		LEFT JOIN MV_ORG_OF_CUSTOMER_ALL b
		ON t.r3_code = b.r3_code
		where 1=1
		<include refid="sf-konkaR3Store-t" />
		<isNotEmpty prepend=" and " property="map.customer_type1">b.PAR_CUSTOMER_TYPE =
			#map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">b.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>

	</select>

	<select id="selectKonkaR3StoreSalePaginatedList" resultMap="KonkaR3StoreSaleResult"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT
		t.*,
		b.DEPT_ID as ext_dept_id,
		b.DEPT_NAME as ext_dept_name,

		b.CUSTOMER_NAME as ext_customer_name,
		b.PAR_CUSTOMER_TYPE as ext_par_customer_type,
		b.PAR_CUSTOMER_TYPE_NAME as ext_par_customer_type_name,
		b.CUSTOMER_TYPE as ext_customer_type,
		b.CUSTOMER_TYPE_NAME as ext_customer_type_name,
		d.USER_NAME AS ext_ywy_name,
		e.cxy_name as ext_cxy_name,
		nvl(i.all_num,0) as all_num,
		nvl(i.all_price,0) as all_price,
		nvl(i.ytv_num,0) as ytv_num,
		nvl(i.ytv_price,0) as ytv_price,
		nvl(i.k_num,0) as k_num,
		nvl(i.k_price,0) as k_price,
		nvl(i.db_num,0) as db_num,
		nvl(i.db_price,0) as db_price,
		nvl(j.last_all_num,0) as last_all_num,
		nvl(j.last_all_price,0) as last_all_price,
		c.file_desc as file_desc,
		c.save_path as save_path
		FROM
		konka_r3_store t
		LEFT JOIN MV_ORG_OF_CUSTOMER_ALL b
		ON
		t.r3_code = b.r3_code
		LEFT JOIN
		(
		SELECT
		link_id,
		listagg(file_desc,',') AS file_desc,
		listagg(save_path,',') AS save_path
		FROM
		ATTACHMENT
		WHERE
		link_tab='KONKA_R3_STORE'
		AND del_mark =0
		GROUP BY
		link_id
		)
		c
		ON
		t.STore_id =c.link_id
		LEFT JOIN konka_pe_prod_user d
		ON
		t.YWY_JOB_ID=d.JOB_ID
		LEFT JOIN
		(
		SELECT
		bb.SHOP_ID,
		TO_CHAR(listagg(cc.user_name, ',')) AS cxy_name
		FROM
		Konka_Mobile_Sp_Relation bb
		LEFT JOIN konka_pe_prod_user cc
		ON
		bb.SELLER_ID = cc.ID
		WHERE
		cc.IS_DEL = 0
		AND bb.SHOP_ID IS NOT NULL
		GROUP BY
		bb.SHOP_ID
		)
		e
		ON
		t.store_id=e.shop_id
		LEFT JOIN
		(
		SELECT
		dept_id,
		SUM(all_num) AS all_num,
		SUM(all_price) AS all_price,
		SUM(ytv_num) AS ytv_num,
		SUM(ytv_price) AS ytv_price,
		SUM(k_num) AS k_num,
		SUM(k_price) AS k_price,
		SUM(db_num) AS db_num,
		SUM(db_price) AS db_price
		FROM
		(
		SELECT
		f.dept_id,
		f.num AS all_num,
		f.ALL_PRICE AS all_price,
		DECODE(NVL(g.IS_YTV,0),1,f.NUM,0) ytv_num,
		DECODE(NVL(g.IS_YTV,0),1,f.all_price,0) ytv_price,
		DECODE(NVL(g.IS_4K,0),1,f.NUM,0) k_num,
		DECODE(NVL(g.IS_4K,0),1,f.all_price,0) k_price,
					                 <![CDATA[    case when g.md_size >= 48 then f.num else 0 end as db_num, ]]>
					                 <![CDATA[   case when g.md_size >= 48 then f.all_price else 0 end as db_price ]]>
		FROM
		KONKA_MOBILE_SAIL_DATA f
		LEFT JOIN konka_pe_pd_model g
		ON
		f.MODEL_ID=g.PD_ID
		WHERE 1=1 and f.is_del=0
		<isNotEmpty prepend=" and " property="map.cur_date_begin"><![CDATA[ f.REPORT_DATE > to_date(#map.cur_date_begin# || '00:00:00','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.cur_date_end"><![CDATA[ f.REPORT_DATE < to_date(#map.cur_date_end# || '23:59:59','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
		) h
		GROUP BY
		h.dept_id
		)
		i
		ON
		t.STORE_ID= i.dept_id
		LEFT JOIN
		(
		SELECT
		dept_id ,
		SUM(num) AS last_all_num,
		SUM(all_price) AS last_all_price
		FROM
		KONKA_MOBILE_SAIL_DATA
		WHERE 1=1 and is_del=0
		<isNotEmpty prepend=" and " property="map.last_date_begin"><![CDATA[ REPORT_DATE > to_date(#map.last_date_begin# || '00:00:00','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.last_date_end"><![CDATA[ REPORT_DATE < to_date(#map.last_date_end# || '23:59:59','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
		GROUP BY
		dept_id
		) j
		ON t.store_id =j.dept_id
		where 1=1
		<include refid="sf-konkaR3Store-t" />
		<isNotEmpty prepend=" and " property="map.customer_type1">b.PAR_CUSTOMER_TYPE =
			#map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">b.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- 门店销售信息表结束 -->


	<!-- 门店管理中查询列表数据返回map -->
	<select id="selectKonkaR3StoreAndYwyNamePaginatedNew"
		resultClass="java.util.HashMap" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT
		t.P_INDEX,t.DEPT_NAME,STORE_NAME,STORE_ID,KH_NAME,t.R3_CODE,cus.PAR_CUSTOMER_TYPE_NAME
		as customer_type1,cus.CUSTOMER_TYPE_NAME as customer_type2,
		dd.cxy_name as cxy_name_all, dd.cxy_id as cxy_id_all,ee.REAL_NAME
		YWY_NAME,YWY_JOB_ID,JB_NAME,CK_NAME,R3_SDF_SN,MF_SN,HAVAMAN,t.is_del,t.ADDR
		FROM konka_r3_store t
		LEFT JOIN (SELECT bb.SHOP_ID, to_char(listagg(cc.user_name, ',')) AS
		cxy_name, to_char(listagg(cc.job_id, ',')) as cxy_id
		FROM Konka_Mobile_Sp_Relation bb LEFT JOIN konka_pe_prod_user cc ON
		bb.SELLER_ID = cc.ID
		where cc.IS_DEL = 0
		and bb.SHOP_ID is not null
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		left join KONKA_PE_PROD_USER ee
		on t.YWY_JOB_ID = ee.JOB_ID
		left join MV_ORG_OF_CUSTOMER_ALL cus on t.r3_code = cus.r3_code
		<isNotEmpty prepend=" " property="map.is_sure">
		   left join (select * from KONKA_AUDIT_LIST_INFO where LINK_TYPE='store' AND BACK_ID='1') a_info on a_info.link_id=t.STORE_ID
		</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.is_sure1">a_info.STATUS = 0</isNotEmpty>
		 <isNotEmpty prepend=" and " property="map.is_sure2">(a_info.STATUS != 0 or a_info.status is null)</isNotEmpty>
		<include refid="sf-konkaR3Store-t" />
		<isNotEmpty prepend=" and " property="map.customer_type1">cus.PAR_CUSTOMER_TYPE
			= #map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">cus.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!--手机端首页的终端列表 开始 -->
	<select id="selectKonkaR3StoreAndJbasePartnerForMainPage"
		resultClass="java.util.HashMap" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
	<![CDATA[ select tab1.*,]]>
	<![CDATA[	'http://qdgl.konka.com/webservice/KonkaR3Store.do?method=showTerminal&terminal_id='||tab1.TERMINAL_ID||'&terminal_type='||tab1.TERMINAL_TYPE]]>
		<isNotEmpty prepend="" property="map.terminal_position_x">
	<![CDATA[	||'&terminal_position_x='||#map.terminal_position_x# ]]>
		</isNotEmpty>
		<isNotEmpty prepend="" property="map.terminal_position_y">
	<![CDATA[	||'&terminal_position_y='||#map.terminal_position_y# ]]>
		</isNotEmpty>
	<![CDATA[ as terminal_url,]]>
		nvl((SELECT SUM(NUM) NUM FROM
		KONKA_MOBILE_SAIL_DATA a WHERE DEPT_ID=TAB1.TERMINAL_ID
		 AND a.REPORT_DATE >= sysdate - 1 YEAR
       AND a.STATUS = 0
		<isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[report_date>=to_date(#map.begin_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[report_date<=to_date(#map.end_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		),0) as terminal_salenum
		from
		(select a.store_id as terminal_id,a.store_name as terminal_name,a.linka_tel
		as terminal_tel,1 as terminal_type,
		'KONKA_R3_STORE' as
		terminal_table,a.MEMO as terminal_memo,
		tab2.position_x as
		terminal_position_x,
		tab2.position_y as terminal_position_y,
		tab2.addr
		as terminal_addr,
		ffa.save_path as terminal_photo
		<isNotEmpty  prepend="" property="map.order_by_distinct">
		,(power((#map.terminal_position_x:Decinal# - tab2.position_x),2) + power((#map.terminal_position_y:Decinal# - tab2.position_y),2)) as distinc
		</isNotEmpty>
		from konka_r3_store a
		left join
		konka_mobile_cust_visit_gps tab2
		on a.store_id=tab2.LINK_ID and
		tab2.LINK_TAB = 'KONKA_R3_STORE'
		left join 
		<![CDATA[(select	link_id,link_tab,listagg('http://qdgl.konka.com/'||f.save_path, ',')   within group (order by	f.LINK_ID) as save_path]]>
		<![CDATA[	from ATTACHMENT f where f.LINK_TAB ='KONKA_R3_STORE' and f.DEL_MARK =0 ]]>
		group by LINK_ID,link_tab) ffa on ffa.link_id=a.store_id
		where a.IS_DEL =0
		<isNotEmpty prepend=" and " property="map.terminal_name_like">
		 a.store_name like  '%' || #map.terminal_name_like# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_code">
		 a.P_INDEX like   #map.p_index_code# || '%'
		</isNotEmpty>
            and tab2.position_x is not null and tab2.position_y is not null
		union
		select b.partner_id as terminal_id,b.partner_name as
		terminal_name,b.link_tel as terminal_tel,
		2 as terminal_type,
		'J_BASE_PARTNER' as terminal_table,
		b.MEMO as terminal_memo,
		tab0.position_x as terminal_position_x,
		tab0.position_y as
		terminal_position_y,
		tab0.addr as terminal_addr,
		ffb.save_path as terminal_photo
		<isNotEmpty  prepend="" property="map.order_by_distinct">
		,(power((#map.terminal_position_x:Decinal# - tab0.position_x),2)+power((#map.terminal_position_y:Decinal# - tab0.position_y),2)) as distinc
		</isNotEmpty>
		from J_BASE_PARTNER b
		left join
		konka_mobile_cust_visit_gps tab0
		on b.partner_id =tab0.LINK_ID and tab0.LINK_TAB ='J_BASE_PARTNER'
		left join 
		<![CDATA[(select	link_id,link_tab,listagg('http://qdgl.konka.com/'||f.save_path, ',')  within group (order by	f.LINK_ID) as save_path]]>
		from ATTACHMENT f where f.LINK_TAB ='J_BASE_PARTNER' and f.DEL_MARK =0
		group by LINK_ID,link_tab) ffb on ffb.link_id=b.partner_id
		where
		b.IS_DEL =0
		<isNotEmpty prepend=" and " property="map.terminal_name_like">
		 b.PARTNER_name like  '%' || #map.terminal_name_like# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_code">
		b.AREA_CODE like #map.p_index_code# || '%'
		</isNotEmpty>
		  and tab0.position_x is not null and tab0.position_y is not null) tab1
		where 1=1
		<isNotEmpty prepend=" and " property="map.terminal_id">tab1.terminal_id =
			#map.terminal_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.max_termianl_id"><![CDATA[tab1.terminal_id > #map.max_termianl_id:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.min_termianl_id"><![CDATA[tab1.terminal_id < #map.min_termianl_id:DECIMAL#]]></isNotEmpty>

		<isNotEmpty prepend=" and " property="map.min_position_y"><![CDATA[tab1.terminal_position_y > #map.min_position_y:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.min_position_x"><![CDATA[tab1.terminal_position_x > #map.min_position_x:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.max_position_y"><![CDATA[tab1.terminal_position_y < #map.max_position_y:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.max_position_x"><![CDATA[tab1.terminal_position_x < #map.max_position_x:DECIMAL#]]></isNotEmpty>
		  <![CDATA[and	rownum >= #map.first_row# and rownum <= #map.last_row#  ]]>
		     <isNotEmpty  prepend=" " property="map.order_by_distinct">
		      order by tab1.distinc 
		       </isNotEmpty> 
		     <isNotEmpty  prepend=" " property="map.order_by_salenum">
		      	 order by terminal_salenum desc
		       </isNotEmpty>
	</select>
	<!--手机端首页的终端列表 结束 -->


	<!--手机端首页的终端修改 开始 -->
	<select id="selectKonkaR3StoreAndJbasePartnerForManager"
		resultClass="java.util.HashMap" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
	<![CDATA[ select tab1.*,tab3.SAVE_PATH as terminal_photo,]]>
	<![CDATA[	'http://qdgl.konka.com/webservice/KonkaR3Store.do?method=managerTerminal&terminal_id='||tab1.TERMINAL_ID||'&terminal_type='||tab1.TERMINAL_TYPE as terminal_url,]]>
		nvl((SELECT SUM(ALL_PRICE) NUM FROM KONKA_MOBILE_SAIL_DATA WHERE
		DEPT_ID=TAB1.TERMINAL_ID
		<isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[report_date>=to_date(#map.begin_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[report_date<=to_date(#map.end_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		),0) as terminal_salemoney,
		nvl((SELECT SUM(NUM) NUM FROM
		KONKA_MOBILE_SAIL_DATA WHERE DEPT_ID=TAB1.TERMINAL_ID
		<isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[report_date>=to_date(#map.begin_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[report_date<=to_date(#map.end_date:VARCHAR#,'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>

		),0) as terminal_salenum
		from (select distinct * from(
		<![CDATA[SELECT jbase.partner_id as terminal_id,jbase.partner_name as terminal_name,jbase.link_tel as terminal_tel,2 as terminal_type,
		'J_BASE_PARTNER' as terminal_table,
		tab12.position_x as terminal_position_x,
		tab12.position_y as terminal_position_y,
		tab12.addr as terminal_addr,
		
		jbase.MEMO as terminal_memo]]>
		FROM J_BASE_PARTNER jbase
		left join
		konka_mobile_cust_visit_gps tab12
		on jbase.partner_id =tab12.LINK_ID and tab12.LINK_TAB ='J_BASE_PARTNER'
		LEFT JOIN
		KONKA_PE_PROD_USER us
		ON jbase.YWY_JOB_ID = us.JOB_ID
		where jbase.IS_DEL=0 and jbase.YWY_JOB_ID is not null and us.JOB_ID is not
		null
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(us.dept_id is not
			null and us.dept_id in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id:DECIMAL#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
		   <![CDATA[ (us.id = #map.filter_by_ywy_id_eq# or jbase.ywy_job_id = (select job_id from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2))]]>
		</isNotEmpty>
		union
	<![CDATA[select partner_id as terminal_id,partner_name as terminal_name,link_tel as terminal_tel,2 as terminal_type,
		'J_BASE_PARTNER' as terminal_table,
		
		tab10.position_x as terminal_position_x,
		tab10.position_y as terminal_position_y,
		tab10.addr as terminal_addr,
		
		MEMO as terminal_memo]]>
		from J_BASE_PARTNER j
		left join
		konka_mobile_cust_visit_gps tab10
		on j.partner_id =tab10.LINK_ID and tab10.LINK_TAB ='J_BASE_PARTNER'
		where is_del=0 and par_c_id in (
		select a.id
		from KONKA_R3_SHOP a

		left join MV_ORG_OF_CUSTOMER ee on ee.konka_r3_id= a.id
		where a.IS_DEL=0
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(ee.YWY_DEPT_ID is not
			null and ee.YWY_DEPT_ID in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id:DECIMAL#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
		   <![CDATA[ (ee.user_id = #map.filter_by_ywy_id_eq# or ee.YWY_DEPT_ID = (select DEPT_ID from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2))]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.cust_type">
			a.shop_status in
			<iterate close=")" open="(" conjunction="," property="map.cust_type">#map.cust_type[]#
			</iterate>
		</isNotEmpty>
		)
		union
		select * from (
	<![CDATA[SELECT t.store_id as terminal_id,t.store_name as terminal_name,t.linka_tel as terminal_tel,1 as terminal_type,
		'KONKA_R3_STORE' as terminal_table,
		tab2.position_x as terminal_position_x,
		tab2.position_y as terminal_position_y,
		tab2.addr as terminal_addr,
		t.MEMO as terminal_memo]]>
		FROM konka_r3_store t
		left join
		konka_mobile_cust_visit_gps tab2
		on t.store_id =tab2.LINK_ID and tab2.LINK_TAB ='KONKA_R3_STORE'
		LEFT JOIN MV_ORG_OF_CUSTOMER_ALL ee
		ON t.r3_code = ee.r3_code
		LEFT JOIN KONKA_R3_SHOP shop
		ON shop.R3_CODE = t.R3_CODE
		left join KONKA_MOBILE_SP_RELATION sp_relation
        on t.STORE_ID=sp_relation.SHOP_ID
		WHERE t.IS_DEL = 0
		<isNotEmpty prepend=" and " property="map.cust_type">
			shop.shop_status in
			<iterate close=")" open="(" conjunction="," property="map.cust_type">#map.cust_type[]#
			</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			((ee.cur_dept_id is not
			null and ee.cur_dept_id in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
			or t.YWY_JOB_ID in(
			     SELECT job_id FROM KONKA_PE_PROD_USER WHERE job_id is not null and  DEPT_ID in(
		               select dept_id from konka_dept start with dept_id in (
						SELECT DISTINCT (dept_id)
						FROM KONKA_ROLE_DATA_LEVEL
						WHERE role_id IN (SELECT role_id
						FROM KONKA_PE_ROLE_USER
						WHERE user_id = #map.session_user_id#)
						) or dept_id = #map.dept_id_start#
						connect by prior dept_id = par_id
					)
			 )
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			<![CDATA[ (ee.user_id = #map.filter_by_ywy_id_eq# or t.ywy_job_id = (select job_id from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2) or sp_relation.SELLER_ID = #map.filter_by_ywy_id_eq#)]]>
		</isNotEmpty>
		order by t.store_name))
		) tab1

		left join 
	<![CDATA[(select	link_id,link_tab,listagg('http://qdgl.konka.com/'||f.save_path, ',')  within group (order by	f.LINK_ID) as save_path]]>
		from ATTACHMENT f where f.LINK_TAB in
		('J_BASE_PARTNER','KONKA_R3_STORE') and f.DEL_MARK =0
		group by LINK_ID,link_tab)
		tab3 on tab1.TERMINAL_ID=tab3.LINK_ID and
		tab1.TERMINAL_TABLE=tab3.LINK_TAB
		where 1=1
		<isNotEmpty prepend=" and " property="map.terminal_id">tab1.terminal_id =
			#map.terminal_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.max_terminal_id"><![CDATA[tab1.terminal_id > #map.max_terminal_id:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.min_terminal_id"><![CDATA[tab1.terminal_id < #map.min_terminal_id:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.first_row">
		       <![CDATA[ rownum >= #map.first_row# ]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.last_row">
		     <![CDATA[    rownum <= #map.last_row#  ]]>
		</isNotEmpty>
	</select>
	<!--手机端首页的终端修改 结束 -->

	<!-- 管理端-门店管理中统计查询数量 -->
	<select id="selectKonkaR3StoreAndYwyNameCount" resultClass="long"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select count(*) from (
		SELECT distinct t.*, dd.cxy_name,dd.cxy_id
		FROM konka_r3_store t left join Konka_Mobile_Sp_Relation sr on t.store_id
		=sr.shop_id
		LEFT JOIN
		(SELECT bb.SHOP_ID,
		to_char (listagg (cc.user_name, ',')) AS cxy_name,
		to_char(listagg (cc.job_id, ',')) as cxy_id
		FROM Konka_Mobile_Sp_Relation bb
		LEFT JOIN
		konka_pe_prod_user cc
		ON bb.SELLER_ID = cc.ID
		where cc.IS_DEL = 0 and bb.SHOP_ID is not null
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		left join konka_r3_shop shop on t.r3_code = shop.r3_code 
		left join (select * from KONKA_AUDIT_LIST_INFO where LINK_TYPE='store' AND BACK_ID='1') a_info on a_info.link_id=t.STORE_ID
		left join konka_pe_prod_user uu on uu.job_id=t.ywy_job_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.is_sure1">a_info.STATUS = 0</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_sure2">(a_info.STATUS != 0 or a_info.status is null)</isNotEmpty>
		<include refid="sf-konkaR3Store-t" />
		<isNotEmpty prepend=" and " property="map.customer_type1">
		    shop.CUSTOMER_TYPE in (SELECT C_INDEX FROM konka_category WHERE PAR_INDEX = #map.customer_type1#)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">
		    shop.CUSTOMER_TYPE = #map.customer_type2#
		</isNotEmpty>
		)
	</select>
	
	<!-- 客户端-我的门店中统计查询数量 -->
	<select id="selectStoreDataCountForVIP" resultClass="long" parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select count(*) from (
			SELECT distinct(t.store_id) FROM konka_r3_store t 
			left join Konka_Mobile_Sp_Relation sr on t.store_id=sr.shop_id
			LEFT JOIN (
				SELECT bb.SHOP_ID,to_char (listagg (cc.user_name, ',')) AS cxy_name,to_char(listagg (cc.job_id, ',')) as cxy_id FROM Konka_Mobile_Sp_Relation bb
				LEFT JOIN konka_pe_prod_user cc ON bb.SELLER_ID = cc.ID where cc.IS_DEL = 0 and bb.SHOP_ID is not null GROUP BY bb.SHOP_ID
			) dd ON t.STORE_ID = dd.SHOP_ID
			left join konka_r3_shop shop on t.r3_code = shop.r3_code 
			left join (select * from KONKA_AUDIT_LIST_INFO where LINK_TYPE='store' AND BACK_ID='1') a_info on a_info.link_id=t.STORE_ID
			left join konka_pe_prod_user uu on uu.job_id=t.ywy_job_id
			where 1 = 1
			<include refid="sf-konkaR3Store-t" />
			<isNotEmpty prepend=" and " property="map.is_sure1">a_info.STATUS = 0</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.is_sure2">(a_info.STATUS != 0 or a_info.status is null)</isNotEmpty>
		)
	</select>
	
	<!-- 客户端-我的门店中查询列表数据 -->
	<select id="selectStoreDataListForVIP" resultClass="java.util.HashMap" parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		    SELECT distinct t.dept_name,t.store_name,t.store_id,uu.user_name ywy_name, dd.cxy_name,t.link_man,t.linka_tel,t.YEAR_SALE_COUNT,t.BUSINESS_AREA,
			t.tv_business_area, t.ck_name,t.mf_sn,t.PROVINCE,t.CITY,t.COUNTRY,t.TOWN,t.addr,t.is_del,a_info.status,t.add_date,t.modify_date,c_u.user_name create_name,m_u.user_name modify_name  FROM konka_r3_store t 
			left join Konka_Mobile_Sp_Relation sr on t.store_id=sr.shop_id
			LEFT JOIN (
				SELECT bb.SHOP_ID,to_char (listagg (cc.user_name, ',')) AS cxy_name,to_char(listagg (cc.job_id, ',')) as cxy_id FROM Konka_Mobile_Sp_Relation bb
				LEFT JOIN konka_pe_prod_user cc ON bb.SELLER_ID = cc.ID where cc.IS_DEL = 0 and bb.SHOP_ID is not null GROUP BY bb.SHOP_ID
			) dd ON t.STORE_ID = dd.SHOP_ID
			left join konka_r3_shop shop on t.r3_code = shop.r3_code 
			left join (select * from KONKA_AUDIT_LIST_INFO where LINK_TYPE='store' AND BACK_ID='1') a_info on a_info.link_id=t.STORE_ID
			left join konka_pe_prod_user uu on uu.job_id=t.ywy_job_id
			left join konka_pe_prod_user c_u on c_u.id=t.create_user_id
			left join konka_pe_prod_user m_u on m_u.id=t.modify_user_id
			where 1 = 1
			<include refid="sf-konkaR3Store-t" />
			<isNotEmpty prepend=" and " property="map.is_sure1">a_info.STATUS = 0</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.is_sure2">(a_info.STATUS != 0 or a_info.status is null)</isNotEmpty>
		order by t.MODIFY_DATE desc,t.ADD_DATE desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>





	<select id="selectKonkaR3StoreForRoleDataPaginatedList"
		resultMap="konkaR3StoreResult" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_R3_STORE a
		<isNotEmpty prepend=" " property="map.is_not_admin">
			LEFT JOIN MV_ORG_OF_CUSTOMER b ON a.R3_CODE = b.R3_CODE
		</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" " property="map.is_not_admin">
			and b.CUR_DEPT_ID is not null
			<isNotEmpty prepend=" and " property="map.fgs_user_id">
				( b.cur_dept_id in( SELECT DISTINCT (dept_id)
				FROM KONKA_ROLE_DATA_LEVEL
				WHERE role_id IN (SELECT role_id
				FROM KONKA_PE_ROLE_USER
				WHERE user_id = #map.fgs_user_id#))
				or b.cur_dept_id = #map.cur_dept_id#)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.ywy_user_id">
				b.user_id = #map.ywy_user_id#
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL =
			#is_del:DECIMAL#</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>


	<!-- 门店管理中统计查询数量 -->
	<select id="selectKonkaR3StoreOnlyByCxyCount" resultClass="long"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select count(*) from (
		SELECT t.*, dd.cxy_name,dd.cxy_id
		FROM Konka_Mobile_Sp_Relation sr left join konka_r3_store t on t.store_id
		=sr.shop_id
		LEFT JOIN
		(SELECT bb.SHOP_ID,
		to_char (listagg (cc.user_name, ',')) AS cxy_name,
		to_char(listagg (cc.job_id, ',')) as cxy_id
		FROM Konka_Mobile_Sp_Relation bb
		LEFT JOIN
		konka_pe_prod_user cc
		ON bb.SELLER_ID = cc.ID
		where cc.IS_DEL = 0 and bb.SHOP_ID is not null
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		left join V_ORG_OF_CXY_ALL_BY_STORE cus on t.r3_code = cus.r3_code

		where 1 = 1
		<include refid="sf-konkaR3Store-t" />
		<!-- isNotEmpty prepend=" and " property="map.only_cxy">sr.seller_id= #map.only_cxy#</isNotEmpty -->
		<isNotEmpty prepend=" and " property="map.customer_type1">cus.PAR_CUSTOMER_TYPE
			= #map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">cus.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>
		)
	</select>

	<select id="selectKonkaR3StoreOnlyByCxyPaginatedList"
		resultClass="java.util.HashMap" parameterClass="konkaR3Store"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT
		t.P_INDEX,t.DEPT_NAME,STORE_NAME,STORE_ID,KH_NAME,t.R3_CODE,cus.PAR_CUSTOMER_TYPE_NAME
		as customer_type1,cus.CUSTOMER_TYPE_NAME as customer_type2,
		dd.cxy_name as cxy_name_all, dd.cxy_id as cxy_id_all,ee.REAL_NAME
		YWY_NAME,YWY_JOB_ID,JB_NAME,CK_NAME,R3_SDF_SN,MF_SN,HAVAMAN,t.is_del,t.ADDR
		FROM Konka_Mobile_Sp_Relation sr left join konka_r3_store t on
		t.store_id =sr.shop_id
		LEFT JOIN (SELECT bb.SHOP_ID, to_char(listagg(cc.user_name, ',')) AS
		cxy_name, to_char(listagg(cc.job_id, ',')) as cxy_id
		FROM Konka_Mobile_Sp_Relation bb LEFT JOIN konka_pe_prod_user cc ON
		bb.SELLER_ID = cc.ID
		where cc.IS_DEL = 0
		and bb.SHOP_ID is not null
		GROUP BY bb.SHOP_ID) dd
		ON t.STORE_ID = dd.SHOP_ID
		left join KONKA_PE_PROD_USER ee
		on t.YWY_JOB_ID = ee.JOB_ID
		left join V_ORG_OF_CXY_ALL_BY_STORE cus on t.r3_code = cus.r3_code

		where 1 = 1
		<include refid="sf-konkaR3Store-t" />
		<!-- isNotEmpty prepend=" and " property="map.only_cxy">sr.seller_id= #map.only_cxy#</isNotEmpty -->
		<isNotEmpty prepend=" and " property="map.customer_type1">cus.PAR_CUSTOMER_TYPE
			= #map.customer_type1#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_type2">cus.CUSTOMER_TYPE =
			#map.customer_type2#</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>


	<select id="selectKonkaR3StoreForRoleDataCount" resultClass="long"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select count(1) from KONKA_R3_STORE a
		<isNotEmpty prepend=" " property="map.is_not_admin">
			LEFT JOIN MV_ORG_OF_CUSTOMER b ON a.R3_CODE = b.R3_CODE
		</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" " property="map.is_not_admin">
			and b.CUR_DEPT_ID is not null
			<isNotEmpty prepend=" and " property="map.fgs_user_id">
				( b.cur_dept_id in( SELECT DISTINCT (dept_id)
				FROM KONKA_ROLE_DATA_LEVEL
				WHERE role_id IN (SELECT role_id
				FROM KONKA_PE_ROLE_USER
				WHERE user_id = #map.fgs_user_id#))
				or b.cur_dept_id = #map.cur_dept_id#)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.ywy_user_id">
				b.user_id = #map.ywy_user_id#
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL =
			#is_del:DECIMAL#</isNotEmpty>
	</select>


	<!-- Liu,ZhiXiang 2013-09-25 根据p_index查询所能获取到的门店数量 -->
	<select id="selectKonkaR3StoreCountByPIndex" resultMap="konkaR3StoreResultCountByPIndex"
		parameterClass="konkaR3Store">
		select aa.* from
		(
		SELECT
		<isNotEmpty prepend=" " property="map.group_town">
			a.P_INDEX as p_index,
			(select bp.p_name from KONKA_BASE_PROVINCE_LIST_FOUR bp where bp.p_index =
			a.P_INDEX) as p_name,
		</isNotEmpty>
		<isEmpty prepend=" " property="map.group_town">
			<isNotEmpty prepend=" " property="map.group_country">
				substr(a.P_INDEX,1,6) as p_index,
				(select bp.p_name from KONKA_BASE_PROVINCE_LIST_FOUR bp where bp.p_index =
				substr(a.P_INDEX,1,6)) as p_name,
			</isNotEmpty>
			<isEmpty prepend=" " property="map.group_country">
				<isNotEmpty prepend=" " property="map.group_city">
					substr(a.P_INDEX,1,4)||'00' as p_index,
					(select bp.p_name from KONKA_BASE_PROVINCE_LIST_FOUR bp where bp.p_index =
					substr(a.P_INDEX,1,4)||'00') as p_name,
				</isNotEmpty>
				<isEmpty prepend=" " property="map.group_city">
					<isNotEmpty prepend=" " property="map.group_province">
						substr(a.P_INDEX,1,2)||'0000' as p_index,
						(select bp.p_name from KONKA_BASE_PROVINCE_LIST_FOUR bp where bp.p_index
						= substr(a.P_INDEX,1,2)||'0000') as p_name,
					</isNotEmpty>
					<isEmpty prepend=" " property="map.group_province">
						a.P_INDEX as p_index,
						(select bp.p_name from KONKA_BASE_PROVINCE_LIST_FOUR bp where bp.p_index
						= a.P_INDEX) as p_name,
					</isEmpty>
				</isEmpty>
			</isEmpty>
		</isEmpty>

		count(a.store_id) as num
		FROM KONKA_R3_STORE a
		where a.IS_DEL = 0 and a.P_INDEX is not null
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.town">a.P_INDEX = #map.town#
		</isNotEmpty>
		<isEmpty prepend=" " property="map.town">
			<isNotEmpty prepend=" and " property="map.country">a.P_INDEX like
				substr(#map.country#,1,6) || '%'</isNotEmpty>
			<isEmpty prepend=" " property="map.country">
				<isNotEmpty prepend=" and " property="map.city">a.P_INDEX like
					substr(#map.city#,1,4) || '%'</isNotEmpty>
				<isEmpty prepend=" " property="map.city">
					<isNotEmpty prepend=" and " property="map.province">a.P_INDEX like
						substr(#map.province#,1,2) || '%'</isNotEmpty>
				</isEmpty>
			</isEmpty>
		</isEmpty>

		<isNotEmpty prepend=" and " property="map.province_ne">a.P_INDEX !=
			#map.province_ne#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.city_ne">a.P_INDEX !=
			#map.city_ne#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.country_ne">a.P_INDEX !=
			#map.country_ne#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.add_date_start"><![CDATA[a.ADD_DATE >= to_date(#map.add_date_start#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_end"><![CDATA[a.ADD_DATE <= to_date(#map.add_date_end#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>

		<isNotEmpty prepend=" and " property="map.sale_money_gt"><![CDATA[ a.store_id in (select cc.store_id from (select c.dept_id as store_id,value(sum(c.ALL_PRICE),0) as sale_money from KONKA_MOBILE_SAIL_DATA c where to_char(c.sale_date,'yyyy') = to_char(sysdate,'yyyy') group by c.dept_id) cc where cc.sale_money > #map.sale_money_gt#*10000) ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sale_money_lt"><![CDATA[ a.store_id in (select cc.store_id from (select c.dept_id as store_id,value(sum(c.ALL_PRICE),0) as sale_money from KONKA_MOBILE_SAIL_DATA c where to_char(c.sale_date,'yyyy') = to_char(sysdate,'yyyy') group by c.dept_id) cc where cc.sale_money < #map.sale_money_lt#*10000) ]]></isNotEmpty>

		<isNotEmpty prepend=" " property="map.group_town">GROUP BY a.P_INDEX
		</isNotEmpty>
		<isEmpty prepend=" " property="map.group_town">
			<isNotEmpty prepend=" " property="map.group_country">GROUP BY
				substr(a.P_INDEX,1,6)</isNotEmpty>
			<isEmpty prepend=" " property="map.group_country">
				<isNotEmpty prepend=" " property="map.group_city">GROUP BY
					substr(a.P_INDEX,1,4)</isNotEmpty>
				<isEmpty prepend=" " property="map.group_city">
					<isNotEmpty prepend=" " property="map.group_province">GROUP BY
						substr(a.P_INDEX,1,2)</isNotEmpty>
				</isEmpty>
			</isEmpty>
		</isEmpty>
		) aa order by aa.num desc
	</select>

	<!-- Liu,ZhiXiang 2013-09-25 根据p_index查询所能获取到的门店零售额 -->
	<select id="selectKonkaR3StoreListByPIndex" resultMap="konkaR3StoreResultListByPIndex"
		parameterClass="konkaR3Store">
		select aa.* from
		(
		SELECT a.store_id,
		a.store_name,
		value (sum (b.ALL_PRICE), 0) AS sale_money
		FROM KONKA_R3_STORE a
		LEFT JOIN KONKA_MOBILE_SAIL_DATA b
		ON a.store_id = b.dept_id AND b.IS_DEL = 0
		<isNotEmpty prepend=" and " property="map.sale_money_gt">to_char(b.sale_date,'yyyy')
			= to_char(sysdate,'yyyy')</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sale_money_lt">to_char(b.sale_date,'yyyy')
			= to_char(sysdate,'yyyy')</isNotEmpty>
		where a.IS_DEL = 0
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID =
			#dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.town">a.P_INDEX = #map.town#
		</isNotEmpty>
		<isEmpty prepend=" " property="map.town">
			<isNotEmpty prepend=" and " property="map.country">a.P_INDEX like
				substr(#map.country#,1,6) || '%'</isNotEmpty>
			<isEmpty prepend=" " property="map.country">
				<isNotEmpty prepend=" and " property="map.city">a.P_INDEX like
					substr(#map.city#,1,4) || '%'</isNotEmpty>
				<isEmpty prepend=" " property="map.city">
					<isNotEmpty prepend=" and " property="map.province">a.P_INDEX like
						substr(#map.province#,1,2) || '%'</isNotEmpty>
				</isEmpty>
			</isEmpty>
		</isEmpty>

		<isNotEmpty prepend=" and " property="map.add_date_start"><![CDATA[a.ADD_DATE >= to_date(#map.add_date_start#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_end"><![CDATA[a.ADD_DATE <= to_date(#map.add_date_end#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>

		GROUP BY a.store_id, a.store_name) aa where 1 = 1
		<isNotEmpty prepend=" and " property="map.sale_money_gt"><![CDATA[ aa.sale_money > #map.sale_money_gt#*10000 ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sale_money_lt"><![CDATA[ aa.sale_money < #map.sale_money_lt#*10000 ]]></isNotEmpty>
	</select>

	<resultMap id="konkaR3StoreResultForStores" class="konkaR3Store">
		<result column="STORE_NAMES" property="map.store_names"
			jdbcType="VARCHAR" />
	</resultMap>

	<select id="selectKonkaR3StoreForStoresList" resultMap="konkaR3StoreResultForStores"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select to_char (listagg (store_name, ',')) AS store_names from
		konka_r3_store where store_id in ($map.store_values$)
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<resultMap id="konkaR3StoreForCustVisitList" class="konkaR3Store">
		<result column="STORE_ID" property="store_id" jdbcType="DECIMAL" />
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 业务通获取终端名称 -->
	<select id="selectkonkaR3StoreForCustVisit" resultMap="konkaR3StoreForCustVisitList"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		select * from (
		SELECT store.STORE_ID, store.STORE_NAME
			  FROM KONKA_R3_STORE store
			       LEFT JOIN KONKA_PE_PROD_USER us
			          ON store.YWY_JOB_ID = us.JOB_ID
			       LEFT JOIN V_ORG_OF_CUSTOMER_STATE shop
			          ON store.R3_CODE = shop.R3_CODE
			 WHERE 1 = 1
			 <isEmpty  prepend=" and " property="map.default">store.IS_DEL = 0</isEmpty>
			 <isNotEmpty prepend=" and " property="map.dept_id_start">
			        (us.DEPT_ID IN
			              (SELECT dept_id
			                 FROM konka_dept
			               START WITH dept_id IN
			                             (SELECT DISTINCT (dept_id)
			                                FROM KONKA_ROLE_DATA_LEVEL
			                               WHERE role_id IN (SELECT role_id
			                                                   FROM KONKA_PE_ROLE_USER
			                                                  WHERE user_id = #map.session_user_id:DECIMAL#))
			                          OR dept_id = #map.dept_id_start#
			               CONNECT BY PRIOR dept_id = par_id)
			         OR
			         shop.CUR_DEPT_ID IN
			              (SELECT dept_id
			                 FROM konka_dept
			               START WITH dept_id IN
			                             (SELECT DISTINCT (dept_id)
			                                FROM KONKA_ROLE_DATA_LEVEL
			                               WHERE role_id IN (SELECT role_id
			                                                   FROM KONKA_PE_ROLE_USER
			                                                  WHERE user_id = #map.session_user_id:DECIMAL#))
			                          OR dept_id = #map.dept_id_start#
			               CONNECT BY PRIOR dept_id = par_id))     
			 </isNotEmpty>
<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			<![CDATA[ ((us.id = #map.filter_by_ywy_id_eq# or store.ywy_job_id = (select job_id from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2))OR (shop.USER_ID = #map.filter_by_ywy_id_eq#))
			]]>
		</isNotEmpty>			
<isNotEmpty prepend=" and " property="map.cust_type">
					shop.shop_status in
					<iterate close=")" open="(" conjunction="," property="map.cust_type">#map.cust_type[]#</iterate>
				 </isNotEmpty>
			UNION
			SELECT jbase.PARTNER_ID || '191919' AS store_id,
			       '[' || jbase.p_level || '级]' || jbase.PARTNER_NAME AS store_name
			  FROM J_BASE_PARTNER jbase
			       LEFT JOIN KONKA_PE_PROD_USER us
			          ON jbase.YWY_JOB_ID = us.JOB_ID
			       LEFT JOIN V_ORG_OF_CUSTOMER_STATE shop
			          ON shop.KONKA_R3_ID = jbase.C_ID
			 WHERE 1 = 1 and PARTNER_TYPE=1 and PARTNER_OBJ=1 
			 <isEmpty  prepend=" and " property="map.default">jbase.IS_DEL = 0</isEmpty>
			  <isNotEmpty prepend=" and " property="map.dept_id_start">
			       (us.DEPT_ID IN
			              (SELECT dept_id
			                 FROM konka_dept
			               START WITH dept_id IN
			                             (SELECT DISTINCT (dept_id)
			                                FROM KONKA_ROLE_DATA_LEVEL
			                               WHERE role_id IN (SELECT role_id
			                                                   FROM KONKA_PE_ROLE_USER
			                                                  WHERE user_id = #map.session_user_id:DECIMAL#))
			                          OR dept_id = #map.dept_id_start#
			               CONNECT BY PRIOR dept_id = par_id)
			        OR        
			        shop.CUR_DEPT_ID IN
			              (SELECT dept_id
			                 FROM konka_dept
			               START WITH dept_id IN
			                             (SELECT DISTINCT (dept_id)
			                                FROM KONKA_ROLE_DATA_LEVEL
			                               WHERE role_id IN (SELECT role_id
			                                                   FROM KONKA_PE_ROLE_USER
			                                                  WHERE user_id = #map.session_user_id:DECIMAL#))
			                          OR dept_id = #map.dept_id_start#
			               CONNECT BY PRIOR dept_id = par_id)
			               )
			     </isNotEmpty>
			     <isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			<![CDATA[ ((us.id = #map.filter_by_ywy_id_eq# or jbase.ywy_job_id = (select job_id from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2))OR (shop.USER_ID = #map.filter_by_ywy_id_eq#))]]>
		</isNotEmpty>	
			     <isNotEmpty prepend=" and " property="map.cust_type">
					shop.shop_status in
					<iterate close=")" open="(" conjunction="," property="map.cust_type">#map.cust_type[]#</iterate>
				 </isNotEmpty>
		)group by store_id,store_name
	</select>

	<!-- 找用户相关的门店信息 -->
	<select id="selectkonkaR3StoreForCustVisit1" resultMap="konkaR3StoreForCustVisitList"
		parameterClass="konkaR3Store" cacheModel="oneDayCache">
		SELECT t.store_id,t.store_name
		FROM konka_r3_store t
		LEFT JOIN MV_ORG_OF_CUSTOMER_ALL ee
		ON t.r3_code = ee.r3_code
		<isNotEmpty prepend=" and " property="map.cust_type">
			LEFT JOIN KONKA_R3_SHOP shop
			ON shop.R3_CODE = t.R3_CODE
			shop.shop_status in
			<iterate close=")" open="(" conjunction="," property="map.cust_type">#map.cust_type[]#
			</iterate>
		</isNotEmpty>
		WHERE t.IS_DEL = 0
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(ee.cur_dept_id is not
			null and ee.cur_dept_id in (
			select dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT (dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			<![CDATA[ (ee.user_id = #map.filter_by_ywy_id_eq# or t.ywy_job_id = (select job_id from konka_pe_prod_user where id = #map.filter_by_ywy_id_eq# and rownum<2))]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.store_name_like">
			<![CDATA[ t.store_name like '%' || #map.store_name_like# || '%']]>
		</isNotEmpty>
		order by t.store_name
	</select>

	<insert id="insertKonkaR3Store" parameterClass="konkaR3Store">
		<selectKey resultClass="long" keyProperty="store_id">select
			KONKA_R3_STORE_SEQ.NEXTVAL as store_id from dual </selectKey>
		<![CDATA[insert into KONKA_R3_STORE (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="store_id">STORE_ID</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>
			<isNotNull prepend="," property="dept_name">DEPT_NAME</isNotNull>
			<isNotNull prepend="," property="r3_code">R3_CODE</isNotNull>
			<isNotNull prepend="," property="store_name">STORE_NAME</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>
			<isNotNull prepend="," property="addr">ADDR</isNotNull>
			<isNotNull prepend="," property="linka_tel">LINKA_TEL</isNotNull>
			<isNotNull prepend="," property="link_man">LINK_MAN</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>
			<isNotNull prepend="," property="mf_sn">MF_SN</isNotNull>
			<isNotNull prepend="," property="zxy_job_id">ZXY_JOB_ID</isNotNull>
			<isNotNull prepend="," property="zxy_name">ZXY_NAME</isNotNull>
			<isNotNull prepend="," property="zxy_tel">ZXY_TEL</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">YWY_JOB_ID</isNotNull>
			<isNotNull prepend="," property="ywy_name">YWY_NAME</isNotNull>
			<isNotNull prepend="," property="jb_job_id">JB_JOB_ID</isNotNull>
			<isNotNull prepend="," property="jb_name">JB_NAME</isNotNull>
			<isNotNull prepend="," property="jb_tel">JB_TEL</isNotNull>
			<isNotNull prepend="," property="province">PROVINCE</isNotNull>
			<isNotNull prepend="," property="city">CITY</isNotNull>
			<isNotNull prepend="," property="country">COUNTRY</isNotNull>
			<isNotNull prepend="," property="town">TOWN</isNotNull>
			<isNotNull prepend="," property="md_jb">MD_JB</isNotNull>
			<isNotNull prepend="," property="kh_name">KH_NAME</isNotNull>
			<isNotNull prepend="," property="r3_shsdf_sn">R3_SHSDF_SN</isNotNull>
			<isNotNull prepend="," property="r3_sdf_sn">R3_SDF_SN</isNotNull>
			<isNotNull prepend="," property="xszz">XSZZ</isNotNull>
			<isNotNull prepend="," property="ywzg_job_id">YWZG_JOB_ID</isNotNull>
			<isNotNull prepend="," property="ywzg_name">YWZG_NAME</isNotNull>
			<isNotNull prepend="," property="ywzg_tel">YWZG_TEL</isNotNull>
			<isNotNull prepend="," property="jbjl_job_id">JBJL_JOB_ID</isNotNull>
			<isNotNull prepend="," property="jbjl_name">JBJL_NAME</isNotNull>
			<isNotNull prepend="," property="havaman">HAVAMAN</isNotNull>
			<isNotNull prepend="," property="ck_id">CK_ID</isNotNull>
			<isNotNull prepend="," property="ck_name">CK_NAME</isNotNull>
			<isNotNull prepend="," property="store_level">STORE_LEVEL</isNotNull>
			<isNotNull prepend="," property="year_sale_count">YEAR_SALE_COUNT</isNotNull>
			<isNotNull prepend="," property="business_area">BUSINESS_AREA</isNotNull>
			<isNotNull prepend="," property="tv_business_area">TV_BUSINESS_AREA
			</isNotNull>
			<isNotNull prepend="," property="konka_site">KONKA_SITE</isNotNull>
			<isNotNull prepend="," property="competitions">COMPETITIONS</isNotNull>
			<isNotNull prepend="," property="is_important">IS_IMPORTANT</isNotNull>
			<isNotNull prepend="," property="memo">MEMO</isNotNull>
			<isNotNull prepend="," property="stop_date">STOP_DATE</isNotNull>
			<isNotNull prepend="," property="create_user_id">CREATE_USER_ID</isNotNull>
			<isNotNull prepend="," property="modify_user_id">MODIFY_USER_ID</isNotNull>
			<isNotNull prepend="," property="modify_date">MODIFY_DATE</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="store_id">#store_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="dept_name">#dept_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="r3_code">#r3_code:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="store_name">#store_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="addr">#addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="linka_tel">#linka_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="link_man">#link_man:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:DATETIME#
			</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="mf_sn">#mf_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="zxy_job_id">#zxy_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="zxy_name">#zxy_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="zxy_tel">#zxy_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">#ywy_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywy_name">#ywy_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jb_job_id">#jb_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jb_name">#jb_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jb_tel">#jb_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="province">#province:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="city">#city:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="country">#country:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="town">#town:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="md_jb">#md_jb:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="kh_name">#kh_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="r3_shsdf_sn">#r3_shsdf_sn:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="r3_sdf_sn">#r3_sdf_sn:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="xszz">#xszz:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywzg_job_id">#ywzg_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywzg_name">#ywzg_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywzg_tel">#ywzg_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jbjl_job_id">#jbjl_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jbjl_name">#jbjl_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="havaman">#havaman:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ck_id">#ck_id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="ck_name">#ck_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="store_level">#store_level:INTEGER#
			</isNotNull>
			<isNotNull prepend="," property="year_sale_count">#year_sale_count:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="business_area">#business_area:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="tv_business_area">#tv_business_area:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="konka_site">#konka_site:INTEGER#
			</isNotNull>
			<isNotNull prepend="," property="competitions">#competitions:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="is_important">#is_important:INTEGER#
			</isNotNull>
			<isNotNull prepend="," property="memo">#memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="stop_date">#stop_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="create_user_id">#create_user_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="modify_user_id">#modify_user_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="modify_date">#modify_date:DATETIME#
			</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaR3Store" parameterClass="KonkaR3Store">
		update KONKA_R3_STORE
		<dynamic prepend="set">
			<isNotNull prepend="," property="store_id">STORE_ID =
				#store_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="dept_name">DEPT_NAME =
				#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_code">R3_CODE = #r3_code:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="store_name">STORE_NAME =
				#store_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="addr">ADDR = #addr:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="linka_tel">LINKA_TEL =
				#linka_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="link_man">LINK_MAN =
				#link_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE =
				#add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="mf_sn">MF_SN = #mf_sn:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="zxy_job_id">ZXY_JOB_ID =
				#zxy_job_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="zxy_name">ZXY_NAME =
				#zxy_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="zxy_tel">ZXY_TEL = #zxy_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">YWY_JOB_ID =
				#ywy_job_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywy_name">YWY_NAME =
				#ywy_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jb_job_id">JB_JOB_ID =
				#jb_job_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jb_name">JB_NAME = #jb_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="jb_tel">JB_TEL = #jb_tel:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="province">PROVINCE =
				#province:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="city">CITY = #city:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="country">COUNTRY = #country:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="town">TOWN = #town:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="md_jb">MD_JB = #md_jb:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="kh_name">KH_NAME = #kh_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="r3_shsdf_sn">R3_SHSDF_SN =
				#r3_shsdf_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_sdf_sn">R3_SDF_SN =
				#r3_sdf_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="xszz">XSZZ = #xszz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywzg_job_id">YWZG_JOB_ID =
				#ywzg_job_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywzg_name">YWZG_NAME =
				#ywzg_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywzg_tel">YWZG_TEL =
				#ywzg_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jbjl_job_id">JBJL_JOB_ID =
				#jbjl_job_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jbjl_name">JBJL_NAME =
				#jbjl_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="havaman">HAVAMAN = #havaman:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ck_id">CK_ID = #ck_id:BIGINT#
			</isNotNull>
			<isNotNull prepend="," property="ck_name">CK_NAME = #ck_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="store_level">STORE_LEVEL =
				#store_level:INTEGER#</isNotNull>
			<isNotNull prepend="," property="year_sale_count">YEAR_SALE_COUNT =
				#year_sale_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="business_area">BUSINESS_AREA =
				#business_area:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="tv_business_area">TV_BUSINESS_AREA =
				#tv_business_area:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="konka_site">KONKA_SITE =
				#konka_site:INTEGER#</isNotNull>
			<isNotNull prepend="," property="competitions">COMPETITIONS =
				#competitions:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_important">IS_IMPORTANT =
				#is_important:INTEGER#</isNotNull>
			<isNotNull prepend="," property="memo">MEMO = #memo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="stop_date">STOP_DATE =
				#stop_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="create_user_id">CREATE_USER_ID =
				#create_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="modify_user_id">MODIFY_USER_ID =
				#modify_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="modify_date">MODIFY_DATE =
				#modify_date:DATETIME#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="store_id">STORE_ID = #store_id#
		</isNotEmpty>
		<isEmpty prepend=" " property="store_id">
			<isNotEmpty prepend=" " property="map.pks">
				STORE_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#
				</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaR3Store" parameterClass="KonkaR3Store">
		delete from KONKA_R3_STORE where
		<isNotEmpty prepend=" " property="store_id">STORE_ID = #store_id#
		</isNotEmpty>
		<isEmpty prepend=" " property="store_id">
			<isNotEmpty prepend=" " property="map.pks">
				STORE_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#
				</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

	<!-- 存储过程查询门店 -->
	<parameterMap class="java.util.HashMap" id="cursorMap">
		<parameter property="I_DEPT_ID" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="I_STORE_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_STORE_CODE" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_YWY_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_CXY_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_R3_CODE" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="I_R3_CODE_LIKE" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_CUST_TYPE1" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_CUST_TYPE2" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_IS_STOP" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="I_JB_NAME" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="I_CUSTOMER_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_HAVE_CXY" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="FIRST_ROW" jdbcType="VARCHAR" javaType="java.lang.Integer"
			mode="IN" />
		<parameter property="COUNT_ROW" jdbcType="VARCHAR" javaType="java.lang.Integer"
			mode="IN" />
		<parameter property="I_DEPT_START" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_YWY_JOB_ID" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="I_FILTER_JOB_ID" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="SESSION_ID" jdbcType="VARCHAR"
			javaType="java.lang.String" mode="IN" />
		<parameter property="ONLY_CXY" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="IS_SURE1" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="IS_SURE2" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="I_JB_JOB_ID" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="SQL_CODE" jdbcType="VARCHAR" javaType="java.lang.String"
			mode="OUT" />
	</parameterMap>

	<procedure id="queryStoreList" parameterMap="cursorMap"
		resultClass="java.util.HashMap">
		{call SELECT_R3_STORE(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)}
	</procedure>
	
	<!-- 根据客户id查询其有效门店列表   add by Liang Houen on 2015-06-23 -->
	<select id="selectStoreListByCID" resultClass="java.util.HashMap" cacheModel="oneDayCache" parameterClass="java.lang.Long">
		select store_id id,store_name name from konka_r3_store 
		where  r3_code = (select r3_code from konka_r3_shop where id=#c_id#) and is_del=0
	</select>
</sqlMap>