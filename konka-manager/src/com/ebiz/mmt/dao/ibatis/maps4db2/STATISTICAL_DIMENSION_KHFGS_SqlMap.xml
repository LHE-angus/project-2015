<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="STATISTICAL_DIMENSION_KHFGS">

	<typeAlias alias="statisticalDimensionKhfgs" type="com.ebiz.mmt.domain.StatisticalDimensionKhfgs" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertStatisticalDimensionKhfgs" />
		<flushOnExecute statement="updateStatisticalDimensionKhfgs" />
		<flushOnExecute statement="deleteStatisticalDimensionKhfgs" />
	</cacheModel>

	<resultMap id="statisticalDimensionKhfgsResultForList" class="statisticalDimensionKhfgs">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="R3_CODE" property="r3_code" jdbcType="VARCHAR" />
		<result column="CUSTOMER_CODE" property="customer_code" jdbcType="VARCHAR" />
		<result column="YWY_ID" property="ywy_id" jdbcType="DECIMAL" />
		<result column="YWY_NAME" property="ywy_name" jdbcType="VARCHAR" />
		<result column="BSC_ID" property="bsc_id" jdbcType="DECIMAL" />
		<result column="BSC_NAME" property="bsc_name" jdbcType="VARCHAR" />
		<result column="JYB_ID" property="jyb_id" jdbcType="DECIMAL" />
		<result column="JYB_NAME" property="jyb_name" jdbcType="VARCHAR" />
		<result column="FGS_ID" property="fgs_id" jdbcType="DECIMAL" />
		<result column="FGS_NAME" property="fgs_name" jdbcType="VARCHAR" />
		<result column="AREA_NAME" property="area_name" jdbcType="VARCHAR" />
		<result column="UPDATE_DATE" property="update_date" jdbcType="TIMESTAMP" />
		<result column="UPDATE_USER_ID" property="update_user_id" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="statisticalDimensionKhfgsResult" class="statisticalDimensionKhfgs" extends="statisticalDimensionKhfgsResultForList">
	</resultMap>

	<sql id="sf-statisticalDimensionKhfgs">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_code">R3_CODE = #r3_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="customer_code">CUSTOMER_CODE = #customer_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_id">YWY_ID = #ywy_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_name">YWY_NAME = #ywy_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bsc_id">BSC_ID = #bsc_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bsc_name">BSC_NAME = #bsc_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jyb_id">JYB_ID = #jyb_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jyb_name">JYB_NAME = #jyb_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fgs_id">FGS_ID = #fgs_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fgs_name">FGS_NAME = #fgs_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="area_name">AREA_NAME = #area_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
	</sql>

	<select id="selectStatisticalDimensionKhfgs" resultMap="statisticalDimensionKhfgsResult" parameterClass="statisticalDimensionKhfgs" cacheModel="oneDayCache">
		select * from STATISTICAL_DIMENSION_KHFGS where 1 = 1
		<include refid="sf-statisticalDimensionKhfgs" />
	</select>

	<select id="selectStatisticalDimensionKhfgsList" resultMap="statisticalDimensionKhfgsResultForList" parameterClass="statisticalDimensionKhfgs" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from STATISTICAL_DIMENSION_KHFGS where 1 = 1
		<include refid="sf-statisticalDimensionKhfgs" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectStatisticalDimensionKhfgsCount" resultClass="long" parameterClass="statisticalDimensionKhfgs" cacheModel="oneDayCache">
		select count(*) from STATISTICAL_DIMENSION_KHFGS where 1 = 1
		<include refid="sf-statisticalDimensionKhfgs" />
	</select>

	<select id="selectStatisticalDimensionKhfgsPaginatedList" resultMap="statisticalDimensionKhfgsResult" parameterClass="statisticalDimensionKhfgs" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from STATISTICAL_DIMENSION_KHFGS where 1 = 1
		<include refid="sf-statisticalDimensionKhfgs" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- 	向表中插入初始化统计分公司数据 2014-12-16-->
	<update id="initStatisticalDimensionKhfgs"  parameterClass="StatisticalDimensionKhfgs">
	<![CDATA[
		insert into STATISTICAL_DIMENSION_KHFGS(ID,R3_CODE,CUSTOMER_CODE,
		YWY_ID,YWY_NAME,BSC_ID,BSC_NAME,JYB_ID,JYB_NAME,FGS_ID,FGS_NAME,AREA_NAME,UPDATE_DATE,UPDATE_USER_ID,IS_DEL)
		SELECT 
        SEQ_STATISTICAL_DIMENSION_KHFGS.NEXTVAL AS ID,
	       a.R3_CODE,
	       a.CUSTOMER_CODE,
	       ba.user_id AS ywy_id,
	       t1.USER_NAME AS ywy_name,
	       ba.BSC_ID,
	       t2.DEPT_NAME AS BSC_NAME,
	       ba.JYB_ID,
	       t3.DEPT_NAME AS JYB_NAME,
	       t4.DEPT_ID as FGS_ID,
	       t4.DEPT_NAME AS FGS_NAME,
	       a.AREA_NAME,
	       SYSDATE AS UDPATE_DATE,
	       0 AS UPDATE_USER_ID,
	       0 AS IS_DEL
	  FROM konka_r3_shop a
	       LEFT JOIN BRANCH_ASSIGN ba
	          ON ba.KONKA_R3_ID = a.ID
	       LEFT JOIN konka_pe_prod_user t1
	          ON t1.id = ba.user_id
	       LEFT JOIN konka_dept t2
	          ON t2.DEPT_ID = ba.BSC_ID
	       LEFT JOIN konka_dept t3
	          ON t3.DEPT_ID = ba.JYB_ID
	       LEFT JOIN konka_dept t4
	          ON t4.DEPT_SN = a.BRANCH_AREA_NAME_2
	 ]]>
	</update>

	<insert id="insertStatisticalDimensionKhfgs" parameterClass="statisticalDimensionKhfgs">
		<selectKey resultClass="long" keyProperty="id">select SEQ_STATISTICAL_DIMENSION_KHFGS.nextval as id from dual </selectKey>
		<![CDATA[insert into STATISTICAL_DIMENSION_KHFGS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="r3_code">R3_CODE</isNotNull>	
			<isNotNull prepend="," property="customer_code">CUSTOMER_CODE</isNotNull>	
			<isNotNull prepend="," property="ywy_id">YWY_ID</isNotNull>	
			<isNotNull prepend="," property="ywy_name">YWY_NAME</isNotNull>	
			<isNotNull prepend="," property="bsc_id">BSC_ID</isNotNull>	
			<isNotNull prepend="," property="bsc_name">BSC_NAME</isNotNull>	
			<isNotNull prepend="," property="jyb_id">JYB_ID</isNotNull>	
			<isNotNull prepend="," property="jyb_name">JYB_NAME</isNotNull>	
			<isNotNull prepend="," property="fgs_id">FGS_ID</isNotNull>	
			<isNotNull prepend="," property="fgs_name">FGS_NAME</isNotNull>	
			<isNotNull prepend="," property="area_name">AREA_NAME</isNotNull>	
			<isNotNull prepend="," property="update_date">UPDATE_DATE</isNotNull>	
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_code">#r3_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="customer_code">#customer_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywy_id">#ywy_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ywy_name">#ywy_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="bsc_id">#bsc_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bsc_name">#bsc_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jyb_id">#jyb_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jyb_name">#jyb_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="fgs_id">#fgs_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fgs_name">#fgs_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="area_name">#area_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">#update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">#update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateStatisticalDimensionKhfgs" parameterClass="StatisticalDimensionKhfgs">
		update STATISTICAL_DIMENSION_KHFGS
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_code">R3_CODE = #r3_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="customer_code">CUSTOMER_CODE = #customer_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ywy_id">YWY_ID = #ywy_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ywy_name">YWY_NAME = #ywy_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="bsc_id">BSC_ID = #bsc_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bsc_name">BSC_NAME = #bsc_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="jyb_id">JYB_ID = #jyb_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jyb_name">JYB_NAME = #jyb_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="fgs_id">FGS_ID = #fgs_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fgs_name">FGS_NAME = #fgs_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="area_name">AREA_NAME = #area_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteStatisticalDimensionKhfgs" parameterClass="StatisticalDimensionKhfgs">
		update STATISTICAL_DIMENSION_KHFGS set is_del=1 where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
	
	<delete id="deleteStatisticalDimensionKhfgsAll" parameterClass="StatisticalDimensionKhfgs">
		delete from STATISTICAL_DIMENSION_KHFGS where 1=1 
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>