<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_BASE_TYPE_DATA">

	<typeAlias alias="konkaBaseTypeData" type="com.ebiz.mmt.domain.KonkaBaseTypeData" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaBaseTypeData" />
		<flushOnExecute statement="updateKonkaBaseTypeData" />
		<flushOnExecute statement="deleteKonkaBaseTypeData" />
	</cacheModel>

	<resultMap id="konkaBaseTypeDataResultForList" class="konkaBaseTypeData">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="TYPE_NAME" property="type_name" jdbcType="VARCHAR" />
		<result column="TYPE_ID" property="type_id" jdbcType="DECIMAL" />
		<result column="PAR_TYPE_ID" property="par_type_id" jdbcType="DECIMAL" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="IS_LOCK" property="is_lock" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="UPDATE_DATE" property="update_date" jdbcType="TIMESTAMP" />
		<result column="UPDATE_USER_ID" property="update_user_id" jdbcType="DECIMAL" />
		<result column="ORDER_SORT" property="order_sort" jdbcType="DECIMAL" />
		<result column="FIELD1" property="field1" jdbcType="VARCHAR" />
		<result column="FIELD2" property="field2" jdbcType="VARCHAR" />
		<result column="FIELD3" property="field3" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaBaseTypeDataResult" class="konkaBaseTypeData" extends="konkaBaseTypeDataResultForList">
	</resultMap>
    <resultMap id="konkaBaseTypeDataLBResult" class="konkaBaseTypeData" extends="konkaBaseTypeDataResultForList">
        <result column="ADD_USER" property="map.add_user" jdbcType="VARCHAR" />
		<result column="UPDATE_USER" property="map.update_user" jdbcType="VARCHAR" />
		<result column="par_type_name" property="map.par_type_name" jdbcType="VARCHAR" />
		<result column="fj_paths" property="map.fj_paths" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="sf-konkaBaseTypeData">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_name">TYPE_NAME = #type_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_id">TYPE_ID = #type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_type_id">PAR_TYPE_ID = #par_type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">MEMO = #memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_lock">IS_LOCK = #is_lock:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_sort">ORDER_SORT = #order_sort:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="field1">FIELD1 = #field1:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="field2">FIELD2 = #field2:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="field3">FIELD3 = #field3:VARCHAR#</isNotEmpty>
	</sql>
	<sql id="sf-konkaBaseTypeDataLB">
			<isNotEmpty prepend=" and " property="id">base_data.ID = #id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="type_name">base_data.TYPE_NAME = #type_name:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="type_id">base_data.TYPE_ID = #type_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="par_type_id">base_data.PAR_TYPE_ID = #par_type_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="memo">base_data.MEMO = #memo:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="is_del">base_data.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="is_lock">base_data.IS_LOCK = #is_lock:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="add_date">base_data.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="add_user_id">base_data.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="update_date">base_data.UPDATE_DATE = #update_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="update_user_id">base_data.UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="order_sort">base_data.ORDER_SORT = #order_sort:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="field1">base_data.FIELD1 = #field1:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="field2">base_data.FIELD2 = #field2:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="field3">base_data.FIELD3 = #field3:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._begin_date"><![CDATA[ base_data.ADD_DATE >= to_date(#map._begin_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._end_date"><![CDATA[ base_data.ADD_DATE <= to_date(#_end_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._type_name_like"> base_data.TYPE_NAME like '%' || #map._type_name_like:VARCHAR# || '%' </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._par_type_name_like">
		          par_base_data.TYPE_NAME like  '%' || #map._par_type_name_like:VARCHAR# || '%'
		    </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._field1"> base_data.FIELD1 like '%' || #map._field1:VARCHAR# || '%' </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._field2"> base_data.FIELD2 like '%' || #map._field2:VARCHAR# || '%' </isNotEmpty>
		</sql>
	<select id="selectKonkaBaseTypeData" resultMap="konkaBaseTypeDataResult" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		select * from KONKA_BASE_TYPE_DATA where 1 = 1
		<include refid="sf-konkaBaseTypeData" />
	</select>

	<select id="selectKonkaBaseTypeDataList" resultMap="konkaBaseTypeDataResultForList" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_BASE_TYPE_DATA where 1 = 1
		<include refid="sf-konkaBaseTypeData" />
		 order by type_id desc 
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaBaseTypeDataCount" resultClass="long" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		select count(*) from KONKA_BASE_TYPE_DATA where 1 = 1
		<include refid="sf-konkaBaseTypeData" />
	</select>

	<select id="selectKonkaBaseTypeDataPaginatedList" resultMap="konkaBaseTypeDataResult" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_BASE_TYPE_DATA where 1 = 1
		<include refid="sf-konkaBaseTypeData" />
		 order by type_id desc 
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
<!--	连表查询数据count-->
	<select id="selectKonkaBaseTypeDataLBCount" resultClass="long" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		SELECT count(*)
		  FROM KONKA_BASE_TYPE_DATA base_data
		       left join KONKA_BASE_TYPE_DATA par_base_data
	           on base_data.PAR_TYPE_ID=par_base_data.TYPE_ID
		       LEFT JOIN KONKA_PE_PROD_USER add_user
		          ON base_data.ADD_USER_ID = add_user.ID
		       LEFT JOIN KONKA_PE_PROD_USER update_user
		          ON base_data.ADD_USER_ID = update_user.ID where 1 = 1
		<include refid="sf-konkaBaseTypeDataLB" />
	</select>
<!--	连表查询数据List-->
	<select id="selectKonkaBaseTypeDataLBPaginatedList" resultMap="konkaBaseTypeDataLBResult" parameterClass="konkaBaseTypeData" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT base_data.*, add_user.USER_NAME as add_user,update_user.USER_NAME as update_user,par_base_data.TYPE_NAME par_type_name,
			(select
			listagg(f.save_path, ',') within group (order by
			f.LINK_ID)
			from
			ATTACHMENT f
			where
			f.LINK_TAB='KONKA_BASE_TYPE_DATA' and f.DEL_MARK =0 and
			f.LINK_ID=base_data.ID
			group by
			LINK_ID ) fj_paths
		  FROM KONKA_BASE_TYPE_DATA base_data
			   left join KONKA_BASE_TYPE_DATA par_base_data
	           on base_data.PAR_TYPE_ID=par_base_data.TYPE_ID
		       LEFT JOIN KONKA_PE_PROD_USER add_user
		          ON base_data.ADD_USER_ID = add_user.ID
		       LEFT JOIN KONKA_PE_PROD_USER update_user
		          ON base_data.ADD_USER_ID = update_user.ID where 1 = 1
		<include refid="sf-konkaBaseTypeDataLB" />
		  order by base_data.ADD_DATE desc, base_data.ORDER_SORT desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaBaseTypeData" parameterClass="konkaBaseTypeData">
		<selectKey resultClass="long" keyProperty="id">select KONKA_BASE_TYPE_DATA_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_BASE_TYPE_DATA (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="type_name">TYPE_NAME</isNotNull>	
			<isNotNull prepend="," property="type_id">TYPE_ID</isNotNull>	
			<isNotNull prepend="," property="par_type_id">PAR_TYPE_ID</isNotNull>	
			<isNotNull prepend="," property="memo">MEMO</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="is_lock">IS_LOCK</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="update_date">UPDATE_DATE</isNotNull>	
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID</isNotNull>	
			<isNotNull prepend="," property="order_sort">ORDER_SORT</isNotNull>	
			<isNotNull prepend="," property="field1">FIELD1</isNotNull>	
			<isNotNull prepend="," property="field2">FIELD2</isNotNull>	
			<isNotNull prepend="," property="field3">FIELD3</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="type_name">#type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_id">#type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_type_id">#par_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="memo">#memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_lock">#is_lock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_date">#update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">#update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_sort">#order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="field1">#field1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="field2">#field2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="field3">#field3:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaBaseTypeData" parameterClass="KonkaBaseTypeData">
		update KONKA_BASE_TYPE_DATA
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="type_name">TYPE_NAME = #type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_id">TYPE_ID = #type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_type_id">PAR_TYPE_ID = #par_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="memo">MEMO = #memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_lock">IS_LOCK = #is_lock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_sort">ORDER_SORT = #order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="field1">FIELD1 = #field1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="field2">FIELD2 = #field2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="field3">FIELD3 = #field3:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaBaseTypeData" parameterClass="KonkaBaseTypeData">
		delete from KONKA_BASE_TYPE_DATA where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>