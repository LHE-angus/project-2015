<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JCFX_KCZZ_KHFZ">

	<typeAlias alias="jcfxKczzKhfz" type="com.ebiz.mmt.domain.JcfxKczzKhfz" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertJcfxKczzKhfz" />
		<flushOnExecute statement="updateJcfxKczzKhfz" />
		<flushOnExecute statement="deleteJcfxKczzKhfz" />
	</cacheModel>

	<resultMap id="jcfxKczzKhfzResultForList" class="jcfxKczzKhfz">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="TITLE" property="title" jdbcType="VARCHAR" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="ADD_USER_NAME" property="add_user_name" jdbcType="VARCHAR" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="jcfxKczzKhfzResult" class="jcfxKczzKhfz" extends="jcfxKczzKhfzResultForList">
	</resultMap>
	
    <resultMap id="jcfxKczzKhfzResultLB" class="jcfxKczzKhfz" extends="jcfxKczzKhfzResultForList">
           <result column="COUSTMER_NAMES" property="map.coustmer_names" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="sf-jcfxKczzKhfz">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="title">TITLE = #title:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
	</sql>
	
	<sql id="sf-jcfxKczzKhfzLB">
		<isNotEmpty prepend=" and " property="id">type.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="title">type.TITLE = #title:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">type.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">type.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">type.ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">type.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map._title_like">
	       	 type.TITLE like '%' || #map._title_like:VARCHAR# || '%'
		 </isNotEmpty>
		<isNotEmpty prepend=" and " property="map._customer_name_like">
	       	 type.COUSTMER_NAMES like '%' || #map._customer_name_like:VARCHAR# || '%'
		 </isNotEmpty>	
		<isNotEmpty prepend=" and " property="map.add_user_name_like">
	       	 type.ADD_USER_NAME like '%' || #map.add_user_name_like:VARCHAR# || '%'
		 </isNotEmpty>
		 <isNotEmpty prepend=" and " property="map._is_del">type.IS_DEL = #map._is_del:DECIMAL#</isNotEmpty>
			
		<isNotEmpty prepend=" and " property="map.begin_add_date"><![CDATA[ type.ADD_DATE >= to_date(#map.begin_add_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_add_date"><![CDATA[ type.ADD_DATE <= to_date(#map.begin_add_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
	</sql>

	<select id="selectJcfxKczzKhfz" resultMap="jcfxKczzKhfzResult" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		select * from JCFX_KCZZ_KHFZ where 1 = 1
		<include refid="sf-jcfxKczzKhfz" />
	</select>

	<select id="selectJcfxKczzKhfzList" resultMap="jcfxKczzKhfzResultForList" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from JCFX_KCZZ_KHFZ where 1 = 1
		<include refid="sf-jcfxKczzKhfz" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJcfxKczzKhfzCount" resultClass="long" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		select count(*) from JCFX_KCZZ_KHFZ where 1 = 1
		<include refid="sf-jcfxKczzKhfz" />
	</select>

	<select id="selectJcfxKczzKhfzPaginatedList" resultMap="jcfxKczzKhfzResult" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from JCFX_KCZZ_KHFZ where 1 = 1
		<include refid="sf-jcfxKczzKhfz" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

    <select id="selectJcfxKczzKhfzLBCount" resultClass="long" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		SELECT count(*)
			  FROM (SELECT khfz.*, (SELECT listagg (f.COUSTMER_NAME, ',') within       group (order by f.KHFZ_ID)
			          from
			          JCFX_KCZZ_KHFZ_LINK f
			          where f.KHFZ_ID=khfz.ID  <![CDATA[ and rownum<10]]>
			          group by
			          KHFZ_ID
			            )COUSTMER_NAMES
			       from JCFX_KCZZ_KHFZ khfz
			    ) type where 1=1
		<include refid="sf-jcfxKczzKhfzLB" />
	</select>

	<select id="selectJcfxKczzKhfzLBPaginatedList" resultMap="jcfxKczzKhfzResultLB" parameterClass="jcfxKczzKhfz" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT *
			  FROM (SELECT khfz.*, (SELECT listagg (f.COUSTMER_NAME, ',') within       group (order by f.KHFZ_ID)
			          from
			          JCFX_KCZZ_KHFZ_LINK f
			          where f.KHFZ_ID=khfz.ID <![CDATA[ and rownum<10]]>
			          group by
			          KHFZ_ID
			            )COUSTMER_NAMES
			       from JCFX_KCZZ_KHFZ khfz
			    ) type where 1=1
		<include refid="sf-jcfxKczzKhfzLB" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertJcfxKczzKhfz" parameterClass="jcfxKczzKhfz">
		<selectKey resultClass="long" keyProperty="id">select JCFX_KCZZ_KHFZ_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into JCFX_KCZZ_KHFZ (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="title">TITLE</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="title">#title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="add_user_name">#add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJcfxKczzKhfz" parameterClass="JcfxKczzKhfz">
		update JCFX_KCZZ_KHFZ
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="title">TITLE = #title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJcfxKczzKhfz" parameterClass="JcfxKczzKhfz">
		delete from JCFX_KCZZ_KHFZ where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>