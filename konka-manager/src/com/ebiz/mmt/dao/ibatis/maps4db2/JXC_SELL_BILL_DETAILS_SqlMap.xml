<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JXC_SELL_BILL_DETAILS">

	<typeAlias alias="jxcSellBillDetails" type="com.ebiz.mmt.domain.JxcSellBillDetails" />

	

	<resultMap id="jxcSellBillDetailsResultForList" class="jxcSellBillDetails">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="SELL_BILL_ID" property="sell_bill_id" jdbcType="DECIMAL" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="count" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="PD_BH" property="pd_bh" jdbcType="VARCHAR" />
		<result column="PD_CH" property="pd_ch" jdbcType="VARCHAR" />
		<result column="IDENTIFICATION" property="identification" jdbcType="VARCHAR" />
		<result column="COST_PRICE" property="cost_price" jdbcType="DECIMAL" />
		<result column="SELL_SRC" property="sell_src" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		
		<result column="ALLOWANCE" property="allowance" jdbcType="DECIMAL" />
		<result column="ALLOWANCE_MONEY" property="allowance_money" jdbcType="DECIMAL" />
		<result column="PD_UNIQUE_CODE" property="pd_unique_code" jdbcType="VARCHAR" />
		<result column="CH_INVOICE_DATE" property="ch_invoice_date" jdbcType="DATETIME" />
		<result column="INVOICE_BH" property="invoice_bh" jdbcType="VARCHAR" />
		<result column="FAVORABLE" property="favorable" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="jxcSellBillDetailsResult" class="jxcSellBillDetails" extends="jxcSellBillDetailsResultForList">
	</resultMap>
	
	<resultMap id="jxcSellBillDetailsStatForReal" class="jxcSellBillDetails" >
		<result column="sales_volume" property="map.sales_volume" jdbcType="DECIMAL" />
		<result column="sales_amount" property="map.sales_amount" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="jxcSellBillDetailsStatForPdReal" class="jxcSellBillDetails" >
		<result column="pd_id" property="map.id" jdbcType="DECIMAL" />
		<result column="pd_name" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="sales_amount" property="map.sales_amount" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap class="jxcSellBillDetails" id="jxcPdModelAnalysis">
		<result column="pd_id" property="map.id" jdbcType="DECIMAL" />
		<result column="pd_name" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="brand_id" property="map.brand_id" jdbcType="DECIMAL" />
		<result column="brand_name" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="pd_type" property="map.pd_type" jdbcType="DECIMAL" />
		<result column="pd_type_name" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="count" property="map.count" jdbcType="DECIMAL" />
		<result column="cost_sales" property="map.cost_sales" jdbcType="DECIMAL" />
		<result column="sales_revenue" property="map.sales_revenue" jdbcType="DECIMAL" />
	</resultMap>
	
	

	<resultMap class="jxcSellBillDetails" id="jxcStoresAnalysis">
		<result column="brand_id" property="map.brand_id" jdbcType="DECIMAL" />
		<result column="brand_name" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="pd_type" property="map.pd_type" jdbcType="DECIMAL" />
		<result column="pd_type_name" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="cost_sales" property="map.cost_sales" jdbcType="DECIMAL" />
		<result column="sales_revenue" property="map.sales_revenue" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap class="jxcSellBillDetails" id="jxcStoresAnalysisAnother">
		<result column="brand_id" property="map.brand_id" jdbcType="DECIMAL" />
		<result column="brand_name" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="cost_sales" property="map.cost_sales" jdbcType="DECIMAL" />
		<result column="pd_type_name" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="sales_revenue" property="map.sales_revenue" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-jxcSellBillDetails">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_bill_id">SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_bh">PD_BH = #PD_BH:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_ch">PD_CH = #PD_CH:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="count">COUNT = #count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="identification">IDENTIFICATION = #identification:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cost_price">COST_PRICE = #cost_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_src">SELL_SRC = #sell_src:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="allowance">ALLOWANCE = #allowance:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="allowance_money">ALLOWANCE_MONEY = #allowance_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_unique_code">PD_UNIQUE_CODE = #pd_unique_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ch_invoice_date">CH_INVOICE_DATE = #ch_invoice_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="invoice_bh">INVOICE_BH = #invoice_bh:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="favorable">FAVORABLE = #favorable:VARCHAR#</isNotEmpty>
		
	    <isNotEmpty prepend=" and " property="map.st_date"><![CDATA[add_date >= to_date(#map.st_date#,'yyyy-MM-dd')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.en_date"><![CDATA[add_date <= to_date(#map.en_date# || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')]]></isNotEmpty>
	</sql>

	<select id="selectJxcSellBillDetails" resultMap="jxcSellBillDetailsResult" parameterClass="jxcSellBillDetails" >
		select * from JXC_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcSellBillDetails" />
	</select>

	<select id="selectJxcSellBillDetailsList" resultMap="jxcSellBillDetailsResultForList" parameterClass="jxcSellBillDetails" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from JXC_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcSellBillDetails" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJxcSellBillDetailsCount" resultClass="long" parameterClass="jxcSellBillDetails" >
		select count(*) from JXC_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcSellBillDetails" />
	</select>

	<select id="selectJxcSellBillDetailsPaginatedList" resultMap="jxcSellBillDetailsResult" parameterClass="jxcSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from JXC_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcSellBillDetails" />
		 order by add_date desc, ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectJxcSellBillDetailsStatForReal" resultMap="jxcSellBillDetailsStatForReal" parameterClass="java.util.Map" >
		select sum(b.count) sales_volume,sum(b.count*b.price) sales_amount from JXC_SELL_BILL_DETAILS b where 1=1
		<isNotEmpty prepend=" and " property="start_date">
		<![CDATA[to_char(b.add_date,'yyyy-mm-dd')>=#start_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">
		<![CDATA[to_char(b.add_date,'yyyy-mm-dd')<=#end_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">b.shop_id=#shop_id#</isNotEmpty>
	</select>
	
	<select id="selectJxcSellBillDetailsStatForPdReal" resultMap="jxcSellBillDetailsStatForPdReal" parameterClass="java.util.Map" >
	<isNotEmpty prepend="" property="rownum">
		select * from (
		</isNotEmpty>
		select  a.pd_id ,a.pd_name,sum(a.count) sales_amount from JXC_SELL_BILL_DETAILS a where 1=1
			<isNotEmpty prepend=" and " property="start_date">
			<![CDATA[to_char(a.add_date,'yyyy-mm-dd')>=#start_date#]]></isNotEmpty>
			<isNotEmpty prepend=" and " property="end_date">
			<![CDATA[to_char(a.add_date,'yyyy-mm-dd')<=#end_date#]]></isNotEmpty>
			<isNotEmpty prepend=" and " property="shop_id">a.shop_id=#shop_id#</isNotEmpty>
			group by a.pd_id,a.pd_name 
			order by sales_amount desc
		<isNotEmpty prepend="" property="rownum"><![CDATA[) where rownum<=#rownum#  ]]></isNotEmpty>
	</select>
	
	<!--Li Ka  2011-11-23  分型号毛利分析-->
	<select id="selectJxcPdModelAnalysis" resultMap="jxcPdModelAnalysis" parameterClass="java.util.Map" >
		select a.pd_id,a.pd_name,a.brand_id,a.brand_name,a.pd_type,a.pd_type_name,sum(a.count) count,sum(a.Cost_Price * a.Count) cost_sales,sum(a.price * a.count) sales_revenue
 		 from JXC_SELL_BILL_DETAILS a left join JXC_SELL_BILL s on s.id = a.sell_bill_id
 			where 1=1
 			<isNotEmpty prepend=" and " property="start_date">
 			<![CDATA[s.sell_date >= to_date(#start_date#,'yyyy-mm-dd')]]></isNotEmpty>
 			<isNotEmpty prepend=" and " property="end_date">
 			<![CDATA[s.sell_date <= to_date(#end_date#,'yyyy-mm-dd')]]></isNotEmpty>
 			<isNotEmpty prepend=" and " property="shop_id">a.shop_id=#shop_id#</isNotEmpty>
 			group by a.pd_id,a.pd_name,a.brand_id,a.brand_name,a.pd_type,a.pd_type_name
 			order by a.pd_type, a.brand_id
	</select>
	
	<select id="selectJxcStoresAnalysis" resultMap="jxcStoresAnalysis" parameterClass="java.util.Map" >
		select a.brand_id,a.brand_name,a.pd_type,a.pd_type_name,sum(a.Cost_Price * a.Count) cost_sales,sum(a.price * a.count) sales_revenue
  			from JXC_SELL_BILL_DETAILS a
 			where 1=1
 			<isNotEmpty prepend=" and " property="start_date">
   			<![CDATA[to_char(a.add_date, 'yyyy-mm-dd') >= #start_date#]]></isNotEmpty>
   			<isNotEmpty prepend=" and " property="end_date">
   			<![CDATA[to_char(a.add_date, 'yyyy-mm-dd') <= #end_date#]]></isNotEmpty>
   			<isNotEmpty prepend=" and " property="shop_id">a.shop_id=#shop_id#</isNotEmpty>
 			group by a.brand_id, a.brand_name, a.pd_type, a.pd_type_name
 			order by a.brand_id,a.pd_type
	</select>
	
	<select id="selectJxcStoresAnalysisAnother" resultMap="jxcStoresAnalysisAnother" parameterClass="java.util.Map" >
		select a.brand_id,a.brand_name,'合计' pd_type_name,sum(a.Cost_Price * a.Count) cost_sales,sum(a.price * a.count) sales_revenue
  			from JXC_SELL_BILL_DETAILS a
 			where 1=1
 			<isNotEmpty prepend=" and " property="start_date">
   			<![CDATA[to_char(a.add_date, 'yyyy-mm-dd') >= #start_date#]]></isNotEmpty>
   			<isNotEmpty prepend=" and " property="end_date">
   			<![CDATA[to_char(a.add_date, 'yyyy-mm-dd') <= #end_date#]]></isNotEmpty>
   			<isNotEmpty prepend=" and " property="shop_id">a.shop_id=#shop_id#</isNotEmpty>
 			group by a.brand_id, a.brand_name
 			order by a.brand_id
	</select>
	
	<!--Ren Zhong  2011-4-19  产品类型汇总毛利分析-->
	<resultMap id="jxcPdTypeAnalysisResult" class="jxcSellBillDetails">
		<result column="PD_TYPE" property="map.pd_type" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_ID" property="map.brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="XSSR" property="map.xssr" jdbcType="DECIMAL" />
		<result column="XSCB" property="map.xscb" jdbcType="DECIMAL" />
		<result column="XSSL" property="map.xssl" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectJxcPdTypeAnalysisResultForList" resultMap="jxcPdTypeAnalysisResult" parameterClass="jxcSellBillDetails" >
	 	  select e.pd_type,
		         e.pd_type_name,
		         e.brand_id,
		         e.brand_name,
		         sum(e.count) as xssl,
		         sum(e.m_1) as xssr,
		         sum(e.m_2) as xscb
		  	from (select a.pd_type,
			             a.pd_type_name,
			             a.brand_id,
			             a.brand_name,
			             a.count,
			             a.count * a.price as m_1,
			             a.count * a.cost_price as m_2
			        from JXC_SELL_BILL_DETAILS a left join JXC_SELL_BILL s on s.id = a.sell_bill_id
			       where 1 = 1
			         and a.shop_id = #map.shop_id#
			         <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[s.sell_date >= to_date(#map.add_date_st#,'yyyy-mm-dd')]]></isNotEmpty>
           		     <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[s.sell_date <= to_date(#map.add_date_en#,'yyyy-mm-dd')]]></isNotEmpty>
           		     <isNotEmpty prepend=" and " property="map.pd_type">a.pd_type = #map.pd_type#</isNotEmpty>
		        	 <isNotEmpty prepend=" and " property="map.brand_id">a.brand_id = #map.brand_id#</isNotEmpty>
		         ) e
			group by e.pd_type, e.pd_type_name, e.brand_id, e.brand_name
		 	order by e.pd_type
  	</select>
  	
  	<!--Ren Zhong  2011-4-19  分销客户汇总毛利分析-->
	<resultMap id="jxcCusAnalysisResult" class="jxcSellBillDetails">
		<result column="XSSL_CUS" property="map.xssl_cus" jdbcType="VARCHAR" />
		<result column="XSSR_CUS" property="map.xssr_cus" jdbcType="VARCHAR" />
		<result column="XSCB_CUS" property="map.xscb_cus" jdbcType="DECIMAL" />
		<result column="NAME" property="map.name" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectJxcCusAnalysisResultForList" resultMap="jxcCusAnalysisResult" parameterClass="jxcSellBillDetails" >
		select sum(e.count) as xssl_cus,
       		   sum(e.count * e.price) as xssr_cus,
       		   sum(e.count * e.cost_price) as xscb_cus,
       		   e.name
  		  from (select c.*, d.name
          		  from (select *
                  		  from JXC_SELL_BILL_DETAILS a
                  		  left join JXC_SELL_BILL b on b.id = a.sell_bill_id
                 		 where 1 = 1
                   		   and b.shop_id = #map.shop_id#
                   		   <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[b.sell_date >= to_date(#map.add_date_st#,'yyyy-mm-dd')]]></isNotEmpty>
                   		   <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[b.sell_date <= to_date(#map.add_date_en#,'yyyy-mm-dd')]]></isNotEmpty>
                   		   )c
          left join JXC_CUSTOMER d on c.customer_id = d.id
          where 1 = 1
          	<isNotEmpty prepend=" and " property="map.name_like">d.name like '%' || #map.name_like# || '%'</isNotEmpty>
          ) e
 		  group by e.name
	</select>
	
	<!-- Ren Zhong 2011-4-20 销售数据统计分析-->
	<resultMap id="jxcDataAnalysisResult"  class="jxcSellBillDetails">
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="B_COUNT" property="map.b_count" jdbcType="DECIMAL" />
		<result column="B_M" property="map.b_m" jdbcType="DECIMAL" />
		<result column="TOT_COUNT" property="map.tot_count" jdbcType="DECIMAL" />
		<result column="TOT_MONEY" property="map.tot_money" jdbcType="DECIMAL" />
		<result column="LAST_MONTH_COUNT" property="map.last_month_count" jdbcType="DECIMAL" />
		<result column="LAST_YEAR_COUNT" property="map.last_year_count" jdbcType="DECIMAL" />
		<result column="LAST_MONTH_MONEY" property="map.last_month_money" jdbcType="DECIMAL" />
		<result column="LAST_YEAR_MONEY" property="map.last_year_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectJxcDataAnalysisResultForList" resultMap="jxcDataAnalysisResult" parameterClass="jxcSellBillDetails" >
		 select z.pd_type_name,
		       	z.pd_type,
		       	z.brand_name,
		       	z.brand_id,
		       	sum(z.b_count) as b_count,
		       	sum(z.b_m) as b_m,
		       	(select sum(a.count)
		           from JXC_SELL_BILL_DETAILS a
		          where a.shop_id = #map.shop_id#
		            <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[a.add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd')]]></isNotEmpty>
         		    <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[a.add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>) as tot_count,
		       	(select sum(a.count * a.price)
		           from JXC_SELL_BILL_DETAILS a
		          where a.shop_id = #map.shop_id#
		            <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[a.add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd')]]></isNotEmpty>
         		    <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[a.add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>) as tot_money,
		        sum(z.last_month_count) as last_month_count,
		        sum(z.last_month_money) as last_month_money,
		        sum(z.last_year_count) as last_year_count,
		        sum(z.last_year_money) as last_year_money
		  from (
		  		<!--当月销量和销额  -->
		  		select a.pd_type_name,
		               a.pd_type,
		               a.brand_name,
		               a.brand_id,
		               sum(a.count) as b_count,
		               sum(a.count * a.price) as b_m,
		               0 as last_month_count,
		               0 as last_month_money,
		               0 as last_year_count,
		               0 as last_year_money
		          from JXC_SELL_BILL_DETAILS a
		         where a.shop_id = #map.shop_id#
		           <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[a.add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd')]]></isNotEmpty>
         		   <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[a.add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		         group by a.pd_type_name, a.pd_type, a.brand_name, a.brand_id
		        union all
		        <!--上月销量和销额 -->
		        select a.pd_type_name,
		               a.pd_type,
		               a.brand_name,
		               a.brand_id,
		               0 as b_count,
		               0 as b_m,
		               sum(a.count) as last_month_count,
		               sum(a.count * a.price) as last_month_money,
		               0 as last_year_count,
		               0 as last_year_money
		          from JXC_SELL_BILL_DETAILS a
		         where a.shop_id = #map.shop_id#
		           <isNotEmpty prepend=" and " property="map.last_month_st"><![CDATA[a.add_date >= to_date(#map.last_month_st#,'yyyy-mm-dd')]]></isNotEmpty>
           		   <isNotEmpty prepend=" and " property="map.last_month_en"><![CDATA[a.add_date <= to_date(#map.last_month_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		         group by a.pd_type_name, a.pd_type, a.brand_name, a.brand_id
		        union all
		        <!--上年同期销量和销额 -->
		        select a.pd_type_name,
		               a.pd_type,
		               a.brand_name,
		               a.brand_id,
		               0 as b_count,
		               0 as b_m,
		               0 as last_month_count,
		               0 as last_month_money,
		               sum(a.count) as last_year_count,
		               sum(a.count * a.price) as last_year_money
		          from JXC_SELL_BILL_DETAILS a
		         where a.shop_id = #map.shop_id#
		           <isNotEmpty prepend=" and " property="map.last_year_st"><![CDATA[a.add_date >= to_date(#map.last_year_st#,'yyyy-mm-dd')]]></isNotEmpty>
           		   <isNotEmpty prepend=" and " property="map.last_year_en"><![CDATA[a.add_date <= to_date(#map.last_year_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		         group by a.pd_type_name, a.pd_type, a.brand_name, a.brand_id) z
		 where 1 = 1
			   <isNotEmpty prepend=" and " property="map.pd_type">z.pd_type = #map.pd_type#</isNotEmpty>
			   <isNotEmpty prepend=" and " property="map.brand">z.brand_id = #map.brand_id#</isNotEmpty>
		 group by z.pd_type_name, z.pd_type, z.brand_name, z.brand_id
		 order by z.pd_type
	</select>

	<insert id="insertJxcSellBillDetails" parameterClass="jxcSellBillDetails">
		<selectKey resultClass="long" keyProperty="id">select JXC_BILL_DETAILS_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into JXC_SELL_BILL_DETAILS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="sell_bill_id">SELL_BILL_ID</isNotNull>	
			<isNotNull prepend="," property="pd_id">PD_ID</isNotNull>	
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME</isNotNull>	
			<isNotNull prepend="," property="brand_name">BRAND_NAME</isNotNull>	
			<isNotNull prepend="," property="pd_name">PD_NAME</isNotNull>	
			<isNotNull prepend="," property="count">COUNT</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>	
			<isNotNull prepend="," property="identification">IDENTIFICATION</isNotNull>	
			<isNotNull prepend="," property="cost_price">COST_PRICE</isNotNull>	
			<isNotNull prepend="," property="sell_src">SELL_SRC</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>
			<isNotNull prepend="," property="pd_bh">PD_BH</isNotNull>
			<isNotNull prepend="," property="pd_ch">PD_CH</isNotNull>
			
			<isNotNull prepend="," property="allowance">ALLOWANCE</isNotNull>
			<isNotNull prepend="," property="allowance_money">ALLOWANCE_MONEY</isNotNull>
			<isNotNull prepend="," property="pd_unique_code">PD_UNIQUE_CODE</isNotNull>
			<isNotNull prepend="," property="ch_invoice_date">CH_INVOICE_DATE</isNotNull>
			<isNotNull prepend="," property="invoice_bh">INVOICE_BH</isNotNull>
			<isNotNull prepend="," property="favorable">FAVORABLE</isNotNull>
			
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_bill_id">#sell_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">#pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">#pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name">#brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_name">#pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="count">#count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="identification">#identification:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cost_price">#cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_src">#sell_src:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="pd_bh">#pd_bh:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_ch">#pd_ch:VARCHAR#</isNotNull>
			
			<isNotNull prepend="," property="allowance">#allowance:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="allowance_money">#allowance_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_unique_code">#pd_unique_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ch_invoice_date">#ch_invoice_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="invoice_bh">#invoice_bh:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="favorable">#favorable:VARCHAR#</isNotNull>
			
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJxcSellBillDetails" parameterClass="JxcSellBillDetails">
		update JXC_SELL_BILL_DETAILS
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_bill_id">SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="count">COUNT = #count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="identification">IDENTIFICATION = #identification:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cost_price">COST_PRICE = #cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_src">SELL_SRC = #sell_src:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="pd_bh">PD_BH = #pd_bh:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_ch">PD_CH = #pd_ch:VARCHAR#</isNotNull>
			
			<isNotNull prepend="," property="allowance">ALLOWANCE = #allowance:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="allowance_money">ALLOWANCE_MONEY = #allowance_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_unique_code">PD_UNIQUE_CODE = #pd_unique_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ch_invoice_date">CH_INVOICE_DATE = #ch_invoice_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="invoice_bh">INVOICE_BH = #invoice_bh:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="favorable">favorable = #favorable:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJxcSellBillDetails" parameterClass="JxcSellBillDetails">
		delete from JXC_SELL_BILL_DETAILS where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>