<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_R3_DEPT_STOCK_INFO">

	<typeAlias alias="konkaR3DeptStockInfo" type="com.ebiz.mmt.domain.KonkaR3DeptStockInfo" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaR3DeptStockInfo" />
		<flushOnExecute statement="updateKonkaR3DeptStockInfo" />
		<flushOnExecute statement="deleteKonkaR3DeptStockInfo" />
	</cacheModel>

	<resultMap id="konkaR3DeptStockInfoResultForList" class="konkaR3DeptStockInfo">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="BZIRK" property="bzirk" jdbcType="VARCHAR" />
		<result column="CLASS1" property="class1" jdbcType="VARCHAR" />
		<result column="CLASS2" property="class2" jdbcType="VARCHAR" />
		<result column="KUNNR" property="kunnr" jdbcType="VARCHAR" />
		<result column="MATNR" property="matnr" jdbcType="VARCHAR" />
		<result column="MATKL" property="matkl" jdbcType="VARCHAR" />
		<result column="LFIMG" property="lfimg" jdbcType="DECIMAL" />
		<result column="LFIMG1" property="lfimg1" jdbcType="DECIMAL" />
		<result column="SUM_" property="sum_" jdbcType="DECIMAL" />
		<result column="MZT" property="mzt" jdbcType="DECIMAL" />
		<result column="MWF" property="mwf" jdbcType="DECIMAL" />
		<result column="PDLABST" property="pdlabst" jdbcType="DECIMAL" />
		<result column="ZZLABST" property="zzlabst" jdbcType="DECIMAL" />
		<result column="JYLABST" property="jylabst" jdbcType="DECIMAL" />
		<result column="CLLABST" property="cllabst" jdbcType="DECIMAL" />
		<result column="YJLABST" property="yjlabst" jdbcType="DECIMAL" />
		<result column="TJLABST" property="tjlabst" jdbcType="DECIMAL" />
		<result column="PCLABST" property="pclabst" jdbcType="DECIMAL" />
		<result column="ZCLABST" property="zclabst" jdbcType="DECIMAL" />
		<result column="BCLABST" property="bclabst" jdbcType="DECIMAL" />
		<result column="DZLABST" property="dzlabst" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="konkaR3DeptStockInfoResult" class="konkaR3DeptStockInfo" extends="konkaR3DeptStockInfoResultForList">
	</resultMap>
	
	<resultMap id="konkaR3DeptStockInfoForClass" class="konkaR3DeptStockInfo">
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaR3DeptStockInfoResultForZzl" class="konkaR3DeptStockInfo" extends="konkaR3DeptStockInfoResultForList">
		<result column="ZZL" property="map.zzl" jdbcType="DECIMAL" />
		<result column="SUM_COUNT" property="map.sum_count" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-konkaR3DeptStockInfo">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bzirk">BZIRK = #bzirk:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="class1">CLASS1 = #class1:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="class2">CLASS2 = #class2:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="kunnr">KUNNR = #kunnr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="matnr">MATNR = #matnr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="matkl">MATKL = #matkl:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="lfimg">LFIMG = #lfimg:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="lfimg1">LFIMG1 = #lfimg1:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sum_">SUM_ = #sum_:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mzt">MZT = #mzt:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mwf">MWF = #mwf:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pdlabst">PDLABST = #pdlabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zzlabst">ZZLABST = #zzlabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jylabst">JYLABST = #jylabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cllabst">CLLABST = #cllabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="yjlabst">YJLABST = #yjlabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="tjlabst">TJLABST = #tjlabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pclabst">PCLABST = #pclabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zclabst">ZCLABST = #zclabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bclabst">BCLABST = #bclabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dzlabst">DZLABST = #dzlabst:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.v_class_like">CLASS1 like '%' || #map.v_class_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.v_matnr_like">MATNR like '%' || #map.v_matnr_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.s_date"><![CDATA[ADD_DATE >= to_date(#map.s_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.e_date"><![CDATA[ADD_DATE <= to_date(#map.e_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
	</sql>

	<select id="selectKonkaR3DeptStockInfo" resultMap="konkaR3DeptStockInfoResult" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		select * from KONKA_R3_DEPT_STOCK_INFO where 1 = 1
		<include refid="sf-konkaR3DeptStockInfo" />
	</select>

	<select id="selectKonkaR3DeptStockInfoList" resultMap="konkaR3DeptStockInfoResultForList" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_R3_DEPT_STOCK_INFO where 1 = 1
		<include refid="sf-konkaR3DeptStockInfo" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaR3DeptStockInfoCount" resultClass="long" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		select count(*) from KONKA_R3_DEPT_STOCK_INFO where 1 = 1
		<include refid="sf-konkaR3DeptStockInfo" />
	</select>

	<select id="selectKonkaR3DeptStockInfoPaginatedList" resultMap="konkaR3DeptStockInfoResult" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_R3_DEPT_STOCK_INFO where 1 = 1
		<include refid="sf-konkaR3DeptStockInfo" />
		<isNotEmpty property="map.order_by_lfimg1"> order by lfimg1 desc</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!-- Hu,Hao 2013-12-13 -->
	<select id="selectKonkaR3DeptStockInfoListForClass" resultMap="konkaR3DeptStockInfoForClass" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select distinct(class1) as dept_name from KONKA_R3_DEPT_STOCK_INFO  where 1 = 1
		<isNotEmpty prepend=" and " property="map.s_date"><![CDATA[ADD_DATE >= to_date(#map.s_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.e_date"><![CDATA[ADD_DATE <= to_date(#map.e_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		order by dept_name
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

  <!-- Hu,Hao 2013-12-13 -->
  <select id="selectKonkaR3DeptStockInfoListForZzl" resultMap="konkaR3DeptStockInfoResultForZzl" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		SELECT a.*,
       		decode (a.sum_count,null,0,0, 0, a.lfimg1 / a.sum_count) * 100 AS zzl
  			FROM (SELECT t.*,
               		(t.sum_ - t.mwf - t.tjlabst - t.zclabst) AS sum_count
          		FROM KONKA_R3_DEPT_STOCK_INFO t where 1 = 1
          		<isNotEmpty prepend=" and " property="map.s_date"><![CDATA[t.ADD_DATE >= to_date(#map.s_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
				<isNotEmpty prepend=" and " property="map.e_date"><![CDATA[t.ADD_DATE <= to_date(#map.e_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
				<isNotEmpty prepend=" and " property="class1">t.CLASS1 = #class1:VARCHAR#</isNotEmpty>
				<isNotEmpty prepend=" and " property="map.matnr_like">upper(t.matnr) like '%' || upper(#map.matnr_like#) || '%'</isNotEmpty>
          		) a
				ORDER BY a.LFIMG1 DESC
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- Hu,Hao 2013-12-16 -->
	<select id="selectKonkaR3DeptStockInfoListForFgsZzl" resultMap="konkaR3DeptStockInfoResultForZzl" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		SELECT b.*, decode (b.SUM_COUNT,NULL,0,0,0, b.LFIMG1 / b.SUM_COUNT)* 100 AS zzl
		  FROM (SELECT null AS id, null AS bzirk, null AS class2, null AS kunnr,null AS matnr, null AS matkl,null as add_date,
		               a.*, (a.sum_ - a.mwf - a.tjlabst - a.zclabst) AS sum_count
		          FROM (SELECT sum (t.LFIMG) AS LFIMG,
		                       sum (t.LFIMG1) AS LFIMG1,
		                       sum (t.SUM_) as sum_,
		                       sum (t.MZT) AS mzt,
		                       sum (t.MWF) AS mwf,
		                       sum (t.PDLABST) AS PDLABST,
		                       sum (t.ZZLABST) AS ZZLABST,
		                       sum (t.JYLABST) AS JYLABST,
		                       sum (t.CLLABST) AS CLLABST,
		                       sum (t.YJLABST) AS YJLABST,
		                       sum (t.TJLABST) AS TJLABST,
		                       sum (t.PCLABST) AS PCLABST,
		                       sum (t.ZCLABST) AS ZCLABST,
		                       sum (t.BCLABST) AS BCLABST,
		                       sum (t.DZLABST) AS DZLABST,
		                       class1
		                  FROM KONKA_R3_DEPT_STOCK_INFO t
		                  where 1 = 1
		                  <isNotEmpty prepend=" and " property="map.s_date"><![CDATA[TO_CHAR(t.ADD_DATE,'yyyy-MM-dd') >= #map.s_date#]]></isNotEmpty>
						  <isNotEmpty prepend=" and " property="map.e_date"><![CDATA[TO_CHAR(t.ADD_DATE,'yyyy-MM-dd') <= #map.e_date#]]></isNotEmpty>
		                GROUP BY class1) a) b
		ORDER BY b.LFIMG1 DESC
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<!-- Hu,Hao 2013-12-13 -->
	<select id="selectKonkaR3DeptStockInfoListForMaxDate" resultMap="konkaR3DeptStockInfoResultForList" parameterClass="konkaR3DeptStockInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_R3_DEPT_STOCK_INFO where id in(
			select max(id) from KONKA_R3_DEPT_STOCK_INFO  where 1 = 1
		)
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<insert id="insertKonkaR3DeptStockInfo" parameterClass="konkaR3DeptStockInfo">
		<selectKey resultClass="long" keyProperty="id">select KONKA_R3_DEPT_STACK_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_R3_DEPT_STOCK_INFO (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="bzirk">BZIRK</isNotNull>	
			<isNotNull prepend="," property="class1">CLASS1</isNotNull>	
			<isNotNull prepend="," property="class2">CLASS2</isNotNull>	
			<isNotNull prepend="," property="kunnr">KUNNR</isNotNull>	
			<isNotNull prepend="," property="matnr">MATNR</isNotNull>	
			<isNotNull prepend="," property="matkl">MATKL</isNotNull>	
			<isNotNull prepend="," property="lfimg">LFIMG</isNotNull>	
			<isNotNull prepend="," property="lfimg1">LFIMG1</isNotNull>	
			<isNotNull prepend="," property="sum_">SUM_</isNotNull>	
			<isNotNull prepend="," property="mzt">MZT</isNotNull>	
			<isNotNull prepend="," property="mwf">MWF</isNotNull>	
			<isNotNull prepend="," property="pdlabst">PDLABST</isNotNull>	
			<isNotNull prepend="," property="zzlabst">ZZLABST</isNotNull>	
			<isNotNull prepend="," property="jylabst">JYLABST</isNotNull>	
			<isNotNull prepend="," property="cllabst">CLLABST</isNotNull>	
			<isNotNull prepend="," property="yjlabst">YJLABST</isNotNull>	
			<isNotNull prepend="," property="tjlabst">TJLABST</isNotNull>	
			<isNotNull prepend="," property="pclabst">PCLABST</isNotNull>	
			<isNotNull prepend="," property="zclabst">ZCLABST</isNotNull>	
			<isNotNull prepend="," property="bclabst">BCLABST</isNotNull>	
			<isNotNull prepend="," property="dzlabst">DZLABST</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bzirk">#bzirk:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="class1">#class1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="class2">#class2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="kunnr">#kunnr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="matnr">#matnr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="matkl">#matkl:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="lfimg">#lfimg:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="lfimg1">#lfimg1:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_">#sum_:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mzt">#mzt:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mwf">#mwf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pdlabst">#pdlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zzlabst">#zzlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jylabst">#jylabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cllabst">#cllabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="yjlabst">#yjlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="tjlabst">#tjlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pclabst">#pclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zclabst">#zclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bclabst">#bclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dzlabst">#dzlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaR3DeptStockInfo" parameterClass="KonkaR3DeptStockInfo">
		update KONKA_R3_DEPT_STOCK_INFO
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bzirk">BZIRK = #bzirk:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="class1">CLASS1 = #class1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="class2">CLASS2 = #class2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="kunnr">KUNNR = #kunnr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="matnr">MATNR = #matnr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="matkl">MATKL = #matkl:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="lfimg">LFIMG = #lfimg:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="lfimg1">LFIMG1 = #lfimg1:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_">SUM_ = #sum_:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mzt">MZT = #mzt:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mwf">MWF = #mwf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pdlabst">PDLABST = #pdlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zzlabst">ZZLABST = #zzlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jylabst">JYLABST = #jylabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cllabst">CLLABST = #cllabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="yjlabst">YJLABST = #yjlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="tjlabst">TJLABST = #tjlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pclabst">PCLABST = #pclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zclabst">ZCLABST = #zclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bclabst">BCLABST = #bclabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dzlabst">DZLABST = #dzlabst:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaR3DeptStockInfo" parameterClass="KonkaR3DeptStockInfo">
		delete from KONKA_R3_DEPT_STOCK_INFO where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" and " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend=" and " property="map.del_s_date"><![CDATA[ADD_DATE >= to_date(#map.del_s_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>