<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SxExtendedPermissions">

    <typeAlias alias="sxExtendedPermissions" type="com.ebiz.mmt.domain.SxExtendedPermissions" />

	
	
    <resultMap id="sxExtendedPermissionsResult" class="sxExtendedPermissions">
		<result property="id" column="ID" jdbcType="DECIMAL" />
		<result property="user_id" column="USER_ID" jdbcType="DECIMAL" />
		<result property="expand_id" column="EXPAND_ID" jdbcType="VARCHAR" />
		<result property="expand_type" column="EXPAND_TYPE" jdbcType="DECIMAL" />
    </resultMap>
    
    <resultMap id="sxExtendedPermissionsBrand" extends="sxExtendedPermissionsResult" class="sxExtendedPermissions">
    	<result property="map.brand_name" column="BRAND_NAME" jdbcType="DECIMAL" />
    </resultMap>
    
    <resultMap id="sxExtendedPermissionsPd" extends="sxExtendedPermissionsResult" class="sxExtendedPermissions">
    	<result property="map.cls_name" column="CLS_NAME" jdbcType="DECIMAL" />
    </resultMap>
    
    <resultMap id="sxExtendedPermissionsSupplier" extends="sxExtendedPermissionsResult" class="sxExtendedPermissions">
    	<result property="map.supplier_code" column="SUPPLIER_CODE" jdbcType="VARCHAR" />
    	<result property="map.supplier_name" column="SUPPLIER_NAME" jdbcType="VARCHAR" />
    </resultMap>
    
    <resultMap id="sxExtendedPermissionsWithClsJoinBrand" class="sxExtendedPermissions">
        <result property="expand_id" column="EXPAND_ID" jdbcType="VARCHAR" />
    	<result property="map.cls_id" column="CLS_ID" jdbcType="DECIMAL" />
    	<result property="map.cls_name" column="CLS_NAME" jdbcType="VARCHAR" />
    	<result property="map.brand_id" column="BRAND_ID" jdbcType="DECIMAL" />
    	<result property="map.brand_name" column="BRAND_NAME" jdbcType="VARCHAR" />
    	<result property="map.cls_brand_name" column="CLS_BRAND_NAME" jdbcType="VARCHAR" />
    </resultMap>    

	<sql id="sf-sxExtendedPermissions">
		<isNotEmpty prepend=" and " property="id">a.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_id">a.USER_ID = #user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="expand_id">a.EXPAND_ID = #expand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="expand_type">a.EXPAND_TYPE = #expand_type:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.selects_expand_id">
			a.EXPAND_ID in ($map.selects_expand_id$)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.not_selects_expand_id">
			a.EXPAND_ID not in ($map.not_selects_expand_id$)
		</isNotEmpty>
	</sql>
	
	<select id="selectSxExtendedPermissions" resultMap="sxExtendedPermissionsResult" parameterClass="sxExtendedPermissions" >
		select * from KONKA_EXTENDED_PERMISSIONS a where 1=1
		<include refid="sf-sxExtendedPermissions" />
	</select>
	
	<select id="selectSxExtendedPermissionsList" resultMap="sxExtendedPermissionsResult" parameterClass="sxExtendedPermissions" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select * from KONKA_EXTENDED_PERMISSIONS a where 1=1
		<include refid="sf-sxExtendedPermissions" />
		<!-- order by a.ID desc -->
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>
	</select>
	
	<select id="selectSxExtendedPermissionsCount" resultClass="long" parameterClass="sxExtendedPermissions" >
		select count(*) from KONKA_EXTENDED_PERMISSIONS a where 1 = 1
		<include refid="sf-sxExtendedPermissions" />
	</select>
	
	<select id="selectSxExtendedPermissionsPaginatedList" resultMap="sxExtendedPermissionsResult" parameterClass="sxExtendedPermissions" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_EXTENDED_PERMISSIONS a where 1=1
		<include refid="sf-sxExtendedPermissions" />
		<!-- order by a.ID desc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectSxExtendedPermissionBrand" resultMap="sxExtendedPermissionsBrand" parameterClass="sxExtendedPermissions" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select a.*,b.brand_name from KONKA_extended_permissions a left join  BASE_BRAND_INFO b
			on a.expand_id = b.brand_id 
			where 1=1 
			<include refid="sf-sxExtendedPermissions" />
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>	
	</select>
	
	<select id="selectSxExtendedPermissionPd" resultMap="sxExtendedPermissionsPd" parameterClass="sxExtendedPermissions" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select a.*,b.cls_name from KONKA_extended_permissions a left join  BASE_PD_CLAZZ b
			on a.expand_id = b.cls_id 
			where 1=1 
			<include refid="sf-sxExtendedPermissions" />
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>	
	</select>
	
	<select id="selectSxExtendedPermissionSupplier" resultMap="sxExtendedPermissionsSupplier" parameterClass="sxExtendedPermissions" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select a.*,b.supplier_code,supplier_name 
		from KONKA_extended_permissions a left join  KONKA_CG_SUPPLIER b
			on a.expand_id = b.id 
			where 1=1 
			<include refid="sf-sxExtendedPermissions" />
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>	
	</select>
	
	<!-- Add by Li,Guohu, Date:2011-07-18 -->
	<!-- 根据扩展权限查找对应的品类、品牌信息 -->
	<select id="selectSxExtendedPermissionWithClsJoinBrand" resultMap="sxExtendedPermissionsWithClsJoinBrand" parameterClass="sxExtendedPermissions" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select distinct a.expand_id,b.cls_id,b.cls_name,b.brand_id,b.brand_name,b.cls_name||'_'||b.brand_name as cls_brand_name
		        from KONKA_extended_permissions a
		  inner join NEW_MV_CLSID_JOIN_BRAND_XXHX b on a.expand_id=b.cls_id||'_'||b.brand_id  
		where 1 = 1
		  <include refid="sf-sxExtendedPermissions" />
		  <isNotEmpty prepend=" and " property="map.key_word">b.cls_name||b.brand_name like '%' || #map.key_word# || '%'</isNotEmpty>
		  order by b.cls_id, b.brand_id
		
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>	
	</select>
	 

	<insert id="insertSxExtendedPermissions" parameterClass="sxExtendedPermissions">
		<selectKey resultClass="long" keyProperty="id">select KONKA_s_base.nextval as id from dual</selectKey>
		<![CDATA[insert into KONKA_EXTENDED_PERMISSIONS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>
			<isNotNull prepend="," property="user_id">USER_ID</isNotNull>
			<isNotNull prepend="," property="expand_id">EXPAND_ID</isNotNull>
			<isNotNull prepend="," property="expand_type">EXPAND_TYPE</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">#user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="expand_id">#expand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="expand_type">#expand_type:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>
	
	<update id="updateSxExtendedPermissions" parameterClass="sxExtendedPermissions">
		update KONKA_EXTENDED_PERMISSIONS
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">USER_ID = #user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="expand_id">EXPAND_ID = #expand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="expand_type">EXPAND_TYPE = #expand_type:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteSxExtendedPermissions" parameterClass="sxExtendedPermissions">
		delete from KONKA_EXTENDED_PERMISSIONS where 1=1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_id">USER_ID = #user_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="expand_type">EXPAND_TYPE = #expand_type:DECIMAL#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
</sqlMap>
