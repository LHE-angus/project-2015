<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_MOBILE_CUST_VISIT">

	<typeAlias alias="konkaMobileCustVisit" type="com.ebiz.mmt.domain.KonkaMobileCustVisit" />

	<typeAlias alias="peProdUser1" type="com.ebiz.mmt.domain.PeProdUser" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaMobileCustVisit" />
		<flushOnExecute statement="updateKonkaMobileCustVisit" />
		<flushOnExecute statement="deleteKonkaMobileCustVisit" />
	</cacheModel>

	<resultMap id="konkaMobileCustVisitResultForList" class="konkaMobileCustVisit">
		<result column="VISIT_ID" property="visit_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="BEGIN_DATE" property="begin_date" jdbcType="TIMESTAMP" />
		<result column="END_DATE" property="end_date" jdbcType="TIMESTAMP" />
		<result column="REPORT_TYPE" property="report_type" jdbcType="DECIMAL" />
		<result column="FEED_LIST" property="feed_list" jdbcType="VARCHAR" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="VISIT_DESC" property="visit_desc" jdbcType="VARCHAR" />
		<result column="YWY_JOB_ID" property="ywy_job_id" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="SUBCOMP_ID" property="subcomp_id" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="VISIT_PER_COUNT" property="visit_per_count"
			jdbcType="DECIMAL" />
		<result column="REPORT_NAE" property="report_nae" jdbcType="VARCHAR" />
		<result column="DATA_SOURCE" property="data_source" jdbcType="DECIMAL" />

		<result column="DOMESTIC_RANKING" property="domestic_ranking"
			jdbcType="DECIMAL" />
		<result column="CONSUMER_SALES" property="consumer_sales"
			jdbcType="DECIMAL" />
		<result column="RETAIL_SALES" property="retail_sales" jdbcType="DECIMAL" />
		<result column="CONSUMER_NAME" property="consumer_name"
			jdbcType="VARCHAR" />
		<result column="CONSUMER_PHONE" property="consumer_phone"
			jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="IMEI" property="imei" jdbcType="VARCHAR" />
		<result column="PHONE_MODEL" property="phone_model" jdbcType="VARCHAR" />
		<result column="FILE_NO" property="file_no" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="peProdUserResultForList" class="peProdUser1">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="PROD_ENTP_ID" property="prod_entp_id" jdbcType="DECIMAL" />
		<result column="USER_TYPE" property="user_type" jdbcType="DECIMAL" />
		<result column="USER_NAME" property="user_name" jdbcType="VARCHAR" />
		<result column="PASS_WORD" property="pass_word" jdbcType="VARCHAR" />
		<result column="REAL_NAME" property="real_name" jdbcType="VARCHAR" />
		<result column="LINK_TEL" property="link_tel" jdbcType="VARCHAR" />
		<result column="LINK_ADDR" property="link_addr" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="DEPARTMENT" property="department" jdbcType="VARCHAR" />
		<result column="CHARGEMAN" property="chargeman" jdbcType="VARCHAR" />
		<result column="IS_CHAPTER" property="is_chapter" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="PAR_DEPT_ID" property="par_dept_id" jdbcType="DECIMAL" />
		<result column="LEADER_ID" property="leader_id" jdbcType="DECIMAL" />
		<result column="POSITION_ID" property="position_id" jdbcType="DECIMAL" />
		<result column="SEX" property="sex" jdbcType="DECIMAL" />
		<result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="LINK_POST" property="link_post" jdbcType="VARCHAR" />
		<result column="LINK_PHONE" property="link_phone" jdbcType="VARCHAR" />
		<result column="LINK_QQ" property="link_qq" jdbcType="VARCHAR" />
		<result column="LINK_MSN" property="link_msn" jdbcType="VARCHAR" />
		<result column="ADD_E_USER_ID" property="add_e_user_id"
			jdbcType="DECIMAL" />
		<result column="ADD_E_USER_ID" property="add_e_user_id"
			jdbcType="DECIMAL" />
		<result column="LOGIN_COUNT" property="login_count" jdbcType="DECIMAL" />
		<result column="LAST_LOGIN_IP" property="last_login_ip"
			jdbcType="VARCHAR" />
		<result column="LAST_LOGIN_TIME" property="last_login_time"
			jdbcType="DATE" />
		<result column="ORDER_VALUE" property="order_value" jdbcType="DECIMAL" />
		<result column="IS_XX_USER" property="is_xx_user" jdbcType="DECIMAL" />
		<result column="JOB_ID" property="job_id" jdbcType="VARCHAR" />
		<result column="CUST_ID" property="cust_id" jdbcType="DECIMAL" />
		<result column="PUBLIC_PWD" property="public_pwd" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaMobileCustVisitResult" class="konkaMobileCustVisit"
		extends="konkaMobileCustVisitResultForList">
	</resultMap>

	<resultMap id="konkaMobileCustVisitResultLB" class="konkaMobileCustVisit"
		extends="konkaMobileCustVisitResultForList">
        <result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR" />
        <result column="CUSTOMER_NAME" property="map.customer_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_NAME" property="map.subcomp_name"
			jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="ADDRESS" property="map.address" jdbcType="VARCHAR" />
		<result column="FJ_PATHS" property="map.fj_paths" jdbcType="VARCHAR" />
		<result column="PHONE_TYPE" property="map.phone_type" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaMobileCustVisitAndDetailResult" class="konkaMobileCustVisit"
		extends="konkaMobileCustVisitResultForList">
		<result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR" />
		<result column="CUSTOMER_NAME" property="map.customer_name"
			jdbcType="VARCHAR" />

		<result column="PAR_CUSTOMER_TYPE" property="map.par_customer_type"
			jdbcType="DECIMAL" />
		<result column="PAR_CUSTOMER_TYPE_NAME" property="map.par_customer_type_name"
			jdbcType="VARCHAR" />
        <result column="CUSTOMER_TYPE" property="map.customer_type"
			jdbcType="DECIMAL" />
		<result column="CUSTOMER_TYPE_NAME" property="map.customer_type_name"
			jdbcType="VARCHAR" />
			
		<result column="SHOP_ID" property="map.shop_id" jdbcType="DECIMAL" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="VISIT_TYPE_NAMES" property="map.visit_type_names"
			jdbcType="VARCHAR" />
		<result column="VISIT_TYPE_IDS" property="map.visit_type_ids"
			jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_NAME" property="map.subcomp_name"
			jdbcType="VARCHAR" />
		<result column="fj_paths" property="map.fj_paths" jdbcType="VARCHAR" />
		<result column="address" property="map.address" jdbcType="VARCHAR" />
		<result column="PHONE_TYPE" property="map.phone_type" jdbcType="VARCHAR" />
	</resultMap>
<resultMap id="konkaMobileCustVisitAndDetailResultNew" class="konkaMobileCustVisit"
		extends="konkaMobileCustVisitResultForList">
		<result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR" />
		<result column="CUSTOMER_NAME" property="map.customer_name"
			jdbcType="VARCHAR" />

		<result column="PAR_CUSTOMER_TYPE" property="map.par_customer_type"
			jdbcType="DECIMAL" />
		<result column="PAR_CUSTOMER_TYPE_NAME" property="map.par_customer_type_name"
			jdbcType="VARCHAR" />
        <result column="CUSTOMER_TYPE" property="map.customer_type"
			jdbcType="DECIMAL" />
		<result column="CUSTOMER_TYPE_NAME" property="map.customer_type_name"
			jdbcType="VARCHAR" />
			
		<result column="SHOP_ID" property="map.shop_id" jdbcType="DECIMAL" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="TYPE_NAME" property="map.visit_type_names"
			jdbcType="VARCHAR" />
		<result column="VISIT_ID" property="map.visit_type_ids"
			jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_NAME" property="map.subcomp_name"
			jdbcType="VARCHAR" />
		<result column="fj_paths" property="map.fj_paths" jdbcType="VARCHAR" />
		<result column="addr" property="map.address" jdbcType="VARCHAR" />
<!-- 		b<result column="PHONE_TYPE" property="map.phone_type" jdbcType="VARCHAR" /> -->
	</resultMap>
	<resultMap id="konkaMobileCustVisitForCountResult" class="konkaMobileCustVisit">
		<result column="REPORT_TYPE" property="report_type" jdbcType="VARCHAR" />
		<result column="REPORT_TYPE_NAME" property="map.report_type_name"
			jdbcType="VARCHAR" />
		<result column="VISIT_COUNT" property="map.visit_count"
			jdbcType="VARCHAR" />
		<result column="CUST_COUNT" property="map.cust_count" jdbcType="DECIMAL" />
		<result column="SHOP_COUNT" property="map.shop_count" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="konkaMobileCustVisitAcountResult" class="konkaMobileCustVisit">
		<result column="USER_ID" property="map.user_id" jdbcType="DECIMAL" />
		<result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
		<result column="DEPT_ONE" property="map.dept_one" jdbcType="DECIMAL" />
		<result column="DEPT_NAME_ONE" property="map.dept_name_one"
			jdbcType="VARCHAR" />
		<result column="DEPT_TWO" property="map.dept_two" jdbcType="VARCHAR" />
		<result column="DEPT_NAME_TWO" property="map.dept_name_two"
			jdbcType="VARCHAR" />
		<result column="DEPT_THREE" property="map.dept_three" jdbcType="VARCHAR" />
		<result column="DEPT_NAME_THREE" property="map.dept_name_three"
			jdbcType="VARCHAR" />
		<result column="JH_VISIT_CUST_COUNT" property="map.jh_visit_cust_count"
			jdbcType="VARCHAR" />
		<result column="JH_VISIT_SHOP_COUNT" property="map.jh_visit_shop_count"
			jdbcType="VARCHAR" />
		<result column="JH_VISIT_COUNT" property="map.jh_visit_count"
			jdbcType="VARCHAR" />
		<result column="BF_COUNT" property="map.bf_count" jdbcType="VARCHAR" />
		<result column="BF_CUST_COUNT" property="map.bf_cust_count"
			jdbcType="VARCHAR" />
		<result column="BF_SHOP_COUNT" property="map.bf_shop_count"
			jdbcType="VARCHAR" />
		<result column="ZC_CUST_VISIT_COUNT" property="map.zc_cust_visit_count"
			jdbcType="VARCHAR" />
		<result column="ZC_SHOP_VISIT_COUNT" property="map.zc_shop_visit_count"
			jdbcType="VARCHAR" />
		<result column="CS_CUST_VISIT_COUNT" property="map.cs_cust_visit_count"
			jdbcType="VARCHAR" />
		<result column="CS_SHOP_VISIT_COUNT" property="map.cs_shop_visit_count"
			jdbcType="VARCHAR" />
		<result column="JH_DEV_CUST_COUNT" property="map.jh_dev_cust_count"
			jdbcType="VARCHAR" />
		<result column="KT_CUST_COUNT" property="map.kt_cust_count"
			jdbcType="VARCHAR" />
		<result column="KT_CUST_VISIT_COUNT" property="map.kt_cust_visit_count"
			jdbcType="VARCHAR" />
		<result column="CUSTBFB" property="map.custbfb" jdbcType="DECIMAL" />
		<result column="SHOPBFB" property="map.shopbfb" jdbcType="DECIMAL" />
		<result column="BF_BFB" property="map.bf_bfb" jdbcType="DECIMAL" />

	</resultMap>
	<!-- 月度 客户or门店 拜报表 -->
	<resultMap id="monthVisitCountResult" class="konkaMobileCustVisit">
		<result column="DEPT_ID" property="map.dept_id" jdbcType="DECIMAL" />
		<result column="ADD_USER_ID" property="map.add_user_id"
			jdbcType="DECIMAL" />

		<result column="DEPT_ID_FGS" property="map.dept_id_fgs"
			jdbcType="DECIMAL" />
		<result column="DEPT_NAME_FGS" property="map.dept_name_fgs"
			jdbcType="VARCHAR" />
		<result column="L4_DEPT_ID" property="map.l4_dept_id" jdbcType="DECIMAL" />
		<result column="L4_DEPT_NAME" property="map.l4_dept_name"
			jdbcType="VARCHAR" />
		<result column="L5_DEPT_id" property="map.l5_dept_id" jdbcType="DECIMAL" />
		<result column="L5_DEPT_NAME" property="map.l5_dept_name"
			jdbcType="VARCHAR" />
		<result column="REPORT_NAE" property="map.report_nae" jdbcType="VARCHAR" />
		<result column="ROLE_NAME" property="map.role_name" jdbcType="VARCHAR" />

		<result column="PAR_CUSTOMER_TYPE" property="map.par_customer_type"
			jdbcType="DECIMAL" />
		<result column="PAR_CUSTOMER_TYPE_NAME" property="map.par_customer_type_name"
			jdbcType="VARCHAR" />

		<result column="ONE_DA" property="map.one_da" jdbcType="DECIMAL" />
		<result column="TWO_DA" property="map.two_da" jdbcType="DECIMAL" />
		<result column="THREE_DA" property="map.three_da" jdbcType="DECIMAL" />
		<result column="FOUR_DA" property="map.four_da" jdbcType="DECIMAL" />
		<result column="FIVE_DA" property="map.five_da" jdbcType="DECIMAL" />
		<result column="SIX_DA" property="map.six_da" jdbcType="DECIMAL" />
		<result column="SEVEN_DA" property="map.seven_da" jdbcType="DECIMAL" />
		<result column="EIGHT_DA" property="map.eight_da" jdbcType="DECIMAL" />
		<result column="NINE_DA" property="map.nine_da" jdbcType="DECIMAL" />
		<result column="TEN_DA" property="map.ten_da" jdbcType="DECIMAL" />
		<result column="ELEVEN_DA" property="map.eleven_da" jdbcType="DECIMAL" />
		<result column="TWELVE_DA" property="map.twelve_da" jdbcType="DECIMAL" />
		<result column="THIRTEEN_DA" property="map.thirteen_da"
			jdbcType="DECIMAL" />
		<result column="FOURTEEN_DA" property="map.fourteen_da"
			jdbcType="DECIMAL" />
		<result column="FIFTEEN_DA" property="map.fifteen_da" jdbcType="DECIMAL" />
		<result column="SIXTEEN_DA" property="map.sixteen_da" jdbcType="DECIMAL" />
		<result column="SEVENTEEN_DA" property="map.seventeen_da"
			jdbcType="DECIMAL" />
		<result column="EIGHTEEN_DA" property="map.eighteen_da"
			jdbcType="DECIMAL" />
		<result column="NINETEEN_DA" property="map.nineteen_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_DA" property="map.twenty_da" jdbcType="DECIMAL" />
		<result column="TWENTY_ONE_DA" property="map.twenty_one_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_TWO_DA" property="map.twenty_two_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_THREE_DA" property="map.twenty_three_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_FOUR_DA" property="map.twenty_four_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_FIVE_DA" property="map.twenty_five_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_SIX_DA" property="map.twenty_six_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_SEVEN_DA" property="map.twenty_seven_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_EIGHT_DA" property="map.twenty_eight_da"
			jdbcType="DECIMAL" />
		<result column="TWENTY_NINE_DA" property="map.twenty_nine_da"
			jdbcType="DECIMAL" />
		<result column="THIRTY_DA" property="map.thirty_da" jdbcType="DECIMAL" />
		<result column="THIRTY_ONE_DA" property="map.thirty_one_da"
			jdbcType="DECIMAL" />
	</resultMap>
	<!-- 客户结果集 -->
	<resultMap class="konkaMobileCustVisit" id="cust"
		extends="monthVisitCountResult">
		<result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR" />
		<result column="CUSTOMER_NAME" property="map.customer_name"
			jdbcType="VARCHAR" />
	</resultMap>
	<!-- 门店结果集 -->
	<resultMap class="konkaMobileCustVisit" id="shop"
		extends="monthVisitCountResult">
		<result column="SHOP_ID" property="map.shop_id" jdbcType="DECIMAL" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="sf-konkaMobileCustVisit">
		<isNotEmpty prepend=" and " property="visit_id">VISIT_ID =
			#visit_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE =
			#add_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="begin_date">BEGIN_DATE =
			#begin_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">END_DATE =
			#end_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_type">REPORT_TYPE =
			#report_type:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="feed_list">FEED_LIST =
			#feed_list:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">STATE =
			#state:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_desc">VISIT_DESC =
			#visit_desc:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_job_id">YWY_JOB_ID =
			#ywy_job_id:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID =
			#dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">SUBCOMP_ID =
			#subcomp_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL =
			#is_del:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID =
			#add_user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_per_count">VISIT_PER_COUNT =
			#visit_per_count:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_nae">REPORT_NAE =
			#report_nae:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="data_source">DATA_SOURCE =
			#data_source:DECIMAL#
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="domestic_ranking">DOMESTIC_RANKING =
			#domestic_ranking:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_sales">CONSUMER_SALES =
			#consumer_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="retail_sales">RETAIL_SALES =
			#retail_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_name">CONSUMER_NAME =
			#consumer_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_phone">CONSUMER_PHONE =
			#consumer_phone:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">REMARK =
			#remark:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="imei">IMEI = #imei:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="phone_model">PHONE_MODEL =
			#phone_model:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="file_no">FILE_NO =
			#file_no:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_start"><![CDATA[ BEGIN_DATE >= to_date(#map.time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_end"><![CDATA[ BEGIN_DATE <= to_date(#map.time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
	</sql>
	<sql id="sf-konkaMobileCustVisitLB">
		<isNotEmpty prepend=" and " property="visit_id">a.VISIT_ID =
			#visit_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE =
			#add_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="begin_date">a.BEGIN_DATE =
			#begin_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">a.BEGIN_DATE =
			#end_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_type">a.REPORT_TYPE =
			#report_type:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="feed_list">a.FEED_LIST =
			#feed_list:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">a.STATE =
			#state:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_desc">a.VISIT_DESC =
			#visit_desc:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_job_id">a.YWY_JOB_ID =
			#ywy_job_id:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID =
			#dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">a.SUBCOMP_ID =
			#subcomp_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL =
			#is_del:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">a.ADD_USER_ID =
			#add_user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_per_count">a.VISIT_PER_COUNT =
			#visit_per_count:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_nae">a.REPORT_NAE =
			#report_nae:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="data_source">a.DATA_SOURCE =
			#data_source:DECIMAL#
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="domestic_ranking">a.DOMESTIC_RANKING =
			#domestic_ranking:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_sales">a.CONSUMER_SALES =
			#consumer_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="retail_sales">a.RETAIL_SALES =
			#retail_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_name">a.CONSUMER_NAME =
			#consumer_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_phone">a.CONSUMER_PHONE =
			#consumer_phone:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">a.REMARK =
			#remark:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="imei">a.IMEI =
			#imei:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="phone_model">a.PHONE_MODEL =
			#phone_model:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="file_no">a.FILE_NO =
			#file_no:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_start"><![CDATA[ a.BEGIN_DATE >= to_date(#map.time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_end"><![CDATA[ a.BEGIN_DATE <= to_date(#map.time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>

		<isNotEmpty prepend=" and " property="map.report_nae_like">a.REPORT_NAE like '%'
			|| #map.report_nae_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_name_like"> a.CUSTOMER_NAME like
		'%' || #map.customer_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.subcomp_name_like">a.SUBCOMP_ID in
			(select dept_id from KONKA_DEPT where dept_name like '%' ||
			#map.subcomp_name_like:VARCHAR# || '%')</isNotEmpty>
	</sql>
	<sql id="sf-konkaMobileCustVisitAndDetail">
		<isNotEmpty prepend=" and " property="visit_id">a.VISIT_ID
			=#visit_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE
			=#add_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="begin_date">a.BEGIN_DATE
			=#begin_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">a.BEGIN_DATE
			=#end_date:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_type">a.REPORT_TYPE
			=#report_type:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="feed_list">a.FEED_LIST
			=#feed_list:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">a.STATE
			=#state:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_desc">a.VISIT_DESC
			=#visit_desc:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="ywy_job_id">a.YWY_JOB_ID
			=#ywy_job_id:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID
			=#dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">a.SUBCOMP_ID
			=#subcomp_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL
			=#is_del:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">a.ADD_USER_ID
			=#add_user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="visit_per_count">a.VISIT_PER_COUNT
			=#visit_per_count:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_nae">a.REPORT_NAE
			=#report_nae:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="data_source">a.DATA_SOURCE
			=#data_source:DECIMAL#
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="domestic_ranking">a.DOMESTIC_RANKING =
			#domestic_ranking:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_sales">a.CONSUMER_SALES =
			#consumer_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="retail_sales">a.RETAIL_SALES =
			#retail_sales:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_name">a.CONSUMER_NAME =
			#consumer_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="consumer_phone">a.CONSUMER_PHONE =
			#consumer_phone:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">a.REMARK =
			#remark:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="imei">a.IMEI =
			#imei:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="phone_model">a.PHONE_MODEL =
			#phone_model:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="file_no">a.FILE_NO =
			#file_no:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_start"><![CDATA[a.BEGIN_DATE >= to_date(#map.time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.time_end"><![CDATA[ a.BEGIN_DATE <= to_date(#map.time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="data_source">a.DATA_SOURCE
			=#data_source:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[a.BEGIN_DATE >= to_date(#map.begin_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[a.BEGIN_DATE <= to_date(#map.end_date#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_like"> b.r3_code like '%' ||
			#map.r3_code_like:VARCHAR# || '%' </isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_name_like"> b.customer_name like
			'%' || #map.customer_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_id"> b.shop_id
			=#map.shop_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_name_like"> b.shop_name like '%'
			|| #map.shop_name_like:VARCHAR# || '%'</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.report_nae_like">a.REPORT_NAE like '%'
			|| #map.report_nae_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.report_type_tj">a.REPORT_TYPE in(1,2)</isNotEmpty>
	</sql>

	<select id="selectKonkaMobileCustVisit" resultMap="konkaMobileCustVisitResult"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select * from KONKA_MOBILE_CUST_VISIT where 1 = 1
		<include refid="sf-konkaMobileCustVisit" />
	</select>

	<select id="selectKonkaMobileCustVisitList" resultMap="konkaMobileCustVisitResultForList"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_MOBILE_CUST_VISIT where 1 = 1
		<include refid="sf-konkaMobileCustVisit" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaMobileCustVisitCount" resultClass="long"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*) from KONKA_MOBILE_CUST_VISIT where 1 = 1
		<include refid="sf-konkaMobileCustVisit" />
	</select>

	<select id="selectKonkaMobileCustVisitPaginatedList" resultMap="konkaMobileCustVisitResult"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_MOBILE_CUST_VISIT where 1 = 1
		<include refid="sf-konkaMobileCustVisit" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaMobileCustVisitLBCount" resultClass="long"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		SELECT count(*)
		FROM (SELECT d.DEPT_NAME, cv.*
		<isNotEmpty prepend=" , " property="report_type">
		   <isEqual property="report_type" compareValue="3" prepend=" ">
		         detail.R3_CODE,detail.CUSTOMER_NAME
		   </isEqual>
		   <isEqual property="report_type" compareValue="4" prepend=" ">
		         '' as R3_CODE, '' as CUSTOMER_NAME
		   </isEqual>
		</isNotEmpty>
		
		FROM
		KONKA_MOBILE_CUST_VISIT cv
		<isNotEmpty prepend=" " property="report_type">
		   <isEqual property="report_type" compareValue="3" prepend=" ">
		    left join KONKA_MOBILE_CUST_VISIT_DETAIL detail
                on cv.VISIT_ID=detail.VISIT_ID
		   </isEqual>
		</isNotEmpty>
		LEFT JOIN
		KONKA_DEPT d
		ON cv.DEPT_ID =
		d.DEPT_ID) a
		LEFT JOIN
		KONKA_DEPT dept
		ON a.SUBCOMP_ID = dept.DEPT_ID
		where 1 = 1
		<include refid="sf-konkaMobileCustVisitLB" />
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(a.dept_id in (
			select
			dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT
			(dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id:DECIMAL#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			a.add_user_id =
			#map.filter_by_ywy_id_eq#
		</isNotEmpty>
	</select>

	<select id="selectKonkaMobileCustVisitPaginatedLBList"
		resultMap="konkaMobileCustVisitResultLB" parameterClass="konkaMobileCustVisit"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT dept.DEPT_NAME AS SUBCOMP_NAME, a.*, decode(p.SHOW_TEXT,null,a.PHONE_MODEL,p.SHOW_TEXT) phone_type
		FROM (SELECT d.DEPT_NAME,
		cv.*,
		<isNotEmpty prepend=" " property="report_type">
		   <isEqual property="report_type" compareValue="3" prepend=" ">
		         detail.R3_CODE,detail.CUSTOMER_NAME,
		   </isEqual>
		   <isEqual property="report_type" compareValue="4" prepend=" ">
		         '' as R3_CODE, '' as CUSTOMER_NAME,
		   </isEqual>
		</isNotEmpty>
		(SELECT gps.ADDR
		FROM KONKA_MOBILE_CUST_VISIT_GPS gps
		WHERE gps.LINK_ID = cv.VISIT_ID and gps.LINK_TAB =
		'KONKA_MOBILE_CUST_VISIT') address,
		(select
		listagg(f.save_path, ',') within group (order by
		f.LINK_ID)
		from
		ATTACHMENT f
		where
		f.LINK_TAB='KONKA_MOBILE_CUST_VISIT' and f.DEL_MARK
		=0 and
		f.LINK_ID=cv.VISIT_ID
		group by
		LINK_ID ) fj_paths
		FROM
		KONKA_MOBILE_CUST_VISIT cv
		<isNotEmpty prepend=" " property="report_type">
		   <isEqual property="report_type" compareValue="3" prepend=" ">
		    left join KONKA_MOBILE_CUST_VISIT_DETAIL detail
                on cv.VISIT_ID=detail.VISIT_ID
		   </isEqual>
		</isNotEmpty>
		LEFT JOIN
		KONKA_DEPT d
		ON cv.DEPT_ID
		=
		d.DEPT_ID) a
		LEFT JOIN KONKA_DEPT dept ON a.SUBCOMP_ID = dept.DEPT_ID
		left join PHONES_INFO p on p.PHONE_TYPE=a.PHONE_MODEL
		where 1 = 1
		<include refid="sf-konkaMobileCustVisitLB" />
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(a.dept_id in (
			select
			dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT
			(dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id:DECIMAL#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			a.add_user_id =
			#map.filter_by_ywy_id_eq#
		</isNotEmpty>
		order by a.BEGIN_DATE desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaMobileCustVisitAndDetailCount"
		resultClass="long" parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*)  FROM
                    (
                        SELECT
                            a.*,
                            b.R3_CODE,
                            b.CUSTOMER_NAME,
                            b.PAR_CUSTOMER_TYPE,
                            b.PAR_CUSTOMER_TYPE_NAME,
                            b.CUSTOMER_TYPE,
                            b.CUSTOMER_TYPE_NAME,
                            b.SHOP_ID,
                            b.SHOP_NAME,
                            b.l5_dept_name dept_name,
                            b.dept_name subcomp_name,
                                gps.addr,
                                    type_ids.type_name,
                                    fj_paths.fj_paths
                        FROM
                            konka_mobile_cust_visit a
                        LEFT JOIN
                            (
                                SELECT
                                    detail.ID,
                                    detail.VISIT_ID,
                                    detail.R3_CODE,
                                    detail.CUSTOMER_NAME,
                                    detail.SHOP_ID,
                                    detail.SHOP_NAME,
                                    cust_all.PAR_CUSTOMER_TYPE,
                                    cust_all.PAR_CUSTOMER_TYPE_NAME,
                                    cust_all.CUSTOMER_TYPE,
                                    cust_all.CUSTOMER_TYPE_NAME,
                                    cust_all.dept_name,
                                    cust_all.l5_dept_name
                               
                                FROM
                                    konka_mobile_cust_visit_detail detail
                                LEFT JOIN
                                    v_org_of_customer_all cust_all
                                ON
                                    detail.R3_CODE = cust_all.R3_CODE ) b
                        ON
                            a.visit_id = b.visit_id
                            left join 
                       
                    KONKA_MOBILE_CUST_VISIT_GPS gps
              on    a.visit_id=gps.link_id
                 and 
                 gps.LINK_TAB = 'KONKA_MOBILE_CUST_VISIT'
              left join 
             (  SELECT visit_id,
                    listagg(f.visit_type_name, ',') within GROUP (ORDER BY f.visit_id)  type_name
                FROM
                    konka_mobile_cust_visit_type f
               
                GROUP BY
                    visit_id ) type_ids
                    on a.visit_id= type_ids.visit_id 
             
             
             
             LEFT JOIN   (
                SELECT link_id,
                    listagg(f.save_path, ',') within GROUP (ORDER BY f.LINK_ID) fj_paths
                FROM
                    ATTACHMENT f
                WHERE
                    f.LINK_TAB='KONKA_MOBILE_CUST_VISIT'
                AND f.DEL_MARK =0
              
                GROUP BY
                    LINK_ID ) fj_paths
                    
                      on fj_paths.LINK_ID=a.VISIT_ID
                    
                    
                        WHERE
                            1=1
			<include refid="sf-konkaMobileCustVisitAndDetail" />
			<isNotEmpty prepend=" and " property="map.dept_id_start">
				(a.dept_id in (
					select
					dept_id from konka_dept start with dept_id in (
					SELECT DISTINCT
					(dept_id)
					FROM KONKA_ROLE_DATA_LEVEL
					WHERE role_id IN (SELECT role_id
					FROM KONKA_PE_ROLE_USER
					WHERE user_id = #map.session_user_id:DECIMAL#)
					) or dept_id = #map.dept_id_start#
					connect by prior dept_id = par_id
					)
				)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
				a.add_user_id =
				#map.filter_by_ywy_id_eq#
			</isNotEmpty>
			)cust_visit
                WHERE
                    1=1
			<isNotEmpty prepend=" and " property="map.cus_type1">cust_visit.PAR_CUSTOMER_TYPE = #map.cus_type1:DECIMAL#</isNotEmpty>
		    <isNotEmpty prepend=" and " property="map.cus_type2">cust_visit.CUSTOMER_TYPE = #map.cus_type2:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.visit_type_name_like">
				type_name like '%' ||
				#map.visit_type_name_like:VARCHAR# || '%'
			</isNotEmpty>
			
	</select>
	<select id="selectKonkaMobileCustVisitAndDetailPaginatedList"
		resultMap="konkaMobileCustVisitAndDetailResultNew" parameterClass="konkaMobileCustVisit"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		 SELECT
                    *
                FROM
                    (
                        SELECT
                            a.*,
                            b.R3_CODE,
                            b.CUSTOMER_NAME,
                            b.PAR_CUSTOMER_TYPE,
                            b.PAR_CUSTOMER_TYPE_NAME,
                            b.CUSTOMER_TYPE,
                            b.CUSTOMER_TYPE_NAME,
                            b.SHOP_ID,
                            b.SHOP_NAME,
                            b.l5_dept_name dept_name,
                            b.dept_name subcomp_name,
                                gps.addr,
                                    type_ids.type_name,
                                    fj_paths.fj_paths
                        FROM
                            konka_mobile_cust_visit a
                        LEFT JOIN
                            (
                                SELECT
                                    detail.ID,
                                    detail.VISIT_ID,
                                    detail.R3_CODE,
                                    detail.CUSTOMER_NAME,
                                    detail.SHOP_ID,
                                    detail.SHOP_NAME,
                                    cust_all.PAR_CUSTOMER_TYPE,
                                    cust_all.PAR_CUSTOMER_TYPE_NAME,
                                    cust_all.CUSTOMER_TYPE,
                                    cust_all.CUSTOMER_TYPE_NAME,
                                    cust_all.dept_name,
                                    cust_all.l5_dept_name
                               
                                FROM
                                    konka_mobile_cust_visit_detail detail
                                LEFT JOIN
                                    v_org_of_customer_all cust_all
                                ON
                                    detail.R3_CODE = cust_all.R3_CODE ) b
                        ON
                            a.visit_id = b.visit_id
                            left join 
                       
                    KONKA_MOBILE_CUST_VISIT_GPS gps
              on    a.visit_id=gps.link_id
                 and 
                 gps.LINK_TAB = 'KONKA_MOBILE_CUST_VISIT'
              left join 
             (  SELECT visit_id,
                    listagg(f.visit_type_name, ',') within GROUP (ORDER BY f.visit_id)  type_name
                FROM
                    konka_mobile_cust_visit_type f
               
                GROUP BY
                    visit_id ) type_ids
                    on a.visit_id= type_ids.visit_id 
             
             
             
             LEFT JOIN   (
                SELECT link_id,
                    listagg(f.save_path, ',') within GROUP (ORDER BY f.LINK_ID) fj_paths
                FROM
                    ATTACHMENT f
                WHERE
                    f.LINK_TAB='KONKA_MOBILE_CUST_VISIT'
                AND f.DEL_MARK =0
              
                GROUP BY
                    LINK_ID ) fj_paths
                    
                      on fj_paths.LINK_ID=a.VISIT_ID
                    
                    
                        WHERE
                            1=1
			<include refid="sf-konkaMobileCustVisitAndDetail" />
			<isNotEmpty prepend=" and " property="map.dept_id_start">
				(a.dept_id in (
					select
					dept_id from konka_dept start with dept_id in (
					SELECT DISTINCT
					(dept_id)
					FROM KONKA_ROLE_DATA_LEVEL
					WHERE role_id IN (SELECT role_id
					FROM KONKA_PE_ROLE_USER
					WHERE user_id = #map.session_user_id:DECIMAL#)
					) or dept_id = #map.dept_id_start#
					connect by prior dept_id = par_id
					)
				)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
				a.add_user_id =
				#map.filter_by_ywy_id_eq#
			</isNotEmpty>
			)cust_visit
                WHERE
                    1=1
			<isNotEmpty prepend=" and " property="map.cus_type1">cust_visit.PAR_CUSTOMER_TYPE = #map.cus_type1:DECIMAL#</isNotEmpty>
		    <isNotEmpty prepend=" and " property="map.cus_type2">cust_visit.CUSTOMER_TYPE = #map.cus_type2:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.visit_type_name_like">
				type_name like '%' ||
				#map.visit_type_name_like:VARCHAR# || '%'
			</isNotEmpty>
			 ORDER BY
                    cust_visit.BEGIN_DATE DESC,
                    cust_visit.ADD_DATE DESC
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaMobileCustVisitAcountCount" resultClass="long"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*) from konka_pe_prod_user a left join V_ORG_OF_DEPT b on
		a.dept_id= b.CUR_DEPT_ID
		where 1=1
		<isNotEmpty prepend=" and " property="map.user_name_like">
			a.real_name like '%'
			||#map.user_name_like:VARCHAR# ||'%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.user_id">
			a.id
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.id in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.id not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188)
	</select>
	<!--查找导出记录数 -->
	<select id="getKonkaMobileCustVisitAcountPaginatedListCount"
		resultClass="long" parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*) from(
		select * from (
		SELECT a.id user_id ,
		a.real_name
		user_name ,
		b.dept_id dept_one,
		b.dept_name dept_name_one,
		b.l4_dept_id
		dept_two,
		b.l4_dept_name dept_name_two,
		b.L5_DEPT_ID dept_three,
		b.L5_DEPT_NAME dept_name_three,
		nvl(( select sum (plan_of_access) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0) jh_visit_count
		from konka_pe_prod_user a left join V_ORG_OF_DEPT
		b on a.dept_id=
		b.CUR_DEPT_ID
		where a.is_del=0
		<isNotEmpty prepend=" and " property="map.user_name_like">
			a.real_name like '%'
			||#map.user_name_like:VARCHAR# ||'%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.user_id">
			a.id
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.id in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.id not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188))where 1=1
		<isNotEmpty prepend="" property="map.jh_visit_count">
			<isNotEmpty prepend=" and " property="map.yjh">
	             <![CDATA[  jh_visit_count >0 ]]>
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.wjh">
	            <![CDATA[  jh_visit_count <= 0 ]]>
			</isNotEmpty>
		</isNotEmpty>
		)

	</select>

	<select id="selectKonkaMobileCustVisitAcountPaginatedList"
		resultMap="konkaMobileCustVisitAcountResult" parameterClass="konkaMobileCustVisit"
		cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from (
		SELECT a.id user_id ,
		a.user_name ,
		b.dept_id
		dept_one,
		b.dept_name dept_name_one,
		b.l4_dept_id dept_two,
		b.l4_dept_name
		dept_name_two,
		b.L5_DEPT_ID dept_three,
		b.L5_DEPT_NAME
		dept_name_three,
		nvl(( select sum (plan_of_access_cust) from
		konka_mobile_visit_plan
		where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0) jh_visit_cust_count,
		nvl(( select sum (plan_of_access_shop) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0) jh_visit_shop_count,
		nvl(( select sum (plan_of_access) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0) jh_visit_count,
		nvl( ( SELECT count(*) from
		KONKA_MOBILE_CUST_VISIT where add_user_id=
		a.id and report_type in(
		'1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) bf_count,
		nvl( ( SELECT sum(decode(detail.R3_CODE,null,0,1))
		FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit
		ON visit.VISIT_ID = detail.VISIT_ID where
		visit.add_user_id= a.id and
		visit.report_type in( '1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) bf_cust_count,
		nvl( ( SELECT sum(decode(detail.shop_id,null,0,1))
		FROM KONKA_MOBILE_CUST_VISIT_DETAIL detail LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit
		ON visit.VISIT_ID = detail.VISIT_ID where
		visit.add_user_id= a.id and
		visit.report_type in( '1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
      <![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      <![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) bf_shop_count,
		nvl(( SELECT sum(decode(detail.R3_CODE,null,0,1))
		FROM KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit
		ON visit.VISIT_ID = detail.VISIT_ID where
		visit.add_user_id= a.id and
		visit.report_type =1
		<isNotEmpty prepend=" and " property="map.begin_time">
		      		<![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
		      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) zc_cust_visit_count,
		nvl(( SELECT
		sum(decode(detail.shop_id,null,0,1)) FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN KONKA_MOBILE_CUST_VISIT
		visit ON visit.VISIT_ID =
		detail.VISIT_ID where visit.add_user_id= a.id
		and visit.report_type =1
		<isNotEmpty prepend=" and " property="map.begin_time">
		     		 <![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
		      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) zc_shop_visit_count,
		nvl( ( SELECT
		sum(decode(detail.R3_CODE,null,0,1)) FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN KONKA_MOBILE_CUST_VISIT
		visit ON visit.VISIT_ID =
		detail.VISIT_ID where visit.add_user_id= a.id
		and visit.report_type =2
		<isNotEmpty prepend=" and " property="map.begin_time">
			      		<![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
			      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) cs_cust_visit_count,
		nvl( ( SELECT
		sum(decode(detail.shop_id,null,0,1)) FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit ON visit.VISIT_ID = detail.VISIT_ID
		where visit.add_user_id= a.id and visit.report_type =2
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) cs_shop_visit_count,
		nvl((SELECT sum (plan_of_dev_cust) FROM
		konka_mobile_visit_plan WHERE add_user_id
		= a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) jh_dev_cust_count,
		nvl(( select count (*) from KONKA_R3_SHOP_DEV g
		where a.ID =YWY_USER_ID
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) kt_cust_count,
		nvl( ( SELECT sum(decode(detail.R3_CODE,null,0,1))
		FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit ON visit.VISIT_ID =
		detail.VISIT_ID where
		visit.add_user_id= a.id and visit.report_type =3
		<isNotEmpty prepend=" and " property="map.begin_time">
     		 <![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0) kt_cust_visit_count,

		decode(nvl(( select sum (plan_of_access_cust)
		from konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
	      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
	      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0),0,'-0.5',
		nvl( ( SELECT sum(decode(detail.R3_CODE,null,0,1))
		FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit
		ON visit.VISIT_ID = detail.VISIT_ID where
		visit.add_user_id= a.id and
		visit.report_type in( '1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
     		 <![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0)/
		nvl(( select sum (plan_of_access_cust) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
     		 <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0)
		)CUSTBFB,

		decode(nvl(( select sum (plan_of_access_shop) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
	      <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
	      <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0),0,'-0.5',
		nvl( ( SELECT sum(decode(detail.shop_id,null,0,1))
		FROM
		KONKA_MOBILE_CUST_VISIT_DETAIL detail LEFT JOIN
		KONKA_MOBILE_CUST_VISIT visit
		ON visit.VISIT_ID = detail.VISIT_ID where
		visit.add_user_id= a.id and
		visit.report_type in( '1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  visit.begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  visit.begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0)/
		nvl(( select sum (plan_of_access_shop) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
     		 <![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0)
		)SHOPBFB,

		decode(nvl(( select sum (plan_of_access) from
		konka_mobile_visit_plan where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
     		 <![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0),0,'-0.5',
		nvl( ( SELECT count(*) from KONKA_MOBILE_CUST_VISIT
		where add_user_id=
		a.id and report_type in( '1', '2', '3')
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		),0)/
		nvl(( select sum (plan_of_access) from konka_mobile_visit_plan
		where
		add_user_id = a.id
		<isNotEmpty prepend=" and " property="map.begin_time">
      		<![CDATA[  plan_begin_date >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
      		<![CDATA[  plan_begin_date <= to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		), 0)
		)BF_BFB
		from konka_pe_prod_user a left join V_ORG_OF_DEPT b on
		a.dept_id=
		b.CUR_DEPT_ID
		where a.cust_id is null and a.is_del=0
		<isNotEmpty prepend=" and " property="map.user_name_like">
			a.user_name like '%'
			||#map.user_name_like:VARCHAR# ||'%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.user_id">
			a.id
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.id in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.id not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188))where 1=1
		<isNotEmpty prepend="" property="map.jh_visit_count">
			<isNotEmpty prepend=" and " property="map.yjh">
	             <![CDATA[  jh_visit_count >0 ]]>
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.wjh">
	            <![CDATA[  jh_visit_count <= 0 ]]>
			</isNotEmpty>
		</isNotEmpty>
		order by custbfb desc,shopbfb desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!-- 查询客户月度天数拜访次数Count -->
	<select id="selectCustMonthVisitListCount" resultClass="long"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*) from (
		select table2.DEPT_ID as
		DEPT_ID_FGS,table2.DEPT_NAME as
		DEPT_NAME_FGS,table2.L4_DEPT_ID,table2.L4_DEPT_NAME,table2.L5_DEPT_ID,table2.L5_DEPT_NAME,table3.ROLE_NAME,table4.PAR_CUSTOMER_TYPE,table4.PAR_CUSTOMER_TYPE_NAME,table1.*
		from(
		select
		R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,sum(one_da)one_da,sum(two_da)two_da,sum(three_da)three_da,sum(four_da)four_da,sum(five_da)five_da,sum(six_da)six_da
		,sum(seven_da)seven_da,sum(eight_da)eight_da,sum(nine_da)nine_da,sum(ten_da)ten_da,sum(eleven_da)eleven_da,sum(twelve_da)twelve_da
		,sum(thirteen_da)thirteen_da,sum(fourteen_da)fourteen_da,sum(fifteen_da)fifteen_da,sum(sixteen_da)sixteen_da,sum(seventeen_da)seventeen_da
		,sum(eighteen_da)eighteen_da,sum(nineteen_da)nineteen_da,sum(twenty_da)twenty_da,sum(twenty_one_da)twenty_one_da,sum(twenty_two_da)twenty_two_da
		,sum(twenty_three_da)twenty_three_da,sum(twenty_four_da)twenty_four_da,sum(twenty_five_da)twenty_five_da,sum(twenty_six_da)twenty_six_da
		,sum(twenty_seven_da)twenty_seven_da,sum(twenty_eight_da)twenty_eight_da,sum(twenty_nine_da)twenty_nine_da,sum(thirty_da)thirty_da,sum(thirty_one_da)thirty_one_da
		from ( select R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'01',1,0) one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'02',1,0) two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'03',1,0) three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'04',1,0) four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'05',1,0) five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'06',1,0) six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'07',1,0) seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'08',1,0) eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'09',1,0) nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'10',1,0) ten_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'11',1,0) eleven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'12',1,0) twelve_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'13',1,0)
		thirteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'14',1,0)
		fourteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'15',1,0)
		fifteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'16',1,0)
		sixteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'17',1,0)
		seventeen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'18',1,0)
		eighteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'19',1,0)
		nineteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'20',1,0) twenty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'21',1,0)
		twenty_one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'22',1,0)
		twenty_two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'23',1,0)
		twenty_three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'24',1,0)
		twenty_four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'25',1,0)
		twenty_five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'26',1,0)
		twenty_six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'27',1,0)
		twenty_seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'28',1,0)
		twenty_eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'29',1,0)
		twenty_nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'30',1,0) thirty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'31',1,0)
		thirty_one_da
		from (
		select
		a.ADD_USER_ID,a.REPORT_NAE,a.BEGIN_DATE,a.END_DATE,a.DEPT_ID,b.R3_CODE,b.CUSTOMER_NAME
		from KONKA_MOBILE_CUST_VISIT a left join
		KONKA_MOBILE_CUST_VISIT_DETAIL b
		on a.VISIT_ID=b.VISIT_ID
		where 1=1
		<isNotEmpty prepend=" and " property="map.begin_time">
				             <![CDATA[ a.BEGIN_DATE >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
				             <![CDATA[ a.BEGIN_DATE < to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<!-- 角色代码 -->
		<isNotEmpty prepend=" and " property="map.user_id">
			a.ADD_USER_ID
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.ADD_USER_ID in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE
			ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.ADD_USER_ID not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188)
		)
		)where R3_CODE is not null group by
		R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID)table1
		left join
		V_ORG_OF_DEPT table2
		on table1.DEPT_ID=table2.cur_dept_id
		left join
		(select role_user.USER_ID,role_user.ROLE_ID,role_info.ROLE_NAME from
		konka_pe_role_user role_user left join konka_pe_role_info role_info on
		role_user.ROLE_ID=role_info.ROLE_ID where <![CDATA[rownum<2]]>
		order by role_info.ROLE_ID desc)table3
		on
		table1.ADD_USER_ID=table3.USER_ID
		left join MV_ORG_OF_CUSTOMER_ALL
		table4
		on table1.R3_CODE=table4.R3_CODE
		where 1=1
		<isNotEmpty prepend=" and " property="map.dept_id_fgs">
			table2.DEPT_ID =
			#map.dept_id_fgs:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l4_dept_id:DECIMAL">
			table2.L4_DEPT_ID =
			#map.l4_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l5_dept_id">
			table2.L5_DEPT_ID =
			#map.l5_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.peport_name_like">
			table1.REPORT_NAE like
			'%' || #map.peport_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_name_like">
			table1.CUSTOMER_NAME
			like '%' || #map.customer_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_like">
			table1.R3_CODE
			like '%'
			|| #map.r3_code_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_customer_type">
			table4.PAR_CUSTOMER_TYPE =
			#map.par_customer_type:DECIMAL#
		</isNotEmpty>
		)
	</select>
	<!-- 查询客户月度天数拜访次数 List -->
	<select id="selectCustMonthVisitList" resultMap="cust"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select table2.DEPT_ID as DEPT_ID_FGS,table2.DEPT_NAME as
		DEPT_NAME_FGS,table2.L4_DEPT_ID,table2.L4_DEPT_NAME,table2.L5_DEPT_ID,table2.L5_DEPT_NAME,table3.ROLE_NAME,table4.PAR_CUSTOMER_TYPE,table4.PAR_CUSTOMER_TYPE_NAME,table1.*
		from(
		select
		R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,sum(one_da)one_da,sum(two_da)two_da,sum(three_da)three_da,sum(four_da)four_da,sum(five_da)five_da,sum(six_da)six_da
		,sum(seven_da)seven_da,sum(eight_da)eight_da,sum(nine_da)nine_da,sum(ten_da)ten_da,sum(eleven_da)eleven_da,sum(twelve_da)twelve_da
		,sum(thirteen_da)thirteen_da,sum(fourteen_da)fourteen_da,sum(fifteen_da)fifteen_da,sum(sixteen_da)sixteen_da,sum(seventeen_da)seventeen_da
		,sum(eighteen_da)eighteen_da,sum(nineteen_da)nineteen_da,sum(twenty_da)twenty_da,sum(twenty_one_da)twenty_one_da,sum(twenty_two_da)twenty_two_da
		,sum(twenty_three_da)twenty_three_da,sum(twenty_four_da)twenty_four_da,sum(twenty_five_da)twenty_five_da,sum(twenty_six_da)twenty_six_da
		,sum(twenty_seven_da)twenty_seven_da,sum(twenty_eight_da)twenty_eight_da,sum(twenty_nine_da)twenty_nine_da,sum(thirty_da)thirty_da,sum(thirty_one_da)thirty_one_da
		from ( select R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'01',1,0) one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'02',1,0) two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'03',1,0) three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'04',1,0) four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'05',1,0) five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'06',1,0) six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'07',1,0) seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'08',1,0) eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'09',1,0) nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'10',1,0) ten_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'11',1,0) eleven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'12',1,0) twelve_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'13',1,0)
		thirteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'14',1,0)
		fourteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'15',1,0)
		fifteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'16',1,0)
		sixteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'17',1,0)
		seventeen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'18',1,0)
		eighteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'19',1,0)
		nineteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'20',1,0) twenty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'21',1,0)
		twenty_one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'22',1,0)
		twenty_two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'23',1,0)
		twenty_three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'24',1,0)
		twenty_four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'25',1,0)
		twenty_five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'26',1,0)
		twenty_six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'27',1,0)
		twenty_seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'28',1,0)
		twenty_eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'29',1,0)
		twenty_nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'30',1,0) thirty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'31',1,0)
		thirty_one_da
		from (
		select
		a.ADD_USER_ID,a.REPORT_NAE,a.BEGIN_DATE,a.END_DATE,a.DEPT_ID,b.R3_CODE,b.CUSTOMER_NAME
		from KONKA_MOBILE_CUST_VISIT a left join
		KONKA_MOBILE_CUST_VISIT_DETAIL b
		on a.VISIT_ID=b.VISIT_ID
		where 1=1
		<isNotEmpty prepend=" and " property="map.begin_time">
				             <![CDATA[ a.BEGIN_DATE >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
				             <![CDATA[ a.BEGIN_DATE < to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<!-- 角色代码 -->
		<isNotEmpty prepend=" and " property="map.user_id">
			a.ADD_USER_ID
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.ADD_USER_ID in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE
			ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.ADD_USER_ID not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188)
		)
		)where R3_CODE is not null group by
		R3_CODE,CUSTOMER_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID)table1
		left join
		V_ORG_OF_DEPT table2
		on table1.DEPT_ID=table2.cur_dept_id
		left join
		(select role_user.USER_ID,role_user.ROLE_ID,role_info.ROLE_NAME from
		konka_pe_role_user role_user left join konka_pe_role_info role_info on
		role_user.ROLE_ID=role_info.ROLE_ID where <![CDATA[rownum<2]]>
		order by role_info.ROLE_ID desc)table3
		on
		table1.ADD_USER_ID=table3.USER_ID
		left join MV_ORG_OF_CUSTOMER_ALL
		table4
		on table1.R3_CODE=table4.R3_CODE
		where 1=1
		<isNotEmpty prepend=" and " property="map.dept_id_fgs">
			table2.DEPT_ID =
			#map.dept_id_fgs:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l4_dept_id:DECIMAL">
			table2.L4_DEPT_ID =
			#map.l4_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l5_dept_id">
			table2.L5_DEPT_ID =
			#map.l5_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.peport_name_like">
			table1.REPORT_NAE like
			'%' || #map.peport_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.customer_name_like">
			table1.CUSTOMER_NAME
			like '%' || #map.customer_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.r3_code_like">
			table1.R3_CODE
			like '%'
			|| #map.r3_code_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_customer_type">
			table4.PAR_CUSTOMER_TYPE =
			#map.par_customer_type:DECIMAL#
		</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!-- 查询门店月度天数拜访次数Count -->
	<select id="selectShopMonthVisitListCount" resultClass="long"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select count(*) from (
		select table2.DEPT_ID as
		DEPT_ID_FGS,table2.DEPT_NAME as
		DEPT_NAME_FGS,table2.L4_DEPT_ID,table2.L4_DEPT_NAME,table2.L5_DEPT_ID,table2.L5_DEPT_NAME,table3.ROLE_NAME,table1.*
		from(
		select
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME,sum(one_da)one_da,sum(two_da)two_da,sum(three_da)three_da,sum(four_da)four_da,sum(five_da)five_da,sum(six_da)six_da
		,sum(seven_da)seven_da,sum(eight_da)eight_da,sum(nine_da)nine_da,sum(ten_da)ten_da,sum(eleven_da)eleven_da,sum(twelve_da)twelve_da
		,sum(thirteen_da)thirteen_da,sum(fourteen_da)fourteen_da,sum(fifteen_da)fifteen_da,sum(sixteen_da)sixteen_da,sum(seventeen_da)seventeen_da
		,sum(eighteen_da)eighteen_da,sum(nineteen_da)nineteen_da,sum(twenty_da)twenty_da,sum(twenty_one_da)twenty_one_da,sum(twenty_two_da)twenty_two_da
		,sum(twenty_three_da)twenty_three_da,sum(twenty_four_da)twenty_four_da,sum(twenty_five_da)twenty_five_da,sum(twenty_six_da)twenty_six_da
		,sum(twenty_seven_da)twenty_seven_da,sum(twenty_eight_da)twenty_eight_da,sum(twenty_nine_da)twenty_nine_da,sum(thirty_da)thirty_da,sum(thirty_one_da)thirty_one_da
		from ( select
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'01',1,0) one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'02',1,0) two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'03',1,0) three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'04',1,0) four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'05',1,0) five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'06',1,0) six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'07',1,0) seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'08',1,0) eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'09',1,0) nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'10',1,0) ten_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'11',1,0) eleven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'12',1,0) twelve_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'13',1,0)
		thirteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'14',1,0)
		fourteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'15',1,0)
		fifteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'16',1,0)
		sixteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'17',1,0)
		seventeen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'18',1,0)
		eighteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'19',1,0)
		nineteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'20',1,0) twenty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'21',1,0)
		twenty_one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'22',1,0)
		twenty_two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'23',1,0)
		twenty_three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'24',1,0)
		twenty_four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'25',1,0)
		twenty_five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'26',1,0)
		twenty_six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'27',1,0)
		twenty_seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'28',1,0)
		twenty_eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'29',1,0)
		twenty_nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'30',1,0) thirty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'31',1,0)
		thirty_one_da
		from (
		select
		a.ADD_USER_ID,a.REPORT_NAE,a.BEGIN_DATE,a.END_DATE,a.DEPT_ID,b.SHOP_ID,b.SHOP_NAME,b.R3_CODE,b.PAR_CUSTOMER_TYPE,b.PAR_CUSTOMER_TYPE_NAME
		from KONKA_MOBILE_CUST_VISIT a left join
		(SELECT
		detail.VISIT_ID,detail.SHOP_ID,detail.SHOP_NAME,store.R3_CODE,store.PAR_CUSTOMER_TYPE,store.PAR_CUSTOMER_TYPE_NAME
		FROM KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN
		(SELECT store1.STORE_ID,
		store1.R3_CODE,
		cust_type.PAR_CUSTOMER_TYPE,
		cust_type.PAR_CUSTOMER_TYPE_NAME
		FROM KONKA_R3_STORE store1
		LEFT JOIN
		MV_ORG_OF_CUSTOMER cust_type
		ON store1.R3_CODE = cust_type.R3_CODE) store
		ON detail.SHOP_ID = store.STORE_ID) b
		on a.VISIT_ID=b.VISIT_ID
		where 1=1
		<!--门店对应的r3code编码 -->
		<isNotEmpty prepend=" and " property="map.par_customer_type">
			b.PAR_CUSTOMER_TYPE=#map.par_customer_type:DECIMAL#
		</isNotEmpty>
		<!--门店对应的客户类型 -->
		<isNotEmpty prepend=" and " property="map.r3_code">
			b.R3_CODE=#map.r3_code:DECIMAL#
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.begin_time">
				             <![CDATA[ a.BEGIN_DATE >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
				             <![CDATA[ a.BEGIN_DATE < to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<!-- 角色代码 -->
		<isNotEmpty prepend=" and " property="map.user_id">
			a.ADD_USER_ID
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.ADD_USER_ID in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE
			ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.ADD_USER_ID not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188)
		)
		)where SHOP_ID is not null group by
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME)table1
		left join
		V_ORG_OF_DEPT table2
		on table1.DEPT_ID=table2.cur_dept_id
		left
		join
		(select role_user.USER_ID,role_user.ROLE_ID,role_info.ROLE_NAME
		from
		konka_pe_role_user role_user left join konka_pe_role_info
		role_info on
		role_user.ROLE_ID=role_info.ROLE_ID where <![CDATA[ rownum<2 ]]>
		order by role_info.ROLE_ID desc)table3
		on
		table1.ADD_USER_ID=table3.USER_ID
		where 1=1
		<isNotEmpty prepend=" and " property="map.dept_id_fgs">
			table2.DEPT_ID =
			#map.dept_id_fgs:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l4_dept_id:DECIMAL">
			table2.L4_DEPT_ID =
			#map.l4_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l5_dept_id">
			table2.L5_DEPT_ID =
			#map.l5_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.peport_name_like">
			table1.REPORT_NAE like
			'%' || #map.peport_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_name_like">
			table1.SHOP_NAME like
			'%' || #map.shop_name_like:VARCHAR# || '%'
		</isNotEmpty>
		)
	</select>
	<!-- 查询门店月度天数拜访次数 List -->
	<select id="selectShopMonthVisitList" resultMap="shop"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select table2.DEPT_ID as DEPT_ID_FGS,table2.DEPT_NAME as
		DEPT_NAME_FGS,table2.L4_DEPT_ID,table2.L4_DEPT_NAME,table2.L5_DEPT_ID,table2.L5_DEPT_NAME,table3.ROLE_NAME,table1.*
		from(
		select
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME,sum(one_da)one_da,sum(two_da)two_da,sum(three_da)three_da,sum(four_da)four_da,sum(five_da)five_da,sum(six_da)six_da
		,sum(seven_da)seven_da,sum(eight_da)eight_da,sum(nine_da)nine_da,sum(ten_da)ten_da,sum(eleven_da)eleven_da,sum(twelve_da)twelve_da
		,sum(thirteen_da)thirteen_da,sum(fourteen_da)fourteen_da,sum(fifteen_da)fifteen_da,sum(sixteen_da)sixteen_da,sum(seventeen_da)seventeen_da
		,sum(eighteen_da)eighteen_da,sum(nineteen_da)nineteen_da,sum(twenty_da)twenty_da,sum(twenty_one_da)twenty_one_da,sum(twenty_two_da)twenty_two_da
		,sum(twenty_three_da)twenty_three_da,sum(twenty_four_da)twenty_four_da,sum(twenty_five_da)twenty_five_da,sum(twenty_six_da)twenty_six_da
		,sum(twenty_seven_da)twenty_seven_da,sum(twenty_eight_da)twenty_eight_da,sum(twenty_nine_da)twenty_nine_da,sum(thirty_da)thirty_da,sum(thirty_one_da)thirty_one_da
		from ( select
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'01',1,0) one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'02',1,0) two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'03',1,0) three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'04',1,0) four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'05',1,0) five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'06',1,0) six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'07',1,0) seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'08',1,0) eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'09',1,0) nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'10',1,0) ten_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'11',1,0) eleven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'12',1,0) twelve_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'13',1,0)
		thirteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'14',1,0)
		fourteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'15',1,0)
		fifteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'16',1,0)
		sixteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'17',1,0)
		seventeen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'18',1,0)
		eighteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'19',1,0)
		nineteen_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'20',1,0) twenty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'21',1,0)
		twenty_one_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'22',1,0)
		twenty_two_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'23',1,0)
		twenty_three_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'24',1,0)
		twenty_four_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'25',1,0)
		twenty_five_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'26',1,0)
		twenty_six_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'27',1,0)
		twenty_seven_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'28',1,0)
		twenty_eight_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'29',1,0)
		twenty_nine_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'30',1,0) thirty_da,
		decode(substr(to_char(begin_date,'yyyymmdd'),7,2),'31',1,0)
		thirty_one_da
		from (
		select
		a.ADD_USER_ID,a.REPORT_NAE,a.BEGIN_DATE,a.END_DATE,a.DEPT_ID,b.SHOP_ID,b.SHOP_NAME,b.R3_CODE,b.PAR_CUSTOMER_TYPE,b.PAR_CUSTOMER_TYPE_NAME
		from KONKA_MOBILE_CUST_VISIT a left join
		(SELECT
		detail.VISIT_ID,detail.SHOP_ID,detail.SHOP_NAME,store.R3_CODE,store.PAR_CUSTOMER_TYPE,store.PAR_CUSTOMER_TYPE_NAME
		FROM KONKA_MOBILE_CUST_VISIT_DETAIL detail
		LEFT JOIN
		(SELECT store1.STORE_ID,
		store1.R3_CODE,
		cust_type.PAR_CUSTOMER_TYPE,
		cust_type.PAR_CUSTOMER_TYPE_NAME
		FROM KONKA_R3_STORE store1
		LEFT JOIN
		MV_ORG_OF_CUSTOMER cust_type
		ON store1.R3_CODE = cust_type.R3_CODE) store
		ON detail.SHOP_ID = store.STORE_ID) b
		on a.VISIT_ID=b.VISIT_ID
		where 1=1
		<!--门店对应的r3code编码 -->
		<isNotEmpty prepend=" and " property="map.par_customer_type">
			b.PAR_CUSTOMER_TYPE=#map.par_customer_type:DECIMAL#
		</isNotEmpty>
		<!--门店对应的客户类型 -->
		<isNotEmpty prepend=" and " property="map.r3_code">
			b.R3_CODE=#map.r3_code:VARCHAR#
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.begin_time">
				             <![CDATA[ a.BEGIN_DATE >= to_date(#map.begin_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_time">
				             <![CDATA[ a.BEGIN_DATE < to_date(#map.end_time#,'yyyy-MM-dd hh24:mi:ss')]]>
		</isNotEmpty>
		<!-- 角色代码 -->
		<isNotEmpty prepend=" and " property="map.user_id">
			a.ADD_USER_ID
			=#map.user_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_dept_id">
			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_dept_id:DECIMAL# connect by prior dept_id = par_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_or_children_dept_id">

			a.dept_id in ( select
			dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior dept_id =
			par_id
			union
			select dept_id from KONKA_DEPT start with dept_id =
			#map.par_or_children_dept_id:DECIMAL# connect by prior par_id =
			dept_id)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.role_ids">
			a.ADD_USER_ID in (SELECT USER_ID FROM KONKA_PE_ROLE_USER WHERE
			ROLE_ID in
			<iterate close=")" open="(" conjunction="," property="map.role_ids">#map.role_ids[]#
			</iterate>
			)
		</isNotEmpty>
		and a.ADD_USER_ID not in (select USER_ID FROM KONKA_PE_ROLE_USER WHERE
		ROLE_ID=188)
		)
		)where SHOP_ID is not null group by
		SHOP_ID,SHOP_NAME,ADD_USER_ID,REPORT_NAE,DEPT_ID,R3_CODE,PAR_CUSTOMER_TYPE,PAR_CUSTOMER_TYPE_NAME)table1
		left join
		V_ORG_OF_DEPT table2
		on table1.DEPT_ID=table2.cur_dept_id
		left
		join
		(select role_user.USER_ID,role_user.ROLE_ID,role_info.ROLE_NAME
		from
		konka_pe_role_user role_user left join konka_pe_role_info
		role_info on
		role_user.ROLE_ID=role_info.ROLE_ID where <![CDATA[ rownum<2 ]]>
		order by role_info.ROLE_ID desc)table3
		on
		table1.ADD_USER_ID=table3.USER_ID
		where 1=1
		<isNotEmpty prepend=" and " property="map.dept_id_fgs">
			table2.DEPT_ID =
			#map.dept_id_fgs:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l4_dept_id:DECIMAL">
			table2.L4_DEPT_ID =
			#map.l4_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.l5_dept_id">
			table2.L5_DEPT_ID =
			#map.l5_dept_id:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.peport_name_like">
			table1.REPORT_NAE like
			'%' || #map.peport_name_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_name_like">
			table1.SHOP_NAME like
			'%' || #map.shop_name_like:VARCHAR# || '%'
		</isNotEmpty>
		
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- 通取当前登陆用户的业务员列表 -->
	<select id="selectYwyByUserList" resultMap="peProdUserResultForList"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		select * from konka_pe_prod_user where dept_id in(
		select dept_id from
		konka_dept start with dept_id in (
		SELECT DISTINCT (dept_id)
		FROM
		KONKA_ROLE_DATA_LEVEL
		WHERE role_id IN (SELECT role_id
		FROM
		KONKA_PE_ROLE_USER
		WHERE 1=1
		<isNotEmpty prepend=" and " property="map.userId">
			user_id =
			#map.userId:DECIMAL#
		</isNotEmpty>
		)
		)
		<isNotEmpty prepend=" or " property="map.deptId">
			dept_id =
			#map.deptId:DECIMAL#
		</isNotEmpty>
		connect by prior dept_id = par_id )
		and id in (select user_id from
		KONKA_PE_ROLE_USER where role_id =60)
	</select>

	<select id="selectKonkaMobileCustVisitForCount" resultMap="konkaMobileCustVisitForCountResult"
		parameterClass="konkaMobileCustVisit" cacheModel="oneDayCache">
		SELECT decode(a.report_type,1,1,2,1,3,3,4,4) report_type,
		(CASE
		decode(a.report_type,1,1,2,1,3,3,4,4)
		WHEN '1' THEN '正常客户拜访'
		WHEN '2'
		THEN '老客户重拾拜访'
		WHEN '3' THEN '新客户开拓上报'
		WHEN '4' THEN '事物日志上报'
		ELSE '其他'
		END) report_type_name,
		count (a.report_type) visit_count,
		sum (decode
		(deatil.r3_code,NULL, 0,1)) cust_count,
		sum (decode
		(deatil.shop_id,NULL,0,1)) shop_count
		FROM KONKA_MOBILE_CUST_VISIT a
		LEFT JOIN KONKA_MOBILE_CUST_VISIT_DETAIL deatil
		ON a.visit_id =
		deatil.visit_id
		WHERE 1 = 1
		<include refid="sf-konkaMobileCustVisitAndDetail" />
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			(a.dept_id in (
			select
			dept_id from konka_dept start with dept_id in (
			SELECT DISTINCT
			(dept_id)
			FROM KONKA_ROLE_DATA_LEVEL
			WHERE role_id IN (SELECT role_id
			FROM KONKA_PE_ROLE_USER
			WHERE user_id = #map.session_user_id:DECIMAL#)
			) or dept_id = #map.dept_id_start#
			connect by prior dept_id = par_id
			)
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_by_ywy_id_eq">
			a.add_user_id =
			#map.filter_by_ywy_id_eq#
		</isNotEmpty>
		GROUP BY decode(a.report_type,1,1,2,1,3,3,4,4)
	</select>



	<insert id="insertKonkaMobileCustVisit" parameterClass="konkaMobileCustVisit">
		<selectKey resultClass="long" keyProperty="visit_id">select
			SEQ_MOBILE_BUSINESS.nextval as visit_id from dual
		</selectKey>
		<![CDATA[insert into KONKA_MOBILE_CUST_VISIT (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="visit_id">VISIT_ID</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>
			<isNotNull prepend="," property="begin_date">BEGIN_DATE</isNotNull>
			<isNotNull prepend="," property="end_date">END_DATE</isNotNull>
			<isNotNull prepend="," property="report_type">REPORT_TYPE</isNotNull>
			<isNotNull prepend="," property="feed_list">FEED_LIST</isNotNull>
			<isNotNull prepend="," property="state">STATE</isNotNull>
			<isNotNull prepend="," property="visit_desc">VISIT_DESC</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">YWY_JOB_ID</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>
			<isNotNull prepend="," property="visit_per_count">VISIT_PER_COUNT</isNotNull>
			<isNotNull prepend="," property="report_nae">REPORT_NAE</isNotNull>
			<isNotNull prepend="," property="data_source">DATA_SOURCE</isNotNull>
			<isNotNull prepend="," property="domestic_ranking">DOMESTIC_RANKING
			</isNotNull>
			<isNotNull prepend="," property="consumer_sales">CONSUMER_SALES</isNotNull>
			<isNotNull prepend="," property="retail_sales">RETAIL_SALES</isNotNull>
			<isNotNull prepend="," property="consumer_name">CONSUMER_NAME</isNotNull>
			<isNotNull prepend="," property="consumer_phone">CONSUMER_PHONE</isNotNull>
			<isNotNull prepend="," property="remark">REMARK</isNotNull>
			<isNotNull prepend="," property="imei">IMEI</isNotNull>
			<isNotNull prepend="," property="phone_model">PHONE_MODEL</isNotNull>
			<isNotNull prepend="," property="file_no">FILE_NO</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="visit_id">#visit_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="begin_date">#begin_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="end_date">#end_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="report_type">#report_type:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="feed_list">#feed_list:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="state">#state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="visit_desc">#visit_desc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">#ywy_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="subcomp_id">#subcomp_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="visit_per_count">#visit_per_count:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="report_nae">#report_nae:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="data_source">#data_source:DECIMAL#
			</isNotNull>

			<isNotNull prepend="," property="domestic_ranking">#domestic_ranking:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="consumer_sales">#consumer_sales:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="retail_sales">#retail_sales:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="consumer_name">#consumer_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="consumer_phone">#consumer_phone:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="remark">#remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="imei">#imei:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="phone_model">#phone_model:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="file_no">#file_no:VARCHAR#
			</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaMobileCustVisit" parameterClass="KonkaMobileCustVisit">
		update KONKA_MOBILE_CUST_VISIT
		<dynamic prepend="set">
			<isNotNull prepend="," property="visit_id">VISIT_ID =
				#visit_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE =
				#add_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="begin_date">BEGIN_DATE =
				#begin_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="end_date">END_DATE =
				#end_date:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="report_type">REPORT_TYPE =
				#report_type:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="feed_list">FEED_LIST =
				#feed_list:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="state">STATE = #state:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="visit_desc">VISIT_DESC =
				#visit_desc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywy_job_id">YWY_JOB_ID =
				#ywy_job_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID =
				#subcomp_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID =
				#add_user_id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="visit_per_count">VISIT_PER_COUNT =
				#visit_per_count:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="report_nae">REPORT_NAE =
				#report_nae:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="data_source">DATA_SOURCE =
				#data_source:DECIMAL#
			</isNotNull>

			<isNotNull prepend="," property="domestic_ranking">DOMESTIC_RANKING =
				#domestic_ranking:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="consumer_sales">CONSUMER_SALES =
				#consumer_sales:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="retail_sales">RETAIL_SALES =
				#retail_sales:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="consumer_name">CONSUMER_NAME =
				#consumer_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="consumer_phone">CONSUMER_PHONE =
				#consumer_phone:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="remark">REMARK = #remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="imei">IMEI = #imei:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="phone_model">PHONE_MODEL =
				#phone_model:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="file_no">FILE_NO = #file_no:VARCHAR#
			</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="visit_id">VISIT_ID = #visit_id#
		</isNotEmpty>
		<isEmpty prepend=" " property="visit_id">
			<isNotEmpty prepend=" " property="map.pks">
				VISIT_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#
				</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaMobileCustVisit" parameterClass="KonkaMobileCustVisit">
		delete from KONKA_MOBILE_CUST_VISIT where
		<isNotEmpty prepend=" " property="visit_id">VISIT_ID = #visit_id#
		</isNotEmpty>
		<isEmpty prepend=" " property="visit_id">
			<isNotEmpty prepend=" " property="map.pks">
				VISIT_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#
				</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>