<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="STD_ENTP_PROD">

	<typeAlias alias="stdEntpProd" type="com.ebiz.mmt.domain.StdEntpProd" />

	

	<resultMap id="stdEntpProdResultForList" class="stdEntpProd">
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="ENTP_NAME" property="entp_name" jdbcType="VARCHAR" />
		<result column="ENTP_SNAME" property="entp_sname" jdbcType="VARCHAR" />
		<result column="ENTP_ENAME" property="entp_ename" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="C_INDEX" property="c_index" jdbcType="VARCHAR" />
		<result column="PAR_ID" property="par_id" jdbcType="DECIMAL" />
		<result column="ROOT_ENTP_ID" property="root_entp_id" jdbcType="DECIMAL" />
		<result column="MAIN_PD" property="main_pd" jdbcType="VARCHAR" />
		<result column="ENTP_KIND" property="entp_kind" jdbcType="DECIMAL" />
		<result column="ENTP_SIZE" property="entp_size" jdbcType="VARCHAR" />
		<result column="ENTP_LICENCE" property="entp_licence" jdbcType="VARCHAR" />
		<result column="CORPORATION" property="corporation" jdbcType="VARCHAR" />
		<result column="ADDR" property="addr" jdbcType="VARCHAR" />
		<result column="POSTCODE" property="postcode" jdbcType="VARCHAR" />
		<result column="LINKMAN" property="linkman" jdbcType="VARCHAR" />
		<result column="TEL" property="tel" jdbcType="VARCHAR" />
		<result column="FAX" property="fax" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="WWW" property="www" jdbcType="VARCHAR" />
		<result column="IS_RECORD" property="is_record" jdbcType="DECIMAL" />
		<result column="SQ_SERIAL" property="sq_serial" jdbcType="VARCHAR" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="INFO_STATE" property="info_state" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="stdEntpProdResult" class="stdEntpProd" extends="stdEntpProdResultForList">
	</resultMap>
	
	<resultMap id="stdEntpProdResultForLogo" class="stdEntpProd">
		<result column="BRAND_LOGO" property="map.brand_logo" jdbcType="VARCHAR" />
		<result column="WWW" property="map.www" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="EntpProdForjoinBrandInfoResult" class="stdEntpProd">
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="ENTP_NAME" property="entp_name" jdbcType="VARCHAR" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="BRANDS" property="map.brands" jdbcType="VARCHAR" />
		<result column="BRANDIDS" property="map.brandids" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="stdEntpProdForjoinBrandAndEntpProdResult" class="stdEntpProd" extends="stdEntpProdResultForList">
		<result column="BRAND_ID" property="map.brand_id" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="MMT_ENTP_ID" property="map.mmt_entp_id" jdbcType="VARCHAR" />
		<result column="MMT_ENTP_NAME" property="map.mmt_entp_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="sf-stdEntpProd">
		<isNotEmpty prepend=" and " property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_name">ENTP_NAME = #entp_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_sname">ENTP_SNAME = #entp_sname:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_ename">ENTP_ENAME = #entp_ename:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_index">C_INDEX = #c_index:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_id">PAR_ID = #par_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="root_entp_id">ROOT_ENTP_ID = #root_entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="main_pd">MAIN_PD = #main_pd:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_kind">ENTP_KIND = #entp_kind:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_size">ENTP_SIZE = #entp_size:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_licence">ENTP_LICENCE = #entp_licence:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="corporation">CORPORATION = #corporation:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr">ADDR = #addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="postcode">POSTCODE = #postcode:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="linkman">LINKMAN = #linkman:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="tel">TEL = #tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fax">FAX = #fax:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="email">EMAIL = #email:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="www">WWW = #www:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_record">IS_RECORD = #is_record:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sq_serial">SQ_SERIAL = #sq_serial:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="info_state">INFO_STATE = #info_state:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.entp_name_like">ENTP_NAME like '%' || #map.entp_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index">P_INDEX IN (
		select P_INDEX from KONKA_BASE_PROVINCE_LIST start with p_index=#map.p_index# connect by prior p_index=par_index
		)</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.entp_id_in_entp_pd_province">
			ENTP_ID in (select distinct t.entp_id from konka_entp_pd_province t where t.pd_type = #map.entp_id_in_entp_pd_province:DECIMAL#)
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.entp_id_in">
			ENTP_ID in (<iterate close=")" open="(" conjunction="," property="map.entp_id_in">#map.entp_id_in[]#</iterate>)
		</isNotEmpty>
	</sql>

	<select id="selectStdEntpProd" resultMap="stdEntpProdResult" parameterClass="stdEntpProd" >
		select * from KONKA_STD_ENTP_PROD where 1 = 1
		<include refid="sf-stdEntpProd" />
	</select>

	<select id="selectStdEntpProdList" resultMap="stdEntpProdResultForList" parameterClass="stdEntpProd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_STD_ENTP_PROD where 1 = 1
		<include refid="sf-stdEntpProd" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectStdEntpProdForLogoList" resultMap="stdEntpProdResultForLogo" parameterClass="stdEntpProd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		SELECT s.www, b.brand_logo
		  FROM KONKA_STD_ENTP_PROD s
		  left join KONKA_STD_ENTP_PROD_JOIN_BRAND_ID st on s.entp_id = st.entp_id
		  left join KONKA_BASE_BRAND_INFO b on st.brand_id = b.brand_id
		 WHERE substr(s.p_index, 0, 2) = substr(#map.p_index#,0,2) and s.info_state = 0 and b.brand_logo is not null
		 order by b.brand_logo
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectStdEntpProdCount" resultClass="long" parameterClass="stdEntpProd" >
		select count(*) from KONKA_STD_ENTP_PROD where 1 = 1
		<include refid="sf-stdEntpProd" />
	</select>

	<select id="selectStdEntpProdPaginatedList" resultMap="stdEntpProdResult" parameterClass="stdEntpProd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_STD_ENTP_PROD where 1 = 1
		<include refid="sf-stdEntpProd" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- MMT后台管理 品牌生产企业管理  coding by Du,HongGang 2010-10-25 -->
	<select id="selectEntpProdForjoinBrandInfoList" resultMap="EntpProdForjoinBrandInfoResult" parameterClass="stdEntpProd"	>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select s.entp_id, s.entp_name, s.own_sys, to_char(listagg(b.brand_name, ',')) as brands, to_char(listagg(b.brand_id, ',')) as brandIds
		  from konka_std_entp_prod s
		  full join std_entp_prod_join_brand_id j on s.entp_id = j.entp_id
		                                         and j.own_sys = s.own_sys
		  left join konka_base_brand_info b on j.brand_id = b.brand_id
		 group by s.entp_id, s.entp_name, s.own_sys
		 order by brands,s.entp_id
		 <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectEntpProdForjoinBrandInfo" resultMap="EntpProdForjoinBrandInfoResult" parameterClass="stdEntpProd"	>
		select s.entp_id, s.entp_name, s.own_sys, to_char(listagg(b.brand_name, ',')) as brands, to_char(listagg(b.brand_id, ',')) as brandIds
		  from konka_std_entp_prod s
		  full join std_entp_prod_join_brand_id j on s.entp_id = j.entp_id
		                                         and j.own_sys = s.own_sys
		  left join konka_base_brand_info b on j.brand_id = b.brand_id
		  where 1 = 1
		  <isNotEmpty prepend=" and " property="entp_id">s.ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
	      <isNotEmpty prepend=" and " property="own_sys">s.OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		 group by s.entp_id, s.entp_name, s.own_sys
	</select>
	
	<select id="selectStdEntpProdForjoinBrandAndEntpProdCount" resultClass="long" parameterClass="stdEntpProd" >
		select count(*)
		from konka_std_entp_prod aa 
		left join std_entp_prod_join_brand_id bb on aa.entp_id = bb.entp_id and aa.own_sys = bb.own_sys
		left join base_brand_info cc on bb.brand_id = cc.brand_id
		left join konka_entp_prod dd on cc.brand_id = dd.brand_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.entp_name_like">aa.ENTP_NAME like '%' || #map.entp_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index">aa.P_INDEX IN (
		select P_INDEX from KONKA_BASE_PROVINCE_LIST start with p_index=#map.p_index# connect by prior p_index=par_index
		)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_name_like">UPPER(cc.BRAND_NAME) like '%' || UPPER(#map.brand_name_like:VARCHAR#) || '%'</isNotEmpty>
	</select>
	
	<select id="selectStdEntpProdForjoinBrandAndEntpProdPaginatedList" resultMap="stdEntpProdForjoinBrandAndEntpProdResult" parameterClass="stdEntpProd"	>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select aa.*,bb.brand_id,cc.brand_name,dd.entp_id mmt_entp_id,dd.entp_name mmt_entp_name
		from konka_std_entp_prod aa 
		left join std_entp_prod_join_brand_id bb on aa.entp_id = bb.entp_id and aa.own_sys = bb.own_sys
		left join konka_base_brand_info cc on bb.brand_id = cc.brand_id
		left join konka_entp_prod dd on cc.brand_id = dd.brand_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.entp_name_like">UPPER(aa.ENTP_NAME) like '%' || UPPER(#map.entp_name_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index">aa.P_INDEX IN (
		select P_INDEX from KONKA_BASE_PROVINCE_LIST start with p_index=#map.p_index# connect by prior p_index=par_index
		)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_name_like">UPPER(cc.BRAND_NAME) like '%' || UPPER(#map.brand_name_like:VARCHAR#) || '%'</isNotEmpty>
		order by bb.brand_id asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectStdEntpProdNotBrandIdCount" resultClass="long" parameterClass="stdEntpProd" >
		select count(*)
		from konka_std_entp_prod aa 
		left join std_entp_prod_join_brand_id bb on aa.entp_id = bb.entp_id and aa.own_sys = bb.own_sys
		where bb.brand_id is null
		<!-- order by ID asc -->
	</select>
	
	<select id="selectStdEntpProdNotBrandIdList" resultMap="stdEntpProdResultForList" parameterClass="stdEntpProd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select aa.*
		from konka_std_entp_prod aa 
		left join std_entp_prod_join_brand_id bb on aa.entp_id = bb.entp_id and aa.own_sys = bb.own_sys
		where bb.brand_id is null
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<insert id="insertStdEntpProd" parameterClass="stdEntpProd">
		<selectKey resultClass="long" keyProperty="id">select seq_xxx.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_STD_ENTP_PROD (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="entp_id">ENTP_ID</isNotNull>	
			<isNotNull prepend="," property="entp_name">ENTP_NAME</isNotNull>	
			<isNotNull prepend="," property="entp_sname">ENTP_SNAME</isNotNull>	
			<isNotNull prepend="," property="entp_ename">ENTP_ENAME</isNotNull>	
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>	
			<isNotNull prepend="," property="c_index">C_INDEX</isNotNull>	
			<isNotNull prepend="," property="par_id">PAR_ID</isNotNull>	
			<isNotNull prepend="," property="root_entp_id">ROOT_ENTP_ID</isNotNull>	
			<isNotNull prepend="," property="main_pd">MAIN_PD</isNotNull>	
			<isNotNull prepend="," property="entp_kind">ENTP_KIND</isNotNull>	
			<isNotNull prepend="," property="entp_size">ENTP_SIZE</isNotNull>	
			<isNotNull prepend="," property="entp_licence">ENTP_LICENCE</isNotNull>	
			<isNotNull prepend="," property="corporation">CORPORATION</isNotNull>	
			<isNotNull prepend="," property="addr">ADDR</isNotNull>	
			<isNotNull prepend="," property="postcode">POSTCODE</isNotNull>	
			<isNotNull prepend="," property="linkman">LINKMAN</isNotNull>	
			<isNotNull prepend="," property="tel">TEL</isNotNull>	
			<isNotNull prepend="," property="fax">FAX</isNotNull>	
			<isNotNull prepend="," property="email">EMAIL</isNotNull>	
			<isNotNull prepend="," property="www">WWW</isNotNull>	
			<isNotNull prepend="," property="is_record">IS_RECORD</isNotNull>	
			<isNotNull prepend="," property="sq_serial">SQ_SERIAL</isNotNull>	
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>	
			<isNotNull prepend="," property="info_state">INFO_STATE</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="entp_id">#entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_name">#entp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_sname">#entp_sname:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_ename">#entp_ename:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_index">#c_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="par_id">#par_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="root_entp_id">#root_entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="main_pd">#main_pd:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_kind">#entp_kind:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_size">#entp_size:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_licence">#entp_licence:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="corporation">#corporation:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr">#addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="postcode">#postcode:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="linkman">#linkman:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="tel">#tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="fax">#fax:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="email">#email:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="www">#www:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_record">#is_record:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sq_serial">#sq_serial:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="info_state">#info_state:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateStdEntpProd" parameterClass="StdEntpProd">
		update KONKA_STD_ENTP_PROD
		<dynamic prepend="set">
			<isNotNull prepend="," property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_name">ENTP_NAME = #entp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_sname">ENTP_SNAME = #entp_sname:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_ename">ENTP_ENAME = #entp_ename:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_index">C_INDEX = #c_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="par_id">PAR_ID = #par_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="root_entp_id">ROOT_ENTP_ID = #root_entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="main_pd">MAIN_PD = #main_pd:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_kind">ENTP_KIND = #entp_kind:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_size">ENTP_SIZE = #entp_size:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="entp_licence">ENTP_LICENCE = #entp_licence:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="corporation">CORPORATION = #corporation:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr">ADDR = #addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="postcode">POSTCODE = #postcode:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="linkman">LINKMAN = #linkman:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="tel">TEL = #tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="fax">FAX = #fax:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="email">EMAIL = #email:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="www">WWW = #www:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_record">IS_RECORD = #is_record:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sq_serial">SQ_SERIAL = #sq_serial:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="info_state">INFO_STATE = #info_state:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteStdEntpProd" parameterClass="StdEntpProd">
		delete from KONKA_STD_ENTP_PROD where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>