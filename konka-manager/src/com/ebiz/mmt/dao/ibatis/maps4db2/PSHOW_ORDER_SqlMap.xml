<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PSHOW_ORDER">

	<typeAlias alias="pshowOrder" type="com.ebiz.mmt.domain.PshowOrder" />
	<!-- add by Jiang,Jiayong 2013-08-15 -->
	<typeAlias alias="pshowOrdeDetails" type="com.ebiz.mmt.domain.PshowOrdeDetails" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertPshowOrder" />
		<flushOnExecute statement="updatePshowOrder" />
		<flushOnExecute statement="deletePshowOrder" />
	</cacheModel>

	<resultMap id="pshowOrderResultForList" class="pshowOrder">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="UUID" property="uuid" jdbcType="VARCHAR" />
		<result column="TRADE_INDEX" property="trade_index" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="OPR_DEPT_ID" property="opr_dept_id" jdbcType="DECIMAL" />
		<result column="TOTAL_PRICE" property="total_price" jdbcType="DECIMAL" />
		<result column="ORDER_USER_ID" property="order_user_id" jdbcType="DECIMAL" />
		<result column="ORDER_USER_NAME" property="order_user_name" jdbcType="VARCHAR" />
		<result column="BUYER_NAME" property="buyer_name" jdbcType="VARCHAR" />
		<result column="BUYER_P_INDEX" property="buyer_p_index" jdbcType="DECIMAL" />
		<result column="BUYER_ADDR" property="buyer_addr" jdbcType="VARCHAR" />
		<result column="BUYER_ZIP" property="buyer_zip" jdbcType="VARCHAR" />
		<result column="BUYER_TEL" property="buyer_tel" jdbcType="VARCHAR" />
		<result column="BUYER_MP" property="buyer_mp" jdbcType="VARCHAR" />
		<result column="DELIVER_WAY" property="deliver_way" jdbcType="DECIMAL" />
		<result column="DELIVER_TIME" property="deliver_time" jdbcType="DECIMAL" />
		<result column="DELIVER_IS_CALL" property="deliver_is_call" jdbcType="DECIMAL" />
		<result column="PAY_WAY" property="pay_way" jdbcType="DECIMAL" />
		<result column="BILL_IS_ADD" property="bill_is_add" jdbcType="DECIMAL" />
		<result column="BILL_TYPE" property="bill_type" jdbcType="DECIMAL" />
		<result column="BILL_HEAD" property="bill_head" jdbcType="DECIMAL" />
		<result column="BILL_CONTENT" property="bill_content" jdbcType="DECIMAL" />
		<result column="BILL_COMPANY" property="bill_company" jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="DEPT_REMARK" property="dept_remark" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="DEL_DATE" property="del_date" jdbcType="TIMESTAMP" />
		<result column="TRADE_NO" property="trade_no" jdbcType="VARCHAR" />
		<result column="PAY_DATE" property="pay_date" jdbcType="TIMESTAMP" />
		<result column="ORDER_FROM" property="order_from" jdbcType="DECIMAL" />
		<result column="ORDER_TYPE" property="order_type" jdbcType="DECIMAL" />
		<result column="LOGISTIC_TYPE" property="logistic_type" jdbcType="DECIMAL" />
		<result column="LOGISTIC_SN" property="logistic_sn" jdbcType="VARCHAR" />
		<result column="SFHK_ORDER_NAME" property="sfhk_order_name" jdbcType="VARCHAR" />
		
		<result column="PAY_ACCOUNT_ID" property="pay_account_id" jdbcType="DECIMAL" />
		<result column="EXPRESS_ID" property="express_id" jdbcType="DECIMAL" />
		<result column="WL_YF" property="wl_yf" jdbcType="DECIMAL" />
		<result column="INTEGRAL" property="integral" jdbcType="DECIMAL" />
		<result column="DEDU_PRICE" property="dedu_price" jdbcType="DECIMAL" />
		<result column="PAY_PRICE" property="pay_price" jdbcType="DECIMAL" />
		<result column="CODE" property="code" jdbcType="VARCHAR" />
		<result column="IS_HDFK" property="is_hdfk" jdbcType="DECIMAL" />
		<result column="PAR_ORDER_ID" property="par_order_id" jdbcType="DECIMAL" />
		<result column="IS_DEDUCTION" property="is_deduction" jdbcType="DECIMAL" />
		<result column="IS_R3" property="is_r3" jdbcType="DECIMAL" />
		<result column="IS_PS" property="is_ps" jdbcType="DECIMAL" />
		<result column="IS_SELF" property="is_self" jdbcType="DECIMAL" />
		<result column="SELF_ID" property="self_id" jdbcType="DECIMAL" />
		<result column="PS_ID" property="ps_id" jdbcType="DECIMAL" />
		<result column="PAY_INTEGRAL" property="pay_integral" jdbcType="DECIMAL" />
		<result column="JIANYIGUAJIA" property="jianyiguajia" jdbcType="DECIMAL" />
		<result column="ID" property="ecVouchersList" select="selectEcVouchersByOrderId" />
		<result column="ID" property="pshowOrdeExchangeList" select="selectPshowOrdeExchangeListByOldOrderId" />
	</resultMap>	

	<resultMap id="pshowOrderResult" class="pshowOrder" extends="pshowOrderResultForList">
	</resultMap>
	
	<!-- add by Jiang,Jiayong 2013-08-15 -->
	<resultMap id="pshowOrderResultIncludeDetails" class="pshowOrder" extends="pshowOrderResultForList">
		<result property="pshowOrdeDetailsList" select="selectPshowOrdeDetailsWithIdList" column="id"/>
	</resultMap>

	<!-- add by Jiang,Jiayong 2013-08-15 -->
	<resultMap id="pshowOrdeDetailsResultForList" class="pshowOrdeDetails">
		<result column="BILL_ITEM_ID" property="bill_item_id" jdbcType="DECIMAL" />
		<result column="ORDER_ID" property="order_id" jdbcType="DECIMAL" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="NUM" property="num" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="TOTAL_PRICE" property="total_price" jdbcType="DECIMAL" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="MAIN_PIC" property="map.main_pic" jdbcType="VARCHAR" />
		<result column="PD_SN" property="map.pd_sn" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="IS_EAVL" property="map.is_eavl" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- add by Pan,Gang 2013-08-16 -->
	<resultMap id="pshowOrderResultForFullNameAndDeptName" class="pshowOrder" extends="pshowOrderResultForList">
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="FULL_NAME" property="map.full_name" jdbcType="VARCHAR" />
		<result column="LOG_SN" property="map.log_sn" jdbcType="VARCHAR" />
		<result column="LOGISTIC_PRICE" property="map.logistic_price" jdbcType="DECIMAL" />
		<result column="ORDER_USER_ID" property="ecUser" select="selectEcUserById" />
	    <result column="CARD_NO" property="map.card_no" jdbcType="VARCHAR" />
	    <result column="SFHK_ORDER_ID" property="map.sfhk_order_id" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- add by Pan,Gang 2013-08-19 -->
	<resultMap id="pshowOrderResultForPdDetails" class="pshowOrder" extends="pshowOrderResultForList">
		<result column="PD_SN" property="map.pd_sn" jdbcType="VARCHAR" />
		<result column="NUM" property="map.num" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="TOTAL_PRICE" property="map.total_price" jdbcType="DECIMAL" />
		<result column="TRADE_NO" property="map.trade_no" jdbcType="VARCHAR" />
		<result column="MAIN_PIC" property="map.main_pic" jdbcType="VARCHAR" />
		<result column="PD_ID" property="map.pd_id" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- add by Pan,Gang 2013-08-19 -->
	<resultMap id="pshowOrderAndDetailTj" class="pshowOrder">  
		<result column="SALE_NUM" property="map.sale_num" jdbcType="DECIMAL" />
		<result column="SALE_PRICE" property="map.sale_price" jdbcType="DECIMAL" />
		<result column="ORDER_COUNT" property="map.order_count" jdbcType="DECIMAL" />
		<result column="RW_WCL" property="map.rw_wcl" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="pshowOrderResultForById" class="pshowOrder" >
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="UUID" property="uuid" jdbcType="VARCHAR" />
		<result column="TRADE_INDEX" property="trade_index" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="OPR_DEPT_ID" property="opr_dept_id" jdbcType="DECIMAL" />
		<result column="TOTAL_PRICE" property="total_price" jdbcType="DECIMAL" />
		<result column="ORDER_USER_ID" property="order_user_id" jdbcType="DECIMAL" />
		<result column="ORDER_USER_NAME" property="order_user_name" jdbcType="VARCHAR" />
		<result column="BUYER_NAME" property="buyer_name" jdbcType="VARCHAR" />
		<result column="BUYER_P_INDEX" property="buyer_p_index" jdbcType="DECIMAL" />
		<result column="BUYER_ADDR" property="buyer_addr" jdbcType="VARCHAR" />
		<result column="BUYER_ZIP" property="buyer_zip" jdbcType="VARCHAR" />
		<result column="BUYER_TEL" property="buyer_tel" jdbcType="VARCHAR" />
		<result column="BUYER_MP" property="buyer_mp" jdbcType="VARCHAR" />
		<result column="DELIVER_WAY" property="deliver_way" jdbcType="DECIMAL" />
		<result column="DELIVER_TIME" property="deliver_time" jdbcType="DECIMAL" />
		<result column="DELIVER_IS_CALL" property="deliver_is_call" jdbcType="DECIMAL" />
		<result column="PAY_WAY" property="pay_way" jdbcType="DECIMAL" />
		<result column="BILL_IS_ADD" property="bill_is_add" jdbcType="DECIMAL" />
		<result column="BILL_TYPE" property="bill_type" jdbcType="DECIMAL" />
		<result column="BILL_HEAD" property="bill_head" jdbcType="DECIMAL" />
		<result column="BILL_CONTENT" property="bill_content" jdbcType="DECIMAL" />
		<result column="BILL_COMPANY" property="bill_company" jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="DEPT_REMARK" property="dept_remark" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="DEL_DATE" property="del_date" jdbcType="TIMESTAMP" />
		<result column="TRADE_NO" property="trade_no" jdbcType="VARCHAR" />
		<result column="PAY_DATE" property="pay_date" jdbcType="TIMESTAMP" />
		<result column="ORDER_FROM" property="order_from" jdbcType="DECIMAL" />
		<result column="ORDER_TYPE" property="order_type" jdbcType="DECIMAL" />
		<result column="LOGISTIC_TYPE" property="logistic_type" jdbcType="DECIMAL" />
		<result column="LOGISTIC_SN" property="logistic_sn" jdbcType="VARCHAR" />		
		<result column="PAY_ACCOUNT_ID" property="pay_account_id" jdbcType="DECIMAL" />
		<result column="EXPRESS_ID" property="express_id" jdbcType="DECIMAL" />
		<result column="WL_YF" property="wl_yf" jdbcType="DECIMAL" />
		<result column="INTEGRAL" property="integral" jdbcType="DECIMAL" />
		<result column="DEDU_PRICE" property="dedu_price" jdbcType="DECIMAL" />
		<result column="PAY_PRICE" property="pay_price" jdbcType="DECIMAL" />
		<result column="CODE" property="code" jdbcType="VARCHAR" />
		<result column="IS_HDFK" property="is_hdfk" jdbcType="DECIMAL" />
		<result column="PAR_ORDER_ID" property="par_order_id" jdbcType="DECIMAL" />
		<result column="IS_DEDUCTION" property="is_deduction" jdbcType="DECIMAL" />
		<result column="IS_R3" property="is_r3" jdbcType="DECIMAL" />
		<result column="IS_PS" property="is_ps" jdbcType="DECIMAL" />
		<result column="IS_SELF" property="is_self" jdbcType="DECIMAL" />
		<result column="SELF_ID" property="self_id" jdbcType="DECIMAL" />
		<result column="PS_ID" property="ps_id" jdbcType="DECIMAL" />
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="FULL_NAME" property="map.full_name" jdbcType="VARCHAR" />
		<result column="LOG_SN" property="map.log_sn" jdbcType="VARCHAR" />
		<result column="LOGISTIC_PRICE" property="map.logistic_price" jdbcType="DECIMAL" />
		<result column="ORDER_USER_ID" property="ecUser" select="selectEcUserById" />
	    <result column="CARD_NO" property="map.card_no" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="sf-pshowOrder">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="uuid">UUID = #uuid:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="trade_index">TRADE_INDEX = #trade_index:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">STATE = #state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="opr_dept_id">OPR_DEPT_ID = #opr_dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="total_price">TOTAL_PRICE = #total_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_user_id">ORDER_USER_ID = #order_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_user_name">ORDER_USER_NAME = #order_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_name">BUYER_NAME = #buyer_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_p_index">BUYER_P_INDEX = #buyer_p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_addr">BUYER_ADDR = #buyer_addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_zip">BUYER_ZIP = #buyer_zip:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_tel">BUYER_TEL = #buyer_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_mp">BUYER_MP = #buyer_mp:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_way">DELIVER_WAY = #deliver_way:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_time">DELIVER_TIME = #deliver_time:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_is_call">DELIVER_IS_CALL = #deliver_is_call:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_way">PAY_WAY = #pay_way:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_is_add">BILL_IS_ADD = #bill_is_add:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_type">BILL_TYPE = #bill_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_head">BILL_HEAD = #bill_head:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_content">BILL_CONTENT = #bill_content:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_company">BILL_COMPANY = #bill_company:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_remark">DEPT_REMARK = #dept_remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_date">DEL_DATE = #del_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="trade_no">TRADE_NO = #trade_no:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_date">PAY_DATE = #pay_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_from">ORDER_FROM = #order_from:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_type">ORDER_TYPE = #order_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="logistic_type">LOGISTIC_TYPE = #logistic_type:DECIMAL#</isNotEmpty> 
		<isNotEmpty prepend=" and " property="logistic_sn">LOGISTIC_SN = #logistic_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_account_id">PAY_ACCOUNT_ID = #pay_account_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="express_id">EXPRESS_ID = #express_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="wl_yf">WL_YF = #wl_yf:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="integral">INTEGRAL = #integral:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dedu_price">DEDU_PRICE = #dedu_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_price">PAY_PRICE = #pay_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="code">CODE = #code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_hdfk">IS_HDFK = #is_hdfk:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_order_id">PAR_ORDER_ID = #par_order_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_deduction">IS_DEDUCTION = #is_deduction:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_ps">IS_PS = #is_ps:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_self">IS_SELF = #is_self:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="self_id">SELF_ID = #self_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ps_id">PS_ID = #ps_id:DECIMAL#</isNotEmpty>
		<isNull prepend=" and " property="opr_dept_id">1 = 1</isNull>
		<isNotEmpty prepend=" and " property="sfhk_order_name">SFHK_ORDER_NAME = #sfhk_order_name:VARCHAR#</isNotEmpty>
		
		
		  
	    <isNotEmpty prepend=" and " property="map.user_id_in">
	    	order_user_id in (128008,128281)
	    </isNotEmpty>
		<isNotEmpty prepend=" and " property="map.state_in">state in <iterate close=")" open="(" conjunction="," property="map.state_in">#map.state_in[]#</iterate></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.logistic_sn_is_not_null">LOGISTIC_SN is not null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.wl_yf_is_null">WL_YF is null</isNotEmpty>
	    <isNotEmpty prepend=" and " property="map.add_time_start"><![CDATA[ ADD_DATE >= to_date(#map.add_time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_time_end"><![CDATA[ ADD_DATE <= to_date(#map.add_time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
	    <isNotEmpty prepend=" and " property="map.express_id_is_not_null">EXPRESS_ID is not null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.express_id_in"> EXPRESS_ID IN (SELECT EXPRESS_ID FROM EC_BASE_EXPRESS WHERE express_ui_type = 1) </isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_index_not_in">TRADE_INDEX NOT IN (SELECT TRADE_INDEX FROM EC_ORDER_EXPRESS_INFO) </isNotEmpty>
		<!-- 分公司客户订单 -->
		<isNotEmpty prepend=" and " property="map.fgs_dept_id">
		( SELECT DEPT_ID FROM KONKA_DEPT where dept_type =3 and DEPT_SN in(
		SELECT BRANCH_AREA_NAME_2 FROM KONKA_R3_SHOP where id in( select CUST_ID FROM EC_USER ec where ec.CUST_ID is not null and ec.id=ORDER_USER_ID )
		) and dept_id =#map.fgs_dept_id# ) is not null
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.fgs_dept_id_new">
		 t.ORDER_USER_ID in (select id from ec_user xx where xx.DEPT_ID in (select dept_id from konka_dept where dept_id = #map.fgs_dept_id_new# union select id as dept_id from EC_GROUP where id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>) )
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.r3_code">
		(SELECT count(*) FROM KONKA_R3_SHOP s left join ec_user u on s.id=u.cust_id where u.id=ORDER_USER_ID and  r3_code= #map.r3_code# )>0
		</isNotEmpty>	
		<isNotEmpty prepend=" and " property="map.trade_index_all">trade_index in <iterate close=")" open="(" conjunction="," property="map.trade_index_all">#map.trade_index_all[]#</iterate></isNotEmpty>
		
	</sql>
	
	<sql id="sf-pshowOrder-t">
		<isNotEmpty prepend=" and " property="id">t.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="uuid">t.UUID = #uuid:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="trade_index">t.TRADE_INDEX = #trade_index:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">t.STATE = #state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="opr_dept_id">t.OPR_DEPT_ID = #opr_dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="total_price">t.TOTAL_PRICE = #total_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_user_id">t.ORDER_USER_ID = #order_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_user_name">t.ORDER_USER_NAME = #order_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_name">t.BUYER_NAME = #buyer_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_p_index">t.BUYER_P_INDEX = #buyer_p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_addr">t.BUYER_ADDR = #buyer_addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_zip">t.BUYER_ZIP = #buyer_zip:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_tel">t.BUYER_TEL = #buyer_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buyer_mp">t.BUYER_MP = #buyer_mp:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_way">t.DELIVER_WAY = #deliver_way:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_time">t.DELIVER_TIME = #deliver_time:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="deliver_is_call">t.DELIVER_IS_CALL = #deliver_is_call:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_way">t.PAY_WAY = #pay_way:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_is_add">t.BILL_IS_ADD = #bill_is_add:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_type">t.BILL_TYPE = #bill_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_head">t.BILL_HEAD = #bill_head:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_content">t.BILL_CONTENT = #bill_content:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bill_company">t.BILL_COMPANY = #bill_company:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">t.REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_remark">t.DEPT_REMARK = #dept_remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">t.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">t.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_date">t.DEL_DATE = #del_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="trade_no">t.TRADE_NO = #trade_no:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_date">t.PAY_DATE = #pay_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_from">t.ORDER_FROM = #order_from:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_type">t.ORDER_TYPE = #order_type:DECIMAL#</isNotEmpty>		
		<isNotEmpty prepend=" and " property="logistic_type">t.LOGISTIC_TYPE = #logistic_type:DECIMAL#</isNotEmpty> 
		<isNotEmpty prepend=" and " property="logistic_sn">t.LOGISTIC_SN = #logistic_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_account_id">t.PAY_ACCOUNT_ID = #pay_account_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="express_id">t.EXPRESS_ID = #express_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="wl_yf">t.WL_YF = #wl_yf:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="integral">t.INTEGRAL = #integral:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dedu_price">t.DEDU_PRICE = #dedu_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_price">t.PAY_PRICE = #pay_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_order_id">t.PAR_ORDER_ID = #par_order_id:DECIMAL#</isNotEmpty>		
		<isNotEmpty prepend=" and " property="is_deduction">t.IS_DEDUCTION = #is_deduction:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_ps">t.IS_PS = #is_ps:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_self">t.IS_SELF = #is_self:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="self_id">t.SELF_ID = #self_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ps_id">t.PS_ID = #ps_id:DECIMAL#</isNotEmpty>
		<isNull prepend=" and " property="opr_dept_id">1 = 1</isNull>
		<isNotEmpty prepend=" and " property="sfhk_order_name">t.SFHK_ORDER_NAME = #sfhk_order_name:VARCHAR#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.confirm_state"> <![CDATA[t.PAY_WAY <> 0]]> </isNotEmpty>
		<isNotEmpty prepend=" and " property="code">CODE = #code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_hdfk">t.IS_HDFK = #is_hdfk:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_time_start"><![CDATA[ t.ADD_DATE >= to_date(#map.add_time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_time_end"><![CDATA[ t.ADD_DATE <= to_date(#map.add_time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.huanhuo">t.id in (SELECT ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE STATE = 2)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.tuihuo">t.id in (SELECT ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE STATE = 1)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.edit_state">t.STATE in (-30,-20,-10,0,5,10)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.edit_state2">t.STATE in (-30,-20,-10,0,5,10,20,30,40,50,60)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.state_in">t.state in <iterate close=")" open="(" conjunction="," property="map.state_in">#map.state_in[]#</iterate></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_index_in">t.TRADE_INDEX in <iterate close=")" open="(" conjunction="," property="map.trade_index_in">#map.trade_index_in[]#</iterate></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_index_like">t.TRADE_INDEX like '%'|| #map.trade_index_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.order_user_name_like">t.ORDER_USER_NAME like '%'|| #map.order_user_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.buyer_name_like">t.BUYER_NAME like '%'|| #map.buyer_name_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.buyer_mp_like">t.BUYER_MP like '%'|| #map.buyer_mp_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_no_like">t.TRADE_NO like '%'|| #map.trade_no_like:VARCHAR# ||'%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.before3months"><![CDATA[current date - 3 MONTHS > t.ADD_DATE]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.last3months"><![CDATA[current date - 3 MONTHS <= t.ADD_DATE]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_start"><![CDATA[t.ADD_DATE >= to_date(#map.add_date_start#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_end"><![CDATA[t.ADD_DATE <= to_date(#map.add_date_end# ||' 23:59:59','yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>				
	    <isNotEmpty prepend=" and " property="map.state_in_2">t.STATE in (10,20,30,40,50,60)</isNotEmpty>
	   
	   <!-- <isNotEmpty prepend=" and " property="map.sfhk_order">ff.SF_ORDER_ID is not null</isNotEmpty>-->
	    
	    <isNotEmpty prepend=" and " property="map.user_id_in">
	    	t.order_user_id in (128008,128281)
	    </isNotEmpty>
	    
	    <isNotEmpty prepend=" and " property="map.fgs_dept_id">
		( SELECT DEPT_ID FROM KONKA_DEPT where dept_type =3 and DEPT_SN in(
		SELECT BRANCH_AREA_NAME_2 FROM KONKA_R3_SHOP where id in( select CUST_ID FROM EC_USER ec where ec.CUST_ID is not null and ec.id=ORDER_USER_ID )
		) and dept_id =#map.fgs_dept_id# ) is not null
		</isNotEmpty>
	    
	    <!-- 分公司客户订单 -->
		<isNotEmpty prepend=" and " property="map.fgs_dept_id_new">
		 t.ORDER_USER_ID in (select id from ec_user xx where xx.DEPT_ID in (select dept_id from konka_dept where dept_id = #map.fgs_dept_id_new# union select id as dept_id from EC_GROUP where id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>) )
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.r3_code">
		(SELECT count(*) FROM KONKA_R3_SHOP s left join ec_user u on s.id=u.cust_id where u.id=t.ORDER_USER_ID and  r3_code like '%'||#map.r3_code#||'%' )>0
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.logistic_sn_like">
		(SELECT count(*)  FROM EC_ORDER_EXPRESS_INFO where TRADE_INDEX=t.TRADE_INDEX and LOGISTIC_SN like '%'||#map.logistic_sn_like#||'%') >0
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sf_order_id_like">
		(SELECT count(*)  FROM SFHK_REL_EPP_ORDER where EPP_ORDER_ID=t.id and SF_ORDER_ID like '%'||#map.sf_order_id_like#||'%') >0
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_index_all">t.trade_index in <iterate close=")" open="(" conjunction="," property="map.trade_index_all">#map.trade_index_all[]#</iterate></isNotEmpty>
			
	</sql>

	<select id="selectPshowOrderById" resultMap="pshowOrderResultForById" parameterClass="long" >
		select t.*,a.dept_name AS dept_name, b.FULL_NAME AS full_name, c.LOGISTIC_PRICE AS LOGISTIC_PRICE, c.LOGISTIC_SN AS log_sn,ee.card_no as card_no
  	   	FROM pshow_order t  LEFT JOIN KONKA_DEPT a  ON t.OPR_DEPT_ID = a.DEPT_ID
       	LEFT JOIN KONKA_BASE_PROVINCE_LIST_FOUR b ON t.BUYER_P_INDEX = b.P_INDEX
       	LEFT JOIN EC_ORDER_EXPRESS_INFO c  ON t.TRADE_INDEX = c.TRADE_INDEX
  		LEFT join EC_USER ee on t.ORDER_USER_ID = ee.ID
  		 where t.ID = #value:DECIMAL#
	</select>

	<select id="selectPshowOrder" resultMap="pshowOrderResult" parameterClass="pshowOrder" cacheModel="oneDayCache">
		select * from PSHOW_ORDER where 1 = 1  and  (par_order_id != -1 or par_order_id is null)
		<include refid="sf-pshowOrder" />
	</select>

	<select id="selectPshowOrderList" resultMap="pshowOrderResultForList" parameterClass="pshowOrder" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from PSHOW_ORDER where 1 = 1  and  (par_order_id != -1 or par_order_id is null)
		<include refid="sf-pshowOrder" />
		<isNotEmpty prepend=" and " property="map.limit_state">
		((pay_way in(1,2,3,4,5,9) and state in (5,10,20,30,40,50,60)) or (pay_way = 0 and state  in (0,10,20,30,40,50,60)))
		</isNotEmpty>
		order by ID desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- add by Jiang,Jiayong 2013-08-15 -->
	<select id="selectPshowOrderIncludeDetailsList" resultMap="pshowOrderResultIncludeDetails" parameterClass="pshowOrder" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from PSHOW_ORDER where 1 = 1  and  (par_order_id != -1 or par_order_id is null)
		<include refid="sf-pshowOrder" />
		order by ID desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectPshowOrderIncludeDetailsPaginatedList" resultMap="pshowOrderResultIncludeDetails" parameterClass="pshowOrder" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from PSHOW_ORDER t where 1 = 1  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder-t" />
		order by t.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- 下级订单 count-->
	<select id="selectPshowOrderSubIncludeDetailsPaginatedListCount" resultClass="long" parameterClass="pshowOrder">
		SELECT count(*)
			  FROM PSHOW_ORDER t
			 WHERE t.ORDER_USER_ID IN (
                         select a.id from EC_USER a where 1 = 1
				 <isNotEmpty prepend="  " property="map.link_user_name">
			      START WITH a.link_user_name = #map.link_user_name:VARCHAR#
					CONNECT BY PRIOR a.user_name =  a.link_user_name
		       </isNotEmpty>
                              )
		  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder-t" />
	</select>
	<!-- 下级订单 list -->
	<select id="selectPshowOrderSubIncludeDetailsPaginatedList" resultMap="pshowOrderResultIncludeDetails" parameterClass="pshowOrder" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT *
			  FROM PSHOW_ORDER t
			 WHERE t.ORDER_USER_ID IN (
                         select a.id from EC_USER a where 1 = 1
				 <isNotEmpty prepend="  " property="map.link_user_name">
			      START WITH a.link_user_name = #map.link_user_name:VARCHAR#
					CONNECT BY PRIOR a.user_name =  a.link_user_name
		       </isNotEmpty>
                              )
		  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder-t" />
		order by t.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- add by Jiang,Jiayong 2013-08-15 -->
	<select id="selectPshowOrdeDetailsWithIdList" resultMap="pshowOrdeDetailsResultForList" parameterClass="long">
		select t.*, t1.main_pic, t1.pd_name, t1.pd_sn, (select count(*) from ec_pd_eavl where detail_id = t.bill_item_id) as is_eavl from PSHOW_ORDE_DETAILS t 
			left join KONKA_BCOMP_PD t1 on t.pd_id = t1.id where t.ORDER_ID = #value#
	</select>
	
	<!-- add by Pan,Gang 2013-08-19 -->
	<select id="selectPshowOrdeForDeptNameAndFullNameListCount" resultClass="long" parameterClass="pshowOrder">
		select count(*) from (SELECT t.*,
       a.dept_name AS dept_name, b.FULL_NAME AS full_name, c.LOGISTIC_PRICE AS LOGISTIC_PRICE,  c.LOGISTIC_SN AS log_sn ,ee.card_no as card_no,ff.SF_ORDER_ID as sfhk_order_id 
       FROM pshow_order t  LEFT JOIN KONKA_DEPT a  ON t.OPR_DEPT_ID = a.DEPT_ID
       LEFT JOIN KONKA_BASE_PROVINCE_LIST_FOUR b  ON t.BUYER_P_INDEX = b.P_INDEX
       LEFT JOIN EC_ORDER_EXPRESS_INFO c ON t.TRADE_INDEX = c.TRADE_INDEX
  		left join EC_USER ee on t.ORDER_USER_ID = ee.ID
  		left join SFHK_REL_EPP_ORDER ff on t.id = ff.epp_order_id
  		<isNotEmpty  prepend="  " property="map.cust_id" > LEFT JOIN ec_user d ON t.ORDER_USER_ID = d.ID </isNotEmpty>
 		WHERE 1=1 and  (t.par_order_id != -1 or t.par_order_id is null)
 		<include refid="sf-pshowOrder-t" />
  		<isNotEmpty  prepend=" and " property="map.card_no_like" > UPPER(ee.card_no) like '%'||UPPER(#map.card_no_like#)||'%' </isNotEmpty>
  		<isNotEmpty  prepend=" and " property="map.sf_order" > ee.dept_id = 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cw_order" > ee.dept_id != 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.gb_order" > t.state !=-10 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.prod_type" >
 			t.ID IN (SELECT distinct ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE PD_ID IN (SELECT ID FROM KONKA_BCOMP_PD WHERE PROD_TYPE = #map.prod_type# 
 			<isNotEmpty prepend=" and " property="map.is_djq" >IS_DJQ=0</isNotEmpty>
 			))
        </isNotEmpty>
        <isNotEmpty prepend=" and " property="map.pd_name_like" >
 			t.ID IN (SELECT distinct ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE pd_name like '%'||#map.pd_name_like#||'%')
        </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cust_pay_way" >t.pay_way !=9 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.audit_state">t.STATE = 10 or (t.STATE = 0 and t.PAY_WAY = 0 <include refid="sf-pshowOrder-t" /> )</isNotEmpty>
 		)
	</select>
	
	
	<!-- add by Pan,Gang 2013-08-16 -->
	<select id="selectPshowOrdeForDeptNameAndFullNameList" resultMap="pshowOrderResultForFullNameAndDeptName" parameterClass="pshowOrder">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT t.*,  a.dept_name AS dept_name, b.FULL_NAME AS full_name, c.LOGISTIC_PRICE AS LOGISTIC_PRICE, c.LOGISTIC_SN AS log_sn,ee.card_no as card_no,ff.SF_ORDER_ID as sfhk_order_id
  	   FROM pshow_order t  LEFT JOIN KONKA_DEPT a  ON t.OPR_DEPT_ID = a.DEPT_ID
       LEFT JOIN KONKA_BASE_PROVINCE_LIST_FOUR b ON t.BUYER_P_INDEX = b.P_INDEX
       LEFT JOIN EC_ORDER_EXPRESS_INFO c  ON t.TRADE_INDEX = c.TRADE_INDEX
  		left join EC_USER ee on t.ORDER_USER_ID = ee.ID
  		left join SFHK_REL_EPP_ORDER ff on t.id = ff.epp_order_id
  		<isNotEmpty  prepend="  " property="map.cust_id" > LEFT JOIN ec_user d  ON t.ORDER_USER_ID = d.ID </isNotEmpty>
 		WHERE 1=1 and (t.par_order_id != -1 or t.par_order_id is null)
 		<include refid="sf-pshowOrder-t" />
 		<isNotEmpty  prepend=" and " property="map.card_no_like" > UPPER(ee.card_no) like '%'||UPPER(#map.card_no_like#)||'%'</isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.sf_order" > ee.dept_id = 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cw_order" > ee.dept_id != 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.gb_order" > t.state !=-10 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.prod_type" >
 			t.ID IN (SELECT distinct ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE PD_ID IN (SELECT ID FROM KONKA_BCOMP_PD WHERE PROD_TYPE = #map.prod_type#
 			<isNotEmpty prepend=" and " property="map.is_djq" >IS_DJQ=0</isNotEmpty>
 			))
        </isNotEmpty>
        <isNotEmpty prepend=" and " property="map.pd_name_like" >
 			t.ID IN (SELECT distinct ORDER_ID FROM PSHOW_ORDE_DETAILS WHERE pd_name like '%'||#map.pd_name_like#||'%')
        </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cust_id" > d.cust_id = #map.cust_id# </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cust_pay_way" > t.pay_way !=9 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.audit_state">t.STATE = 10 or (t.STATE = 0 and t.PAY_WAY = 0 <include refid="sf-pshowOrder-t" /> )</isNotEmpty>
 		order by t.add_date desc
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	
	<select id="selectPshowOrderAndDetailsForTj" resultMap="pshowOrderAndDetailTj" parameterClass="pshowOrder">
		SELECT decode (sum (tt.NUM),
               NULL,
               0,
               sum (tt.NUM))
          AS SALE_NUM,
       decode (sum (tt.PAY_PRICE),
               NULL,
               0,
               sum (tt.PAY_PRICE))
          AS SALE_PRICE,
       count (tt.ID) AS ORDER_COUNT,
       decode (sum (tt.PAY_PRICE),
               NULL,
               0,
               sum (tt.PAY_PRICE))
       / 20000
          AS RW_WCL
  FROM (SELECT t.pay_price, t.id, sum (a.num) AS num
          FROM PSHOW_ORDER t, PSHOW_ORDE_DETAILS a
         WHERE 1 = 1  AND (t.par_order_id != -1 OR t.par_order_id IS NULL)
               AND a.ORDER_ID = t.ID
        <isNotEmpty prepend=" and " property="map.add_time_start"><![CDATA[ t.ADD_DATE >= to_date(#map.add_time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_time_end"><![CDATA[ t.ADD_DATE <= to_date(#map.add_time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.state_in">t.state in <iterate close=")" open="(" conjunction="," property="map.state_in">#map.state_in[]#</iterate></isNotEmpty>
        GROUP BY t.PAY_PRICE, t.id) tt 
	</select>
	
	
	<select id="selectPshowOrderAndDetailsForTj2" resultMap="pshowOrderAndDetailTj" parameterClass="pshowOrder">
		SELECT decode (sum (tt.NUM),
               NULL,
               0,
               sum (tt.NUM))
          AS SALE_NUM,
       decode (sum (tt.PAY_PRICE),
               NULL,
               0,
               sum (tt.PAY_PRICE))
          AS SALE_PRICE,
       count (tt.ID) AS ORDER_COUNT,
       decode (sum (tt.PAY_PRICE),
               NULL,
               0,
               sum (tt.PAY_PRICE))
       / 20000
          AS RW_WCL
  FROM (SELECT bb.pay_price, bb.id, sum (aa.num) AS num
          FROM (SELECT t.*
  	   FROM pshow_order t  LEFT JOIN KONKA_DEPT a  ON t.OPR_DEPT_ID = a.DEPT_ID
       LEFT JOIN KONKA_BASE_PROVINCE_LIST_FOUR b ON t.BUYER_P_INDEX = b.P_INDEX
       LEFT JOIN EC_ORDER_EXPRESS_INFO c  ON t.TRADE_INDEX = c.TRADE_INDEX
  		left join EC_USER ee on t.ORDER_USER_ID = ee.ID
  		<isNotEmpty  prepend="  " property="map.cust_id" > LEFT JOIN ec_user d  ON t.ORDER_USER_ID = d.ID </isNotEmpty>
 		WHERE 1=1 and (t.par_order_id != -1 or t.par_order_id is null)
 		<include refid="sf-pshowOrder-t" />
 		<isNotEmpty  prepend=" and " property="map.card_no_like" > UPPER(ee.card_no) like '%'||UPPER(#map.card_no_like#)||'%'</isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.sf_order" > ee.dept_id = 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cw_order" > ee.dept_id != 2110 </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.gb_order" > t.state !=-10 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.prod_type" >t.ID IN (SELECT ORDER_ID
                      FROM PSHOW_ORDE_DETAILS 
                     WHERE PD_ID IN (SELECT ID
                                          FROM KONKA_BCOMP_PD 
                                         WHERE PROD_TYPE = #map.prod_type#))</isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cust_id" > d.cust_id = #map.cust_id# </isNotEmpty>
 		<isNotEmpty  prepend=" and " property="map.cust_pay_way" > t.pay_way !=9 </isNotEmpty>
 		<isNotEmpty prepend=" and " property="map.audit_state">t.STATE = 10 or (t.STATE = 0 and t.PAY_WAY = 0 <include refid="sf-pshowOrder-t" /> )</isNotEmpty>
 		order by t.add_date desc)bb, PSHOW_ORDE_DETAILS aa
         WHERE 1 = 1  
               AND aa.ORDER_ID = bb.ID
        GROUP BY bb.PAY_PRICE, bb.id) tt 
	</select>
	
	<!-- add by Pan,Gang 2013-08-19 -->
	<select id="selectPshowOrdeForPdDetailsListCount" resultClass="long" parameterClass="pshowOrder">
		select count(*) from (select t.*,a.NUM as num,a.PRICE as price,a.TOTAL_PRICE as total_price,a.PD_ID as pd_id,
		b.PD_SN as pd_sn,b.MAIN_PIC as main_pic from PSHOW_ORDER t left join PSHOW_ORDE_DETAILS a 
		on t.ID=a.ORDER_ID left join KONKA_BCOMP_PD b on a.PD_ID=b.ID WHERE 1=1  and  (t.par_order_id != -1 or t.par_order_id is null)
 		<include refid="sf-pshowOrder-t" />
 		)
	</select>
	
	<!-- add by Pan,Gang 2013-08-19 -->
	<select id="selectPshowOrdeForPdDetailsList" resultMap="pshowOrderResultForPdDetails" parameterClass="pshowOrder">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,a.NUM as num,a.PRICE as price,a.TOTAL_PRICE as total_price,a.PD_ID as pd_id,
		b.PD_SN as pd_sn,b.MAIN_PIC as main_pic from PSHOW_ORDER t left join PSHOW_ORDE_DETAILS a  
		on t.ID=a.ORDER_ID left join KONKA_BCOMP_PD b on a.PD_ID=b.ID WHERE 1=1  and  (t.par_order_id != -1 or t.par_order_id is null)
 		<include refid="sf-pshowOrder-t" />
 		order by t.add_date desc
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- add by Liu,ZhiXiang 2013-09-12 -->
	<select id="selectTotalPriceByOrderUserId" resultClass="java.math.BigDecimal" parameterClass="pshowOrder" cacheModel="oneDayCache">
		select value(sum(TOTAL_PRICE),0) from PSHOW_ORDER where 1 = 1  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder" />
	</select>

	<select id="selectPshowOrderCount" resultClass="long" parameterClass="pshowOrder" cacheModel="oneDayCache">
		select count(*) from PSHOW_ORDER t where 1 = 1  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder-t" />
	</select>

	<select id="selectPshowOrderPaginatedList" resultMap="pshowOrderResult" parameterClass="pshowOrder" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from PSHOW_ORDER where 1 = 1  and  (t.par_order_id != -1 or t.par_order_id is null)
		<include refid="sf-pshowOrder" />
		order by ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertPshowOrder" parameterClass="pshowOrder">
		<selectKey resultClass="long" keyProperty="id">select PSHOW_BASE_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into PSHOW_ORDER (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="uuid">UUID</isNotNull>	
			<isNotNull prepend="," property="trade_index">TRADE_INDEX</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="state">STATE</isNotNull>	
			<isNotNull prepend="," property="opr_dept_id">OPR_DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="total_price">TOTAL_PRICE</isNotNull>	
			<isNotNull prepend="," property="order_user_id">ORDER_USER_ID</isNotNull>	
			<isNotNull prepend="," property="order_user_name">ORDER_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="buyer_name">BUYER_NAME</isNotNull>	
			<isNotNull prepend="," property="buyer_p_index">BUYER_P_INDEX</isNotNull>	
			<isNotNull prepend="," property="buyer_addr">BUYER_ADDR</isNotNull>	
			<isNotNull prepend="," property="buyer_zip">BUYER_ZIP</isNotNull>	
			<isNotNull prepend="," property="buyer_tel">BUYER_TEL</isNotNull>	
			<isNotNull prepend="," property="buyer_mp">BUYER_MP</isNotNull>	
			<isNotNull prepend="," property="deliver_way">DELIVER_WAY</isNotNull>	
			<isNotNull prepend="," property="deliver_time">DELIVER_TIME</isNotNull>	
			<isNotNull prepend="," property="deliver_is_call">DELIVER_IS_CALL</isNotNull>	
			<isNotNull prepend="," property="pay_way">PAY_WAY</isNotNull>	
			<isNotNull prepend="," property="bill_is_add">BILL_IS_ADD</isNotNull>	
			<isNotNull prepend="," property="bill_type">BILL_TYPE</isNotNull>	
			<isNotNull prepend="," property="bill_head">BILL_HEAD</isNotNull>	
			<isNotNull prepend="," property="bill_content">BILL_CONTENT</isNotNull>	
			<isNotNull prepend="," property="bill_company">BILL_COMPANY</isNotNull>	
			<isNotNull prepend="," property="remark">REMARK</isNotNull>	
			<isNotNull prepend="," property="dept_remark">DEPT_REMARK</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="del_date">DEL_DATE</isNotNull>	
			<isNotNull prepend="," property="trade_no">TRADE_NO</isNotNull>	
			<isNotNull prepend="," property="pay_date">PAY_DATE</isNotNull>	
			<isNotNull prepend="," property="order_from">ORDER_FROM</isNotNull>	
			<isNotNull prepend="," property="order_type">ORDER_TYPE</isNotNull>	
			<isNotNull prepend="," property="logistic_type">LOGISTIC_TYPE</isNotNull>	
			<isNotNull prepend="," property="logistic_sn">LOGISTIC_SN</isNotNull>
			<isNotNull prepend="," property="pay_account_id">PAY_ACCOUNT_ID</isNotNull>	
			<isNotNull prepend="," property="express_id">EXPRESS_ID</isNotNull>
			<isNotNull prepend="," property="wl_yf">WL_YF</isNotNull>
			<isNotNull prepend="," property="integral">INTEGRAL</isNotNull>
			<isNotNull prepend="," property="dedu_price">DEDU_PRICE</isNotNull>
			<isNotNull prepend="," property="pay_price">PAY_PRICE</isNotNull>
			<isNotNull prepend="," property="code">CODE</isNotNull>	
			<isNotNull prepend="," property="is_hdfk">IS_HDFK</isNotNull>
			<isNotNull prepend="," property="is_deduction">IS_DEDUCTION</isNotNull>
			<isNotNull prepend="," property="is_r3">IS_R3</isNotNull>
			<isNotNull prepend="," property="is_ps">IS_PS</isNotNull>
			<isNotNull prepend="," property="par_order_id">PAR_ORDER_ID</isNotNull>
			<isNotNull prepend="," property="is_self">IS_SELF</isNotNull>	
			<isNotNull prepend="," property="self_id">SELF_ID</isNotNull>
			<isNotNull prepend="," property="ps_id">PS_ID</isNotNull>
			<isNotNull prepend="," property="pay_integral">PAY_INTEGRAL</isNotNull>
			<isNotNull prepend="," property="jianyiguajia">JIANYIGUAJIa</isNotNull>
			<isNotNull prepend="," property="sfhk_order_name">SFHK_ORDER_NAME</isNotNull>			
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="uuid">#uuid:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="trade_index">#trade_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="state">#state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="opr_dept_id">#opr_dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="total_price">#total_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_user_id">#order_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_user_name">#order_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_name">#buyer_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_p_index">#buyer_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="buyer_addr">#buyer_addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_zip">#buyer_zip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_tel">#buyer_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_mp">#buyer_mp:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="deliver_way">#deliver_way:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="deliver_time">#deliver_time:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="deliver_is_call">#deliver_is_call:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_way">#pay_way:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_is_add">#bill_is_add:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_type">#bill_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_head">#bill_head:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_content">#bill_content:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_company">#bill_company:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="remark">#remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_remark">#dept_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">#del_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="trade_no">#trade_no:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_date">#pay_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="order_from">#order_from:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_type">#order_type:DECIMAL#</isNotNull>			
			<isNotNull prepend="," property="logistic_type">#logistic_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="logistic_sn">#logistic_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_account_id">#pay_account_id:DECIMAL#</isNotNull>	
			<isNotNull prepend="," property="express_id">#express_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="wl_yf">#wl_yf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="integral">#integral:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dedu_price">#dedu_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_price">#pay_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="code">#code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_hdfk">#is_hdfk:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_deduction">#is_deduction:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_r3">#is_r3:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_ps">#is_ps:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_order_id">#par_order_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_self">#is_self:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="self_id">#self_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ps_id">#ps_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_integral">#pay_integral:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jianyiguajia">#jianyiguajia:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sfhk_order_name">#sfhk_order_name:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updatePshowOrder" parameterClass="PshowOrder">
		update PSHOW_ORDER
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="uuid">UUID = #uuid:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="trade_index">TRADE_INDEX = #trade_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="state">STATE = #state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="opr_dept_id">OPR_DEPT_ID = #opr_dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="total_price">TOTAL_PRICE = #total_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_user_id">ORDER_USER_ID = #order_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_user_name">ORDER_USER_NAME = #order_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_name">BUYER_NAME = #buyer_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_p_index">BUYER_P_INDEX = #buyer_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="buyer_addr">BUYER_ADDR = #buyer_addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_zip">BUYER_ZIP = #buyer_zip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_tel">BUYER_TEL = #buyer_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="buyer_mp">BUYER_MP = #buyer_mp:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="deliver_way">DELIVER_WAY = #deliver_way:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="deliver_time">DELIVER_TIME = #deliver_time:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="deliver_is_call">DELIVER_IS_CALL = #deliver_is_call:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_way">PAY_WAY = #pay_way:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_is_add">BILL_IS_ADD = #bill_is_add:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_type">BILL_TYPE = #bill_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_head">BILL_HEAD = #bill_head:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_content">BILL_CONTENT = #bill_content:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bill_company">BILL_COMPANY = #bill_company:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="remark">REMARK = #remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_remark">DEPT_REMARK = #dept_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">DEL_DATE = #del_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="trade_no">TRADE_NO = #trade_no:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_date">PAY_DATE = #pay_date:TIMESTAMP#</isNotNull>
		  <!--   <isNull prepend="," property="opr_dept_id">OPR_DEPT_ID = null</isNull>  -->
			<isNotNull prepend="," property="order_from">ORDER_FROM = #logistic_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_type">ORDER_TYPE = #order_type:DECIMAL#</isNotNull>				
			<isNotNull prepend="," property="logistic_type">LOGISTIC_TYPE = #logistic_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="logistic_sn">LOGISTIC_SN = #logistic_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_account_id">PAY_ACCOUNT_ID=#pay_account_id:DECIMAL#</isNotNull>	
			<isNotNull prepend="," property="express_id">EXPRESS_ID=#express_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="wl_yf">WL_YF=#wl_yf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="integral">INTEGRAL=#integral:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dedu_price">DEDU_PRICE=#dedu_price:DECIMAL#</isNotNull>		
			<isNotNull prepend="," property="pay_price">PAY_PRICE=#pay_price:DECIMAL#</isNotNull>	
			<isNotNull prepend="," property="code">CODE = #code:VARCHAR#</isNotNull>	
			<isNotNull prepend="," property="is_hdfk">IS_HDFK=#is_hdfk:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_deduction">IS_DEDUCTION=#is_deduction:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_r3">IS_R3=#is_r3:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_ps">IS_PS=#is_ps:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_order_id">PAR_ORDER_ID=#par_order_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_self">IS_SELF=#is_self:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="self_id">SELF_ID=#self_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ps_id">PS_ID=#ps_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_integral">PAY_INTEGRAL=#pay_integral:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jianyiguajia">JIANYIGUAJIA=#jianyiguajia:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sfhk_order_name">SFHK_ORDER_NAME = #sfhk_order_name:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="trade_index">TRADE_INDEX = #trade_index#</isNotEmpty>
		</isEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>
	
	<!-- Cancel order, add by tudp 2013-09-14 -->
	<update id="updatePshowOrderForCancel" parameterClass="PshowOrder">
		update PSHOW_ORDER set STATE = -10 where STATE = 0 and ID = #id#
		<isNotEmpty prepend=" and " property="order_user_id">ORDER_USER_ID = #order_user_id:DECIMAL#</isNotEmpty>
	</update>
	
	<update id="updatePshowOrderForSwitchR3" parameterClass="PshowOrder">
		update PSHOW_ORDER set IS_R3 = 1 where ID = #id#
	</update>
	
	<delete id="deletePshowOrder" parameterClass="PshowOrder">
		delete from PSHOW_ORDER where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>