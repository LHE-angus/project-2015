<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ include file="/commons/pages/taglibs.jsp" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>${naviString}</title>
	<link href="${ctx}/styles/global.css" rel="stylesheet" type="text/css" />
	<link href="${ctx}/styles/konka.css" rel="stylesheet" type="text/css" />
	<style type="text/css">
		.rtable1 td{
			padding: 2px 0 2px 0;
		}
	</style>
	<script type="text/javascript">
		var money1 = 0;
		var money2 = 0;
		var money3 = 0;
		var money4 = 0;
		var money5 = 0;
		var money6 = 0;
		var money7 = 0;
		var money8 = 0;
		var money9 = 0;
		var num1 = 0;
		var num2 = 0;
		var num3 = 0;
		var num4 = 0;
		var num5 = 0;
		var num6 = 0;
		var num7 = 0;
		var num8 = 0;
		var num9 = 0;
	</script>
</head>
<body>
<div class="oarcont" id="body_oarcont">
  <div class="oartop">
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td width="3%"><img src="${ctx}/styles/admin-index/images/k_tup.jpg" style="vertical-align:middle;" /></td>
        <td>当前位置：${naviString}</td>
        <td width="60"><img src="${ctx}/images/manager/help.gif" style="vertical-align:middle;" /> <span id="span_help" style="cursor:pointer;">帮助</span></td>
      </tr>
    </table>
  </div>
  <div class="rtabcont1">
  	<html-el:form action="/admin/KonkaSellModelNameForCx">
  		<html-el:hidden property="method" value="list" />
  		<html-el:hidden property="mod_id" />
      	<html-el:hidden property="tj_type" styleId="tj_type" value="${af.map.tj_type}" />
		<input type="hidden" id='excel_to_all' name="excel_to_all" value=''  />
      	<table width="100%" border="0" cellspacing="1" cellpadding="0" class="rtable1">
	        <tr>
				<td width="15"></td>
				<td align="right"><strong class="fb">销售时间：</strong></td>
				<td>
					<html-el:text property="sell_date_start" styleId="sell_date_start"  size="10" maxlength="10" readonly="true" onclick="new Calendar(2011, 2021, 0).show(this);" style="cursor:pointer;text-align:center;" title="点击选择日期" />
					至
					<html-el:text property="sell_date_end" styleId="sell_date_end"  size="10" maxlength="10" readonly="true" onclick="new Calendar(2011, 2021, 0).show(this);" style="cursor:pointer;text-align:center;" title="点击选择日期" />
				</td>
				<td align="right"><strong class="fb">排名显示：</strong></td>
				<td>
					<html-el:select property="show_top" styleId="show_top" style="width:120px">
						<html-el:option value="">全部</html-el:option>
						<html-el:option value="5">Top5</html-el:option>
						<html-el:option value="10">Top10</html-el:option>
						<html-el:option value="20">Top20</html-el:option>
						<html-el:option value="30">Top30</html-el:option>
						<html-el:option value="40">Top40</html-el:option>
						<html-el:option value="50">Top50</html-el:option>
					</html-el:select>
				</td>
				<td align="right"><strong class="fb">分&nbsp;公&nbsp;司：</strong></td>
				<td>
					<c:set var="disabled" value="false" />
					<c:if test="${af.map.dept_type eq 3}">
						<c:set var="disabled" value="true" />
					</c:if>
					<html-el:select property="dept_id" styleId="dept_id" disabled="${disabled}">
						<html-el:option value="">-请选择-</html-el:option>
					</html-el:select>
					&nbsp;
					<html-el:select property="l4_dept_id" styleId="l4_dept_id">
						<html-el:option value="">-请选择-</html-el:option>
					</html-el:select>
					&nbsp;
					<html-el:select property="l5_dept_id" styleId="l5_dept_id">
						<html-el:option value="">-请选择-</html-el:option>
					</html-el:select>
				</td>
	        </tr>
	        <tr>
	        	<td width="15"></td>
	        	<td align="right"><strong class="fb">产品型号：</strong></td>
				<td>
		        	<html-el:text property="model_name" size="15" maxlength="40" styleId="model_name"  />
				</td>
				<td align="right"><strong class="fb">业&nbsp;务&nbsp;员：</strong></td>
		        <td><html-el:text property="ywy_user_name_like" size="15" maxlength="40" styleId="ywy_user_name_like"  /></td>
		        <td align="right"><strong class="fb">尺&nbsp;&nbsp;&nbsp;&nbsp;寸：</strong></td>
		        <td><html-el:text property="md_size" size="15" maxlength="10" styleId="md_size"  /></td>
			</tr>
			<tr>
				<td width="15"></td>
		        <td align="right"><strong class="fb">尺&nbsp;寸&nbsp;段：</strong></td>
		        <td>
					<html-el:select property="size_sec" styleId="size_sec" style="width:120px;" >
		              	<html-el:option value="">请选择</html-el:option>
		              	<c:forEach items="${sizeSecList}" var="cur" varStatus="vs">
	      					<html-el:option value="${cur.field1}">${cur.type_name}</html-el:option>
	      				</c:forEach>
		            </html-el:select>
	        	</td>
				<td align="right"><strong class="fb">客户名称：</strong></td>
				<td><html-el:text property="kh_name_like" size="15" maxlength="40" styleId="kh_name_like"  /></td>
				<td align="right"><strong class="fb">R3&nbsp;编&nbsp;码：</strong></td>
				<td><html-el:text property="r3_code_like" size="15" maxlength="10" styleId="r3_code_like"  /></td>
	        </tr>
	        <tr>
	          	<td width="15"></td>
				<td align="right"><strong class="fb">客户类型：</strong></td>
				<td colspan="4">
					<html-el:select property="v_customer_type1" styleId="v_customer_type1" style="width:80px;">
						<html-el:option value="">-请选择-</html-el:option>
					</html-el:select>
					<html-el:select property="v_customer_type2" styleId="v_customer_type2" style="width:130px;">
						<html-el:option value="">-请选择-</html-el:option>
					</html-el:select>
				</td>
	          	<td>
					<html-el:submit styleClass="but1" value="搜索" />&nbsp;&nbsp;
					<input type="button" value="导出" id="export" class="but_excel" style="margin-left: 10px;" title="导出EXCEL表格" />
				</td>
	        </tr>
      </table>
  	</html-el:form>
  </div>
  <%--<div align="right">--%>
		<%--<a href="javascript:setTjType(1);" style="color:${af.map.tj_type eq 1 ? '#B11212':'#0072bc'};">按销售额排名</a>&nbsp;&nbsp;<a href="javascript:setTjType(2);" style="color:${af.map.tj_type eq 2 ? '#B11212':'#0072bc'};">按销售量排名</a>&nbsp;--%>
  <%--</div>--%>
  <div class="rtabcont1">
  	<table width="100%">
  		<tr>
  			<td width="48%" valign="top" >
  				<table width="100%" border="0" cellpadding="0" cellspacing="1" class="rtable6">
			      <tr class="tabtt6">
					  <td width="5%" nowrap="nowrap" align="center">序号</td>
					  <td nowrap="nowrap" align="center">产品型号</td>
					  <td nowrap="nowrap" align="center" width="5%">规格段</td>
					  <td width="20%" align="center" nowrap="nowrap">零售额</td>
					  <td width="20%" align="center" nowrap="nowrap">零售量</td>
			          <td width="20%" align="center" nowrap="nowrap">平均单价</td>
			      </tr>
			      <c:set var="total_money" value="0" />
	  			  <c:set var="total_num" value="0" />
			      <c:forEach items="${entityList}" var="cur" varStatus="vs">
			        <tr>
						<c:choose>
							<c:when test="${cur[1] eq '<32英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num1 += parseInt(num);
									money1 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '32-36英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num2 += parseInt(num);
									money2 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '37-39英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num3 += parseInt(num);
									money3 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '40-45英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num4 += parseInt(num);
									money4 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '46-50英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num5 += parseInt(num);
									money5 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '51-59英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num6 += parseInt(num);
									money6 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '60-69英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num7 += parseInt(num);
									money7 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '>=70英寸'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num8 += parseInt(num);
									money8 += parseInt(val);
								</script>
							</c:when>
							<c:when test="${cur[1] eq '其他'}">
								<script type="text/javascript">
									var val = '${cur[2]}';
									var num = '${cur[3]}';
									num9 += parseInt(num);
									money9 += parseInt(val);
								</script>
							</c:when>
						</c:choose>
					  <td align="center">${vs.count}</td>
					  <td align="left" nowrap="nowrap">${cur[0]}</td>
					  <td align="center" nowrap="nowrap">${cur[1]}</td>
					  <td align="right" nowrap="nowrap"><span class="kz-price-12"><fmt:formatNumber value="${cur[2]}" type="number" pattern="#,##0.00"/></span></td>
					  <td align="right" nowrap="nowrap">${cur[3]}</td>
					  <td align="right" nowrap="nowrap"><span class="kz-price-12"><fmt:formatNumber value="${cur[4]}" type="number" pattern="#,##0.00" /></span></td>
			        </tr>
			        <c:set var="total_money" value="${total_money+cur[2] }" />
	  			    <c:set var="total_num" value="${total_num+cur[3] }" />
			      </c:forEach>
			      <tr>
			      	<td align="right" colspan="3"><span style="font-size:14px;font-family:verdana;font-weight:700;">合计</span></td>
			      	<td align="right"><span class="kz-price"><fmt:formatNumber value="${total_money}" type="number" pattern="#,##0.00" /></span></td>
			      	<td align="right"><span style="font-size:14px;font-family:verdana;font-weight:700;">${total_num}</span></td>
			      	<td align="right"><span style="font-size:14px;font-family:verdana;font-weight:700;">/</span></td>
			      </tr>
			    </table>
  			</td>
  			<td width="2%">&nbsp;</td>
  			<td width="50%" valign="top">
				<table align="center" width="100%" cellpadding="0" cellspacing="0">
	       			<tr align="center">
	       				<td>
							<div id='pie_chart1' style="height: 390px;width: 100%; margin-top: 5px"></div>
	       				</td>
	       			</tr>
					<tr height="10px"></tr>
					<tr align="center">
	       				<td>
							<div id='pie_chart2' style="height: 380px;width: 100%; margin-top: 5px"></div>
	       				</td>
	       			</tr>
    			</table>
			</td>
  		</tr>
  	</table>

  </div>
</div>
<div id="cvtooltipClose" style="display: none; line-height: 24px;">${helpString}</div>
<script type="text/javascript" src="${ctx}/commons/scripts/jquery.js"></script> 
<script type="text/javascript" src="${ctx}/commons/scripts/jquery.cvtooltip.js"></script>
<script type="text/javascript" src="${ctx}/commons/scripts/rowEffect.js"></script>
<script type="text/javascript" src="${ctx}/commons/scripts/calendar.js"></script>
<script type="text/javascript" src="${ctx}/commons/scripts/jquery.cs.js"></script>
<script type="text/javascript" src="${ctx}/commons/scripts/json2.js"></script>
<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
<script type="text/javascript">//<![CDATA[    
$(document).ready(function(){
	// 路径配置   Add by Liang Houen on 2015-07-16
	require.config({
		paths: {
			echarts: 'http://echarts.baidu.com/build/dist'
		}
	});

	//加载指定类型图形并生成
	require(
			[
				'echarts',
				'echarts/chart/pie'
			],
			DrawCharts
	);
	function DrawCharts(ec){
		showMoneyChart(ec);
		showNumChart(ec);
	}
	//根据销售额画图
	function showMoneyChart(ec) {
		// 基于准备好的dom，初始化echarts图表
		var Chart = ec.init(document.getElementById('pie_chart1'));
		var option = {
			title : {
				text: '产品规格段零售额占比图',
				x:'center'
			},
			tooltip : {
				trigger: 'item',
				formatter: "{a} <br/>{b} : {c} ({d}%)"
			},
			calculable : true,
			series : [
				{
					name:'尺寸段',
					type:'pie',
					radius : [20, 110],
					center : ['50%', 200],
					roseType : 'radius',
					width: '40%',       // for funnel
					max: 40,            // for funnel
					sort : 'ascending',
					data:[
						{value:money1,name:'<32英寸'},
						{value:money2,name:'32-36英寸'},
						{value:money3,name:'37-39英寸'},
						{value:money4,name:'40-45英寸'},
						{value:money5,name:'46-50英寸'},
						{value:money6,name:'51-59英寸'},
						{value:money7,name:'60-69英寸'},
						{value:money8,name:'>=70英寸'},
						{value:money9,name:'其他'}
					]
				}
			]
		};
		// 为echarts对象加载数据
		Chart.setOption(option);
	}

	//根据销量画图
	function showNumChart(ec) {
		// 基于准备好的dom，初始化echarts图表
		var Chart = ec.init(document.getElementById('pie_chart2'));
		var option = {
			title : {
				text: '产品规格段零售量占比图',
				x:'center'
			},
			tooltip : {
				trigger: 'item',
				formatter: "{a} <br/>{b} : {c} ({d}%)"
			},
			calculable : true,
			series : [
				{
					name:'尺寸段',
					type:'pie',
					radius : [20, 110],
					center : ['50%', 200],
					roseType : 'radius',
					width: '40%',       // for funnel
					max: 40,            // for funnel
					sort : 'ascending',
					data:[
						{value:num1,name:'<32英寸'},
						{value:num2,name:'32-36英寸'},
						{value:num3,name:'37-39英寸'},
						{value:num4,name:'40-45英寸'},
						{value:num5,name:'46-50英寸'},
						{value:num6,name:'51-59英寸'},
						{value:num7,name:'60-69英寸'},
						{value:num8,name:'>=70英寸'},
						{value:num9,name:'其他'}
					]
				}
			]
		};
		// 为echarts对象加载数据
		Chart.setOption(option);
	}


	$("#span_help").click(function(){
        $("#cvtooltipClose").cvtooltip({
            panel: "#body_oarcont",
            direction: 1,                
            width: 420,
            left: 320,
            top: 5,
            speed: 500,
            delay: 10000
        });
    });
	
	$("#dept_id").attr({"subElement": "l4_dept_id", "defaultText": "-请选择-", "defaultValue": "", "selectedValue": "${af.map.dept_id}"});
	$("#l4_dept_id"    ).attr({"subElement": "l5_dept_id", "defaultText": "-请选择-", "defaultValue": "", "selectedValue": "${af.map.l4_dept_id}"});
	$("#l5_dept_id" ).attr({"defaultText": "-请选择-", "defaultValue": "", "selectedValue": "${af.map.l5_dept_id}"});

	$("#dept_id").cs("${ctx}/manager/admin/CsAjax.do?method=getKonkaDeptForParId&isNotEpp=isNotEpp", "par_id", "0", false);
	$("#dept_id").change();

	//客户类型初始化
	$("#v_customer_type1").attr({"subElement": "v_customer_type2", "defaultText": "-请选择-", "defaultValue": "", "selectedValue": "${af.map.v_customer_type1}"});
	$("#v_customer_type2").attr({"defaultText": "-请选择-", "defaultValue": "", "selectedValue": "${af.map.v_customer_type2}"});

	$("#v_customer_type1").cs("${ctx}/manager/admin/CsAjax.do?method=getKonkaShopType", "par_id", "0", false);
	$("#v_customer_type1").change();
	
	<%--if(${not empty entityList}){--%>
		<%--var flash = "MSBar3D.swf";--%>
		<%----%>
		<%--var chart = new FusionCharts("${ctx}/scripts/fusioncharts/swf/"+flash, "ChartId", "100%", "${char_x_heigth+330}", "0", "0");--%>
		<%--var dataStr = "KonkaSellModelNameForCx.do?method=chart";--%>
		<%--dataStr += "&tj_type=${af.map.tj_type}";--%>
		<%--dataStr += "&show_top=${af.map.show_top}";--%>
		<%--dataStr += "&sell_date_start=${af.map.sell_date_start}";--%>
		<%--dataStr += "&sell_date_end=${af.map.sell_date_end}";--%>
		<%--dataStr += "&dept_id=${af.map.dept_id}";--%>
		<%--dataStr += "&l4_dept_id=${af.map.l4_dept_id}";--%>
		<%--dataStr += "&l5_dept_id=${af.map.l5_dept_id}";--%>
		<%--dataStr += "&model_name=${af.map.model_name}";--%>
		<%--dataStr += "&ywy_user_name_like=${af.map.ywy_user_name_like}";--%>
		<%--dataStr += "&md_size=${af.map.md_size}";--%>
		<%--dataStr += "&size_sec=${af.map.size_sec}";--%>
		<%--$.ajax({--%>
		    <%--type: "POST",--%>
		    <%--url: dataStr,--%>
		    <%--error: function(request, settings) {alert("数据加载请求失败"); },--%>
		    <%--success: function(data) {--%>
		        <%--if (data != ''){--%>
		            <%--chart.setDataXML(data);--%>
		            <%--chart.render("chartdiv");--%>
		        <%--}--%>
		    <%--}--%>
		<%--});--%>
		<%----%>
	<%--}--%>

	//导出
	$("#export").click(function(){
		if(confirm("提示，您确认导出数据？")){
			//CNZZ统计代码
			_czc.push(["_trackEvent", "零售畅销机型下载", "导出", "Excel", 0, "export"]);
			var f = document.forms[0];
			$("#excel_to_all").val("1");
			f.submit();
			$("#excel_to_all").val("");
		}
	});
});

function setTjType(type){
	document.getElementById("tj_type").value = type
	//$("#tj_type").val(type);
	document.forms[0].submit();
}


//]]></script>
<jsp:include page="/__analytics.jsp" />
</body>
</html>


