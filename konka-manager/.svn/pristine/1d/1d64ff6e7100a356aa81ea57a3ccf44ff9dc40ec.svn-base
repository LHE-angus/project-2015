<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_MOBILE_FIGHT_REPORT">

	<typeAlias alias="konkaMobileFightReport" type="com.ebiz.mmt.domain.KonkaMobileFightReport" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaMobileFightReport" />
		<flushOnExecute statement="updateKonkaMobileFightReport" />
		<flushOnExecute statement="deleteKonkaMobileFightReport" />
	</cacheModel>

	<resultMap id="konkaMobileFightReportResultForList" class="konkaMobileFightReport">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="CHANNEL_A_ID" property="channel_a_id" jdbcType="DECIMAL" />
		<result column="CHANNEL_A_NAME" property="channel_a_name" jdbcType="VARCHAR" />
		<result column="CHANNEL_B_ID" property="channel_b_id" jdbcType="DECIMAL" />
		<result column="CHANNEL_B_NAME" property="channel_b_name" jdbcType="VARCHAR" />
		<result column="ORG_ID" property="org_id" jdbcType="DECIMAL" />
		<result column="ORG_NAME" property="org_name" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="DEPT_NAME" property="dept_name" jdbcType="VARCHAR" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="CLS_ID" property="cls_id" jdbcType="DECIMAL" />
		<result column="SIZE_ID" property="size_id" jdbcType="DECIMAL" />
		<result column="MODEL_ID" property="model_id" jdbcType="VARCHAR" />
		<result column="NUM" property="num" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="SUBCOMP_ID" property="subcomp_id" jdbcType="DECIMAL" />
		<result column="SUBCOMP_NAME" property="subcomp_name" jdbcType="VARCHAR" />
		<result column="OFFICE_ID" property="office_id" jdbcType="DECIMAL" />
		<result column="OFFICE_NAME" property="office_name" jdbcType="VARCHAR" />
		<result column="REPORT_MAN" property="report_man" jdbcType="DECIMAL" />
		<result column="REPORT_NAME" property="report_name" jdbcType="VARCHAR" />
		<result column="REPORT_TIME" property="report_time" jdbcType="DATETIME" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="SINGLE_PRICE" property="single_price" jdbcType="DECIMAL" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="PAR_TYPE_ID" property="par_type_id" jdbcType="DECIMAL" />
		<result column="DATA_SOURCE" property="data_source" jdbcType="INTEGER" />
	</resultMap>

	<resultMap id="konkaMobileFightReportResult" class="konkaMobileFightReport" extends="konkaMobileFightReportResultForList">
	</resultMap>

	
	<resultMap id="konkaMobileFightReportResultForQuery" class="konkaMobileFightReport" extends="konkaMobileFightReportResultForList">
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="E_SIZE" property="map.e_size" jdbcType="VARCHAR" />
		<result column="L45_DEPT_NAME" property="map.l45_dept_name" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="konkaMobileFightReportResultForQueryNew" class="konkaMobileFightReport" extends="konkaMobileFightReportResultForList">
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="E_SIZE" property="map.e_size" jdbcType="VARCHAR" />
		<result column="VO_DEPT_NAME" property="map.vo_dept_name" jdbcType="VARCHAR" />
		<result column="L5_DEPT_NAME" property="map.l5_dept_name" jdbcType="VARCHAR" />
		<result column="TYPE_NAME" property="map.type_name" jdbcType="VARCHAR"/>
		<result column="PAR_CUSTOMER_TYPE_NAME" property="map.par_customer_type_name" jdbcType="VARCHAR"/>
		<result column="CUSTOMER_TYPE_NAME" property="map.customer_type_name" jdbcType="VARCHAR"/>
		<result column="STORE_NAME" property="map.store_name" jdbcType="VARCHAR"/>
		<result column="R3_CODE" property="map.r3_code" jdbcType="VARCHAR"/>
	</resultMap>
	
	<resultMap id="konkaMobileFightReportResultSum" class="konkaMobileFightReport">
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="YC32" property="map.yc32" jdbcType="DECIMAL" />
		<result column="YC40" property="map.yc40" jdbcType="DECIMAL" />
		<result column="YC43" property="map.yc43" jdbcType="DECIMAL" />
		<result column="YC50" property="map.yc50" jdbcType="DECIMAL" />
		<result column="YC55" property="map.yc55" jdbcType="DECIMAL" />
		<result column="YC60" property="map.yc60" jdbcType="DECIMAL" />
		<result column="YC65" property="map.yc65" jdbcType="DECIMAL" />
		<result column="YCD65" property="map.ycd65" jdbcType="DECIMAL" />
		<result column="YCQT" property="map.ycqt" jdbcType="DECIMAL" />
	</resultMap>
		
	<sql id="sf-konkaMobileFightReport">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_id">CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_name">CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_id">CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_name">CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_id">ORG_ID = #org_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_name">ORG_NAME = #org_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cls_id">CLS_ID = #cls_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="size_id">SIZE_ID = #size_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="model_id">MODEL_ID = #model_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="num">NUM = #num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_name">SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_id">OFFICE_ID = #office_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_name">OFFICE_NAME = #office_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_man">REPORT_MAN = #report_man:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_name">REPORT_NAME = #report_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_time">REPORT_TIME = #report_time:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="single_price">SINGLE_PRICE = #single_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">MEMO = #memo:VARCHARL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="status">STATUS = #status:DECIMAL#</isNotEmpty>
		
		<isNotEmpty property="map.date_begin">
			<isNotEmpty prepend=" and " property="map.date_end">
				<![CDATA[ to_char(REPORT_TIME, 'yyyy-MM-dd') >= #map.date_begin# and to_char(REPORT_TIME, 'yyyy-MM-dd') <= #map.date_end#]]>
			</isNotEmpty>
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.num_price_not_null"><![CDATA[ num <> 0 and price <> 0 ]]></isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.report_name_like">REPORT_NAME like '%' || #map.report_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.model_id_like">MODEL_ID like '%' || #map.model_id_like:VARCHAR# || '%'</isNotEmpty>
	</sql>
	
	<sql id="sf-konkaMobileFightReport-t">
		<isNotEmpty prepend=" and " property="id">t.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_id">t.CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_name">t.CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_id">t.CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_name">t.CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_id">t.ORG_ID = #org_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_name">t.ORG_NAME = #org_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">t.DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">t.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cls_id">t.CLS_ID = #cls_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="size_id">t.SIZE_ID = #size_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="model_id">t.MODEL_ID = #model_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="num">t.NUM = #num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">t.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">t.SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_name">t.SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_id">t.OFFICE_ID = #office_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_name">t.OFFICE_NAME = #office_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_man">t.REPORT_MAN = #report_man:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_name">t.REPORT_NAME = #report_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_time">t.REPORT_TIME = #report_time:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="single_price">t.SINGLE_PRICE = #single_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">t.MEMO = #memo:VARCHARL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="status">t.STATUS = #status:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_type_id">t.PAR_TYPE_ID = #par_type_id:DECIMAL#</isNotEmpty>
		
		
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			vo.cur_dept_id in (
				select dept_id from konka_dept start with dept_id = #map.dept_id_start:DECIMAL# connect  by prior dept_id = par_id
			)
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.fgs_dept_id">
			t.SUBCOMP_ID in (
				select dept_id from konka_dept start with dept_id = #map.fgs_dept_id:DECIMAL# connect  by prior dept_id = par_id
			)
		</isNotEmpty>
		
		<isNotEmpty property="map.date_begin">
			<isNotEmpty prepend=" and " property="map.date_end">
				<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') >= #map.date_begin# and to_char(t.REPORT_TIME, 'yyyy-MM-dd') <= #map.date_end#]]>
			</isNotEmpty>
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.startime">
			<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') >= #map.startime#]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.endtime">
			<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') <= #map.endtime#]]>
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.num_price_not_null"><![CDATA[ num <> 0 and price <> 0 ]]></isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.dept_name_like">t.dept_name like '%' || #map.dept_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.report_name_like">t.REPORT_NAME like '%' || #map.report_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.model_id_like">t.MODEL_ID like '%' || #map.model_id_like:VARCHAR# || '%'</isNotEmpty>
	</sql>
	
	
	<sql id="sf-konkaMobileFightReport-t1">
		<isNotEmpty prepend=" and " property="id">t.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_id">t.CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_name">t.CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_id">t.CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_name">t.CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_id">t.ORG_ID = #org_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_name">t.ORG_NAME = #org_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">t.DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">t.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cls_id">t.CLS_ID = #cls_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="size_id">t.SIZE_ID = #size_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="model_id">t.MODEL_ID = #model_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="num">t.NUM = #num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">t.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">t.SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_name">t.SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_id">t.OFFICE_ID = #office_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_name">t.OFFICE_NAME = #office_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_man">t.REPORT_MAN = #report_man:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_name">t.REPORT_NAME = #report_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="report_time">t.REPORT_TIME = #report_time:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="single_price">t.SINGLE_PRICE = #single_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">t.MEMO = #memo:VARCHARL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="status">t.STATUS = #status:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_type_id">t.PAR_TYPE_ID = #par_type_id:DECIMAL#</isNotEmpty>
		
		
		<isNotEmpty prepend=" and " property="map.e_size">
			e.screen_size=#map.e_size:DECIMAL#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id_start">
			vo.cur_dept_id in (
				select dept_id from konka_dept start with dept_id = #map.dept_id_start:DECIMAL# connect  by prior dept_id = par_id
			)
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.fgs_dept_id">
			t.SUBCOMP_ID in (
				select dept_id from konka_dept start with dept_id = #map.fgs_dept_id:DECIMAL# connect  by prior dept_id = par_id
			)
		</isNotEmpty>
		
		<isNotEmpty property="map.date_begin">
			<isNotEmpty prepend=" and " property="map.date_end">
				<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') >= #map.date_begin# and to_char(t.REPORT_TIME, 'yyyy-MM-dd') <= #map.date_end#]]>
			</isNotEmpty>
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.startime">
			<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') >= #map.startime#]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.endtime">
			<![CDATA[ to_char(t.REPORT_TIME, 'yyyy-MM-dd') <= #map.endtime#]]>
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.num_price_not_null"><![CDATA[ num <> 0 and price <> 0 ]]></isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.dept_name_like">t.dept_name like '%' || #map.dept_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.report_name_like">t.REPORT_NAME like '%' || #map.report_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.model_id_like">t.MODEL_ID like '%' || #map.model_id_like:VARCHAR# || '%'</isNotEmpty>
	</sql>

	<select id="selectKonkaMobileFightReport" resultMap="konkaMobileFightReportResult" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		select * from KONKA_MOBILE_FIGHT_REPORT where 1 = 1
		<include refid="sf-konkaMobileFightReport" />
	</select>

	<select id="selectKonkaMobileFightReportList" resultMap="konkaMobileFightReportResultForList" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_MOBILE_FIGHT_REPORT where 1 = 1
		<include refid="sf-konkaMobileFightReport" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaMobileFightReportCount" resultClass="long" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		select count(*)    FROM KONKA_MOBILE_FIGHT_REPORT t
       LEFT JOIN konka_mobile_category b
          ON b.c_index = t.brand_id
       LEFT JOIN KONKA_MOBILE_PD e
          ON  t.model_id = e.md_name
         LEFT JOIN  (select  store_id,max(ywy_user_name) ywy_user_name,
       par_customer_type_name,customer_type_name,par_customer_type,customer_type,CUR_DEPT_ID,
       store_name,r3_code,l5_dept_name,dept_name vo_dept_name
       from mv_org_of_cxy  group by store_id,par_customer_type,customer_type,CUR_DEPT_ID,
       par_customer_type_name,customer_type_name,
       store_name,r3_code
       ,l5_dept_name,dept_name) vo
          ON vo.store_id = t.dept_id 
           LEFT JOIN Konka_Base_Type_Data kbt
          ON (kbt.par_type_id = 100025 AND t.Par_type_id = kbt.type_id)
 		WHERE 1 = 1
		<isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
		  <include refid="sf-konkaMobileFightReport-t1" />
	</select>

	<select id="selectKonkaMobileFightReportPaginatedList" resultMap="konkaMobileFightReportResult" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_MOBILE_FIGHT_REPORT where 1 = 1
		<include refid="sf-konkaMobileFightReport" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	
	<select id="selectKonkaMobileFightReportPaginatedListForQueryNew" resultMap="konkaMobileFightReportResultForQueryNew" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
select t.*,
       decode (t.model_id,'1001',(select distinct brand_name from KONKA_MOBILE_PD where BRAND_ID= t.brand_id ),brand_name ) as brand_name,
       e.screen_size AS e_size,
       t.dept_id,
       t.memo,
       t.single_price,
       t.DATA_SOURCE,
       kbt.type_name,
       vo.ywy_user_name,
       vo.par_customer_type_name,
       vo.customer_type_name,
       vo.store_name,
       vo.r3_code,
       vo.vo_dept_name,
       vo.l5_dept_name
       FROM KONKA_MOBILE_FIGHT_REPORT t
       LEFT JOIN konka_mobile_category b
          ON b.c_index = t.brand_id
       LEFT JOIN KONKA_MOBILE_PD e
          ON  t.model_id = e.md_name
         LEFT JOIN  (select  store_id,max(ywy_user_name) ywy_user_name,
       par_customer_type_name,customer_type_name,par_customer_type,customer_type,CUR_DEPT_ID,
       store_name,r3_code,l5_dept_name,dept_name vo_dept_name
       from mv_org_of_cxy  group by store_id,par_customer_type,customer_type,CUR_DEPT_ID,
       par_customer_type_name,customer_type_name,
       store_name,r3_code
       ,l5_dept_name,dept_name) vo
          ON vo.store_id = t.dept_id 
           LEFT JOIN Konka_Base_Type_Data kbt
          ON (kbt.par_type_id = 100025 AND t.Par_type_id = kbt.type_id)
 	WHERE 1 = 1
		<isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
		  <include refid="sf-konkaMobileFightReport-t1" />
		  order by t.ID desc
	</select>
	
	<!-- 	统计金额 -->
	<select id="sumPrice" resultMap="konkaMobileFightReportResultSum" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
	  <![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
      		SELECT t.brand_id,
		( select distinct brand_name  from KONKA_MOBILE_PD where brand_id = t.brand_id) brand_name,
			sum( decode(t.PAR_TYPE_ID,10002501,t.PRICE,0)) as YC32,
      		sum( decode(t.PAR_TYPE_ID,10002502,t.PRICE,0)) as YC40,
      		sum( decode(t.PAR_TYPE_ID,10002503,t.PRICE,0)) as YC43,
	        sum( decode(t.PAR_TYPE_ID,10002504,t.PRICE,0)) as YC50,
	        sum( decode(t.PAR_TYPE_ID,10002505,t.PRICE,0)) as YC55,
      		sum( decode(t.PAR_TYPE_ID,10002506,t.PRICE,0)) as YC60,
      		sum( decode(t.PAR_TYPE_ID,10002507,t.PRICE,0)) as YC65,
       		sum( decode(t.PAR_TYPE_ID,10002508,t.PRICE,0)) as YCD65,
            sum( decode(t.PAR_TYPE_ID,10002509,t.PRICE,0)) as YCQT
       from KONKA_MOBILE_FIGHT_REPORT t
		  left join konka_mobile_category b on b.c_index = t.brand_id
		  left join mv_org_of_cxy vo on vo.store_id = t.dept_id 
		  left join Konka_Base_Type_Data kbt on (kbt.par_type_id=100025 and t.Par_type_id=kbt.type_id)
		  where 1 = 1 
      <isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
      <include refid="sf-konkaMobileFightReport-t1" />
      
           group by t.brand_id
	  <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="sumKonkaMobileFightReportCount" resultClass="long" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		select count(*) from ( SELECT t.brand_id,
		( select distinct brand_name  from KONKA_MOBILE_PD where brand_id = t.brand_id) brand_name,
			sum( decode(t.PAR_TYPE_ID,10002501,t.num,0)) as YC32,
      		sum( decode(t.PAR_TYPE_ID,10002502,t.num,0)) as YC40,
      		sum( decode(t.PAR_TYPE_ID,10002503,t.num,0)) as YC43,
	        sum( decode(t.PAR_TYPE_ID,10002504,t.num,0)) as YC50,
	        sum( decode(t.PAR_TYPE_ID,10002505,t.num,0)) as YC55,
      		sum( decode(t.PAR_TYPE_ID,10002506,t.num,0)) as YC60,
      		sum( decode(t.PAR_TYPE_ID,10002507,t.num,0)) as YC65,
       		sum( decode(t.PAR_TYPE_ID,10002508,t.num,0)) as YCD65,
            sum( decode(t.PAR_TYPE_ID,10002509,t.num,0)) as YCQT
       from KONKA_MOBILE_FIGHT_REPORT t
		  left join konka_mobile_category b on b.c_index = t.brand_id
		  left join mv_org_of_cxy vo on vo.store_id = t.dept_id 
		  left join Konka_Base_Type_Data kbt on (kbt.par_type_id=100025 and t.Par_type_id=kbt.type_id)
		  where 1 = 1 
      <isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
      <include refid="sf-konkaMobileFightReport-t1" />
           group by t.brand_id
          )
	</select>
	
	<!-- 	统计数量 -->
	<select id="selectSumNum" resultMap="konkaMobileFightReportResultSum" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		 SELECT t.brand_id,
		( select distinct brand_name  from KONKA_MOBILE_PD where brand_id = t.brand_id) brand_name,
			sum( decode(t.PAR_TYPE_ID,10002501,t.num,0)) as YC32,
      		sum( decode(t.PAR_TYPE_ID,10002502,t.num,0)) as YC40,
      		sum( decode(t.PAR_TYPE_ID,10002503,t.num,0)) as YC43,
	        sum( decode(t.PAR_TYPE_ID,10002504,t.num,0)) as YC50,
	        sum( decode(t.PAR_TYPE_ID,10002505,t.num,0)) as YC55,
      		sum( decode(t.PAR_TYPE_ID,10002506,t.num,0)) as YC60,
      		sum( decode(t.PAR_TYPE_ID,10002507,t.num,0)) as YC65,
       		sum( decode(t.PAR_TYPE_ID,10002508,t.num,0)) as YCD65,
            sum( decode(t.PAR_TYPE_ID,10002509,t.num,0)) as YCQT
       from KONKA_MOBILE_FIGHT_REPORT t
		  left join konka_mobile_category b on b.c_index = t.brand_id
		  left join mv_org_of_cxy vo on vo.store_id = t.dept_id 
		  left join Konka_Base_Type_Data kbt on (kbt.par_type_id=100025 and t.Par_type_id=kbt.type_id)
		  where 1 = 1 
      <isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
      <include refid="sf-konkaMobileFightReport-t1" />
          group by t.brand_id
      <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaMobileFightReportPaginatedListForQuery" resultMap="konkaMobileFightReportResultForQueryNew" parameterClass="konkaMobileFightReport" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,
       decode (t.model_id,'1001',(select distinct brand_name from KONKA_MOBILE_PD where BRAND_ID= t.brand_id ),brand_name ) as brand_name,
       e.screen_size AS e_size,
       t.dept_id,
       t.memo,
       t.single_price,
       t.DATA_SOURCE,
       kbt.type_name,
       vo.ywy_user_name,
       vo.par_customer_type_name,
       vo.customer_type_name,
       vo.store_name,
       vo.r3_code,
       vo.vo_dept_name,
       vo.l5_dept_name
       FROM KONKA_MOBILE_FIGHT_REPORT t
       LEFT JOIN konka_mobile_category b
          ON b.c_index = t.brand_id
       LEFT JOIN KONKA_MOBILE_PD e
          ON  t.model_id = e.md_name
         LEFT JOIN  (select  store_id,max(ywy_user_name) ywy_user_name,par_customer_type,customer_type,CUR_DEPT_ID,
       par_customer_type_name,customer_type_name,
       store_name,r3_code,l5_dept_name,dept_name vo_dept_name
       from mv_org_of_cxy  group by store_id,par_customer_type,customer_type,CUR_DEPT_ID,
       par_customer_type_name,customer_type_name,
       store_name,r3_code
       ,l5_dept_name,dept_name) vo
          ON vo.store_id = t.dept_id 
           LEFT JOIN Konka_Base_Type_Data kbt
          ON (kbt.par_type_id = 100025 AND t.Par_type_id = kbt.type_id)
 	WHERE 1 = 1
		<isNotEmpty  prepend=" and " property="map.r3_code">vo.r3_code=#map.r3_code:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.store_name">vo.store_name=#map.store_name:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.c_comm">vo.par_customer_type=#map.c_comm:VARCHAR#</isNotEmpty>
      <isNotEmpty  prepend=" and " property="map.customer_cate_id">vo.customer_type=#map.customer_cate_id:VARCHAR#</isNotEmpty>
      	<include refid="sf-konkaMobileFightReport-t1" />
		order by t.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaMobileFightReport" parameterClass="konkaMobileFightReport">
		<selectKey resultClass="long" keyProperty="id">select KONKA_MOBILE_REPORT.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_MOBILE_FIGHT_REPORT (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="channel_a_id">CHANNEL_A_ID</isNotNull>	
			<isNotNull prepend="," property="channel_a_name">CHANNEL_A_NAME</isNotNull>	
			<isNotNull prepend="," property="channel_b_id">CHANNEL_B_ID</isNotNull>	
			<isNotNull prepend="," property="channel_b_name">CHANNEL_B_NAME</isNotNull>	
			<isNotNull prepend="," property="org_id">ORG_ID</isNotNull>	
			<isNotNull prepend="," property="org_name">ORG_NAME</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="dept_name">DEPT_NAME</isNotNull>	
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>	
			<isNotNull prepend="," property="cls_id">CLS_ID</isNotNull>	
			<isNotNull prepend="," property="size_id">SIZE_ID</isNotNull>	
			<isNotNull prepend="," property="model_id">MODEL_ID</isNotNull>	
			<isNotNull prepend="," property="num">NUM</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID</isNotNull>	
			<isNotNull prepend="," property="subcomp_name">SUBCOMP_NAME</isNotNull>	
			<isNotNull prepend="," property="office_id">OFFICE_ID</isNotNull>	
			<isNotNull prepend="," property="office_name">OFFICE_NAME</isNotNull>	
			<isNotNull prepend="," property="report_man">REPORT_MAN</isNotNull>	
			<isNotNull prepend="," property="report_name">REPORT_NAME</isNotNull>	
			<isNotNull prepend="," property="report_time">REPORT_TIME</isNotNull>	
			<isNotNull prepend="," property="status">STATUS</isNotNull>	
			<isNotNull prepend="," property="single_price">SINGLE_PRICE</isNotNull>	
			<isNotNull prepend="," property="memo">MEMO</isNotNull>	
			<isNotNull prepend="," property="par_type_id">PAR_TYPE_ID</isNotNull>
			<isNotNull prepend="," property="data_source">DATA_SOURCE</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_id">#channel_a_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_name">#channel_a_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="channel_b_id">#channel_b_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_b_name">#channel_b_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="org_id">#org_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="org_name">#org_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_name">#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cls_id">#cls_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="size_id">#size_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="model_id">#model_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="num">#num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_id">#subcomp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_name">#subcomp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="office_id">#office_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="office_name">#office_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="report_man">#report_man:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="report_name">#report_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="report_time">#report_time:DATETIME#</isNotNull>
			<isNotNull prepend="," property="status">#status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="single_price">#single_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="memo">#memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="par_type_id">#par_type_id:DATETIME#</isNotNull>
			<isNotNull prepend="," property="data_source">#data_source:INTEGER#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaMobileFightReport" parameterClass="KonkaMobileFightReport">
		update KONKA_MOBILE_FIGHT_REPORT
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_id">CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_name">CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="channel_b_id">CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_b_name">CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="org_id">ORG_ID = #org_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="org_name">ORG_NAME = #org_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cls_id">CLS_ID = #cls_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="size_id">SIZE_ID = #size_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="model_id">MODEL_ID = #model_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="num">NUM = #num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_name">SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="office_id">OFFICE_ID = #office_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="office_name">OFFICE_NAME = #office_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="report_man">REPORT_MAN = #report_man:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="report_name">REPORT_NAME = #report_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="report_time">REPORT_TIME = #report_time:DATETIME#</isNotNull>
			<isNotNull prepend="," property="status">STATUS = #status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="single_price">SINGLE_PRICE= #single_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="memo">MEMO = #memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="par_type_id">PAR_TYPE_ID = #par_type_id:DATETIME#</isNotNull>
			<isNotNull prepend="," property="data_source">DATA_SOURCE = #data_source:INTEGER#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaMobileFightReport" parameterClass="KonkaMobileFightReport">
		delete from KONKA_MOBILE_FIGHT_REPORT where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>