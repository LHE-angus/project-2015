<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_XX_SELL_BILL_DETAILS">

	<typeAlias alias="konkaXxSellBillDetails" type="com.ebiz.mmt.domain.KonkaXxSellBillDetails" />

	

	<resultMap id="konkaXxSellBillDetailsResultForList" class="konkaXxSellBillDetails">
		<result column="SELL_BILL_DETAILS_ID" property="sell_bill_details_id" jdbcType="DECIMAL" />
		<result column="SELL_BILL_ID" property="sell_bill_id" jdbcType="DECIMAL" />
		<result column="PD_CLS" property="pd_cls" jdbcType="DECIMAL" />
		<result column="PD_CLS_NAME" property="pd_cls_name" jdbcType="VARCHAR" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="COUNTS" property="counts" jdbcType="DECIMAL" />
		<result column="GIFT" property="gift" jdbcType="VARCHAR" />
		<result column="XS_REMARKS" property="xs_remarks" jdbcType="VARCHAR" />
		<result column="ZMD_FEE" property="zmd_fee" jdbcType="DECIMAL" />
		<result column="FIX_FEE" property="fix_fee" jdbcType="DECIMAL" />
		<result column="LOCK_STOCK_STATE" property="lock_stock_state" jdbcType="DECIMAL" />
		<result column="ZMD_FEE_FP" property="zmd_fee_fp" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="konkaXxSellBillDetailsWithOrderResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="ZMD_SN" property="map.zmd_sn" jdbcType="VARCHAR" />
		<result column="SELL_DATE" property="map.sell_date" jdbcType="DATETIME" />
		<result column="SELL_MAN" property="map.sell_man" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsWithSpecResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="SPEC" property="map.spec" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsWithPdTypeResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="TYPE_NAME" property="map.type_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsForJJsResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="CHECKOUT_STATE" property="map.checkout_state" jdbcType="DECIMAL" />
		<result column="ZMD_SN" property="map.zmd_sn" jdbcType="VARCHAR" />
		<result column="SELL_STATE" property="map.sell_state" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsInRoadResult" class="konkaXxSellBillDetails">
		<result column="PD_CLS" property="pd_cls" jdbcType="DECIMAL" />
		<result column="PD_CLS_NAME" property="pd_cls_name" jdbcType="VARCHAR" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="PD_IN_ROAD_COUNTS" property="map.pd_in_road_counts" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsInload" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="BUYER_NAME" property="map.buyer_name" jdbcType="VARCHAR" />
		<result column="BUYER_PHONE" property="map.buyer_phone" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaXxSellBillDetailsResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
	</resultMap>
	
	<sql id="sf-konkaXxSellBillDetails">
		<isNotEmpty prepend=" and " property="sell_bill_details_id">SELL_BILL_DETAILS_ID = #sell_bill_details_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_bill_id">SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls">PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls_name">PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="counts">COUNTS = #counts:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="gift">GIFT = #gift:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xs_remarks">XS_REMARKS = #xs_remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_fee">ZMD_FEE = #zmd_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fix_fee">FIX_FEE = #fix_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="lock_stock_state">LOCK_STOCK_STATE = #lock_stock_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_fee_fp">ZMD_FEE_FP = #zmd_fee_fp:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		
	</sql>

	<select id="selectKonkaXxSellBillDetails" resultMap="konkaXxSellBillDetailsResult" parameterClass="konkaXxSellBillDetails" >
		select * from KONKA_XX_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-konkaXxSellBillDetails" />
	</select>

	<select id="selectKonkaXxSellBillDetailsList" resultMap="konkaXxSellBillDetailsResultForList" parameterClass="konkaXxSellBillDetails" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_XX_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-konkaXxSellBillDetails" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsForInRoadList" resultMap="konkaXxSellBillDetailsInload" parameterClass="konkaXxSellBillDetails" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select aa.*,
			   bb.buyer_name as buyer_name,
			   bb.buyer_phone as buyer_phone
  			from konka_xx_sell_bill_details aa
  			left join konka_xx_sell_bill bb on aa.sell_bill_id = bb.sell_bill_id
  			where 1 = 1
			<isNotEmpty prepend=" and " property="map.pd_in_load"><![CDATA[ bb.sell_state in (20,30) ]]></isNotEmpty>
			<isNotEmpty prepend=" and " property="md_name">aa.MD_NAME = #md_name:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="pd_cls">aa.PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsWithSpecList" resultMap="konkaXxSellBillDetailsWithSpecResult" parameterClass="konkaXxSellBillDetails" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select t.*,pd.spec from konka_xx_sell_bill_details t
		left join konka_xx_std_pd pd on t.md_name = pd.md_name 
		where 1 = 1
		<isNotEmpty prepend=" and " property="sell_bill_id">t.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsInRoadCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select count(1) from ( select t1.pd_cls,t1.pd_cls_name,t1.md_name,sum(t1.counts) from konka_xx_sell_bill_details t1
		left join konka_xx_sell_bill t2 on t1.sell_bill_id = t2.sell_bill_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="pd_cls">t1.PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls_name">t1.PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">t1.MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.md_name_like">upper(t1.MD_NAME) like '%' || upper(#map.md_name_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">t2.dept_id = #map.dept_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_in_load"><![CDATA[ t2.sell_state in (20,30) ]]></isNotEmpty>
		group by t1.pd_cls,t1.pd_cls_name,t1.md_name )
	</select>
	
	<select id="selectKonkaXxSellBillDetailsInRoadPaginatedList" resultMap="konkaXxSellBillDetailsInRoadResult" parameterClass="konkaXxSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t1.pd_cls,t1.pd_cls_name,t1.md_name,sum(t1.counts) pd_in_road_counts from konka_xx_sell_bill_details t1
		left join konka_xx_sell_bill t2 on t1.sell_bill_id = t2.sell_bill_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="pd_cls">PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls_name">PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.md_name_like">upper(t1.MD_NAME) like '%' || upper(#map.md_name_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">t2.dept_id = #map.dept_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_in_load"><![CDATA[ t2.sell_state in (20,30) ]]></isNotEmpty>
		group by t1.pd_cls,t1.pd_cls_name,t1.md_name
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectKonkaXxSellBillDetailsCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select count(*) from KONKA_XX_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-konkaXxSellBillDetails" />
	</select>
	
	<!-- modify by liyuan 2012-02-06 begin -->
	<!-- <select id="selectKonkaXxSellBillDetailsForKcCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		SELECT nvl(sum(counts),0)
		  FROM KONKA_XX_SELL_BILL_DETAILS
		 where lock_stock_state = 1
		   and sell_bill_id in
		       (select sell_bill_id from KONKA_XX_SELL_BILL where dept_id = #map.dept_id:DECIMAL#)
		   and md_name = #md_name:VARCHAR#
	</select> -->
	
	<select id="selectKonkaXxSellBillDetailsForKcCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select nvl(sum(counts), 0) from KONKA_XX_SELL_BILL_DETAILS_DST
		 where SELL_BILL_DETAILS_ID in
		       (select SELL_BILL_DETAILS_ID from KONKA_XX_SELL_BILL_DETAILS where LOCK_STOCK_STATE = 1 and MD_NAME = #md_name:VARCHAR#)
		   and md_name = #md_name:VARCHAR#
		   and factory_id || store_id in <iterate close=")" open="(" conjunction="," property="map.factoryStores">#map.factoryStores[]#</iterate>
	</select>
	<!-- modify by liyuan 2012-02-06 end -->
	
	<select id="selectKonkaXxSellBillDetailsPaginatedList" resultMap="konkaXxSellBillDetailsResult" parameterClass="konkaXxSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_XX_SELL_BILL_DETAILS where 1 = 1
		<include refid="sf-konkaXxSellBillDetails" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!--@author Hh Hao @version 2012-04-20-->
	<select id="selectKonkaXxSellBillDetailsForJJSPaginatedList" resultMap="konkaXxSellBillDetailsForJJsResult" parameterClass="konkaXxSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select aa.*,bb.checkout_state,bb.zmd_sn,bb.sell_state
  			from konka_xx_sell_bill_details aa
  			left join konka_xx_sell_bill bb on aa.sell_bill_id = bb.sell_bill_id where 1 = 1
  		   <isNotEmpty prepend=" and " property="map.dept_id">bb.dept_id = #map.dept_id:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.zmd_id">bb.zmd_id = #map.zmd_id:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.checkout_state">bb.checkout_state = #map.checkout_state:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.add_date_ge"><![CDATA[bb.add_date >= to_date(#map.add_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.add_date_le"><![CDATA[bb.add_date <= to_date(#map.add_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		order by bb.add_date desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!--@author Hh Hao @version 2012-04-20-->
	<select id="selectKonkaXxSellBillDetailsForJJSCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select count(1)
  			from konka_xx_sell_bill_details aa
  			left join konka_xx_sell_bill bb on aa.sell_bill_id = bb.sell_bill_id where 1 = 1
		   <isNotEmpty prepend=" and " property="map.dept_id">bb.dept_id = #map.dept_id:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.zmd_id">bb.zmd_id = #map.zmd_id:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.checkout_state">bb.checkout_state = #map.checkout_state:DECIMAL#</isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.add_date_ge"><![CDATA[bb.add_date >= to_date(#map.add_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.add_date_le"><![CDATA[bb.add_date <= to_date(#map.add_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsWithOrderCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select count(*) from konka_xx_sell_bill_details t
    	left join konka_xx_sell_bill kxsb on t.sell_bill_id = kxsb.sell_bill_id
    	left join konka_dept kd on kxsb.dept_id = kd.dept_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="sell_bill_details_id">t.SELL_BILL_DETAILS_ID = #sell_bill_details_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_bill_id">t.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls">t.PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls_name">t.PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">t.MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">t.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="counts">t.COUNTS = #counts:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="gift">t.GIFT = #gift:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xs_remarks">t.XS_REMARKS = #xs_remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_fee">t.ZMD_FEE = #zmd_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fix_fee">t.FIX_FEE = #fix_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="lock_stock_state">t.LOCK_STOCK_STATE = #lock_stock_state:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.md_name_like">upper(t.MD_NAME) like '%' || upper(#map.md_name_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_pd_cls">t.PD_CLS in 
		 (select t.cls_id from konka_base_Pd_Clazz t start with t.cls_id = #map.par_pd_cls# connect by prior t.cls_id = t.par_id )</isNotEmpty>
		 
		<isNotEmpty prepend=" and " property="map.order_type">kxsb.ORDER_TYPE = #map.order_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.stock_from">kxsb.STOCK_FROM = #map.stock_from:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">kxsb.DEPT_ID = #map.dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmd_id">kxsb.ZMD_ID = #map.zmd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.js_bill_state">kxsb.JS_BILL_STATE = #map.js_bill_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_ge"><![CDATA[SELL_DATE >= to_date(#map.sell_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_le"><![CDATA[SELL_DATE <= to_date(#map.sell_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmd_sn_like">upper(kxsb.ZMD_SN) like '%'  || upper(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_man_like">kxsb.SELL_MAN like '%' || #map.sell_man_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_name_like">kd.DEPT_NAME like '%'  || #map.dept_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmds">
				kxsb.ZMD_ID in
				<iterate close=")" open="(" conjunction="," property="map.zmds">#map.zmds[]#</iterate>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsWithOrderPaginatedList" resultMap="konkaXxSellBillDetailsWithOrderResult" parameterClass="konkaXxSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,kd.dept_name,kxsb.zmd_sn,kxsb.sell_date,kxsb.sell_man from konka_xx_sell_bill_details t
    	left join konka_xx_sell_bill kxsb on t.sell_bill_id = kxsb.sell_bill_id
    	left join konka_dept kd on kxsb.dept_id = kd.dept_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="sell_bill_details_id">t.SELL_BILL_DETAILS_ID = #sell_bill_details_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_bill_id">t.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls">t.PD_CLS = #pd_cls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_cls_name">t.PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">t.MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">t.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="counts">t.COUNTS = #counts:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="gift">t.GIFT = #gift:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xs_remarks">t.XS_REMARKS = #xs_remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_fee">t.ZMD_FEE = #zmd_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fix_fee">t.FIX_FEE = #fix_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="lock_stock_state">t.LOCK_STOCK_STATE = #lock_stock_state:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.md_name_like">upper(t.MD_NAME) like '%' || upper(#map.md_name_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.par_pd_cls">t.PD_CLS in 
		 (select t.cls_id from konka_base_Pd_Clazz t start with t.cls_id = #map.par_pd_cls# connect by prior t.cls_id = t.par_id )</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.order_type">kxsb.ORDER_TYPE = #map.order_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.stock_from">kxsb.STOCK_FROM = #map.stock_from:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">kxsb.DEPT_ID = #map.dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmd_id">kxsb.ZMD_ID = #map.zmd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.js_bill_state">kxsb.JS_BILL_STATE = #map.js_bill_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_ge"><![CDATA[SELL_DATE >= to_date(#map.sell_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_le"><![CDATA[SELL_DATE <= to_date(#map.sell_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmd_sn_like">upper(kxsb.ZMD_SN) like '%'  || upper(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_man_like">kxsb.SELL_MAN like '%' || #map.sell_man_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_name_like">kd.DEPT_NAME like '%'  || #map.dept_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmds">
				kxsb.ZMD_ID in
				<iterate close=")" open="(" conjunction="," property="map.zmds">#map.zmds[]#</iterate>
		</isNotEmpty>
		<!-- order by ID asc -->
		order by kd.dept_id asc,sell_bill_details_id asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaXxSellBillDetailsWithPdTypeList" resultMap="konkaXxSellBillDetailsWithPdTypeResult" parameterClass="konkaXxSellBillDetails" >
		select t1.*,t3.type_name from konka_xx_sell_bill_details t1
		left join konka_xx_pd t2 on t1.md_name = t2.md_name
		left join konka_xx_base_type t3 on t2.pd_type = t3.type_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="sell_bill_id">t1.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
	</select>
	
	<!-- 销售单审核、发货、收货确认 2012-01-11，Ren zhong, Begin-->
	<select id="selectkonkaXxSellBillDetailsForSalesOrdersCount" resultClass="long" parameterClass="konkaXxSellBillDetails" >
		select count(*) 
		  from (select d.dept_name,
                       b.zmd_sn,
                       b.dept_id,
                       b.sell_state,
                       b.zmd_id,
                       b.sell_rec_name,
                       to_char(b.add_date, 'yyyy-mm-dd hh24:mi:ss') add_date,
                       p.full_name,
                       b.sell_post_addr,
                       b.sell_rec_link_mp,
                       b.fee_of_post,
                       t.*
				  from konka_xx_sell_bill_details t
				  left join konka_xx_sell_bill b on t.sell_bill_id = b.sell_bill_id
				  left join konka_dept d on b.dept_id = d.dept_id
				  left join konka_base_province_list_four p on b.sell_post_p_index = p.p_index
				 where 1 = 1
				   <isNotEmpty prepend=" and " property="map.dept_id">b.dept_id = #map.dept_id#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.b_sell_state"><![CDATA[b.sell_state >= #map.b_sell_state#]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.e_sell_state"><![CDATA[b.sell_state <= #map.e_sell_state#]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.sell_state_in">b.sell_state in <iterate close=")" open="(" conjunction="," property="map.sell_state_in">#map.sell_state_in[]#</iterate></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.zmd_sn_like">b.ZMD_SN like '%' || #map.zmd_sn_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="sell_bill_details_id">t.SELL_BILL_DETAILS_ID = #sell_bill_details_id:DECIMAL#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="sell_bill_id">t.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.pd_cls_name_like">t.PD_CLS_NAME = #map.pd_cls_name_like#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.md_name_like">t.MD_NAME like '%' || #map.md_name_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.add_date_ge"><![CDATA[b.ADD_DATE >= to_date(#map.add_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.add_date_le"><![CDATA[b.ADD_DATE <= to_date(#map.add_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.buyer_name_like">b.BUYER_NAME like '%' || #map.buyer_name_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.sell_state">b.SELL_STATE = #map.sell_state#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.lock_stock_state">t.LOCK_STOCK_STATE = #map.lock_stock_state#</isNotEmpty>
				   order by b.zmd_id, b.sell_bill_id desc)
		<!--<include refid="sf-konkaXxSellBillDetails" />-->
	</select>
	
	<resultMap id="konkaXxSellBillDetailsForSalesOrdersForResult" class="konkaXxSellBillDetails" extends="konkaXxSellBillDetailsResultForList">
		<result column="ZMD_ID" property="map.zmd_id" jdbcType="DECIMAL" />
		<result column="ZMD_SN" property="map.zmd_sn" jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="map.dept_id" jdbcType="DECIMAL" />
		<result column="SELL_STATE" property="map.sell_state" jdbcType="DECIMAL" />
		<result column="SELL_REC_NAME" property="map.sell_rec_name" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="map.add_date" jdbcType="VARCHAR" />
		<result column="FULL_NAME" property="map.full_name" jdbcType="VARCHAR" />
		<result column="SELL_POST_ADDR" property="map.sell_post_addr" jdbcType="VARCHAR" />
		<result column="SELL_REC_LINK_MP" property="map.sell_rec_link_mp" jdbcType="VARCHAR" />
		<result column="FEE_OF_POST" property="map.fee_of_post" jdbcType="DECIMAL"/>
	</resultMap>
	
	<select id="selectKonkaXxSellBillDetailsForSalesOrdersForResultList" resultMap="konkaXxSellBillDetailsForSalesOrdersForResult" parameterClass="konkaXxSellBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
				select d.dept_name,
                       b.zmd_sn,
                       b.dept_id,
                       b.sell_state,
                       b.zmd_id,
                       b.sell_rec_name,
                       to_char(b.add_date, 'yyyy-mm-dd hh24:mi:ss') add_date,
                       p.full_name,
                       b.sell_post_addr,
                       b.sell_rec_link_mp,
                       b.fee_of_post,
                       t.*
				  from konka_xx_sell_bill_details t
				  left join konka_xx_sell_bill b on t.sell_bill_id = b.sell_bill_id
				  left join konka_dept d on b.dept_id = d.dept_id
				  left join konka_base_province_list_four p on b.sell_post_p_index = p.p_index
				 where 1 = 1
				   <isNotEmpty prepend=" and " property="map.dept_id">b.dept_id = #map.dept_id#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.b_sell_state"><![CDATA[b.sell_state >= #map.b_sell_state#]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.e_sell_state"><![CDATA[b.sell_state <= #map.e_sell_state#]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.sell_state_in">b.sell_state in <iterate close=")" open="(" conjunction="," property="map.sell_state_in">#map.sell_state_in[]#</iterate></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.zmd_sn_like">b.ZMD_SN like '%' || #map.zmd_sn_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.zmd_id">b.zmd_id = #map.zmd_id#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="sell_bill_id">t.SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.pd_cls_like">t.PD_CLS = #map.pd_cls_like#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.pd_cls_name_like">t.PD_CLS_NAME = #map.pd_cls_name_like#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.md_name_like">t.MD_NAME like '%' || #map.md_name_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.add_date_ge"><![CDATA[b.ADD_DATE >= to_date(#map.add_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.add_date_le"><![CDATA[b.ADD_DATE <= to_date(#map.add_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.buyer_name_like">b.BUYER_NAME like '%' || #map.buyer_name_like# || '%'</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.sell_state">b.SELL_STATE = #map.sell_state#</isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.lock_stock_state">t.LOCK_STOCK_STATE = #map.lock_stock_state#</isNotEmpty>
				   order by b.zmd_id, b.sell_bill_id desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- 销售单审核、发货、收货确认 2012-01-11，Ren zhong, End-->

	<insert id="insertKonkaXxSellBillDetails" parameterClass="konkaXxSellBillDetails">
		<selectKey resultClass="long" keyProperty="sell_bill_details_id">select KONKA_XX_BASE_SEQ.nextval as sell_bill_details_id from dual </selectKey>
		<![CDATA[insert into KONKA_XX_SELL_BILL_DETAILS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="sell_bill_details_id">SELL_BILL_DETAILS_ID</isNotNull>	
			<isNotNull prepend="," property="sell_bill_id">SELL_BILL_ID</isNotNull>	
			<isNotNull prepend="," property="pd_cls">PD_CLS</isNotNull>	
			<isNotNull prepend="," property="pd_cls_name">PD_CLS_NAME</isNotNull>	
			<isNotNull prepend="," property="md_name">MD_NAME</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="counts">COUNTS</isNotNull>	
			<isNotNull prepend="," property="gift">GIFT</isNotNull>	
			<isNotNull prepend="," property="xs_remarks">XS_REMARKS</isNotNull>	
			<isNotNull prepend="," property="zmd_fee">ZMD_FEE</isNotNull>	
			<isNotNull prepend="," property="fix_fee">FIX_FEE</isNotNull>	
			<isNotNull prepend="," property="lock_stock_state">LOCK_STOCK_STATE</isNotNull>	
			<isNotNull prepend="," property="zmd_fee_fp">ZMD_FEE_FP</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="sell_bill_details_id">#sell_bill_details_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_bill_id">#sell_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_cls">#pd_cls:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_cls_name">#pd_cls_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="md_name">#md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="counts">#counts:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="gift">#gift:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="xs_remarks">#xs_remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="zmd_fee">#zmd_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fix_fee">#fix_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="lock_stock_state">#lock_stock_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_fee_fp">#zmd_fee_fp:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaXxSellBillDetails" parameterClass="KonkaXxSellBillDetails">
		update KONKA_XX_SELL_BILL_DETAILS
		<dynamic prepend="set">
			<isNotNull prepend="," property="sell_bill_details_id">SELL_BILL_DETAILS_ID = #sell_bill_details_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_bill_id">SELL_BILL_ID = #sell_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_cls">PD_CLS = #pd_cls:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_cls_name">PD_CLS_NAME = #pd_cls_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="md_name">MD_NAME = #md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="counts">COUNTS = #counts:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="gift">GIFT = #gift:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="xs_remarks">XS_REMARKS = #xs_remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="zmd_fee">ZMD_FEE = #zmd_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fix_fee">FIX_FEE = #fix_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="lock_stock_state">LOCK_STOCK_STATE = #lock_stock_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_fee_fp">ZMD_FEE_FP = #zmd_fee_fp:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="sell_bill_details_id">SELL_BILL_DETAILS_ID = #sell_bill_details_id#</isNotEmpty>
		<isEmpty prepend=" " property="sell_bill_details_id">
			<isNotEmpty prepend=" " property="map.pks">
				SELL_BILL_DETAILS_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
			<isNotEmpty prepend=" " property="map.auditDelivery">SELL_BILL_ID = #map.auditDelivery#</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaXxSellBillDetails" parameterClass="KonkaXxSellBillDetails">
		delete from KONKA_XX_SELL_BILL_DETAILS where
		<isNotEmpty prepend=" " property="sell_bill_details_id">SELL_BILL_DETAILS_ID = #sell_bill_details_id#</isNotEmpty>
		<isEmpty prepend=" " property="sell_bill_details_id">
			<isNotEmpty prepend=" " property="map.pks">
				SELL_BILL_DETAILS_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
			<isNotEmpty prepend=" " property="sell_bill_id">SELL_BILL_ID = #sell_bill_id#</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>