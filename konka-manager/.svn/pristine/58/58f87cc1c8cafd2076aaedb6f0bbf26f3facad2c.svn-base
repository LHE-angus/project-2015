<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="USER_INFO">

	<typeAlias alias="userInfo" type="com.ebiz.mmt.domain.UserInfo" />



	<resultMap id="userInfoResultForList" class="userInfo">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="USER_NAME" property="user_name" jdbcType="VARCHAR" />
		<result column="PASS_WORD" property="password" jdbcType="VARCHAR" />
		<result column="USER_TYPE" property="user_type" jdbcType="DECIMAL" />
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="REALNAME" property="realname" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="USER_SCORE" property="user_score" jdbcType="DECIMAL" />
		<result column="USER_STATE" property="user_state" jdbcType="DECIMAL" />
		<result column="SEX" property="sex" jdbcType="DECIMAL" />
		<result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
		<result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
		<result column="TEL" property="tel" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="QQ" property="qq" jdbcType="VARCHAR" />
		<result column="MSN" property="msn" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="USER_IMAGE" property="user_image" jdbcType="DECIMAL" />
		<result column="LOGIN_COUNT" property="login_count" jdbcType="DECIMAL" />
		<result column="LAST_LOGIN_IP" property="last_login_ip" jdbcType="VARCHAR" />
		<result column="LAST_LOGIN_TIME" property="last_login_time" jdbcType="DATETIME" />
		<result column="ADDRESS" property="address" jdbcType="VARCHAR" />
		<result column="IS_ACTIVATE" property="is_activate" jdbcType="DECIMAL" />
		<result column="SIGN" property="sign" jdbcType="VARCHAR" />
		<result column="P_COUNT" property="p_count" jdbcType="DECIMAL" />
		<result column="O_COUNT" property="o_count" jdbcType="DECIMAL" />
		<result column="CARD_AUDIT_STATE" property="card_audit_state" jdbcType="DECIMAL" />
		<result column="STD_ENTP_MAIN_ID" property="std_entp_main_id" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="userInfoResult" class="userInfo" extends="userInfoResultForList">
	</resultMap>

	<sql id="sf-userInfo">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_name">USER_NAME = #user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_state">USER_STATE = #user_state:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="password">PASS_WORD = #password:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_type">USER_TYPE = #user_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="realname">REALNAME like '%' || #realname:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="sex">SEX = #sex:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="birthday">BIRTHDAY = #birthday:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mobile">MOBILE = #mobile:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="tel">TEL = #tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="email">EMAIL = #email:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="qq">QQ = #qq:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="msn">MSN = #msn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_image">USER_IMAGE = #user_image:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="login_count">LOGIN_COUNT = #login_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="last_login_ip">LAST_LOGIN_IP = #last_login_ip:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="last_login_time">LAST_LOGIN_TIME = #last_login_time:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="address">ADDRESS = #address:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_activate">IS_ACTIVATE = #is_activate:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sign">SIGN = #sign:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="card_audit_state">CARD_AUDIT_STATE = #card_audit_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="std_entp_main_id">STD_ENTP_MAIN_ID = #std_entp_main_id:DECIMAL#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.email_like">email = #map.email_like:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mobile_like">MOBILE = #map.mobile_like:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.user_type_ne"><![CDATA[USER_TYPE <> #map.user_type_ne:DECIMAL#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.id_ne"><![CDATA[ID <> #map.id_ne:DECIMAL#]]></isNotEmpty>

		<isNotEmpty prepend=" and " property="map.p_index_par">p_index in (
			select t.p_index from BASE_PROVINCE_LIST t start with t.p_index=#map.p_index_par:VARCHAR# connect by prior t.p_index= t.par_index
			)
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="p_count">P_COUNT = #p_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="o_count">O_COUNT = #o_count:DECIMAL#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.add_date_ge">
			<![CDATA[to_char(ADD_DATE,'yyyy-MM-dd') >= #map.add_date_ge:VARCHAR#]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_lt">
			<![CDATA[to_char(ADD_DATE,'yyyy-MM-dd') < #map.add_date_lt:VARCHAR#]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_le">
			<![CDATA[to_char(ADD_DATE,'yyyy-MM-dd') <= #map.add_date_le:VARCHAR#]]>
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.last_login_time_ge">
			<![CDATA[to_char(LAST_LOGIN_TIME,'yyyy-MM-dd') >= #map.last_login_time_ge:VARCHAR#]]>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.last_login_time_le">
			<![CDATA[to_char(LAST_LOGIN_TIME,'yyyy-MM-dd') <= #map.last_login_time_le:VARCHAR#]]>
		</isNotEmpty>


		<isNotEmpty prepend=" and " property="map.buy_count_compar">
			ID IN (select t.user_id from USER_ORDER t group by t.user_id having 1 = 1
			<isNotEmpty prepend=" and " property="map.buy_count_ge">
				<![CDATA[count(t.user_id) >= #map.buy_count_ge#]]>
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.buy_count_le">
				<![CDATA[count(t.user_id) <= #map.buy_count_le#]]>
			</isNotEmpty>
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.order_count_compar">
			ID IN (select t.user_id from USER_ORDER t group by t.user_id having 1 = 1
			<isNotEmpty prepend=" and " property="map.order_count_ge">
				<![CDATA[sum(t.order_num) >= #map.order_count_ge#]]>
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.order_count_le">
				<![CDATA[sum(t.order_num) <= #map.order_count_le#]]>
			</isNotEmpty>
			)
		</isNotEmpty>
	</sql>

	<select id="selectUserInfo" resultMap="userInfoResult" parameterClass="userInfo">
		select * from USER_INFO where 1 = 1
		<include refid="sf-userInfo" />
	</select>

	<select id="selectUserInfoList" resultMap="userInfoResultForList" parameterClass="userInfo">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from USER_INFO where 1 = 1
		<include refid="sf-userInfo" />
		order by id desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<!-- 买卖商通通过店铺名称和地址 -->
	<select id="selectUserInfoListForBindWithEntpNameAndPindex" resultMap="userInfoResultForList" parameterClass="userInfo">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select *
		from USER_INFO ui
		where ui.shop_id in (select sem.shop_id
		from STD_ENTP_MAIN sem
		where sem.entp_name = #map.entp_name:VARCHAR#
		and sem.p_index = #map.p_index:DECIMAL#)
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectUserInfoCount" resultClass="long" parameterClass="userInfo">
		select count(*) from USER_INFO where 1 = 1
		<include refid="sf-userInfo" />
	</select>

	<select id="selectUserInfoListForEntpTypeId" resultMap="userInfoResult" parameterClass="userInfo">
		select * from ( select * from USER_INFO where 1 = 0
		<isNotEmpty prepend=" union " property="map.entpTypes">
			<iterate conjunction=" union " property="map.entpTypes">
				select u.* from ENTP_INFO e, USER_INFO u where e.id = u.entp_id and
				',' || e.enpt_type_id || ',' like '%' ||
				#map.entpTypes[]# || '%' and e.is_del = 0 and u.is_del = 0</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" union " property="map.userIds">
			select u.* from USER_INFO u where u.id in
			<iterate close=")" open="(" conjunction="," property="map.userIds">#map.userIds[]#</iterate>
		</isNotEmpty>
		) t order by t.id desc
	</select>

	<!-- <select id="selectUserInfoListForEntpTypeId" resultMap="userInfoResult" parameterClass="userInfo" > select * from <isNotEmpty prepend=" " property="map.entpTypes"> <iterate close=")" open="(" conjunction=" union " property="map.entpTypes"> select u.* from ENTP_INFO e, USER_INFO u where e.id = u.entp_id 
		and ',' || e.enpt_type_id || ',' like '%' || #map.entpTypes[]# || '%' and e.is_del = 0 and u.is_del = 0</iterate> </isNotEmpty> t order by t.id desc </select> -->

	<select id="selectUserInfoPaginatedList" resultMap="userInfoResult" parameterClass="userInfo">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from USER_INFO where 1 = 1
		<include refid="sf-userInfo" />
		order by id asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertUserInfo" parameterClass="userInfo">
		<selectKey resultClass="long" keyProperty="id">select USER_SEQUENCE.nextval as id from dual</selectKey>
		<![CDATA[insert into USER_INFO (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>
			<isNotNull prepend="," property="user_name">USER_NAME</isNotNull>
			<isNotNull prepend="," property="password">PASS_WORD</isNotNull>
			<isNotNull prepend="," property="user_type">USER_TYPE</isNotNull>
			<isNotNull prepend="," property="entp_id">ENTP_ID</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>
			<isNotNull prepend="," property="realname">REALNAME</isNotNull>
			,ADD_DATE
			<isNotNull prepend="," property="user_score">USER_SCORE</isNotNull>
			<isNotNull prepend="," property="user_state">USER_STATE</isNotNull>
			<isNotNull prepend="," property="sex">SEX</isNotNull>
			<isNotNull prepend="," property="birthday">BIRTHDAY</isNotNull>
			<isNotNull prepend="," property="mobile">MOBILE</isNotNull>
			<isNotNull prepend="," property="tel">TEL</isNotNull>
			<isNotNull prepend="," property="email">EMAIL</isNotNull>
			<isNotNull prepend="," property="qq">QQ</isNotNull>
			<isNotNull prepend="," property="msn">MSN</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>
			<isNotNull prepend="," property="user_image">USER_IMAGE</isNotNull>
			<isNotNull prepend="," property="login_count">LOGIN_COUNT</isNotNull>
			<isNotNull prepend="," property="last_login_ip">LAST_LOGIN_IP</isNotNull>
			<isNotNull prepend="," property="last_login_time">LAST_LOGIN_TIME</isNotNull>
			<isNotNull prepend="," property="address">ADDRESS</isNotNull>
			<isNotNull prepend="," property="is_activate">IS_ACTIVATE</isNotNull>
			<isNotNull prepend="," property="sign">SIGN</isNotNull>
			<isNotNull prepend="," property="p_count">P_COUNT</isNotNull>
			<isNotNull prepend="," property="o_count">O_COUNT</isNotNull>
			<isNotNull prepend="," property="card_audit_state">CARD_AUDIT_STATE</isNotNull>
			<isNotNull prepend="," property="std_entp_main_id">STD_ENTP_MAIN_ID</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">#user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="password">#password:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_type">#user_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">#entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="realname">#realname:VARCHAR#</isNotNull>
			,sysdate
			<isNotNull prepend="," property="user_score">#user_score:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_state">#user_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sex">#sex:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="birthday">#birthday:DATE#</isNotNull>
			<isNotNull prepend="," property="mobile">#mobile:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="tel">#tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="email">#email:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="qq">#qq:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="msn">#msn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_image">#user_image:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="login_count">#login_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="last_login_ip">#last_login_ip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="last_login_time">#last_login_time:DATETIME#</isNotNull>
			<isNotNull prepend="," property="address">#address:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_activate">#is_activate:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sign">#sign:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_count">#p_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="o_count">#o_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="card_audit_state">#card_audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="std_entp_main_id">#std_entp_main_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateUserInfo" parameterClass="userInfo">
		update USER_INFO
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">USER_NAME = #user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="password">PASS_WORD = #password:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_type">USER_TYPE = #user_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="realname">REALNAME = #realname:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="user_score">USER_SCORE = #user_score:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_state">USER_STATE = #user_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sex">SEX = #sex:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="birthday">BIRTHDAY = #birthday:DATE#</isNotNull>
			<isNotNull prepend="," property="mobile">MOBILE = #mobile:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="tel">TEL = #tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="email">EMAIL = #email:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="qq">QQ = #qq:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="msn">MSN = #msn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="login_count">LOGIN_COUNT = #login_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_image">USER_IMAGE = #user_image:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="last_login_ip">LAST_LOGIN_IP = #last_login_ip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="last_login_time">LAST_LOGIN_TIME = #last_login_time:DATETIME#</isNotNull>
			<isNotNull prepend="," property="address">ADDRESS = #address:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_activate">IS_ACTIVATE = #is_activate:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sign">SIGN = #sign:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="card_audit_state">CARD_AUDIT_STATE = #card_audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="std_entp_main_id">STD_ENTP_MAIN_ID = #std_entp_main_id:DECIMAL#</isNotNull>

			<isNotNull prepend="," property="p_count">P_COUNT = #p_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="o_count">O_COUNT = #o_count:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteUserInfo" parameterClass="userInfo">
		delete from USER_INFO where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>