<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="J_BASE_GOODS">

	<typeAlias alias="jBaseGoods" type="com.ebiz.mmt.domain.JBaseGoods" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertJBaseGoods" />
		<flushOnExecute statement="updateJBaseGoods" />
		<flushOnExecute statement="deleteJBaseGoods" />
	</cacheModel>

	<resultMap id="jBaseGoodsResultForList" class="jBaseGoods">
		<result column="GOODS_ID" property="goods_id" jdbcType="DECIMAL" />
		<result column="GOODS_NAME" property="goods_name" jdbcType="VARCHAR" />
		<result column="GOODS_SN" property="goods_sn" jdbcType="VARCHAR" />
		<result column="GOODS_UNIT" property="goods_unit" jdbcType="DECIMAL" />
		<result column="GOODS_TYPE" property="goods_type" jdbcType="DECIMAL" />
		<result column="GOODS_STUTES" property="goods_stutes" jdbcType="DECIMAL" />
		<result column="GOODS_DESC" property="goods_desc" jdbcType="VARCHAR" />
		<result column="INIT_COUNT" property="init_count" jdbcType="DECIMAL" />
		<result column="BUY_PRICE" property="buy_price" jdbcType="DECIMAL" />
		<result column="SELL_PRICE" property="sell_price" jdbcType="DECIMAL" />
		<result column="IS_KONKA" property="is_konka" jdbcType="DECIMAL" />
		<result column="C_ID" property="c_id" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="jBaseGoodsResult" class="jBaseGoods" extends="jBaseGoodsResultForList">
	</resultMap>

	<sql id="sf-jBaseGoods">
		<isNotEmpty prepend=" and " property="goods_id">GOODS_ID = #goods_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_name">GOODS_NAME = #goods_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_sn">GOODS_SN = #goods_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_unit">GOODS_UNIT = #goods_unit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_type">GOODS_TYPE = #goods_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_stutes">GOODS_STUTES = #goods_stutes:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_desc">GOODS_DESC = #goods_desc:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="init_count">INIT_COUNT = #init_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="buy_price">BUY_PRICE = #buy_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_price">SELL_PRICE = #sell_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_konka">IS_KONKA = #is_konka:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">C_ID = #c_id:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.goods_name_like">GOODS_NAME like '%' || #map.goods_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.goods_sn_like">GOODS_SN like '%' || #map.goods_sn_like:VARCHAR# || '%'</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.selects">GOODS_ID in ($map.selects$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.no_selects">GOODS_ID not in ($map.no_selects$)</isNotEmpty>
	</sql>

	<select id="selectJBaseGoods" resultMap="jBaseGoodsResult" parameterClass="jBaseGoods" cacheModel="oneDayCache">
		select * from J_BASE_GOODS where 1 = 1
		<include refid="sf-jBaseGoods" />
	</select>

	<select id="selectJBaseGoodsList" resultMap="jBaseGoodsResultForList" parameterClass="jBaseGoods" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from J_BASE_GOODS where 1 = 1
		<include refid="sf-jBaseGoods" />
		order by GOODS_NAME asc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJBaseGoodsCount" resultClass="long" parameterClass="jBaseGoods" cacheModel="oneDayCache">
		select count(*) from J_BASE_GOODS where 1 = 1
		<include refid="sf-jBaseGoods" />
		
	</select>

	<select id="selectJBaseGoodsPaginatedList" resultMap="jBaseGoodsResult" parameterClass="jBaseGoods" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from J_BASE_GOODS where 1 = 1
		<include refid="sf-jBaseGoods" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- 取仓库库存列表，Ren zhong，2013-06-17，BEGIN -->
	<select id="selectJBaseGoodsWithStockCount" resultClass="long" parameterClass="jBaseGoods" cacheModel="oneDayCache">
		select count(*)
		  from J_BASE_GOODS
		 where 1 = 1
		<include refid="sf-jBaseGoods" />
		<isNotEmpty prepend=" and " property="map.goodsIdsIn">
		   	   goods_id in
		       (select goods_id
		          from j_stocks
		         where store_id in
		               (select store_id from j_base_store where c_id = #map.goodsIdsIn#)
		               <isNotEmpty prepend=" and " property="map.storeId">store_id = #map.storeId#</isNotEmpty>)
		</isNotEmpty>		   
	</select>
	
	<select id="selectJBaseGoodsWithStockPaginatedList" resultMap="jBaseGoodsResult"  parameterClass="jBaseGoods" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
					select *
					  from J_BASE_GOODS
					 where 1 = 1
					    <include refid="sf-jBaseGoods" />
						<isNotEmpty prepend=" and " property="map.goodsIdsIn">
						   	   goods_id in
						       (select goods_id
						          from j_stocks
						         where store_id in
						               (select store_id from j_base_store where c_id = #map.goodsIdsIn#)
						               <isNotEmpty prepend=" and " property="map.storeId">store_id = #map.storeId#</isNotEmpty>)
						</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>	
	</select>
	<!-- 取仓库库存列表，Ren zhong，2013-06-17，END -->

	<insert id="insertJBaseGoods" parameterClass="jBaseGoods">
		<selectKey resultClass="long" keyProperty="goods_id">select SEQ_J_GOODS_ID.nextval as goods_id from dual </selectKey>
		<![CDATA[insert into J_BASE_GOODS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="goods_id">GOODS_ID</isNotNull>	
			<isNotNull prepend="," property="goods_name">GOODS_NAME</isNotNull>	
			<isNotNull prepend="," property="goods_sn">GOODS_SN</isNotNull>	
			<isNotNull prepend="," property="goods_unit">GOODS_UNIT</isNotNull>	
			<isNotNull prepend="," property="goods_type">GOODS_TYPE</isNotNull>	
			<isNotNull prepend="," property="goods_stutes">GOODS_STUTES</isNotNull>	
			<isNotNull prepend="," property="goods_desc">GOODS_DESC</isNotNull>	
			<isNotNull prepend="," property="init_count">INIT_COUNT</isNotNull>	
			<isNotNull prepend="," property="buy_price">BUY_PRICE</isNotNull>	
			<isNotNull prepend="," property="sell_price">SELL_PRICE</isNotNull>	
			<isNotNull prepend="," property="is_konka">IS_KONKA</isNotNull>	
			<isNotNull prepend="," property="c_id">C_ID</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="goods_id">#goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_name">#goods_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="goods_sn">#goods_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="goods_unit">#goods_unit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_type">#goods_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_stutes">#goods_stutes:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_desc">#goods_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="init_count">#init_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="buy_price">#buy_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_price">#sell_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_konka">#is_konka:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">#c_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJBaseGoods" parameterClass="JBaseGoods">
		update J_BASE_GOODS
		<dynamic prepend="set">
			<isNotNull prepend="," property="goods_id">GOODS_ID = #goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_name">GOODS_NAME = #goods_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="goods_sn">GOODS_SN = #goods_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="goods_unit">GOODS_UNIT = #goods_unit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_type">GOODS_TYPE = #goods_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_stutes">GOODS_STUTES = #goods_stutes:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_desc">GOODS_DESC = #goods_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="init_count">INIT_COUNT = #init_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="buy_price">BUY_PRICE = #buy_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_price">SELL_PRICE = #sell_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_konka">IS_KONKA = #is_konka:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID = #c_id:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="goods_id">GOODS_ID = #goods_id#</isNotEmpty>
		<isEmpty prepend=" " property="goods_id">
			<isNotEmpty prepend=" " property="map.pks">
				GOODS_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJBaseGoods" parameterClass="JBaseGoods">
		update J_BASE_GOODS set GOODS_STUTES =1 where
		<isNotEmpty prepend=" " property="goods_id">GOODS_ID = #goods_id#</isNotEmpty>
		<isEmpty prepend=" " property="goods_id">
			<isNotEmpty prepend=" " property="map.pks">
				GOODS_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>