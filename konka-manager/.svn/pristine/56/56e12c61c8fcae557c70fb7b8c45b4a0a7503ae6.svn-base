<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="YWT_TASK">

	<typeAlias alias="ywtTask" type="com.ebiz.mmt.domain.YwtTask" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertYwtTask" />
		<flushOnExecute statement="updateYwtTask" />
		<flushOnExecute statement="deleteYwtTask" />
	</cacheModel>

	<resultMap id="ywtTaskResultForList" class="ywtTask">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="USER_ID" property="user_id" jdbcType="DECIMAL" />
		<result column="REAL_NAME" property="real_name" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="PAR_TASK_ID" property="par_task_id" jdbcType="DECIMAL" />
		<result column="PAR_TASK_NAME" property="par_task_name" jdbcType="VARCHAR" />
		<result column="TASK_NAME" property="task_name" jdbcType="VARCHAR" />
		<result column="PRIORITY" property="priority" jdbcType="DECIMAL" />
		<result column="TASK_TYPE" property="task_type" jdbcType="DECIMAL" />
		<result column="CONTENT" property="content" jdbcType="CLOB" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="FINSH_DATE" property="finsh_date" jdbcType="TIMESTAMP" />
		<result column="TASK_STATE" property="task_state" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="ASSIGNED_USER_ID" property="assigned_user_id" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="DEL_USER_ID" property="del_user_id" jdbcType="DECIMAL" />
		<result column="DEL_DATE" property="del_date" jdbcType="TIMESTAMP" />
		<result column="TASK_REULST" property="task_reulst" jdbcType="VARCHAR" />
		<result column="CONCLUSION" property="conclusion" jdbcType="VARCHAR" />
		<result column="BEGIN_DATE" property="begin_date" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="ywtTaskResult" class="ywtTask" extends="ywtTaskResultForList">
	</resultMap>
	
	<resultMap id="ywtTaskResultLB" class="ywtTask" extends="ywtTaskResultForList">
		<result column="fgs_Dept" property="map.fgs_Dept" jdbcType="VARCHAR" />
		<result column="reveUser" property="map.reveUser" jdbcType="VARCHAR" />
		<result column="delUser" property="map.delUser" jdbcType="VARCHAR" />
		<result column="TYPE_NAME" property="map.type_name" jdbcType="VARCHAR" />
		<result column="fj_paths" property="map.fj_paths" jdbcType="VARCHAR" />
		<result column="revecount" property="map.revecount" jdbcType="VARCHAR" />
		<result column="subcount" property="map.subcount" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-ywtTask">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_id">USER_ID = #user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="real_name">REAL_NAME = #real_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_task_id">PAR_TASK_ID = #par_task_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_task_name">PAR_TASK_NAME = #par_task_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="task_name">TASK_NAME = #task_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="priority">PRIORITY = #priority:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="task_type">TASK_TYPE = #task_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="content">CONTENT = #content:CLOB#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="finsh_date">FINSH_DATE = #finsh_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="task_state">TASK_STATE = #task_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="assigned_user_id">ASSIGNED_USER_ID = #assigned_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_user_id">DEL_USER_ID = #del_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_date">DEL_DATE = #del_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="task_reulst">TASK_REULST = #task_reulst:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="conclusion">CONCLUSION = #conclusion:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="begin_date">BEGIN_DATE = #begin_date:TIMESTAMP#</isNotEmpty>
	</sql>
	<sql id="sf-ywtTaskLB">
			<isNotEmpty prepend=" and " property="id">task.ID = #id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="user_id">task.USER_ID = #user_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="real_name">task.REAL_NAME = #real_name:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="add_date">task.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="par_task_id">task.PAR_TASK_ID = #par_task_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="par_task_name">task.PAR_TASK_NAME = #par_task_name:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="task_name">task.TASK_NAME = #task_name:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="priority">task.PRIORITY = #priority:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="task_type">task.TASK_TYPE = #task_type:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="content">task.CONTENT = #content:CLOB#</isNotEmpty>
			<isNotEmpty prepend=" and " property="remark">task.REMARK = #remark:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="finsh_date">task.FINSH_DATE = #finsh_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="task_state">task.TASK_STATE = #task_state:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="dept_id">task.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="assigned_user_id">task.ASSIGNED_USER_ID = #assigned_user_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="is_del">task.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="del_user_id">task.DEL_USER_ID = #del_user_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="del_date">task.DEL_DATE = #del_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="task_reulst">task.TASK_REULST = #task_reulst:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="conclusion">task.CONCLUSION = #conclusion:VARCHAR#</isNotEmpty>
			<isNotEmpty prepend=" and " property="begin_date">task.BEGIN_DATE = #begin_date:TIMESTAMP#</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._fgs_dept_id">
			   dept.L4_DEPT_ID = #map._fgs_dept_id:DECIMAL#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._real_name_like">
			   task.REAL_NAME like '%' || #map._real_name_like:VARCHAR# || '%'
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._assigned_user_name_like">
			  task.ASSIGNED_USER_ID in(
				select fb_user.ID from KONKA_PE_PROD_USER fb_user 
				where fb_user.REAL_NAME like '%' || #map._assigned_user_name_like:VARCHAR# || '%'
			   )
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._task_name_like">
			   task.TASK_NAME like '%' || #map._task_name_like:VARCHAR# || '%'
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._par_task_name_like">
			   task.PAR_TASK_NAME like '%' || #map._par_task_name_like:VARCHAR# || '%'
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map._begin_begin_date">
                 <![CDATA[ task.BEGIN_DATE >= to_date (#map._begin_begin_date:VARCHAR#, 'yyyy-mm-dd hh24:mi:ss') ]]>
            </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._end_finsh_date">
		         <![CDATA[ task.FINSH_DATE <= to_date (#map._end_finsh_date:VARCHAR#, 'yyyy-mm-dd hh24:mi:ss') ]]>
		    </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map._add_date">
		         <![CDATA[ to_char(task.ADD_DATE,'yyyy-MM') = #map._add_date:VARCHAR#]]>
		    </isNotEmpty>
		    <isNotEmpty prepend=" and " property="map.dept_id_start">
			       task.USER_ID IN
			              (SELECT deptDownUser.ID
			                 FROM KONKA_PE_PROD_USER deptDownUser
			                WHERE deptDownUser.DEPT_ID IN
			                         (SELECT dept_id
			                            FROM konka_dept
			                          START WITH dept_id IN
			                                        (SELECT DISTINCT (dept_id)
			                                           FROM KONKA_ROLE_DATA_LEVEL
			                                          WHERE role_id IN
			                                                   (SELECT role_id
			                                                      FROM KONKA_PE_ROLE_USER
			                                                     WHERE user_id = #map.session_user_id:DECIMAL#))
			                                     OR dept_id = #map.dept_id_start#
			                          CONNECT BY PRIOR dept_id = par_id))
			       OR task.USER_ID = #map.session_user_id:DECIMAL#  
			 </isNotEmpty>
		</sql>

	<select id="selectYwtTask" resultMap="ywtTaskResult" parameterClass="ywtTask" cacheModel="oneDayCache">
		select * from YWT_TASK where 1 = 1
		<include refid="sf-ywtTask" />
	</select>

	<select id="selectYwtTaskList" resultMap="ywtTaskResultForList" parameterClass="ywtTask" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from YWT_TASK where 1 = 1
		<include refid="sf-ywtTask" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectYwtTaskCount" resultClass="long" parameterClass="ywtTask" cacheModel="oneDayCache">
		select count(*) from YWT_TASK where 1 = 1
		<include refid="sf-ywtTask" />
	</select>

	<select id="selectYwtTaskPaginatedList" resultMap="ywtTaskResult" parameterClass="ywtTask" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from YWT_TASK where 1 = 1
		<include refid="sf-ywtTask" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectYwtTaskLBCount" resultClass="long" parameterClass="ywtTask" cacheModel="oneDayCache">
		SELECT count(*)
	       FROM YWT_TASK task
	       LEFT JOIN  KONKA_BASE_TYPE_DATA base_type
		          ON task.TASK_TYPE = base_type.TYPE_ID
	       LEFT JOIN V_ORG_OF_DEPT dept
	          ON task.DEPT_ID = dept.CUR_DEPT_ID
	       LEFT JOIN KONKA_PE_PROD_USER reveUser
	          ON task.ASSIGNED_USER_ID = reveUser.ID
	       LEFT JOIN KONKA_PE_PROD_USER delUser
	          ON task.DEL_USER_ID = delUser.ID
	           WHERE 1 = 1 AND base_type.IS_DEL=0
			<include refid="sf-ywtTaskLB" />
		</select>
	
		<select id="selectYwtTaskLBPaginatedList" resultMap="ywtTaskResultLB" parameterClass="ywtTask" cacheModel="oneDayCache">
			<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
			SELECT task.*,
		       dept.DEPT_NAME fgs_Dept,
		       reveUser.REAL_NAME reveUser,
		       delUser.REAL_NAME delUser,
		       base_type.TYPE_NAME,
		       (select
				listagg(f.save_path, ',') within group (order by
				f.LINK_ID)
				from
				ATTACHMENT f
				where
				f.LINK_TAB='YWT_TASK' and f.DEL_MARK =0 and
				f.LINK_ID=task.ID
				group by
				LINK_ID ) fj_paths,
			(select count(*) from YWT_TASK_RECEIVE reveTotle where reveTotle.TASK_ID=task.ID) revecount,
			 (SELECT count (*) FROM YWT_TASK b WHERE b.PAR_TASK_ID = task.ID) subcount 
	         FROM YWT_TASK task
	           LEFT JOIN  KONKA_BASE_TYPE_DATA base_type
		          ON task.TASK_TYPE = base_type.TYPE_ID
		       LEFT JOIN V_ORG_OF_DEPT dept
		          ON task.DEPT_ID = dept.CUR_DEPT_ID
		       LEFT JOIN KONKA_PE_PROD_USER reveUser
		          ON task.ASSIGNED_USER_ID = reveUser.ID
		       LEFT JOIN KONKA_PE_PROD_USER delUser
		          ON task.DEL_USER_ID = delUser.ID
		        WHERE 1 = 1 AND base_type.IS_DEL=0
			<include refid="sf-ywtTaskLB" />
			   order by task.add_date desc
			<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
		</select>
		
		<!--查找子任务-->
		<select id="selectxiaji" resultMap="ywtTaskResultLB" parameterClass="ywtTask" cacheModel="oneDayCache" >
			<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
				SELECT task.*,
                       dept.DEPT_NAME fgs_Dept,
                       reveUser.REAL_NAME reveUser,
                       delUser.REAL_NAME delUser,
                       base_type.TYPE_NAME,
                       (SELECT listagg (f.save_path, ',') within    
                       group (order by     f.LINK_ID)     from     ATTACHMENT f    
                       where     f.LINK_TAB='YWT_TASK' and f.DEL_MARK =0 and     f.LINK_ID=task.ID    
                       group by     LINK_ID ) fj_paths,    (select count(*) from YWT_TASK_RECEIVE reveTotle 
                       where reveTotle.TASK_ID=task.ID) revecount,     (SELECT count (*) FROM YWT_TASK b 
                       WHERE b.PAR_TASK_ID = task.ID) subcount            FROM YWT_TASK task            
                       LEFT JOIN  KONKA_BASE_TYPE_DATA base_type             ON task.TASK_TYPE = base_type.TYPE_ID         
                       LEFT JOIN V_ORG_OF_DEPT dept             ON task.DEPT_ID = dept.CUR_DEPT_ID          
                       LEFT JOIN KONKA_PE_PROD_USER reveUser             ON task.ASSIGNED_USER_ID = reveUser.ID         
                       LEFT JOIN KONKA_PE_PROD_USER delUser             ON task.DEL_USER_ID = delUser.ID          
                       WHERE 1 = 1 AND base_type.IS_DEL=0 
                      <isNotEmpty prepend=" and " property="par_task_id">
                   		   task.PAR_TASK_ID = #par_task_id:DECIMAL#
                      </isNotEmpty>
               <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
		</select>
		
    <!--根据单个或多个部门 模糊搜索用户待选分配下级人员列表-->
	<select id="selectNoChooseList" resultClass="HashMap" parameterClass="ywtTask" cacheModel="oneDayCache">
		select <![CDATA[(allUser.ID||'&'||allUser.REAL_NAME)AS ID]]>,allUser.REAL_NAME AS REAL_NAME from KONKA_PE_PROD_USER allUser 
		where 1=1 
		and allUser.IS_DEL=0
		and allUser.dept_id IS NOT NULL
                  <!--当前人坐在部门及下级部门-->
    <isNotEmpty prepend=" and " property="map.currUserId">
          allUser.DEPT_ID in(SELECT dept_id
            FROM konka_dept
          START WITH dept_id IN
                        (SELECT DISTINCT (dept_id)
                          FROM KONKA_ROLE_DATA_LEVEL
                          WHERE role_id IN
                                  (SELECT role_id
                                      FROM KONKA_PE_ROLE_USER
                                    WHERE user_id = #map.currUserId:DECIMAL#))
                    OR dept_id = #map.currUserDept:DECIMAL#
          CONNECT BY PRIOR dept_id = par_id)
    </isNotEmpty>
     <!--选择多个或单个部门-->
    <isNotEmpty prepend=" and " property="map.select_depts">
		 allUser.DEPT_ID in
	    <iterate close=")" open="(" conjunction="," property="map.select_depts">#map.select_depts[]#</iterate>
	</isNotEmpty>
     <!--模糊搜索待选人-->
    <isNotEmpty prepend=" and " property="map.no_choose_user_like">
          allUser.ID in(select searchUser.ID from KONKA_PE_PROD_USER searchUser where searchUser.REAL_NAME like '%' || #map.no_choose_user_like:VARCHAR# || '%')
    </isNotEmpty>
    <!--过滤已选人-->
    <isNotEmpty prepend=" and " property="map.curr_task_id">
           allUser.ID not in(select reveUser.USER_ID from YWT_TASK_RECEIVE reveUser where 1=1 and reveUser.TASK_ID= #map.curr_task_id:DECIMAL#)
    </isNotEmpty>
	</select>
	
	<!--查找接收人信息列表-->
	<select id="selectChooseList" resultClass="HashMap" parameterClass="ywtTask" cacheModel="oneDayCache">
	  select <![CDATA[(reveUser.ID||'&'||reveUser.REAL_NAME)AS ID ]]>,reveUser.REAL_NAME AS REAL_NAME 
	    from YWT_TASK_RECEIVE receive 
	    left join KONKA_PE_PROD_USER reveUser 
	    on receive.USER_ID=reveUser.ID
	    where 1=1
	    <isNotEmpty prepend=" and " property="map.curr_task_id">
            receive.TASK_ID=#map.curr_task_id:DECIMAL#
        </isNotEmpty>
	</select>
	
	<insert id="insertYwtTask" parameterClass="ywtTask">
		<selectKey resultClass="long" keyProperty="id">select YWT_TASK_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into YWT_TASK (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="user_id">USER_ID</isNotNull>	
			<isNotNull prepend="," property="real_name">REAL_NAME</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="par_task_id">PAR_TASK_ID</isNotNull>	
			<isNotNull prepend="," property="par_task_name">PAR_TASK_NAME</isNotNull>	
			<isNotNull prepend="," property="task_name">TASK_NAME</isNotNull>	
			<isNotNull prepend="," property="priority">PRIORITY</isNotNull>	
			<isNotNull prepend="," property="task_type">TASK_TYPE</isNotNull>	
			<isNotNull prepend="," property="content">CONTENT</isNotNull>	
			<isNotNull prepend="," property="remark">REMARK</isNotNull>	
			<isNotNull prepend="," property="finsh_date">FINSH_DATE</isNotNull>	
			<isNotNull prepend="," property="task_state">TASK_STATE</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="assigned_user_id">ASSIGNED_USER_ID</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="del_user_id">DEL_USER_ID</isNotNull>	
			<isNotNull prepend="," property="del_date">DEL_DATE</isNotNull>	
			<isNotNull prepend="," property="task_reulst">TASK_REULST</isNotNull>	
			<isNotNull prepend="," property="conclusion">CONCLUSION</isNotNull>	
			<isNotNull prepend="," property="begin_date">BEGIN_DATE</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">#user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="real_name">#real_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="par_task_id">#par_task_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_task_name">#par_task_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="task_name">#task_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="priority">#priority:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="task_type">#task_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="content">#content:CLOB#</isNotNull>
			<isNotNull prepend="," property="remark">#remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="finsh_date">#finsh_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="task_state">#task_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="assigned_user_id">#assigned_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_user_id">#del_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">#del_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="task_reulst">#task_reulst:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="conclusion">#conclusion:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="begin_date">#begin_date:TIMESTAMP#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateYwtTask" parameterClass="YwtTask">
		update YWT_TASK
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">USER_ID = #user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="real_name">REAL_NAME = #real_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="par_task_id">PAR_TASK_ID = #par_task_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_task_name">PAR_TASK_NAME = #par_task_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="task_name">TASK_NAME = #task_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="priority">PRIORITY = #priority:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="task_type">TASK_TYPE = #task_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="content">CONTENT = #content:CLOB#</isNotNull>
			<isNotNull prepend="," property="remark">REMARK = #remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="finsh_date">FINSH_DATE = #finsh_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="task_state">TASK_STATE = #task_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="assigned_user_id">ASSIGNED_USER_ID = #assigned_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_user_id">DEL_USER_ID = #del_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">DEL_DATE = #del_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="task_reulst">TASK_REULST = #task_reulst:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="conclusion">CONCLUSION = #conclusion:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="begin_date">BEGIN_DATE = #begin_date:TIMESTAMP#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteYwtTask" parameterClass="YwtTask">
		delete from YWT_TASK where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>