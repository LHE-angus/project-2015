<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="GLOBAL_IP_GEO_LIB">

	<typeAlias alias="globalIpGeoLib" type="com.ebiz.mmt.domain.GlobalIpGeoLib" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertGlobalIpGeoLib" />
		<flushOnExecute statement="updateGlobalIpGeoLib" />
		<flushOnExecute statement="deleteGlobalIpGeoLib" />
	</cacheModel>

	<resultMap id="globalIpGeoLibResultForList" class="globalIpGeoLib">
		<result column="IP1" property="ip1" jdbcType="VARCHAR" />
		<result column="IP2" property="ip2" jdbcType="VARCHAR" />
		<result column="ADDR" property="addr" jdbcType="VARCHAR" />
		<result column="ADDR_DESC" property="addr_desc" jdbcType="VARCHAR" />
		<result column="IPV1" property="ipv1" jdbcType="DECIMAL" />
		<result column="IPV2" property="ipv2" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="globalIpGeoLibResult" class="globalIpGeoLib" extends="globalIpGeoLibResultForList">
	</resultMap>
	
	<resultMap id="globalIpGeoLibForIndexResult" class="globalIpGeoLib" extends="globalIpGeoLibResultForList">
		<result column="P_INDEX" property="map.p_index" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-globalIpGeoLib">
		<isNotEmpty prepend=" and " property="ip1">IP1 = #ip1:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ip2">IP2 = #ip2:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr">ADDR = #addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr_desc">ADDR_DESC = #addr_desc:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ipv1">IPV1 = #ipv1:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ipv2">IPV2 = #ipv2:DECIMAL#</isNotEmpty>
	</sql>

	<select id="selectGlobalIpGeoLib" resultMap="globalIpGeoLibResult" parameterClass="globalIpGeoLib" cacheModel="oneDayCache">
		select * from GLOBAL_IP_GEO_LIB where 1 = 1
		<include refid="sf-globalIpGeoLib" />
	</select>

	<select id="selectGlobalIpGeoLibList" resultMap="globalIpGeoLibResultForList" parameterClass="globalIpGeoLib" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from GLOBAL_IP_GEO_LIB where 1 = 1
		<include refid="sf-globalIpGeoLib" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!--@author Hu,Hao @version 2012-07-05-->
	<select id="selectGlobalIpGeoLibForIndexList" resultMap="globalIpGeoLibForIndexResult" parameterClass="globalIpGeoLib" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.*, b.p_index
    		from GLOBAL_IP_GEO_LIB a
    		left join KONKA_BASE_PROVINCE_LIST_FOUR b on a.addr = b.FULL_NAME
   			where a.addr not in
         		('法国', '欧洲', '荷兰', '阿塞拜疆', '局域网', '柬埔寨', '白俄罗斯', '阿尔巴尼亚', '马耳他',
          		'塔吉克斯坦', '尼日利亚', '赞比亚', '博茨瓦纳', '冈比亚', '塞内加尔', '蒙古', '英属维尔京群岛',
          		'汉中理工学院', '法罗群岛', '开曼群岛', '瓦努阿图', '不丹', '委内瑞拉', '尼加拉瓜', '朝鲜',
          		'巴拉圭', '阿鲁巴', 'IANA保留地址用于网络测试', '基里巴斯', '西北工业大学', '纯真网络', '日本',
          		'阿联酋', '克罗地亚', '巴勒斯坦', '挪威', '葡萄牙', '伊朗', '新西兰', '马来西亚', '摩尔多瓦',
         		'巴布亚新几内亚', '圣文森特和格林纳丁斯', '乌兹别克斯坦', '拉脱维亚', '卢森堡', '泽西岛', '马达加斯加',
          		'莱索托', '苏丹', '科特迪瓦', '突尼斯', '卡塔尔', '牙买加', '百慕大', '哥伦比亚', '格林纳达', 'AD',
          		'刚果共和国', '非洲地区', '所罗门群岛', '土库曼斯坦', '本机地址', '拉美地区', '厄瓜多尔', '海地',
          		'苏里南', '几内亚比绍', '科摩罗', '美属萨摩亚', '齐齐哈尔医学院', 's246.xrea.com日本',
          		'聚友网络', '英格兰', '波兰', '意大利', '瑞士', 'IANA保留地址', '北美地区', '马尔代夫',
          		'孟加拉', '埃及', '肯尼亚', '加蓬', '加纳', '佛得角', '刚果(布)', '毛里求斯', '摩洛哥', '中非',
          		'留尼汪', '根西岛', '特克斯和凯科斯群岛', '格陵兰', '法属波利尼西亚', '马提尼克', '密克罗尼西亚联邦', '智利',
          		'乌拉圭', '洪都拉斯', '圭亚那', '波黑', '圣卢西亚', '安圭拉', '北马里亚纳群岛', '全国通用',
          		'太原科技大学', '韩国', '澳大利亚', '罗马尼亚', '奥地利', '越南', '希腊', '黎巴嫩', '立陶宛', '阿曼',
          		'塞尔维亚', '亚太地区', '斐济', '叙利亚', '比利时', '阿根廷', '格鲁吉亚', '也门', '塞拉利昂', '冰岛', '马里', '贝宁',
          		'利比亚', '马拉维', '乌干达', '喀麦隆', '几内亚', '刚果(金)', '非洲', '纳米比亚', '梵蒂冈',
          		'APNIC', '安提瓜和巴布达', '法属圣马丁', '萨摩亚', '圣基茨和尼维斯', '秘鲁', '荷属安的列斯',
          		'瓜德罗普', '雅虎', 'IBM中国公司', '厄立特里亚', '泰国', '印度', '德国', '伊拉克',
          		'波斯尼亚和黑塞哥维那', '匈牙利', '列支敦士登', '加拿大', '爱尔兰', '安哥拉', '南非', 'IANA',
          		'美属维尔京群岛', '直布罗陀', '奥兰群岛', '关岛', 'Microsoft', '玻利维亚', '汤加', '多米尼加',
          		'IANA保留地址6to4隧道地址', '埃塞俄比亚', '英属印度洋领地', '维多利亚', '俄罗斯', '沙特阿拉伯', '捷克',
          		'爱沙尼亚', '芬兰', '美国', '新加坡', '乌克兰', '波多黎各', '巴基斯坦', '斯洛伐克', '巴哈马',
          		'吉尔吉斯斯坦', '坦桑尼亚', '斯威士兰', '布基纳法索', '欧洲和中东地区', '圣皮埃尔和密克隆', '马恩岛',
          		'特立尼达和多巴哥', '摩纳哥', '斯里兰卡', '马绍尔群岛', '缅甸', '危地马拉', '圣多美和普林西比',
          		'法属圭亚那', '蒙塞拉特岛', '图瓦卢', '库克群岛', '多米尼克', '瑙鲁', '塞尔维亚和黑山', '英国',
          		'西班牙', '瑞典', '约旦', '塞浦路斯', '保加利亚', '马其顿', '印度尼西亚', '菲律宾', '托克劳',
          		'亚美尼亚', '卢旺达', '阿尔及利亚', '多哥', '塞舌尔', '伯利兹', '布隆迪', 'SS', '吉布提', '纽埃',
          		'新喀里多尼亚', '文莱', '联合国', '圣马力诺', '巴巴多斯', '巴拿马', '哥斯达黎加', '巴西',
          		'萨尔瓦多', '帕劳', 'CNNIC', '土耳其', '丹麦', '以色列', '哈萨克斯坦', '斯洛文尼亚', '尼泊尔',
          		'瓦利斯和富图纳', '科威特', '巴林', '乍得', '莫桑比克', '津巴布韦', '利比里亚', '赤道几内亚',
          		'索马里', '尼日尔', '毛里塔尼亚', '阿富汗', '凯里', '老挝', '墨西哥', '古巴', '东帝汶',
          		'诺福克岛', '联通', '台湾省')
     		and  #map.ipValue:DECIMAL# >= a.IPV1
     		and  a.Ipv2 > #map.ipValue:DECIMAL# 
		<include refid="sf-globalIpGeoLib" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectGlobalIpGeoLibCount" resultClass="long" parameterClass="globalIpGeoLib" cacheModel="oneDayCache">
		select count(*) from GLOBAL_IP_GEO_LIB where 1 = 1
		<include refid="sf-globalIpGeoLib" />
	</select>

	<select id="selectGlobalIpGeoLibPaginatedList" resultMap="globalIpGeoLibResult" parameterClass="globalIpGeoLib" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from GLOBAL_IP_GEO_LIB where 1 = 1
		<include refid="sf-globalIpGeoLib" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertGlobalIpGeoLib" parameterClass="globalIpGeoLib">
		<selectKey resultClass="long" keyProperty="id">select seq_xxx.nextval as id from dual </selectKey>
		<![CDATA[insert into GLOBAL_IP_GEO_LIB (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="ip1">IP1</isNotNull>	
			<isNotNull prepend="," property="ip2">IP2</isNotNull>	
			<isNotNull prepend="," property="addr">ADDR</isNotNull>	
			<isNotNull prepend="," property="addr_desc">ADDR_DESC</isNotNull>	
			<isNotNull prepend="," property="ipv1">IPV1</isNotNull>	
			<isNotNull prepend="," property="ipv2">IPV2</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="ip1">#ip1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ip2">#ip2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr">#addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr_desc">#addr_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ipv1">#ipv1:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ipv2">#ipv2:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateGlobalIpGeoLib" parameterClass="GlobalIpGeoLib">
		update GLOBAL_IP_GEO_LIB
		<dynamic prepend="set">
			<isNotNull prepend="," property="ip1">IP1 = #ip1:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ip2">IP2 = #ip2:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr">ADDR = #addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="addr_desc">ADDR_DESC = #addr_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ipv1">IPV1 = #ipv1:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ipv2">IPV2 = #ipv2:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteGlobalIpGeoLib" parameterClass="GlobalIpGeoLib">
		delete from GLOBAL_IP_GEO_LIB where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>