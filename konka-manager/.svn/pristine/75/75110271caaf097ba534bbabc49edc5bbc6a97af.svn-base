<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JXC_STOCK_BILL">

	<typeAlias alias="jxcStockBill" type="com.ebiz.mmt.domain.JxcStockBill" />

	

	<resultMap id="jxcStockBillResultForList" class="jxcStockBill">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="SHOP_P_INDEX" property="shop_p_index" jdbcType="DECIMAL" />
		<result column="SN" property="sn" jdbcType="VARCHAR" />
		<result column="SUPPLIER_ID" property="supplier_id" jdbcType="DECIMAL" />
		<result column="IN_DATE" property="in_date" jdbcType="DATE" />
		<result column="OPR_MAN" property="opr_man" jdbcType="VARCHAR" />
		<result column="PAY_MONEY" property="pay_money" jdbcType="DECIMAL" />
		<result column="PAID_MONEY" property="paid_money" jdbcType="DECIMAL" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<!-- add 2011-11-15 -->
		<result column="STOCK_SRC" property="stock_src" jdbcType="DECIMAL" />
		<!-- add 2011-11-16 -->
		<result column="FH_SN" property="fh_sn" jdbcType="VARCHAR" />
		<result column="XS_SN" property="xs_sn" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="jxcStockBillResult" class="jxcStockBill" extends="jxcStockBillResultForList">
	</resultMap>
	
	<resultMap id="jxcStockBillResultWithSupplierName" class="jxcStockBill" extends="jxcStockBillResultForList">
		<result column="supplier_name" property="map.supplier_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="jxcStockBillResultWithMoney" class="jxcStockBill" >
		<result column="yf_pay" property="map.yf_pay" jdbcType="DECIMAL" />
		<result column="sf_pay" property="map.sf_pay" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="jxcStockBillResultForSZMX" class="jxcStockBill">
		<result column="SN" property="sn" jdbcType="VARCHAR" />
		<result column="IN_DATE" property="in_date" jdbcType="DATE" />
		<result column="PAY_MONEY" property="pay_money" jdbcType="DECIMAL" />
		<result column="PAID_MONEY" property="paid_money" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="SM" property="map.sm" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="sf-jxcStockBill">
		<isNotEmpty prepend=" and " property="id">a.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_p_index">a.SHOP_P_INDEX = #shop_p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sn">a.SN = #sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="supplier_id">a.SUPPLIER_ID = #supplier_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="in_date">a.IN_DATE = #in_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="opr_man">a.OPR_MAN = #opr_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_money">a.PAY_MONEY = #pay_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="paid_money">a.PAID_MONEY = #paid_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">a.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE = #add_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">a.REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<!-- add 2011-11-15 -->
		<isNotEmpty prepend=" and " property="stock_src">a.STOCK_SRC = #stock_src:DECIMAL#</isNotEmpty>
		<!-- add 2011-11-16 -->
		<isNotEmpty prepend=" and " property="fh_sn">a.FH_SN = #fh_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="xs_sn">a.XS_SN = #xs_sn:VARCHAR#</isNotEmpty>
		
		<!-- 用户自定义 -->
		
		<isNotEmpty prepend=" and " property="map.add_date_lt_0"><![CDATA[ a.ADD_DATE < to_date(#map.add_date_lt_0#, 'YYYY-MM-DD') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_lt"><![CDATA[ a.ADD_DATE <= to_date(#map.add_date_lt# || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_gt"><![CDATA[ a.ADD_DATE >= to_date(#map.add_date_gt#, 'YYYY-MM-DD') ]]></isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.add_date_lt1">ADD_DATE between #map.add_date_lt1:DATETIME# and #map.add_date_gt1:DATETIME#</isNotEmpty>
	</sql>

	<select id="selectJxcStockBill" resultMap="jxcStockBillResult" parameterClass="jxcStockBill" >
		select * from CHEA_FILL.JXC_STOCK_BILL a where 1 = 1
		<include refid="sf-jxcStockBill" />
	</select>
	
	<!-- 查询金额 -->
	<select id="selectJxcStockBillWithMoney" resultMap="jxcStockBillResultWithMoney" parameterClass="jxcStockBill" >
		select sum(a.pay_money) as yf_pay,sum(a.paid_money) as sf_pay from CHEA_FILL.JXC_STOCK_BILL a where 1 = 1
		<include refid="sf-jxcStockBill" />
	</select>
	
	<!-- 进销存付款列表明细  2011-03-04 -->
	<select id="selectJxcStockBillListForSZMX" resultMap="jxcStockBillResultForSZMX" parameterClass="jxcStockBill" >
		select *
		  from (select a.in_date,
		               a.sn,
		               a.pay_money,
		               a.paid_money,
		               1 as sm,
		               a.add_date
		          from CHEA_FILL.JXC_STOCK_BILL a
		         where a.is_del = 0
		        <include refid="sf-jxcStockBill" />
		        
		        union all
		        
		        select sz.busi_date as in_date,
		               sz.sz_sn as sn,
		               0 as pay_money,
		               sz.money as paid_money,
		               0 as sm,
		               sz.add_date
		          from CHEA_FILL.JXC_SZ_DETAILS sz
		         where sz.sz_type = 0
		           and sz.is_del = 0
		           <isNotEmpty prepend=" and " property="supplier_id">
		           		sz.sz_obj_id = #supplier_id:DECIMAL#
		           </isNotEmpty>
		           <isNotEmpty prepend=" and " property="shop_id">
		           		sz.shop_id = #shop_id:DECIMAL#
		           </isNotEmpty>
		           <isNotEmpty prepend=" and " property="map.add_date_lt">
		           		<![CDATA[ busi_date <= to_date(#map.add_date_lt# || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS') ]]>
		           </isNotEmpty>
				   <isNotEmpty prepend=" and " property="map.add_date_gt">
						<![CDATA[ busi_date >= to_date(#map.add_date_gt#,'yyyy-mm-dd') ]]>
				   </isNotEmpty>
		           )
		 order by in_date, add_date
	</select>
	
	<select id="selectJxcStockBillList" resultMap="jxcStockBillResultWithSupplierName" parameterClass="jxcStockBill" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.*,s.name as supplier_name from CHEA_FILL.JXC_STOCK_BILL a left join CHEA_FILL.JXC_SUPPLIER s on a.supplier_id = s.id where 1 = 1
		<include refid="sf-jxcStockBill" />
		order by a.in_date desc,a.ID desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJxcStockBillCount" resultClass="long" parameterClass="jxcStockBill" >
		select count(*) from CHEA_FILL.JXC_STOCK_BILL a where 1 = 1
		<include refid="sf-jxcStockBill" />
	</select>

	<select id="selectJxcStockBillPaginatedList" resultMap="jxcStockBillResultWithSupplierName" parameterClass="jxcStockBill" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*,s.name as supplier_name from CHEA_FILL.JXC_STOCK_BILL a 
		left join CHEA_FILL.JXC_SUPPLIER s on a.supplier_id = s.id
		where 1 = 1
		<include refid="sf-jxcStockBill" />
		order by a.in_date desc,a.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectJxcStockBillPaginatedListWithSname" resultMap="jxcStockBillResultWithSupplierName" parameterClass="jxcStockBill" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*,s.name as supplier_name from CHEA_FILL.JXC_STOCK_BILL a left join CHEA_FILL.JXC_SUPPLIER s on a.supplier_id = s.id 
		where 1 = 1
		<include refid="sf-jxcStockBill" />
		order by a.in_date desc,a.id desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertJxcStockBill" parameterClass="jxcStockBill">
		<selectKey resultClass="long" keyProperty="id">select CHEA_FILL.JXC_BILL_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into CHEA_FILL.JXC_STOCK_BILL (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>		
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>	
			<isNotNull prepend="," property="shop_p_index">SHOP_P_INDEX</isNotNull>	
			<isNotNull prepend="," property="sn">SN</isNotNull>	
			<isNotNull prepend="," property="supplier_id">SUPPLIER_ID</isNotNull>	
			<isNotNull prepend="," property="in_date">IN_DATE</isNotNull>	
			<isNotNull prepend="," property="opr_man">OPR_MAN</isNotNull>	
			<isNotNull prepend="," property="pay_money">PAY_MONEY</isNotNull>	
			<isNotNull prepend="," property="paid_money">PAID_MONEY</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>
			<!-- add 2011-11-15 -->
			<isNotNull prepend="," property="stock_src">STOCK_SRC</isNotNull>	
			<!-- add 2011-11-16 -->
			<isNotNull prepend="," property="fh_sn">FH_SN</isNotNull>	
			<isNotNull prepend="," property="xs_sn">XS_SN</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_p_index">#shop_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sn">'JH' || to_char(systimestamp, 'yyyymmddhh24missff')</isNotNull>
			<isNotNull prepend="," property="supplier_id">#supplier_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="in_date">#in_date:DATE#</isNotNull>
			<isNotNull prepend="," property="opr_man">#opr_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_money">#pay_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="paid_money">#paid_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<!-- add 2011-11-15 -->
			<isNotNull prepend="," property="stock_src">#stock_src:DECIMAL#</isNotNull>
			<!-- add 2011-11-16 -->
			<isNotNull prepend="," property="fh_sn">#fh_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="xs_sn">#xs_sn:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJxcStockBill" parameterClass="JxcStockBill">
		update CHEA_FILL.JXC_STOCK_BILL
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_p_index">SHOP_P_INDEX = #shop_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sn">SN = #sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="supplier_id">SUPPLIER_ID = #supplier_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="in_date">IN_DATE = #in_date:DATE#</isNotNull>
			<isNotNull prepend="," property="opr_man">OPR_MAN = #opr_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pay_money">PAY_MONEY = #pay_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="paid_money">PAID_MONEY = #paid_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATE#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<!-- add 2011-11-15 -->
			<isNotNull prepend="," property="stock_src">STOCK_SRC = #stock_src:DECIMAL#</isNotNull>
			<!-- add 2011-11-16 -->
			<isNotNull prepend="," property="fh_sn">FH_SN = #fh_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="xs_sn">XS_SN = #xs_sn:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJxcStockBill" parameterClass="JxcStockBill">
		delete from CHEA_FILL.JXC_STOCK_BILL where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>