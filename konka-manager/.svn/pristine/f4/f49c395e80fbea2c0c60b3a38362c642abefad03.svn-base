<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_ORDER_INFO">

	<typeAlias alias="konkaOrderInfo" type="com.ebiz.mmt.domain.KonkaOrderInfo" />
	<typeAlias alias="konkaOrderInfoAudit" type="com.ebiz.mmt.domain.KonkaOrderInfoAudit" />

	

	<resultMap id="konkaOrderInfoResultForList" class="konkaOrderInfo">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="TRADE_INDEX" property="trade_index" jdbcType="VARCHAR" />
		<result column="ORDER_NUM" property="order_num" jdbcType="DECIMAL" />
		<result column="MONEY" property="money" jdbcType="DECIMAL" />
		<result column="GOOD_DISCOUNT_PRICE" property="good_discount_price" jdbcType="DECIMAL" />
		<result column="ORDER_STATE" property="order_state" jdbcType="DECIMAL" />
		<result column="USER_NAME" property="user_name" jdbcType="VARCHAR" />
		<result column="USER_TEL" property="user_tel" jdbcType="VARCHAR" />
		<result column="USER_PHONE" property="user_phone" jdbcType="VARCHAR" />
		<result column="USER_ADDR" property="user_addr" jdbcType="VARCHAR" />
		<result column="USER_ZIP" property="user_zip" jdbcType="VARCHAR" />
		<result column="USER_P_INDEX" property="user_p_index" jdbcType="DECIMAL" />
		<result column="USER_SHOP_NAME" property="user_shop_name" jdbcType="VARCHAR" />
		<result column="USER_REMARK" property="user_remark" jdbcType="VARCHAR" />
		<result column="ORDER_DATE" property="order_date" jdbcType="DATETIME" />
		<result column="PAY_DATE" property="pay_date" jdbcType="DATETIME" />
		<result column="SHIPPING_ID" property="shipping_id" jdbcType="DECIMAL" />
		<result column="SHIPPING_DATE" property="shipping_date" jdbcType="DATETIME" />
		<result column="RECEIVING_ID" property="receiving_id" jdbcType="DECIMAL" />
		<result column="RECEIVING_DATE" property="receiving_date" jdbcType="DATETIME" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="FREIGHT" property="freight" jdbcType="DECIMAL" />
		<result column="INVOICE_TYPE" property="invoice_type" jdbcType="DECIMAL" />
		<result column="INVOICES_PAYABLE" property="invoices_payable" jdbcType="VARCHAR" />
		<result column="RETURN_REASON" property="return_reason" jdbcType="VARCHAR" />
		<result column="INVOICE_STATUS" property="invoice_status" jdbcType="DECIMAL" />
		<result column="PAY_TYPE" property="pay_type" jdbcType="DECIMAL" />
		<result column="MATFLOW_MODE" property="matflow_mode" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="ADD_USER_NAME" property="add_user_name" jdbcType="VARCHAR" />
		<result column="ADD_DEPT_ID" property="add_dept_id" jdbcType="DECIMAL" />
		<result column="ADD_DEPT_NAME" property="add_dept_name" jdbcType="VARCHAR" />
		<result column="UPDATE_DATE" property="update_date" jdbcType="DATETIME" />
		<result column="UPDATE_USER_ID" property="update_user_id" jdbcType="DECIMAL" />
		<result column="PROCESS_STATE" property="process_state" jdbcType="DECIMAL" />
		<!-- new add dzm by 2012/2/7 start-->
		<result column="PROCESS_ID" property="process_id" jdbcType="DECIMAL" />
		<result column="AUDIT_STATE" property="audit_state" jdbcType="DECIMAL" />
		<!-- new add dzm by 2012/2/7 end -->
		<!-- new add lk by 2012/2/16 start-->
		<result column="SEND_TYPE" property="send_type" jdbcType="DECIMAL" />
		<!-- new add lk by 2012/2/16 end -->
		<!-- new add dzm by 2012/3/1 start-->
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="IS_SUBMIT" property="is_submit" jdbcType="DECIMAL" />
		<result column="IS_END" property="is_end" jdbcType="DECIMAL" />
		<!-- new add dzm by 2012/3/1 end-->
		<result column="CUST_ID" property="cust_id" jdbcType="DECIMAL" />
		<result column="SALES_ORG" property="sales_org" jdbcType="VARCHAR" />
		<result column="DIVISION" property="division" jdbcType="VARCHAR" />
		<result column="AG" property="ag" jdbcType="VARCHAR" />
		<result column="RE" property="re" jdbcType="VARCHAR" />
		<result column="RG" property="rg" jdbcType="VARCHAR" />
		<result column="WE" property="we" jdbcType="VARCHAR" />
		<result column="SYNC_STATE" property="sync_state" jdbcType="DECIMAL" />
		<result column="R3_ID" property="r3_id" jdbcType="DECIMAL" />
	</resultMap>

	<!-- ibatis联合查询审核信息表 需要的resultMap :BEGIN-->
	<resultMap id="konkaOrderInfoAuditResultListForAudit" class="konkaOrderInfoAudit">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="LINK_ID" property="link_id" jdbcType="DECIMAL" />
		<result column="AUDIT_TYPE" property="audit_type" jdbcType="DECIMAL" />
		<result column="AUDIT_LEVEL" property="audit_level" jdbcType="DECIMAL" />
		<result column="AUDIT_USER_ID" property="audit_user_id" jdbcType="DECIMAL" />
		<result column="AUDIT_USER" property="audit_user" jdbcType="VARCHAR" />
		<result column="AUDIT_COMMENT" property="audit_comment" jdbcType="VARCHAR" />
		<result column="AUDIT_DATETIME" property="audit_datetime" jdbcType="DATETIME" />
		<result column="AGENT_AUDIT_USER_ID" property="agent_audit_user_id" jdbcType="DECIMAL" />
		<result column="AGENT_AUDIT_USER" property="agent_audit_user" jdbcType="VARCHAR" />
		<result column="AUDIT_RESULT" property="audit_result" jdbcType="DECIMAL" />
		<result column="AUDIT_DEPT_ID" property="audit_dept_id" jdbcType="DECIMAL" />
		<result column="AUDIT_DEPT_NAME" property="audit_dept_name" jdbcType="VARCHAR" />
		<result column="AGENT_AUDIT_DEPT_ID" property="agent_audit_dept_id" jdbcType="DECIMAL" />
		<result column="AGENT_AUDIT_DEPT_NAME" property="agent_audit_dept_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="selectEntpStateTypeInfoListWithAuditInfos" resultMap="konkaOrderInfoAuditResultListForAudit" parameterClass="long">
		select * from KONKA_ORDER_INFO_AUDIT
		 where 1 = 1 
		 and LINK_ID = #value#
		order by audit_datetime , id 
	</select>
	<!-- ibatis联合查询审核信息表 需要的resultMap :END-->
	
	<resultMap id="konkaOrderInfoResult" class="konkaOrderInfo" extends="konkaOrderInfoResultForList">
	</resultMap>
	
	<resultMap id="konkaOrderInfoResultWithShopNameAndAuditInfos" class="konkaOrderInfo" extends="konkaOrderInfoResultForList">
		<result column="ID" property="konkaOrderInfoAuditList" select="selectEntpStateTypeInfoListWithAuditInfos" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-konkaOrderInfo">
		<isNotEmpty prepend=" and " property="id">a.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="trade_index">a.TRADE_INDEX = #trade_index:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_num">a.ORDER_NUM = #order_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money">a.MONEY = #money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="good_discount_price">a.GOOD_DISCOUNT_PRICE = #good_discount_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_state">a.ORDER_STATE = #order_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_name">a.USER_NAME = #user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_tel">a.USER_TEL = #user_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_phone">a.USER_PHONE = #user_phone:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_addr">a.USER_ADDR = #user_addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_zip">a.USER_ZIP = #user_zip:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_p_index">a.USER_P_INDEX = #user_p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_shop_name">a.USER_SHOP_NAME = #user_shop_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_remark">a.USER_REMARK = #user_remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_date">a.ORDER_DATE = #order_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_date">a.PAY_DATE = #pay_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shipping_id">a.SHIPPING_ID = #shipping_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shipping_date">a.SHIPPING_DATE = #shipping_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="receiving_id">a.RECEIVING_ID = #receiving_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="receiving_date">a.RECEIVING_DATE = #receiving_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">a.REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="freight">a.FREIGHT = #freight:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="invoice_type">a.INVOICE_TYPE = #invoice_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="invoices_payable">a.INVOICES_PAYABLE = #invoices_payable:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="return_reason">a.RETURN_REASON = #return_reason:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="invoice_status">a.INVOICE_STATUS = #invoice_status:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pay_type">a.PAY_TYPE = #pay_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="matflow_mode">a.MATFLOW_MODE = #matflow_mode:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">a.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">a.ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_dept_id">a.ADD_DEPT_ID = #add_dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_dept_name">a.ADD_DEPT_NAME = #add_dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">a.UPDATE_DATE = #update_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">a.UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="process_state">a.PROCESS_STATE = #process_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="process_id">a.PROCESS_ID = #process_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_state">a.AUDIT_STATE = #audit_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="send_type">a.SEND_TYPE = #send_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_submit">a.IS_SUBMIT = #is_submit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_end">a.IS_END = #is_end:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cust_id">a.CUST_ID = #cust_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sales_org">SALES_ORG = #sales_org:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="division">DIVISION = #division:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ag">AG = #ag:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="re">RE = #re:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="rg">RG = #rg:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="we">WE = #we:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sync_state">SYNC_STATE = #sync_state:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_id">R3_ID = #r3_id:VARCHAR#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.start_date"><![CDATA[a.ORDER_DATE >= to_date(#map.start_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.trade_index_like">a.TRADE_INDEX like '%'|| #map.trade_index_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[a.ORDER_DATE <= to_date(#map.end_date#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.process_state">
		a.PROCESS_STATE is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.filter_ids">
			a.ID in (
				select distinct t.link_id from konka_Order_Info_Audit t
				left join Konka_Order_info t1 on t1.id=t.link_id
				left join Konka_Order_Audit_Process t2 on t2.Process_type = t1.process_state and t2.add_dept_id = #map.filter_ids_fgs_dept_id:DECIMAL# and t2.Is_del=0
				left join Konka_Order_Audit_Process_Node t3 on t3.Audit_proces_id=t2.id and t3.audit_level=t.audit_level and t3.add_dept_id = #map.filter_ids_fgs_dept_id:DECIMAL# and t3.Is_del=0 
				where 1=1
				and t.AUDIT_DEPT_ID in (
				    select dept_id  from KONKA_DEPT
				              start with dept_id = #map.filter_ids_fgs_dept_id:DECIMAL#
				              connect by prior dept_id = par_id
				  )
				and t.Audit_level in <iterate close=")" open="(" conjunction="," property="map.filter_ids_audit_level_array">#map.filter_ids_audit_level_array[]#</iterate>
				and t.Audit_result = #map.filter_ids_audit_result:DECIMAL#
			)
		</isNotEmpty>
		
		<!--审核状态搜索条件		-->
		<isNotEmpty prepend=" and " property="map.audit_state_not_audit"><!-- 未审核 -->
			 a.id  not in (select  koia_audit.link_id
                  from konka_order_info_audit koia_audit
                 where 1 = 1
                   <isNotEmpty prepend=" and " property="map.audit_state_levels">
						koia_audit.audit_level in 
						<iterate close=")" open="(" conjunction="," property="map.audit_state_levels">#map.audit_state_levels[]#</iterate>
	               </isNotEmpty>
	               <isNotEmpty prepend=" and " property="map.audit_role_id">
						koia_audit.audit_user_id in(
							select r.user_id
							  from Konka_Pe_Role_User r
							 where r.role_id = #map.audit_role_id#
							   and r.user_id in
							       (select u.id from Konka_Pe_Prod_User u where u.dept_id = #map.audit_dept_id#)
 
						)
	               </isNotEmpty>
				and koia_audit.audit_dept_id in(
                		select dept_id 
                			from KONKA_DEPT
                        	start with dept_id = #map.fgs_dept_id#
                            connect by prior dept_id = par_id
                 )
             )
			
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.audit_state"><!-- 已审核 -->
			 a.id  in (select  koia_audit.link_id
                  from konka_order_info_audit koia_audit
                 where 1 = 1
                   <isNotEmpty prepend=" and " property="map.audit_state_levels">
						koia_audit.audit_level in 
						<iterate close=")" open="(" conjunction="," property="map.audit_state_levels">#map.audit_state_levels[]#</iterate>
	               </isNotEmpty>
<!--                   <isNotEmpty prepend=" and " property="map.andit_level_now_user">-->
<!--						koia_audit.audit_level = #map.andit_level_now_user#-->
<!--	               </isNotEmpty>-->
				<!--一个角色为一个等级或两个等级不相同时，加上用户的角色和部门id过滤              -->
                   <isNotEmpty prepend=" and " property="map.audit_role_id">
						koia_audit.audit_user_id in(
							select r.user_id
							  from Konka_Pe_Role_User r
							 where r.role_id = #map.audit_role_id#
							   and r.user_id in
							       (select u.id from Konka_Pe_Prod_User u where u.dept_id = #map.audit_dept_id#)
						)
	               </isNotEmpty>
                   and koia_audit.audit_dept_id in(
                   		select dept_id 
                   			from KONKA_DEPT
                          	 start with dept_id = #map.fgs_dept_id#
                          		connect by prior dept_id = par_id
                   )
                   and koia_audit.audit_result = #map.audit_state#
                 )
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.audit_level_eq_1"><!-- 一级审核（业务员） -->
		(a.SHOP_ID in (<!-- 取对应买买提shop_id -->
			select b.mmt_shop_id shop_id
			  from konka_r3_mmt_match b
			 where b.r3_shop_id in (select t.konka_r3_id
			                          from branch_assign t
			                         where t.user_id =#map.ywy_id#
			                         	   and t.branch_type = 1
			                         )
			union (select t2.mmt_shop_id
					  from konka_branch_category t2
					 where 1 = 1
					   and t2.konka_r3_id in (select t.konka_r3_id
					                            from branch_assign t
					                           where t.user_id = #map.ywy_id#
					                           	     and t.branch_type = 1
					                           )
					   and t2.mmt_shop_id is not null
					   and t2.category_id = 20
			)
		)
		or (a.cust_id in (select t.konka_r3_id from branch_assign t where t.user_id =#map.ywy_id# and t.branch_type = 1) and a.cust_id is not null)
		)
		</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.audit_level_gt_1"><!-- 2级及以上 级别审核 -->
			( a.ID  in ( <!-- 取前一级已审核通过的订单 -->
					select t.link_id
		                  from konka_order_info_audit t
		                 where 1=1
		                 <isNotEmpty prepend=" " property="map.is_all">
			                 <isNotEmpty prepend=" and " property="map.before_audit_levels">
								t.audit_level in 
								<iterate close=")" open="(" conjunction="," property="map.before_audit_levels">#map.before_audit_levels[]#</iterate>
			                 </isNotEmpty>
			                <!-- 
			                 <isNotEmpty prepend=" and " property="map.sqlStr"> ($map.sqlStr$) </isNotEmpty>
			                 <isEmpty prepend=" and " property="map.sqlStr"> t.link_id in (-1) </isEmpty> -->
						</isNotEmpty>
		                <isEmpty prepend=" and " property="map.is_all"> t.audit_level = #map.audit_level_before# </isEmpty>
		                <isNotEmpty prepend=" and " property="map.process_state">
							t.link_id in (select c.id from KONKA_ORDER_INFO c where c.process_state = #map.process_state#)
						</isNotEmpty>
		                   and t.audit_result = 1
		                   and t.audit_dept_id in(
		                   		select dept_id 
		                   			from KONKA_DEPT
		                          	 start with dept_id = #map.fgs_dept_id#
		                          		connect by prior dept_id = par_id
		                   )
				)
				or ((a.SHOP_ID in (<!-- 取充当的业务员对应的订单                  -->
					select b.mmt_shop_id shop_id
					  from konka_r3_mmt_match b
					 where b.r3_shop_id in (select t.konka_r3_id
					                          from branch_assign t
					                         where t.user_id =#map.ywy_id#
					                         	   and t.branch_type = 1
					                         )
					union (select t2.mmt_shop_id
							  from konka_branch_category t2
							 where 1 = 1
							   and t2.konka_r3_id in (select t.konka_r3_id
							                            from branch_assign t
							                           where t.user_id = #map.ywy_id#
							                           	     and t.branch_type = 1
							                           )
							   and t2.mmt_shop_id is not null
							   and t2.category_id = 20
					)
				) 
				<isNotEmpty prepend=" and " property="map.process_state_select"> a.PROCESS_STATE = #map.process_state_select# </isNotEmpty>
				)
				or (a.cust_id in (select t.konka_r3_id from branch_assign t where t.user_id =#map.ywy_id# and t.branch_type = 1) and a.cust_id is not null)
				)
			)
		</isNotEmpty>
		
    	<!--分公司查看订单	 @admin、事业部不执行该语句		-->
		<isNotEmpty prepend=" and " property="map.order_view_fgs">
		(a.SHOP_ID in (<!-- 取对应买买提shop_id -->
			select b.mmt_shop_id shop_id
			  from konka_r3_mmt_match b
			 where b.r3_shop_id in (
					select t3.konka_r3_id
					  from BRANCH_ASSIGN t3
					 where 1 = 1
					   and t3.branch_type = 1
					   and (t3.fgs_id in (select dept_id
					                        from KONKA_DEPT
					                       start with dept_id = #map.fgs_dept_id#
					                      connect by prior dept_id = par_id) or
					       t3.jyb_id in (select dept_id
					                        from KONKA_DEPT
					                       start with dept_id = #map.fgs_dept_id#
					                      connect by prior dept_id = par_id) or
					       t3.bsc_id in (select dept_id
					                        from KONKA_DEPT
					                       start with dept_id = #map.fgs_dept_id#
					                      connect by prior dept_id = par_id))
			                         )
		<!--			union (select t1.shop_id from konka_shop_develop t1 where t1.user_id = #map.salesmanId#)-->
			union (select t2.mmt_shop_id
					  from konka_branch_category t2
					 where 1 = 1
					   and t2.konka_r3_id in (
							select t3.konka_r3_id
							  from BRANCH_ASSIGN t3
							 where 1 = 1
							   and t3.branch_type = 1
							   and (t3.fgs_id in (select dept_id
							                        from KONKA_DEPT
							                       start with dept_id = #map.fgs_dept_id#
							                      connect by prior dept_id = par_id) or
							       t3.jyb_id in (select dept_id
							                        from KONKA_DEPT
							                       start with dept_id = #map.fgs_dept_id#
							                      connect by prior dept_id = par_id) or
							       t3.bsc_id in (select dept_id
							                        from KONKA_DEPT
							                       start with dept_id = #map.fgs_dept_id#
							                      connect by prior dept_id = par_id))
					                           )
					   and t2.mmt_shop_id is not null
					   and t2.category_id = 20
			)
		)
		or (a.cust_id in (select t3.konka_r3_id from branch_assign t3 where t3.branch_type = 1
			   and (t3.fgs_id in (select dept_id
			                        from KONKA_DEPT
			                       start with dept_id = #map.fgs_dept_id#
			                      connect by prior dept_id = par_id) or
			       t3.jyb_id in (select dept_id
			                        from KONKA_DEPT
			                       start with dept_id = #map.fgs_dept_id#
			                      connect by prior dept_id = par_id) or
			       t3.bsc_id in (select dept_id
			                        from KONKA_DEPT
			                       start with dept_id = #map.fgs_dept_id#
			                      connect by prior dept_id = par_id))) and a.cust_id is not null)
		)
		</isNotEmpty>
		
    	<!--订单	 @选择部门搜索	-->
		<isNotEmpty prepend=" and " property="map.order_view_for_search">
		(a.SHOP_ID in (<!-- 取对应买买提shop_id -->
			select b.mmt_shop_id shop_id
			  from konka_r3_mmt_match b
			 where b.r3_shop_id in (
					select t3.konka_r3_id
					  from BRANCH_ASSIGN t3
					 where 1 = 1
					   and t3.branch_type = 1
					   and (
					   		<isNotEmpty prepend=" " property="map.fgs_dept_id_for_search">
						  		t3.fgs_id = #map.fgs_dept_id_for_search#
					   		<isNotEmpty prepend=" and " property="map.jyb_dept_id_for_search">
						        t3.jyb_id = #map.jyb_dept_id_for_search#
							</isNotEmpty>
					   		<isNotEmpty prepend=" and " property="map.bsc_dept_id_for_search">
						        t3.bsc_id = #map.bsc_dept_id_for_search#
							</isNotEmpty>
							</isNotEmpty>
					)
			)
			union (select t2.mmt_shop_id
					  from konka_branch_category t2
					 where 1 = 1
					   and t2.konka_r3_id in (
							select t3.konka_r3_id
							  from BRANCH_ASSIGN t3
							 where 1 = 1
							   and t3.branch_type = 1
							   and (<isNotEmpty prepend=" " property="map.fgs_dept_id_for_search">
						  		t3.fgs_id = #map.fgs_dept_id_for_search#
					   		<isNotEmpty prepend=" and " property="map.jyb_dept_id_for_search">
						        t3.jyb_id = #map.jyb_dept_id_for_search#
							</isNotEmpty>
					   		<isNotEmpty prepend=" and " property="map.bsc_dept_id_for_search">
						        t3.bsc_id = #map.bsc_dept_id_for_search#
							</isNotEmpty>
							</isNotEmpty>
							)
					                           )
					   and t2.mmt_shop_id is not null
					   and t2.category_id = 20
			)
		)
		or a.cust_id in (select t3.konka_r3_id
							  from BRANCH_ASSIGN t3
							 where 1 = 1
							   and t3.branch_type = 1
							   and (<isNotEmpty prepend=" " property="map.fgs_dept_id_for_search">
						  		t3.fgs_id = #map.fgs_dept_id_for_search#
					   		<isNotEmpty prepend=" and " property="map.jyb_dept_id_for_search">
						        t3.jyb_id = #map.jyb_dept_id_for_search#
							</isNotEmpty>
					   		<isNotEmpty prepend=" and " property="map.bsc_dept_id_for_search">
						        t3.bsc_id = #map.bsc_dept_id_for_search#
							</isNotEmpty>
							</isNotEmpty>
							))
		)
		</isNotEmpty>
		
		<!--订单 @客户名称模糊搜索		-->
		<isNotEmpty prepend=" and " property="map.customer_name_like">
		(a.SHOP_ID in (
			select b.mmt_shop_id shop_id
			  from konka_r3_mmt_match b
			 where b.r3_shop_id in<!--根据名称模糊搜索R3网点，找出对应的网点信息(代理商，经销商的shop_id)	-->
			       (select krs.id
			          from konka_r3_shop krs
			         where 1=1 and ((krs.CUSTOMER_NAME like '%' || #map.customer_name_like:VARCHAR# || '%') or
			               (krs.AREA_NAME like '%' || #map.customer_name_like:VARCHAR# || '%') or
			               (krs.BRANCH_AREA_NAME like'%' || #map.customer_name_like# || '%')))
			union (select t2.mmt_shop_id
			         from konka_branch_category t2
			        where 1 = 1
			          and t2.konka_r3_id in
			              (select krs.id
			                 from konka_r3_shop krs
			                where 1 = 1
			                  and ((krs.CUSTOMER_NAME like '%' || #map.customer_name_like :VARCHAR# || '%') or
			                      (krs.AREA_NAME like '%' || #map.customer_name_like :VARCHAR# || '%') or
			                      (krs.BRANCH_AREA_NAME like'%' || #map.customer_name_like# || '%')))
			          and t2.mmt_shop_id is not null
			          and t2.category_id = 20)
		)
		 or a.cust_id in (select krs.id
			          from konka_r3_shop krs
			         where 1=1 and ((krs.CUSTOMER_NAME like '%' || #map.customer_name_like:VARCHAR# || '%') or
			               (krs.AREA_NAME like '%' || #map.customer_name_like:VARCHAR# || '%') or
			               (krs.BRANCH_AREA_NAME like'%' || #map.customer_name_like# || '%')))
		)
		</isNotEmpty>
		
		<isNotEmpty prepend=" " property="map.action_audit_order"><!-- 登录用户待审核订单-->
			and (a.AUDIT_STATE = 0 or a.AUDIT_STATE = 1)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.history_audit_order"><!-- 登录用户审核参与的审核完成的订单-->
		a.id in (
				select t.link_id from konka_order_info_audit t where t.audit_user_id = #map.login_user_Id#
		) 
		and (a.AUDIT_STATE = 2 or a.AUDIT_STATE = 3)
		</isNotEmpty>
		
	</sql>

	<select id="selectKonkaOrderInfo" resultMap="konkaOrderInfoResultForList" parameterClass="konkaOrderInfo" >
		select a.* from KONKA_ORDER_INFO a where 1 = 1
		<include refid="sf-konkaOrderInfo" />
	</select>

	<select id="selectKonkaOrderInfoListWithShopName" resultMap="konkaOrderInfoResultWithShopNameAndAuditInfos" parameterClass="konkaOrderInfo" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.* ,b.shop_name from KONKA_ORDER_INFO a 
		left join entp_shop b on b.shop_id = a.shop_id  
		where 1 = 1
		<include refid="sf-konkaOrderInfo" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaOrderInfoCount" resultClass="long" parameterClass="konkaOrderInfo" >
		select count(*) from KONKA_ORDER_INFO a where 1 = 1
		<include refid="sf-konkaOrderInfo" />
	</select>

	<select id="selectKonkaOrderInfoPaginatedListWithShopName" resultMap="konkaOrderInfoResultWithShopNameAndAuditInfos" parameterClass="konkaOrderInfo" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.* ,b.shop_name from KONKA_ORDER_INFO a 
		left join entp_shop b on b.shop_id = a.shop_id  
		where 1 = 1
		<include refid="sf-konkaOrderInfo" />
		order by a.ORDER_DATE desc,a.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- Ren,zhong 2013-06-09 -->
	<select id="selectKonkaOrderInfoResultForPaginatedList" resultMap="konkaOrderInfoResultForList" parameterClass="konkaOrderInfo">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
						select a.* from KONKA_ORDER_INFO a 
						where 1 = 1
						<include refid="sf-konkaOrderInfo" />
				 	    order by a.ORDER_DATE desc,a.ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaOrderInfo" parameterClass="konkaOrderInfo">
		<selectKey resultClass="long" keyProperty="id">select SEQ_KONKA_ORDER.nextval as id from dual</selectKey>
		<![CDATA[insert into KONKA_ORDER_INFO (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="trade_index">TRADE_INDEX</isNotNull>	
			<isNotNull prepend="," property="order_num">ORDER_NUM</isNotNull>	
			<isNotNull prepend="," property="money">MONEY</isNotNull>	
			<isNotNull prepend="," property="good_discount_price">GOOD_DISCOUNT_PRICE</isNotNull>	
			<isNotNull prepend="," property="order_state">ORDER_STATE</isNotNull>	
			<isNotNull prepend="," property="user_name">USER_NAME</isNotNull>	
			<isNotNull prepend="," property="user_tel">USER_TEL</isNotNull>	
			<isNotNull prepend="," property="user_phone">USER_PHONE</isNotNull>	
			<isNotNull prepend="," property="user_addr">USER_ADDR</isNotNull>	
			<isNotNull prepend="," property="user_zip">USER_ZIP</isNotNull>	
			<isNotNull prepend="," property="user_p_index">USER_P_INDEX</isNotNull>	
			<isNotNull prepend="," property="user_shop_name">USER_SHOP_NAME</isNotNull>	
			<isNotNull prepend="," property="user_remark">USER_REMARK</isNotNull>	
			<isNotNull prepend="," property="order_date">ORDER_DATE</isNotNull>	
			<isNotNull prepend="," property="pay_date">PAY_DATE</isNotNull>	
			<isNotNull prepend="," property="shipping_id">SHIPPING_ID</isNotNull>	
			<isNotNull prepend="," property="shipping_date">SHIPPING_DATE</isNotNull>	
			<isNotNull prepend="," property="receiving_id">RECEIVING_ID</isNotNull>	
			<isNotNull prepend="," property="receiving_date">RECEIVING_DATE</isNotNull>	
			<isNotNull prepend="," property="remark">REMARK</isNotNull>	
			<isNotNull prepend="," property="freight">FREIGHT</isNotNull>	
			<isNotNull prepend="," property="invoice_type">INVOICE_TYPE</isNotNull>	
			<isNotNull prepend="," property="invoices_payable">INVOICES_PAYABLE</isNotNull>	
			<isNotNull prepend="," property="return_reason">RETURN_REASON</isNotNull>	
			<isNotNull prepend="," property="invoice_status">INVOICE_STATUS</isNotNull>	
			<isNotNull prepend="," property="pay_type">PAY_TYPE</isNotNull>	
			<isNotNull prepend="," property="matflow_mode">MATFLOW_MODE</isNotNull>	
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="add_dept_id">ADD_DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="add_dept_name">ADD_DEPT_NAME</isNotNull>	
			<isNotNull prepend="," property="update_date">UPDATE_DATE</isNotNull>	
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID</isNotNull>
			<isNotNull prepend="," property="process_state">PROCESS_STATE</isNotNull>
			<isNotNull prepend="," property="process_id">PROCESS_ID</isNotNull>
			<isNotNull prepend="," property="audit_state">AUDIT_STATE</isNotNull>
			<isNotNull prepend="," property="send_type">SEND_TYPE</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>
			<isNotNull prepend="," property="is_submit">IS_SUBMIT</isNotNull>
			<isNotNull prepend="," property="is_end">IS_END</isNotNull>
			<isNotNull prepend="," property="cust_id">CUST_ID</isNotNull>
			<isNotNull prepend="," property="sales_org">SALES_ORG</isNotNull>	
			<isNotNull prepend="," property="division">DIVISION</isNotNull>	
			<isNotNull prepend="," property="ag">AG</isNotNull>	
			<isNotNull prepend="," property="re">RE</isNotNull>	
			<isNotNull prepend="," property="rg">RG</isNotNull>	
			<isNotNull prepend="," property="we">WE</isNotNull>	
			<isNotNull prepend="," property="sync_state">SYNC_STATE</isNotNull>	
			<isNotNull prepend="," property="r3_id">R3_ID</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="trade_index">#trade_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_num">#order_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="money">#money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="good_discount_price">#good_discount_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_state">#order_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">#user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_tel">#user_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_phone">#user_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_addr">#user_addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_zip">#user_zip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_p_index">#user_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_shop_name">#user_shop_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_remark">#user_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_date">#order_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="pay_date">#pay_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="shipping_id">#shipping_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shipping_date">#shipping_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="receiving_id">#receiving_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="receiving_date">#receiving_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="remark">#remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="freight">#freight:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="invoice_type">#invoice_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="invoices_payable">#invoices_payable:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="return_reason">#return_reason:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="invoice_status">#invoice_status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_type">#pay_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="matflow_mode">#matflow_mode:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">#add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_dept_id">#add_dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_dept_name">#add_dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">#update_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="update_user_id">#update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="process_state">#process_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="process_id">#process_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_state">#audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="send_type">#send_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_submit">#is_submit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_end">#is_end:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cust_id">#cust_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sales_org">#sales_org:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="division">#division:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ag">#ag:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="re">#re:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="rg">#rg:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="we">#we:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="sync_state">#sync_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_id">#r3_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaOrderInfo" parameterClass="konkaOrderInfo">
		update KONKA_ORDER_INFO
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="trade_index">TRADE_INDEX = #trade_index:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_num">ORDER_NUM = #order_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="money">MONEY = #money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="good_discount_price">GOOD_DISCOUNT_PRICE = #good_discount_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="order_state">ORDER_STATE = #order_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">USER_NAME = #user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_tel">USER_TEL = #user_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_phone">USER_PHONE = #user_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_addr">USER_ADDR = #user_addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_zip">USER_ZIP = #user_zip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_p_index">USER_P_INDEX = #user_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_shop_name">USER_SHOP_NAME = #user_shop_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_remark">USER_REMARK = #user_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_date">ORDER_DATE = #order_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="pay_date">PAY_DATE = #pay_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="shipping_id">SHIPPING_ID = #shipping_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shipping_date">SHIPPING_DATE = #shipping_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="receiving_id">RECEIVING_ID = #receiving_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="receiving_date">RECEIVING_DATE = #receiving_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="remark">REMARK = #remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="freight">FREIGHT = #freight:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="invoice_type">INVOICE_TYPE = #invoice_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="invoices_payable">INVOICES_PAYABLE = #invoices_payable:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="return_reason">RETURN_REASON = #return_reason:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="invoice_status">INVOICE_STATUS = #invoice_status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pay_type">PAY_TYPE = #pay_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="matflow_mode">MATFLOW_MODE = #matflow_mode:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_dept_id">ADD_DEPT_ID = #add_dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_dept_name">ADD_DEPT_NAME = #add_dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">UPDATE_DATE = #update_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="process_state">PROCESS_STATE = #process_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_state">AUDIT_STATE = #audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="process_id">PROCESS_ID = #process_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="send_type">SEND_TYPE = #send_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_submit">IS_SUBMIT = #is_submit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_end">IS_END = #is_end:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cust_id">CUST_ID = #cust_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sales_org">SALES_ORG = #sales_org:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="division">DIVISION = #division:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="ag">AG = #ag:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="re">RE = #re:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="rg">RG = #rg:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="we">WE = #we:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="sync_state">SYNC_STATE = #sync_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_id">R3_ID = #r3_id:DECIMAL#</isNotNull>
		</dynamic>
		where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaOrderInfo" parameterClass="konkaOrderInfo">
		delete from KONKA_ORDER_INFO where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>