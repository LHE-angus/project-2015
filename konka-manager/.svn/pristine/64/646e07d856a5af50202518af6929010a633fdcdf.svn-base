<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KonkaBranchCategory">

    <typeAlias alias="konkaBranchCategory" type="com.ebiz.mmt.domain.KonkaBranchCategory" />

	
	
    <resultMap id="konkaBranchCategoryResult" class="konkaBranchCategory">
		<result property="konka_r3_id" column="KONKA_R3_ID" jdbcType="DECIMAL" />
		<result property="mmt_shop_id" column="MMT_SHOP_ID" jdbcType="DECIMAL" />
		<result property="category_id" column="CATEGORY_ID" jdbcType="DECIMAL" />
		<result property="jxs_r3_id" column="JXS_R3_ID" jdbcType="DECIMAL" />
		<result property="add_date"    column="ADD_DATE"    jdbcType="DATE" />
    </resultMap>
    
    <resultMap id="konkaBranchCategoryResultForMsgAndArticle" class="konkaBranchCategory">
		<result property="map.mmt_shop_id" column="MMT_SHOP_ID" jdbcType="DECIMAL" />
		<result property="map.mmt_shop_name" column="MMT_SHOP_NAME" jdbcType="VARCHAR" />
    </resultMap>

	<resultMap id="konkaBranchCategoryResultWithCustomerNames" class="konkaBranchCategory" >
		<result property="konka_r3_id" column="KONKA_R3_ID" jdbcType="DECIMAL" />
		<result property="map.customer_name" column="CUSTOMER_NAME" jdbcType="DECIMAL" />
    </resultMap>
    
	<sql id="sf-konkaBranchCategory">
		<isNotEmpty prepend=" and " property="konka_r3_id">a.KONKA_R3_ID = #konka_r3_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mmt_shop_id">a.MMT_SHOP_ID = #mmt_shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="category_id">a.CATEGORY_ID = #category_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jxs_r3_id">a.JXS_R3_ID = #jxs_r3_id:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.MMT_shop_ids">a.mmt_shop_id in ($map.MMT_shop_ids$)</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.jxs_name_like">
		  a.mmt_shop_id in (select k.shop_id from entp_shop k where k.shop_name like '%' || #map.jxs_name_like:VARCHAR# || '%')             
        </isNotEmpty>
		
	</sql>
	
	<select id="selectKonkaBranchCategory" resultMap="konkaBranchCategoryResult" parameterClass="konkaBranchCategory" >
		select * from KONKA_BRANCH_CATEGORY a where 1=1
		<include refid="sf-konkaBranchCategory" />
	</select>
	
	<!-- @author: 惠钢 -->
	<!-- @desc: category_id=10:代理商  category_id=20:经销商 -->
	<select id="selectKonkaBranchCategoryListForMsgAndArticle" resultMap="konkaBranchCategoryResultForMsgAndArticle" parameterClass="konkaBranchCategory" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select bb.mmt_shop_id, bb.mmt_shop_name from (select * from KONKA_BRANCH_CATEGORY a where 1=1<include refid="sf-konkaBranchCategory" />) aa left join 
		<isEqual prepend="" property="category_id" compareValue="10">
		KONKA_R3_MMT_MATCH bb on aa.konka_r3_id = bb.r3_shop_id
		<isNotEmpty prepend=" " property="map.areas_ids">
		left join (select a.shop_id, b.par_index from entp_shop a left join konka_base_province_list b on a.p_index = b.p_index) cc on bb.mmt_shop_id = cc.shop_id where cc.par_index in ($map.areas_ids$)
		</isNotEmpty>
		<isEmpty prepend=" " property="map.areas_ids">where 1 = 1</isEmpty>
		<isNotEmpty prepend=" and " property="map.selects">bb.mmt_shop_id in ($map.selects$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.not_selects">bb.mmt_shop_id  not in ($map.not_selects$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_shop_name">bb.mmt_shop_name like '%' || #map.mmt_shop_name:VARCHAR# || '%'</isNotEmpty>
		<![CDATA[ and bb.mmt_shop_id > 0]]>
		</isEqual>
		<isEqual prepend="" property="category_id" compareValue="20">
		(select a.shop_id as mmt_shop_id, a.shop_name as mmt_shop_name , b.par_index from entp_shop a left join konka_base_province_list b on a.p_index = b.p_index) bb on aa.mmt_shop_id = bb.mmt_shop_id
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.areas_ids">bb.par_index in ($map.areas_ids$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.selects">aa.mmt_shop_id in ($map.selects$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.not_selects">aa.mmt_shop_id  not in ($map.not_selects$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_shop_name">bb.mmt_shop_name like '%' || #map.mmt_shop_name:VARCHAR# || '%'</isNotEmpty>
		<![CDATA[ and bb.mmt_shop_id > 0 ]]>
		</isEqual>
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>

	</select>	
	
	<select id="selectKonkaBranchCategoryList" resultMap="konkaBranchCategoryResult" parameterClass="konkaBranchCategory" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select * from KONKA_BRANCH_CATEGORY a where 1=1
		<include refid="sf-konkaBranchCategory" />
		<!-- order by a.ID desc -->
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>
	</select>
	
	<select id="selectKonkaBranchCategoryCount" resultClass="long" parameterClass="konkaBranchCategory" >
		select count(*) from KONKA_BRANCH_CATEGORY a where 1 = 1
		<include refid="sf-konkaBranchCategory" />
	</select>
	
	<!--author 张续峰 2011-10-21 根据登录的网点 查找下一级网点	-->
	<select id="selectKonkaBranchCategoryWithCustomerNamesList" resultMap="konkaBranchCategoryResultWithCustomerNames" parameterClass="konkaBranchCategory" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select a.konka_r3_id, c.customer_name
		  from konka_branch_category a
		  left join KONKA_R3_MMT_MATCH b on a.konka_r3_id = b.r3_shop_id
		  left join konka_r3_shop c on c.id = a.konka_r3_id
		  where a.category_id = 10
		  and b.mmt_shop_id = #map.shop_id#
		<include refid="sf-konkaBranchCategory" />
		<!-- order by a.ID desc -->
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>
	</select>
	
	<select id="selectKonkaBranchCategoryPaginatedList" resultMap="konkaBranchCategoryResult" parameterClass="konkaBranchCategory" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_BRANCH_CATEGORY a where 1=1
		<include refid="sf-konkaBranchCategory" />
		<!-- order by a.ID desc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaBranchCategory" parameterClass="konkaBranchCategory">
		<![CDATA[insert into KONKA_BRANCH_CATEGORY (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="konka_r3_id">KONKA_R3_ID</isNotNull>
			<isNotNull prepend="," property="mmt_shop_id">MMT_SHOP_ID</isNotNull>
			<isNotNull prepend="," property="category_id">CATEGORY_ID</isNotNull>
			<isNotNull prepend="," property="jxs_r3_id">JXS_R3_ID</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="konka_r3_id">#konka_r3_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_shop_id">#mmt_shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="category_id">#category_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jxs_r3_id">#jxs_r3_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>
	
	<update id="updateKonkaBranchCategory" parameterClass="konkaBranchCategory">
		update KONKA_BRANCH_CATEGORY
		<dynamic prepend="set">
			<isNotNull prepend="," property="konka_r3_id">KONKA_R3_ID = #konka_r3_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_shop_id">MMT_SHOP_ID = #mmt_shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="category_id">CATEGORY_ID = #category_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jxs_r3_id">JXS_R3_ID = #jxs_r3_id:DECIMAL#</isNotNull>
		</dynamic>
		where 1 = 1
		<isNotNull prepend=" and " property="konka_r3_id">KONKA_R3_ID = #konka_r3_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" and " property="mmt_shop_id">MMT_SHOP_ID = #mmt_shop_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" and " property="category_id">CATEGORY_ID = #category_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" and " property="jxs_r3_id">JXS_R3_ID = #jxs_r3_id:DECIMAL#</isNotNull>
	</update>

	<delete id="deleteKonkaBranchCategory" parameterClass="konkaBranchCategory">
		delete from KONKA_BRANCH_CATEGORY where 1 = 1
		<isNotNull prepend=" and " property="konka_r3_id">KONKA_R3_ID = #konka_r3_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" and " property="mmt_shop_id">MMT_SHOP_ID = #mmt_shop_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" and " property="category_id">CATEGORY_ID = #category_id:DECIMAL#</isNotNull>
		<isNotNull prepend=" or " property="jxs_r3_id">JXS_R3_ID = #jxs_r3_id:DECIMAL#</isNotNull>
	</delete>
</sqlMap>
