<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head xmlns="">
<title>数据上报</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0;user-scalable=0;" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
<style type="text/css">
	table.rtab3 td{font-size: 14px; height:14px;line-height:14px;}
	.qs1 { height:14px;line-height:14px;font-size: 14px;}
</style>
</head>
<body>
<!--head start -->
<div class="top4 head_class">
  <div class="jiantou"><a ><img src="images/jiantou_09.jpg" onclick="javascript:history.back();" /></a></div>
  <div class="topzi" style="float:left; display:inline; width:100px; padding-left:15%"><img src="images/shujushagnb.png" /></div>
</div>
<form action="#" name="temp_form" id="temp_form" style="margin:0px;padding:0px;">
<input type="hidden" id="count_num" value="1" />
<table width="100%" border="0" class="rtab3">
  <tr>
    <th colspan="2" align="right"><span id="sj_his" style="cursor:pointer;">历史记录　</span></th>
  </tr>
</table>
<table width="100%" border="0">
	<tr>
		<td style="padding:0px;">
			<table width="100%" border="0" class="rtab3 table_class" style="margin:0px;margin-top:5px;margin-bottom:5px;" cellpadding="0" cellspacing="0">
				<tr>
					<td align="center" nowrap="nowrap" width="20%">门店<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">型号<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">数量（台）<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">单价（元）<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">金额（元）<span class="red16px">*</span></td>
				</tr>
				<tr>
					<td align="center">
						<select id="store_id" class="text01" style="width:90px;" onmouseover="this.style.width='90px';" onchange="this.style.width='90px';" onblur="this.style.width='90px';">
			              <option value="">-请选择-</option>
			         	</select>
			        </td>
					<td align="center">
						<input type="hidden" id="select-choice-2" value="" />
			    		<input class="selblue422 change_class" type="text" id="select-choice-1" maxlength="50" />
			    	</td>
					<td align="center"><input class="selblue41" type="text" id="sales_count" value="1" onfocus="javascript:setOnlyInt(this);" maxlength="4" /></td>
					<td align="center"><input class="selblue41" type="text" id="single_price" value="" onfocus="javascript:setOnlyNum(this);" maxlength="8" /></td>
					<td align="center"><input class="selblue411" type="text" id="sales_price" value="" onfocus="javascript:setOnlyNum(this);" maxlength="9" /></td>
				</tr>
				<tr>
					<td colspan="5" align="center" style="cursor:pointer;" class="show_customer">点击填写顾客信息</td>
				</tr>
				<tr style="display:none;">
					<td align="center" nowrap="nowrap">顾客姓名</td>
					<td align="center" nowrap="nowrap">顾客电话</td>
					<td align="center" nowrap="nowrap">顾客地址</td>
					<td align="center" nowrap="nowrap">顾客身份证</td>
					<td align="center" nowrap="nowrap">备注</td>
				</tr>
				<tr style="display:none;">
					<td align="center"><input class="selblue42" type="text" id="realname" maxlength="20" /></td>
					<td align="center"><input class="selblue422" type="text" id="phonenum" maxlength="50" /></td>
					<td align="center"><input class="selblue4" type="text" id="addresss" maxlength="100" /></td>
					<td align="center"><input class="selblue4" type="text" id="mastercode" maxlength="18" /></td>
					<td align="center">
						<textarea name="memo" id="memo" cols="1" rows="1" class="qs1"></textarea>
    					<div id="info_tip" style="color:#0066FF;font-size:12px;display:none"></div>
    				</td>
				</tr>
			</table>
		</td>
		<td style="width:35px;" align="center">
			<img id="_add" src="images/+.gif" style="vertical-align:middle;cursor:pointer;" />
		</td>
	</tr>
	<tr id="_tr" style="display:none;">
		<td style="padding:0px;">
			<table width="100%" border="0" class="" style="margin:0px;margin-bottom:5px;" cellpadding="0" cellspacing="0">
				<tr>
					<td align="center" nowrap="nowrap" width="20%">门店<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">型号<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">数量（台）<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">单价（元）<span class="red16px">*</span></td>
					<td align="center" nowrap="nowrap" width="20%">金额（元）<span class="red16px">*</span></td>
				</tr>
				<tr>
					<td align="center"></td>
					<td align="center">
						<input type="hidden" value="" />
			    		<input class="selblue422 change_class" type="text" maxlength="50" />
			    	</td>
					<td align="center"><input class="selblue41" type="text" value="1" onfocus="javascript:setOnlyInt(this);" maxlength="4" /></td>
					<td align="center"><input class="selblue41" type="text" value="" onfocus="javascript:setOnlyNum(this);" maxlength="8" /></td>
					<td align="center"><input class="selblue411" type="text" value="" onfocus="javascript:setOnlyNum(this);" maxlength="9" /></td>
				</tr>
				<tr>
					<td colspan="5" align="center" style="cursor:pointer;" class="show_customer">点击填写顾客信息</td>
				</tr>
				<tr style="display:none;">
					<td align="center" nowrap="nowrap">顾客姓名</td>
					<td align="center" nowrap="nowrap">顾客电话</td>
					<td align="center" nowrap="nowrap">顾客地址</td>
					<td align="center" nowrap="nowrap">顾客身份证</td>
					<td align="center" nowrap="nowrap">备注</td>
				</tr>
				<tr style="display:none;">
					<td align="center"><input class="selblue42" type="text" maxlength="20" /></td>
					<td align="center"><input class="selblue42" type="text" maxlength="50" /></td>
					<td align="center"><input class="selblue4" type="text" maxlength="100" /></td>
					<td align="center"><input class="selblue4" type="text" maxlength="18" /></td>
					<td align="center">
						<textarea name="memo" id="memo" cols="1" rows="1" class="qs1"></textarea>
    					<div id="info_tip" style="color:#0066FF;font-size:12px;display:none"></div>
    				</td>
				</tr>
			</table>
		</td>
		<td style="width:35px;" align="center">
			<img class="remove_class" src="images/_x.gif" style="vertical-align:middle;cursor:pointer;" />
		</td>
	</tr>
	<tbody id="_tbody" style="border:0px;"></tbody>
</table>
<div class="xt_fenye1"><a id="btn_sub"><img src="images/shagnbao.jpg" alt="" width="93" height="38" /></a>　　 
<a  onclick="document.temp_form.reset();"><img src="images/xt_chongzhi.jpg" alt="" width="93" height="38" /></a></div>
</form>
<!--head end --> 
<!--first start -->

</div>

<!-- footer start--> 
<!-- footer end-->
<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="js/lhgdialog.min.js?skin=idialog"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/validator.js"></script>
<script type="text/javascript" src="js/jquery.textbox.js"></script>
<script type="text/javascript">//<![CDATA[
//防止缓存每次都加载JS    
document.write("<s" + "cript type='text/javascript' src='js/base-data.js?" + Math.random() + "'></scr" + "ipt>");

$(document).ready(function(){
   // 定义AJAX获取的型号信息
	var pd_module_data;
	
	// 浏览器参数获取用户名和密码
	var username  = getQueryString("username");
	var userpass = getQueryString("userpass");
	var from_pc = getQueryString("from_pc");
	
	// 如果是pc端需要隐藏头部
	if(1 == from_pc){
		$(".head_class").hide();
	}

	// 如果访问地址携带用户名和密码则初始化相关信息
	if(username != null && userpass != null && username != "null" && userpass != "null" && username != "" && userpass != ""){
		// 初始化门店信息 
		store_init(username, userpass);

		// 初始化品牌
		pd_module_init(username, userpass);
	} else { // 否则强制要求输入用户和密码
		show_login();
	}
	
	// 显示顾客信息
	$(".show_customer").click(function(){
		$(this).parent().next().show();
		$(this).parent().next().next().show();
		$(this).parent().remove();
	});
	
	// 点击增加
	$("#_add").click(function(){
		// 改变提交按钮的ID
		$("#btn_sub").attr("id", "btn_sub_change");
		
		// 计算现有总共销售条数
		var count_num = parseInt($("#count_num").val()) + 1;
		$("#count_num").val(count_num);
		
		// 复制一行信息处理
		var _tr = $("#_tr").clone();
		var select = $("#store_id").clone(); // 复制门店信息
		 _tr.find("table").eq(0).attr("class", "rtab3 table_class"); // 样式处理
		select.appendTo(_tr.find("table").eq(0).find("tr").eq(1).find("td").eq(0)) // 拷贝进新增销售信息
		_tr.appendTo($("#_tbody")).show();
		
		// 处理全部顾客信息
		var i = 1; // 状态
		$(".table_class").each(function(){
			// 先清除背景颜色
			$(this).css("background-color", ""); 
			if(i != 1) { // 第一个不处理，最后一个隐藏的也不处理
				// 处理表格背景颜色
				if(i % 2 == 0){
					$(this).css("background-color", "#FFEFD5"); 
				}
			
				// 显示填写顾客信息				
				$(".show_customer").click(function(){
					$(this).parent().next().show();
					$(this).parent().next().next().show();
					$(this).parent().remove();
				});
				
				// 处理每个项的ID
				$(this).find("select").eq(0).attr("id", "store_id" + i);       // 门店
				$(this).find("input").eq(0).attr("id", "select-choice-2" + i); // 型号，隐藏ID
				$(this).find("input").eq(1).attr("id", "select-choice-1" + i); // 型号，名称
				$(this).find("input").eq(2).attr("id", "sales_count" + i);     // 数量
				$(this).find("input").eq(3).attr("id", "single_price" + i);    // 单价
				$(this).find("input").eq(4).attr("id", "sales_price" + i);     // 总价
				$(this).find("input").eq(5).attr("id", "realname" + i);        // 客户姓名
				$(this).find("input").eq(6).attr("id", "phonenum" + i);        // 客户电话
				$(this).find("input").eq(7).attr("id", "addresss" + i);        // 客户地址
				$(this).find("input").eq(8).attr("id", "mastercode" + i);        // 顾客身份证号
				$(this).find("textarea").eq(0).attr("id", "memo" + i);            // 备注
				
				$("#store_id" + i       ).attr("dataType", "Require").attr("msg", "请选择门店！");
				$("#select-choice-2" + i).attr("dataType", "Require").attr("msg", "请填写型号！");
				$("#sales_count" + i    ).attr("dataType", "Require").attr("msg", "请填写数量！");
				$("#single_price" + i   ).attr("dataType", "Require").attr("msg", "请填写单价！");
				$("#sales_price" + i    ).attr("dataType", "Require").attr("msg", "请填写金额！");
				
				// 注册绑定事件
				$(".change_class").bind("input propertychange", function() {
					var index = $(this).attr("id").substring(15);
					initAutoDiv(index);
				});
			}
			i++; // 状态加1
		});
		
		// 删除处理
		$(".remove_class").click(function(){
			// 计算现有总共销售条数
			$("#count_num").val(parseInt($("#count_num").val()) - 1);
			
			// 处理全部顾客信息
			dealWithCustomer();
			
			$(this).parent().parent().remove();
		});
	});
	
	// 遍历循环处理相关信息
	function dealWithCustomer(){
		var i = 1; // 状态
		$(".table_class").each(function(){
			// 先清除背景颜色
			$(this).css("background-color", ""); 
			if(i != 1) { // 第一个不处理，最后一个隐藏的也不处理
				// 处理表格背景颜色
				if(i % 2 == 0){
					$(this).css("background-color", "#FFEFD5"); 
				}
			
				// 显示填写顾客信息				
				$(".show_customer").click(function(){
					$(this).parent().next().show();
					$(this).parent().next().next().show();
					$(this).parent().remove();
				});
				
				// 处理每个项的ID
				$(this).find("select").eq(0).attr("id", "store_id" + i);       // 门店
				$(this).find("input").eq(0).attr("id", "select-choice-2" + i); // 型号，隐藏ID
				$(this).find("input").eq(1).attr("id", "select-choice-1" + i); // 型号，名称
				$(this).find("input").eq(2).attr("id", "sales_count" + i);     // 数量
				$(this).find("input").eq(3).attr("id", "single_price" + i);    // 单价
				$(this).find("input").eq(4).attr("id", "sales_price" + i);     // 总价
				$(this).find("input").eq(5).attr("id", "realname" + i);        // 客户姓名
				$(this).find("input").eq(6).attr("id", "phonenum" + i);        // 客户电话
				$(this).find("input").eq(7).attr("id", "addresss" + i);        // 客户地址
				$(this).find("input").eq(8).attr("id", "mastercode" + i);        // 顾客身份证号
				$(this).find("textarea").eq(0).attr("id", "memo" + i);            // 备注
				
				$("#store_id" + i       ).attr("dataType", "Require").attr("msg", "请选择门店！");
				$("#select-choice-2" + i).attr("dataType", "Require").attr("msg", "请填写型号！");
				$("#sales_count" + i    ).attr("dataType", "Require").attr("msg", "请填写数量！");
				$("#single_price" + i   ).attr("dataType", "Require").attr("msg", "请填写单价！");
				$("#sales_price" + i    ).attr("dataType", "Require").attr("msg", "请填写金额！");
				
				// 注册绑定事件
				$(".change_class").bind("input propertychange", function() {
					var index = $(this).attr("id").substring(15);
					initAutoDiv(index);
				});
				
				$("#memo").textbox({
					maxLength: 100,
					onInput: function(event, status) {
						var img = '<img src="images/tishi.gif" style="vertical-align:middle;" />';
						$("#info_tip").slideDown("fast").html(img + " 请将字数限制在：" + status.maxLength + " 个字内，您还可以输入：<font style='color:red;'>" + status.leftLength + "</font> 个字。");
					}
				}).blur(function() {
					$("#info_tip").slideUp("normal");
				});
			}
			i++; // 状态加1
		});
	}
	
	$("#store_id"       ).attr("dataType", "Require").attr("msg", "请选择门店！");
	$("#select-choice-2").attr("dataType", "Require").attr("msg", "请填写型号！");
	$("#sales_count"    ).attr("dataType", "Require").attr("msg", "请填写数量！");
	$("#single_price"   ).attr("dataType", "Require").attr("msg", "请填写单价！");
	$("#sales_price"    ).attr("dataType", "Require").attr("msg", "请填写金额！");
	
	$("#btn_sub").click(function(){
		// 判断是否有用户名和密码
		if(username == null || userpass == null || username == "null" || userpass == "null" || username == "" || userpass == ""){
			show_login();
			return false;
		}
		
		if(Validator.Validate($("#temp_form")[0], 2)){
			var count_num = parseInt($("#count_num").val());
			alert(count_num);
			
		    var id  = $("#id").val();
		    var store_id  = $("#store_id").val();
		    var select_choice_2 = $("#select-choice-2").val();
		    var sales_count = $("#sales_count").val();
		    var sales_price = $("#sales_price").val();
		    var single_price = $("#single_price").val();
		    var memo = $("#memo").val();
		    var realname = $("#realname").val();
		    var phonenum = $("#phonenum").val();
		    var addresss = $("#addresss").val();
		    var mastercode = $("#mastercode").val();
		
		  
		 	 return;
		  
		  	// 正在加载数据层
		  	var load_data = $.dialog({content: '正在提交数据...', lock: true, max: false, min: false, icon: 'loading.gif', title: '提示！'});
		  
			$.ajax({
				type: "POST",
				url: host_url + "/MobileSubmit.do?method=DoSubmit011&from_html=1",
				data: {
					"username":encodeURI(username), "userpass":encodeURI(userpass), "id":id, "store_id":store_id, "select-choice-2":select_choice_2, "sales_count":sales_count,
					"single_price":single_price, "sales_price":sales_price, "memo":encodeURI(memo), "realname":encodeURI(realname), "phonenum":phonenum, "addresss":encodeURI(addresss), "mastercode":mastercode,
					"timestamp":new Date().getTime()
				},
				dataType: "jsonp",
				jsonp: "jsonpcallback",
				//sync: false, // jsonp不支持同步
				error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！"); },
				success: function(result) {
				  // 关闭-正在加载数据层
			  	  load_data.close();

				  if (result.msg == 'success'){
				        $.dialog({
				        	max: false, min: false, fixed: true, lock: true,
						    content: '恭喜，数据上报成功！',
						    init: function () {
						        var that = this, i = 5;
						        var fn = function () {
						            that.title(i + '秒后关闭');
						            !i && that.close();
						            i--;
						        };
						        timer = setInterval(fn, 1000);
						        fn();
						    },
						    close: function () {
						        clearInterval(timer);
						    }
						});
				        
				        // 重置数据
			        	document.temp_form.reset();
			        	$("#select-choice-2").val("");
			       } else {
						$.dialog({
						    max: false, min: false, fixed: true, lock: true,
						    content: result.msg,
						    init: function () {
						        var that = this, i = 5;
						        var fn = function () {
						            that.title(i + '秒后关闭');
						            !i && that.close();
						            i--;
						        };
						        timer = setInterval(fn, 1000);
						        fn();
						    },
						    close: function () {
						        clearInterval(timer);
						    }
						});
				   }
				}
			});
		}
	});

	// 搜索--判断和区分IE和非IE浏览器分别进行注册监听
	$("#select-choice-1").bind("input propertychange", function() {
		initAutoDiv(0);
	});
	
	// 数量，单价改变计算总金额
	$("#sales_count, #single_price").change(function(){
		cal_all_price();
	});
	
	// 总价改变计算单价
	$("#sales_price").change(function(){
		cal_single_price();
	});

	// 数量或者单价改变计算总价
    function cal_all_price(){
		var sales_count = $("#sales_count").val();
		var single_price = $("#single_price").val();
		if(sales_count > 0 && single_price>0){
			if((sales_count * single_price).toFixed(2) > 999999999){
				 $.dialog.alert("计算金额超出范围！",function(){});
				return;
			}
			
			$("#sales_price").val((sales_count * single_price).toFixed(2));
		}
		  
    }

	// 总价改变计算单价
    function cal_single_price(){
		var sales_count = $("#sales_count").val();
		var sales_price = $("#sales_price").val();
		if(sales_count > 0 && sales_price > 0)
		  $("#single_price").val((sales_price / sales_count).toFixed(2));
    }

	// 输入关键字搜索
	function initAutoDiv(index){
		// 隐藏下拉框
		if($("#auto_prompt_div")){
	        $("#auto_prompt_div").remove();
		}
		
	 	var id1 = "select-choice-1";
        var id2 = "select-choice-2";
        if(index != 0) { 
        	id1 = "select-choice-1" + index;
            id2 = "select-choice-2" + index;
        }
        
        // 输入框有改变将型号置为空
        $("#" + id2).val("");
        
		if($.trim($("#" + id1).val()).length >= 2){
			var val = $.trim($("#" + id1).val());
			var count = 0;
			for(var i = 0; i < pd_module_data.length; i++){
				var id = pd_module_data[i].id;
				var name = pd_module_data[i].name;
				if(name.toLowerCase().indexOf(val.toLowerCase()) != -1)
					count++;
			}

			var top = $("#" + id1).offset().top;
	        var left = $("#" + id1).offset().left - 5;
	        var width = $("#" + id1).width() - 3;
	        if(width <= 90) width = 90; // 强制宽度最小90
	        var auto_prompt_div = $("<div />").width(width).css("position", "absolute").css("backgroundColor", "white").css("left", left).css("top", top + $("#" + id1).height() + 6).css("border", "1px solid #1C86EE").attr("id", "auto_prompt_div");
	        var table = $("<table width='100%' id=\"div_table\" />").attr("cellpadding", "0").attr("cellspacing", "0");
	        
			// 满足条件控制在30个内，如果超过30个则不显示
			if(count != 0){
				for(var i = 0; i < pd_module_data.length; i++){
					var id = pd_module_data[i].id;
					var name = pd_module_data[i].name;
					if(name.toLowerCase().indexOf(val.toLowerCase()) != -1){
	                    var tr = $("<tr />").css("cursor", "pointer").attr("class", "tr_value").mouseout(function(){
	                        $(this).css("backgroundColor", "white").css("color", "black");
	                    }).mouseover(function(){
	                        $(this).css("backgroundColor", "#1C86EE").css("color", "white");
	                    }).click(function(){
	                        $("#" + id1).val($(this).find("td").eq(0).html());
	                        $("#" + id2).val($(this).find("td").eq(0).attr("id"));
	                	    $("#auto_prompt_div").remove();
	                    });
	                    var td = $("<td class=\"td_class\" />").html(name).css("fontSize", "12px").css("margin", "5px 5px 5px 5px").css("padding-left", "6px").attr("align", "left").attr("id", id);
	                    tr.append(td);
	                    table.append(tr);
				    }
				}
			} else {
                var tr = $("<tr />").css("cursor", "pointer").attr("class", "tr_value").mouseout(function(){
                    $(this).css("backgroundColor", "white").css("color", "black");
                }).mouseover(function(){
                    $(this).css("backgroundColor", "#1C86EE").css("color", "white");
                });
                var td = $("<td />").html("提示，您搜索的型号“" + val + "”，共检索到 " + count + " 条数据，请精确搜索条件！").css("fontSize", "12px").css("margin", "5px 5px 5px 5px").css("padding-left", "6px").attr("align", "left");
                tr.append(td);
                table.append(tr);
			}

			auto_prompt_div.append(table);
	        $(document.body).append(auto_prompt_div);
		}
	}

	// 历史记录
	$("#sj_his").click(function(){
		location.href = "shuj_his.html?username=" + escape(username) + "&userpass=" + escape(userpass) + "&from_pc=" + from_pc + "&timestamp=" + new Date().getTime();		
	});
	
	// 登陆层
	function show_login(){	
		// cookie, 2013-06-27
		if(cookie_enable){ // 在base-data.js中定义状态
		  var cookie_name = $.cookie("cookie_name");	
		  var cookie_pass = $.cookie("cookie_pass");	
		  if(cookie_name != null && cookie_pass != null){
			username = cookie_name;
			userpass = cookie_pass;
			// 初始化门店信息 
			store_init(username, userpass);

			// 初始化型号
			pd_module_init(username, userpass);
			return false;
		  }
		}
		
	  $.dialog({
			id: 'login-window',
			title: '登录',
			content: '帐&nbsp;&nbsp;号：<input id="login-na" type="text" maxlength="20" value="" />' + '<br /><br />密&nbsp;&nbsp;码：<input id="login-pw" type="password" maxlength="20" value="" />',
			initialize: function () {
				document.getElementById('login-na').focus();
			},
			lock: true, fixed: true, max:false, min:false,
			ok: function () {
				var na = document.getElementById('login-na');
				var pw = document.getElementById('login-pw');
				if(na.value == ""){
					alert("提示，请填写账号！");
					na.select();
					return false;
				}
				if(pw.value == ""){
					alert("提示，请填写密码！");
					pw.select();
					return false;
				}
				// 用户和密码赋值
				username = na.value;
				userpass = pw.value;

				// 初始化门店信息 
				store_init(username, userpass);

				// 初始化型号
				pd_module_init(username, userpass);
				
				// cookie,2013-06-27
				if(cookie_enable){ // 在base-data.js中定义状态
					$.cookie("cookie_name", username);	
					$.cookie("cookie_pass", userpass);	
				}	
			},
			okValue: '登录',
			cancel: function () {}
		});
	}

	// 根据用户名和密码初始化型号信息
	function pd_module_init(username, userpass){
		// 正在加载数据层
		var load_data = $.dialog({content: '数据加载中...', lock: true, max: false, min: false, icon: 'loading.gif', title: '提示！'});
		
		$.ajax({
			type: "POST",
			url: host_url + "/MobileList.do?method=GetList04&from_html=1",
			data: { "username":encodeURI(username), "userpass":encodeURI(userpass), "timestamp":new Date().getTime() },
			dataType: "jsonp",
			jsonp: "jsonpcallback",
			error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！"); },
			success: function(result) {
			  // 关闭-正在加载数据层
		  	  load_data.close();	
				
			  if (result.status == "-1"){
			        $.dialog.alert(result.msg,function(){});
		      } else {
		    	pd_module_data = result;
			  }
			}
		});
	}
	
	$("#memo").textbox({
		maxLength: 100,
		onInput: function(event, status) {
			var img = '<img src="images/tishi.gif" style="vertical-align:middle;" />';
			$("#info_tip").slideDown("fast").html(img + " 请将字数限制在：" + status.maxLength + " 个字内，您还可以输入：<font style='color:red;'>" + status.leftLength + "</font> 个字。");
		}
	}).blur(function() {
		$("#info_tip").slideUp("normal");
	});
});
//]]></script>
</body>
</html>