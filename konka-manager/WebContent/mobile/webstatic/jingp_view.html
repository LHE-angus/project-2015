<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head xmlns="">
<title>竞品详细</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0;user-scalable=0;" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
</head>
<body>
<!--head start -->
<div class="top4 head_class">
  <div class="jiantou"><a ><img src="images/jiantou_09.jpg" onclick="javascript:history.back();" /></a></div>
  <div class="topzi" style="float:left; display:inline; width:100px; padding-left:15%"><img src="images/jingpignshagnb.png" /></div>
</div>
<div class="headtab31 head_class"></div>
<table width="100%" border="0"  class="rtab3">
  <tr>
    <th colspan="2" align="right"><span id="jp_his" style="cursor:pointer;">历史记录　</span></th>
  </tr>
  <tr>
    <td width="25%" align="center">分公司</td>
    <td width="75%" align="left"><span id="subcomp_name" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
  <tr>
    <td align="center">门店</td>
    <td align="left"><span id="dept_name" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">竞品品牌 </td>
    <td align="left"><span id="brand_name" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
   <tr>
    <td align="center" nowrap="nowrap">规格段</td>
    <td align="left"><span id="type_name" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
    </tr>
  <tr>
    <td align="center">竞品型号</td>
    <td align="left"><span id="model_id" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
  <tr>
    <td align="center">数量</td>
    <td align="left"><span id="num" style="color:blue;font-weight:normal;font-size:16px;margin-right:50px;"></span> 台<br /></td>
  </tr>
  <tr>
    <td align="center">单价</td>
    <td align="left"><span id="single_price" style="color:blue;font-weight:normal;font-size:16px;margin-right:50px;"></span> 元<br /></td>
  </tr>
  <tr>
    <td align="center">金额</td>
    <td align="left"><span id="price" style="color:blue;font-weight:normal;font-size:16px;margin-right:50px;"></span> 元<br /></td>
  </tr>
  <tr>
    <td align="center">备注</td>
    <td align="left" id="memo"></td>
  </tr>
  <tr>
    <td align="center">上报人</td>
    <td align="left"><span id="report_name" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
  <tr>
    <td align="center">上报时间</td>
    <td align="left"><span id="report_time" style="color:blue;font-weight:normal;font-size:16px;"></span><br /></td>
  </tr>
   <tr>
    <td align="center">附件</td>
    <td align="left" id="fujing" ></td>
  </tr>
</table>
<!--head end --> 
<!--first start -->
</div>
<!-- footer start--> 
<!-- footer end-->
<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="js/lhgdialog.min.js?skin=idialog"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript">//<![CDATA[
//防止缓存每次都加载JS    
document.write("<s" + "cript type='text/javascript' src='js/base-data.js?" + Math.random() + "'></scr" + "ipt>");

$(document).ready(function(){
	// 获取参数
	var username  = getQueryString("username");
	var userpass = getQueryString("userpass");
	var id = getQueryString("id");
	var from_pc = getQueryString("from_pc");

	// 如果是pc端需要隐藏头部
	if("1" == from_pc){
		$(".head_class").hide();
	}
	
	if(id == null || id  == "null" || id == ""){
		// 正在加载数据层
		$.dialog({ fixed: true, title: '提示！', content: '对不起，ID丢失不能加载数据！' });
		return;
	}
	
	// 如果访问地址携带用户名和密码则初始化相关信息
	if(username != null && userpass != null && username != "null" && userpass != "null" && username != "" && userpass != ""){
		// 读取数据
		data_init(username, userpass, id , "6");

	} else {
		show_login();
	}

	// 历史记录
	$("#jp_his").click(function(){
		location.href = "jingp_his.html?username=" + escape(username) + "&userpass=" + escape(userpass) + "&from_pc=" + from_pc + "&timestamp=" + new Date().getTime();		
	});
	
	// 登陆层
	function show_login(){	
	  // cookie, 2013-06-27
	  if(cookie_enable){ // 在base-data.js中定义状态
		  var cookie_name = $.cookie("cookie_name");	
		  var cookie_pass = $.cookie("cookie_pass");	
		  if(cookie_name != null && cookie_pass != null){
			username = cookie_name;
			userpass = cookie_pass;
			// 初始化信息
			data_init(username, userpass, id , "6");
			return false;
		  }
	  }
		  
	  $.dialog({
			id: 'login-window',
			title: '登录',
			content: '帐&nbsp;&nbsp;号：<input id="login-na" type="text" maxlength="20" value="" />' + '<br /><br />密&nbsp;&nbsp;码：<input id="login-pw" type="password" maxlength="20" value="" />',
			initialize: function () {
				document.getElementById('login-na').focus();
			},
			fixed: true, max:false, min:false,
			ok: function () {
				var na = document.getElementById('login-na');
				var pw = document.getElementById('login-pw');
				if(na.value == ""){
					alert("提示，请填写账号！");
					na.select();
					return false;
				}
				if(pw.value == ""){
					alert("提示，请填写密码！");
					pw.select();
					return false;
				}
				// 用户名密码赋值
				username = na.value;
				userpass = pw.value;

				// 初始化信息
				data_init(username, userpass, id , "6");
				
				// cookie,2013-06-27
				if(cookie_enable){ // 在base-data.js中定义状态
					$.cookie("cookie_name", username);	
					$.cookie("cookie_pass", userpass);	
				}
			},
			okValue: '登录',
			cancel: function () {}
		});
	}


	// 根据用户名和密码初始化竞品信息
	function data_init(username, userpass, id , type){
		// 正在加载数据层
		var load_data = $.dialog({content: '数据加载中...', max: false, min: false, icon: 'loading.gif', title: '提示！'});
		
		$.ajax({
			type: "POST",
			url: host_url + "/MobileList.do?method=GetModel&from_html=1",
			data: {"username":encodeURI(username), "userpass":encodeURI(userpass), "type":type, "id":id, "timestamp":new Date().getTime() },
			dataType: "jsonp",
			jsonp: "jsonpcallback",
			error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！"); },
			success: function(result) {
			  // 关闭-正在加载数据层
		  	  load_data.close();
				
			  if (result.status == "-1"){
			        $.dialog({
					    max: false, min: false, fixed: true,
					    content: result.msg,
					    init: function () {
					        var that = this, i = 8;
					        var fn = function () {
					            that.title(i + '秒后关闭');
					            !i && that.close();
					            i--;
					        };
					        timer = setInterval(fn, 1000);
					        fn();
					    },
					    close: function () {
					        clearInterval(timer);
					    }
					});
		      } else {
			      $("#subcomp_name").html(result.subcomp_name);
			      $("#dept_name").html(result.dept_name);
			      if(result.model_id=="1001"){
			    	  result.model_id="全部"
			      }
			      $("#model_id").html(result.model_id);
			      
			      $("#brand_name").html(result.map.brand_name);
			      $("#num").html(result.num);
			      $("#single_price").html(result.single_price);
			      $("#price").html(result.price);
			      $("#report_name").html(result.report_name);
			      $("#report_time").html(result.report_time);
			      $("#memo").html(result.memo);
			      $("#type_name").html(result.map.type_name);
			      
			      for ( var ii = 0; ii < result.map.athList.length; ii++) {
			    	  $("#fujing").append("<a href="+host_url+"/"+result.map.athList[ii].save_path+">"+result.map.athList[ii].file_name+"</a><br/>")
				}
			  }
			}
		});
	}
});
//]]></script>
</body>
</html>