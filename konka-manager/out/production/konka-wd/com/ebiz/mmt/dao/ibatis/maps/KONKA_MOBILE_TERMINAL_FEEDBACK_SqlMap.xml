<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_MOBILE_TERMINAL_FEEDBACK">

	<typeAlias alias="konkaMobileTerminalFeedback" type="com.ebiz.mmt.domain.KonkaMobileTerminalFeedback" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaMobileTerminalFeedback" />
		<flushOnExecute statement="updateKonkaMobileTerminalFeedback" />
		<flushOnExecute statement="deleteKonkaMobileTerminalFeedback" />
	</cacheModel>

	<resultMap id="konkaMobileTerminalFeedbackResult" class="konkaMobileTerminalFeedback">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="MESSAGE_TYPE" property="message_type" jdbcType="DECIMAL" />
		<result column="CONTENT" property="content" jdbcType="VARCHAR" />
		<result column="QUESTION_PERSON" property="question_person" jdbcType="VARCHAR" />
		<result column="QUESTION_ID" property="question_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="MESSAGE_FROM" property="message_from" jdbcType="DECIMAL" />
		<result column="CHANNEL_A_ID" property="channel_a_id" jdbcType="DECIMAL" />
		<result column="CHANNEL_A_NAME" property="channel_a_name" jdbcType="VARCHAR" />
		<result column="CHANNEL_B_ID" property="channel_b_id" jdbcType="DECIMAL" />
		<result column="CHANNEL_B_NAME" property="channel_b_name" jdbcType="VARCHAR" />
		<result column="ORG_ID" property="org_id" jdbcType="DECIMAL" />
		<result column="ORG_NAME" property="org_name" jdbcType="VARCHAR" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="DEPT_NAME" property="dept_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_ID" property="subcomp_id" jdbcType="DECIMAL" />
		<result column="SUBCOMP_NAME" property="subcomp_name" jdbcType="VARCHAR" />
		<result column="OFFICE_ID" property="office_id" jdbcType="DECIMAL" />
		<result column="OFFICE_NAME" property="office_name" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="konkaMobileTerminalFeedbackResultForList" class="konkaMobileTerminalFeedback" extends="konkaMobileTerminalFeedbackResult">
		<result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
		<result column="C_NAME" property="map.c_name" jdbcType="VARCHAR" />
		<result column="OFFICE_NAME" property="map.office_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_NAME" property="map.subcomp_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaMobileTerminalFeedbackResultForBean" class="konkaMobileTerminalFeedback" extends="konkaMobileTerminalFeedbackResult">
		<result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
		<result column="C_NAME" property="map.c_name" jdbcType="VARCHAR" />
		<result column="OFFICE_NAME" property="map.office_name" jdbcType="VARCHAR" />
		<result column="SUBCOMP_NAME" property="map.subcomp_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaMobileTerminalFeedbackwithFbBack" class="konkaMobileTerminalFeedback" extends="konkaMobileTerminalFeedbackResult">
	    <result column="FB_CONTENT" property="map.fb_content" jdbcType="VARCHAR" />
	    <result column="FB_ID" property="map.fb_id" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-konkaMobileTerminalFeedback">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="message_type">MESSAGE_TYPE = #message_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="content">CONTENT = #content:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="question_person">QUESTION_PERSON = #question_person:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="question_id">QUESTION_ID = #question_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="message_from">MESSAGE_FROM = #message_from:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_id">CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_a_name">CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_id">CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="channel_b_name">CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_id">ORG_ID = #org_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="org_name">ORG_NAME = #org_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_id">SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="subcomp_name">SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_id">OFFICE_ID = #office_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="office_name">OFFICE_NAME = #office_name:VARCHAR#</isNotEmpty>
	</sql>

	<select id="selectKonkaMobileTerminalFeedback" resultMap="konkaMobileTerminalFeedbackResultForBean" parameterClass="konkaMobileTerminalFeedback" cacheModel="oneDayCache">
		select a.*, b.user_name as user_name,
			t.c_name,
			c.dept_name as subcomp_name1,
			d.dept_name as office_name1
			from KONKA_MOBILE_TERMINAL_FEEDBACK a
			left join KONKA_PE_PROD_USER b on b.id = a.question_id
			left join KONKA_DEPT c on c.dept_id = a.subcomp_id
			and c.dept_type = 3
			left join KONKA_DEPT d on d.dept_id = a.office_id
			and d.dept_type = 4
			and d.par_id = a.subcomp_id
			left join KONKA_MOBILE_CATEGORY t on a.message_type = t.c_index
			where 1 = 1
			and t.is_type = 1
			and t.is_del = 0
		<include refid="sf-konkaMobileTerminalFeedback" />
	</select>

	<select id="selectKonkaMobileTerminalFeedbackListWithFbBack" resultMap="konkaMobileTerminalFeedbackwithFbBack" parameterClass="konkaMobileTerminalFeedback" >
			<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.* ,b.content as fb_content,b.id as fb_id from KONKA_MOBILE_TERMINAL_FEEDBACK a  
		left join KONKA_MOBILE_TERMINAL_FB_BACK b on a.id=b.feed_id  
		where 1=1
		<include refid="sf-konkaMobileTerminalFeedback" />
		<isNotEmpty prepend=" and " property="map.is_history">b.IS_HISTORY = #map.is_history:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_history_null">( b.is_history is null  or b.is_history=0)</isNotEmpty>
		 order by a.ID desc 
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaMobileTerminalFeedbackList" resultMap="konkaMobileTerminalFeedbackResultForList" parameterClass="konkaMobileTerminalFeedback" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.* ,b.c_name from KONKA_MOBILE_TERMINAL_FEEDBACK a  left join KONKA_MOBILE_CATEGORY b on a.message_type=b.c_index  where 1=1 and b.is_type=1 and b.is_del=0
		<include refid="sf-konkaMobileTerminalFeedback" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaMobileTerminalFeedbackCount" resultClass="long" parameterClass="konkaMobileTerminalFeedback" cacheModel="oneDayCache">
		select count(*) from KONKA_MOBILE_TERMINAL_FEEDBACK a 
		<isNotEmpty property="map.feedback"> 
		left join KONKA_PE_PROD_USER b on b.id = a.question_id 
	    left join KONKA_DEPT c on c.dept_id = a.subcomp_id  and c.dept_type=3
	    left join KONKA_DEPT d on d.dept_id=a.office_id  and d.dept_type=4 and d.par_id=a.subcomp_id
	    left join KONKA_MOBILE_CATEGORY t on a.message_type = t.c_index
		where 1 = 1
		and t.is_type = 1
	    and t.is_del = 0 
	    </isNotEmpty>
	    <isNotEmpty property="map.report_name_like">
	    and b.user_name like  '%'|| #map.report_name_like# ||'%'
		</isNotEmpty>
		 <isNotEmpty property="map.have_where">
			where 1=1
		</isNotEmpty>
		<include refid="sf-konkaMobileTerminalFeedback" />
	</select>

	<select id="selectKonkaMobileTerminalFeedbackPaginatedList" resultMap="konkaMobileTerminalFeedbackResultForList" parameterClass="konkaMobileTerminalFeedback" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*,
		b.user_name as user_name,
		t.c_name,
		c.dept_name as subcomp_name1,
		d.dept_name as office_name1
		from KONKA_MOBILE_TERMINAL_FEEDBACK a
		left join KONKA_PE_PROD_USER b on b.id = a.question_id
		left join KONKA_DEPT c on c.dept_id = a.subcomp_id
		left join KONKA_DEPT d on d.dept_id = a.office_id
		left join KONKA_MOBILE_CATEGORY t on a.message_type = t.c_index
		where 1 = 1
		and t.is_type = 1
		and t.is_del = 0
		 <isNotEmpty property="map.report_name_like">
	    and b.user_name like  '%'|| #map.report_name_like# ||'%'
		</isNotEmpty>
		<include refid="sf-konkaMobileTerminalFeedback" />
		 order by a.ID desc 
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaMobileTerminalFeedback" parameterClass="konkaMobileTerminalFeedback">
		<selectKey resultClass="long" keyProperty="id">select KONKA_MOBILE_TERMINAL.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_MOBILE_TERMINAL_FEEDBACK (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="message_type">MESSAGE_TYPE</isNotNull>	
			<isNotNull prepend="," property="content">CONTENT</isNotNull>	
			<isNotNull prepend="," property="question_person">QUESTION_PERSON</isNotNull>	
			<isNotNull prepend="," property="question_id">QUESTION_ID</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="message_from">MESSAGE_FROM</isNotNull>	
			<isNotNull prepend="," property="channel_a_id">CHANNEL_A_ID</isNotNull>	
			<isNotNull prepend="," property="channel_a_name">CHANNEL_A_NAME</isNotNull>	
			<isNotNull prepend="," property="channel_b_id">CHANNEL_B_ID</isNotNull>	
			<isNotNull prepend="," property="channel_b_name">CHANNEL_B_NAME</isNotNull>	
			<isNotNull prepend="," property="org_id">ORG_ID</isNotNull>	
			<isNotNull prepend="," property="org_name">ORG_NAME</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="dept_name">DEPT_NAME</isNotNull>	
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID</isNotNull>	
			<isNotNull prepend="," property="subcomp_name">SUBCOMP_NAME</isNotNull>	
			<isNotNull prepend="," property="office_id">OFFICE_ID</isNotNull>	
			<isNotNull prepend="," property="office_name">OFFICE_NAME</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="message_type">#message_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="content">#content:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="question_person">#question_person:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="question_id">#question_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="message_from">#message_from:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_id">#channel_a_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_name">#channel_a_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="channel_b_id">#channel_b_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_b_name">#channel_b_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="org_id">#org_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="org_name">#org_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_name">#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="subcomp_id">#subcomp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_name">#subcomp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="office_id">#office_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="office_name">#office_name:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaMobileTerminalFeedback" parameterClass="KonkaMobileTerminalFeedback">
		update KONKA_MOBILE_TERMINAL_FEEDBACK
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="message_type">MESSAGE_TYPE = #message_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="content">CONTENT = #content:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="question_person">QUESTION_PERSON = #question_person:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="question_id">QUESTION_ID = #question_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="message_from">MESSAGE_FROM = #message_from:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_id">CHANNEL_A_ID = #channel_a_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_a_name">CHANNEL_A_NAME = #channel_a_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="channel_b_id">CHANNEL_B_ID = #channel_b_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="channel_b_name">CHANNEL_B_NAME = #channel_b_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="org_id">ORG_ID = #org_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="org_name">ORG_NAME = #org_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="subcomp_id">SUBCOMP_ID = #subcomp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="subcomp_name">SUBCOMP_NAME = #subcomp_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="office_id">OFFICE_ID = #office_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="office_name">OFFICE_NAME = #office_name:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaMobileTerminalFeedback" parameterClass="KonkaMobileTerminalFeedback">
		delete from KONKA_MOBILE_TERMINAL_FEEDBACK where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>