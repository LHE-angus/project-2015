<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JXC_STOCK_BILL_DETAILS">

	<typeAlias alias="jxcStockBillDetails" type="com.ebiz.mmt.domain.JxcStockBillDetails" />

	

	<resultMap id="jxcStockBillDetailsResultForList" class="jxcStockBillDetails">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="STOCK_BILL_ID" property="stock_bill_id" jdbcType="DECIMAL" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="count" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="IS_PC" property="is_pc" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="jxcStockBillDetailsResult" class="jxcStockBillDetails" extends="jxcStockBillDetailsResultForList">
	</resultMap>
	
	<resultMap id="jxcStockBillDetailsStatForReal" class="jxcStockBillDetails" >
		<result column="purchase_quantity" property="map.purchase_quantity" jdbcType="DECIMAL" />
		<result column="purchase_amount" property="map.purchase_amount" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-jxcStockBillDetails">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="stock_bill_id">STOCK_BILL_ID = #stock_bill_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="count">COUNT = #count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">REMARKS = #remarks:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_pc">IS_PC = #is_pc:DECIMAL#</isNotEmpty>
	</sql>

	<select id="selectJxcStockBillDetails" resultMap="jxcStockBillDetailsResult" parameterClass="jxcStockBillDetails" >
		select * from CHEA_FILL.JXC_STOCK_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcStockBillDetails" />
	</select>

	<select id="selectJxcStockBillDetailsList" resultMap="jxcStockBillDetailsResultForList" parameterClass="jxcStockBillDetails" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from CHEA_FILL.JXC_STOCK_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcStockBillDetails" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJxcStockBillDetailsCount" resultClass="long" parameterClass="jxcStockBillDetails" >
		select count(*) from CHEA_FILL.JXC_STOCK_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcStockBillDetails" />
	</select>

	<select id="selectJxcStockBillDetailsPaginatedList" resultMap="jxcStockBillDetailsResult" parameterClass="jxcStockBillDetails" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from CHEA_FILL.JXC_STOCK_BILL_DETAILS where 1 = 1
		<include refid="sf-jxcStockBillDetails" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectJxcStockBillDetailsStatForReal" resultMap="jxcStockBillDetailsStatForReal" parameterClass="java.util.Map" >
		select sum(b.count) purchase_quantity,sum(b.count*b.price) purchase_amount from  CHEA_FILL.JXC_STOCK_BILL_DETAILS b where 1=1
		<isNotEmpty prepend=" and " property="start_date">
		<![CDATA[to_char(b.add_date,'yyyy-mm-dd')>=#start_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">
		<![CDATA[to_char(b.add_date,'yyyy-mm-dd')<=#end_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">b.shop_id=#shop_id#</isNotEmpty>
	</select>
	
	<!-- 根据网点或部门及产品型号、日期、是否确认等条件查询按来源（进货、发货、分销）统计发货产品型号进货货数量 add by du,zhiming 20111117 -->
	<select id="selectJxcstockBillDetailsSumPdCountList" resultClass="java.util.HashMap" parameterClass="jxcStockBillDetails"
		>
		select a.pd_type_name as pd_type_name,a.pd_name as pd_name,a.brand_name as brand_name,b.stock_src as stock_src,sum(a.count) as sumCount from CHEA_FILL.jxc_stock_bill_details a
		left join CHEA_FILL.jxc_stock_bill b on a.stock_bill_id = b.id
		where 1=1
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_ids">a.pd_id in ($map.pd_ids$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">a.pd_id = #pd_id#</isNotEmpty>
		<!-- isNotEmpty prepend=" and " property="map.is_confirm">b.IS_CONFIRM = #map.is_confirm#</isNotEmpty> -->
		<isNotEmpty prepend=" and " property="map.start_date"><![CDATA[to_date(#map.start_date#, 'YYYY-MM-DD') <= b.IN_DATE]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[b.IN_DATE <= to_date(#map.end_date#  || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')]]></isNotEmpty>
		group by b.stock_src, a.pd_type_name ,a.pd_name ,a.brand_name 
		
	</select>
	<!-- 根据网点或部门及产品型号、日期、是否确认等条件查询统计发货产品型号进货货总数量 add by du,zhiming 20111118 -->
	<select id="selectJxcstockBillDetailsSumPdCountNotSrc" resultClass="long" parameterClass="jxcStockBillDetails"
		>
		select sum(a.count) as sumCount from CHEA_FILL.jxc_stock_bill_details a
		left join CHEA_FILL.jxc_stock_bill b on a.stock_bill_id = b.id
		where 1=1
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_ids">a.pd_id in ($map.pd_ids$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">a.pd_id = #pd_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.start_date"><![CDATA[to_date(#map.start_date#, 'YYYY-MM-DD') <= b.IN_DATE]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.end_date"><![CDATA[b.IN_DATE <= to_date(#map.end_date#  || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')]]></isNotEmpty>
	</select>

	<insert id="insertJxcStockBillDetails" parameterClass="jxcStockBillDetails">
		<selectKey resultClass="long" keyProperty="id">select CHEA_FILL.JXC_BILL_DETAILS_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into CHEA_FILL.JXC_STOCK_BILL_DETAILS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="stock_bill_id">STOCK_BILL_ID</isNotNull>	
			<isNotNull prepend="," property="pd_id">PD_ID</isNotNull>	
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME</isNotNull>	
			<isNotNull prepend="," property="brand_name">BRAND_NAME</isNotNull>	
			<isNotNull prepend="," property="pd_name">PD_NAME</isNotNull>	
			<isNotNull prepend="," property="count">COUNT</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="is_pc">IS_PC</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_bill_id">#stock_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">#pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">#pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name">#brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_name">#pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="count">#count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>	
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="is_pc">#is_pc:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJxcStockBillDetails" parameterClass="JxcStockBillDetails">
		update CHEA_FILL.JXC_STOCK_BILL_DETAILS
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_bill_id">STOCK_BILL_ID = #stock_bill_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="count">COUNT = #count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATE#</isNotNull>
			<isNotNull prepend="," property="is_pc">IS_PC = #is_pc:DECIMAL#</isNotNull>
		</dynamic>
		where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_id">PD_ID = #map.pd_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_id">SHOP_ID = #map.shop_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id">BRAND_ID = #map.brand_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date"><![CDATA[ ADD_DATE < to_date(#map.add_date# || '23:59:59','yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_pc">IS_PC = #map.is_pc#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJxcStockBillDetails" parameterClass="JxcStockBillDetails">
		delete from CHEA_FILL.JXC_STOCK_BILL_DETAILS where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>