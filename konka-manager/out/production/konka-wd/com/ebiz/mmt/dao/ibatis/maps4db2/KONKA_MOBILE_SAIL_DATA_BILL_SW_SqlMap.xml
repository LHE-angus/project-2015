<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_MOBILE_SAIL_DATA_BILL_SW">

	<typeAlias alias="konkaMobileSailDataBillSw" type="com.ebiz.mmt.domain.KonkaMobileSailDataBillSw" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaMobileSailDataBillSw" />
		<flushOnExecute statement="updateKonkaMobileSailDataBillSw" />
		<flushOnExecute statement="deleteKonkaMobileSailDataBillSw" />
	</cacheModel>

	<resultMap id="konkaMobileSailDataBillSwResultForList" class="konkaMobileSailDataBillSw">
		<result column="SWITCH_ID" property="switch_id" jdbcType="DECIMAL" />
		<result column="SWITCH_TITLE" property="switch_title" jdbcType="VARCHAR" />
		<result column="SWITCH_USER_ID" property="switch_user_id" jdbcType="DECIMAL" />
		<result column="SWITCH_USER_NAME" property="switch_user_name" jdbcType="VARCHAR" />
		<result column="FINAL_AUDIT_ID" property="final_audit_id" jdbcType="DECIMAL" />
		<result column="FINAL_AUDIT_NAME" property="final_audit_name" jdbcType="VARCHAR" />
		<result column="SWITCH_REMARK" property="switch_remark" jdbcType="VARCHAR" />
		<result column="FINAL_AUDIT_REMARK" property="final_audit_remark" jdbcType="VARCHAR" />
		<result column="SWITCH_DATE" property="switch_date" jdbcType="TIMESTAMP" />
		<result column="FINAL_AUDIT_DATE" property="final_audit_date" jdbcType="TIMESTAMP" />
		<result column="CANCEL_USER_ID" property="cancel_user_id" jdbcType="DECIMAL" />
		<result column="CANCEL_USER_NAME" property="cancel_user_name" jdbcType="VARCHAR" />
		<result column="CANCEL_DATE" property="cancel_date" jdbcType="TIMESTAMP" />
		<result column="STATE" property="state" jdbcType="INTEGER" />
	</resultMap>

	<resultMap id="konkaMobileSailDataBillSwResult" class="konkaMobileSailDataBillSw" extends="konkaMobileSailDataBillSwResultForList">
	</resultMap>
	<resultMap id="konkaMobileSailDataBillSwAndBillResult" class="konkaMobileSailDataBillSw" extends="konkaMobileSailDataBillSwResultForList">
	<result column="ALL_PRICE" property="map.all_price" jdbcType="DECIMAL" />
	<result column="NUM" property="map.num" jdbcType="DECIMAL" />
	<result column="DEC_MONEY" property="map.dec_money" jdbcType="DECIMAL" />
	<result column="AUDIT_MONEY" property="map.audit_money" jdbcType="DECIMAL" />
	<result column="FINAL_AUDIT_MONEY" property="map.final_audit_money" jdbcType="DECIMAL" />
	<result column="SUBCOMP_NAME" property="map.subcomp_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaMobileSailDataBillSwAndBillForSwitchedResult" class="konkaMobileSailDataBillSw" extends="konkaMobileSailDataBillSwResultForList">
	<result column="ALL_PRICE" property="map.all_price" jdbcType="DECIMAL" />
	<result column="NUM" property="map.num" jdbcType="DECIMAL" />
	<result column="DEC_MONEY" property="map.dec_money" jdbcType="DECIMAL" />
	<result column="AUDIT_MONEY" property="map.audit_money" jdbcType="DECIMAL" />
	<result column="SUBCOMP_ID" property="map.subcomp_id" jdbcType="DECIMAL" />
	<result column="SUBCOMP_NAME" property="map.subcomp_name" jdbcType="VARCHAR" />
	<result column="DEPT_ID" property="map.dept_id" jdbcType="DECIMAL" />
	<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
	<result column="REPORT_ID" property="map.report_id" jdbcType="DECIMAL" />
	<result column="YWY_JOB_ID" property="map.ywy_job_id" jdbcType="VARCHAR" />
	<result column="REPORT_NAME" property="map.report_name" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-konkaMobileSailDataBillSw">
		<isNotEmpty prepend=" and " property="switch_id">SWITCH_ID = #switch_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="switch_title">SWITCH_TITLE = #switch_title:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="switch_user_id">SWITCH_USER_ID = #switch_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="switch_user_name">SWITCH_USER_NAME = #switch_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="final_audit_id">FINAL_AUDIT_ID = #final_audit_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="final_audit_name">FINAL_AUDIT_NAME = #final_audit_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="switch_remark">SWITCH_REMARK = #switch_remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="final_audit_remark">FINAL_AUDIT_REMARK = #final_audit_remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="switch_date">SWITCH_DATE = #switch_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="final_audit_date">FINAL_AUDIT_DATE = #final_audit_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cancel_user_id">CANCEL_USER_ID = #cancel_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cancel_user_name">CANCEL_USER_NAME = #cancel_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cancel_date">CANCEL_DATE = #cancel_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">STATE = #state:INTEGER#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.switch_user_name_like">SWITCH_USER_NAME like '%'|| #map.switch_user_name_like:VARCHAR# || '%'</isNotEmpty>
		
	</sql>

	<select id="selectKonkaMobileSailDataBillSw" resultMap="konkaMobileSailDataBillSwResult" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		select * from KONKA_MOBILE_SAIL_DATA_BILL_SW where 1 = 1
		<include refid="sf-konkaMobileSailDataBillSw" />
	</select>

	<select id="selectKonkaMobileSailDataBillSwList" resultMap="konkaMobileSailDataBillSwResultForList" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_MOBILE_SAIL_DATA_BILL_SW where 1 = 1
		<include refid="sf-konkaMobileSailDataBillSw" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaMobileSailDataBillSwCount" resultClass="long" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		select count(*) from KONKA_MOBILE_SAIL_DATA_BILL_SW where 1 = 1
		<include refid="sf-konkaMobileSailDataBillSw" />
	</select>

	<select id="selectKonkaMobileSailDataBillSwPaginatedList" resultMap="konkaMobileSailDataBillSwResult" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_MOBILE_SAIL_DATA_BILL_SW where 1 = 1
		<include refid="sf-konkaMobileSailDataBillSw" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaMobileSailDataBillSwAndBillCount" resultClass="long" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		select count(*) from KONKA_MOBILE_SAIL_DATA_BILL_sw a left join
			(select b.switch_id,max(c.subcomp_id) subcomp_id from
			KONKA_MOBILE_SAIL_DATA_BILL b left join konka_mobile_sail_data c on
			b.sail_id =c.id
			where b.switch_id is not null
			and c.subcomp_id is not null
			<isNotEmpty prepend=" and "  property="map.subcomp_id">c.subcomp_id=#map.subcomp_id# </isNotEmpty>
			group by b.switch_id) d 
			on a.switch_id=d.switch_id
			where 1=1
			 <isNotEmpty prepend=" and "  property="map.final_audit_flag">
				a.state=1
				 </isNotEmpty>
				 <isEmpty prepend=" and "  property="map.final_audit_flag">
				a.state !=1
				 </isEmpty>
		<include refid="sf-konkaMobileSailDataBillSw" />
		 <isNotEmpty prepend=" and "  property="map.subcomp_id">d.subcomp_id=#map.subcomp_id# </isNotEmpty>
	</select>
	
	<select id="selectKonkaMobileSailDataBillSwAndBillPaginatedList" resultMap="konkaMobileSailDataBillSwAndBillResult" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
			select a.*,d.all_price,d.num,d.dec_money,d.audit_money,d.final_audit_money,d.subcomp_name from 
			KONKA_MOBILE_SAIL_DATA_BILL_sw a left join
				(select b.switch_id,sum(c.all_price) all_price, sum(c.num) num, sum(b.dec_money) dec_money,
				sum(b.audit_money) audit_money,sum(b.final_audit_money) final_audit_money,max(c.subcomp_id) subcomp_id,
				max(c.subcomp_name) subcomp_name from 
				 KONKA_MOBILE_SAIL_DATA_BILL b left join konka_mobile_sail_data c on 
				b.sail_id   =c.id
				where  b.switch_id is not null
				and c.subcomp_id is not null
			   <isNotEmpty prepend=" and "  property="map.subcomp_id">c.subcomp_id=#map.subcomp_id# </isNotEmpty>
				group by b.switch_id) d 
				on a.switch_id=d.switch_id
				where 1=1 
				<isNotEmpty prepend=" and "  property="map.final_audit_flag">
				a.state=1
				 </isNotEmpty>
				 <isEmpty prepend=" and "  property="map.final_audit_flag">
				a.state !=1
				 </isEmpty>
		<include refid="sf-konkaMobileSailDataBillSw" />
		 <isNotEmpty prepend=" and "  property="map.subcomp_id">d.subcomp_id=#map.subcomp_id# </isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>


<!-- 已转订单查询 -->
<select id="selectKonkaMobileSailDataBillSwAndBillForSwitchedCount" resultClass="long" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		select count(*) from KONKA_MOBILE_SAIL_DATA_BILL_sw a right join
			(SELECT 
		      b.switch_id,
		      sum (b.DEC_MONEY) dec_money,
		       sum (b.AUDIT_MONEY) audit_money,
		       sum(c.all_price) all_price,
		       sum(c.num) num,
		       c.dept_id,
		       c.dept_name,
		       c.SUBCOMP_ID,
		       c.SUBCOMP_NAME,
		       c.REPORT_ID,
		       max(d.YWY_JOB_ID) YWY_JOB_ID,
		       max (c.REPORT_NAME) report_name
		  FROM    konka_mobile_sail_data_bill b
		       LEFT JOIN
		          konka_mobile_sail_data c
		       ON b.SAIL_ID = c.ID
		             LEFT JOIN KONKA_R3_STORE d
		             ON d.STORE_ID = c.DEPT_ID
		 WHERE b.SWITCH_ID IS NOT NULL
		    <isNotEmpty prepend=" and "  property="map.subcomp_id">c.subcomp_id=#map.subcomp_id# </isNotEmpty>
		GROUP BY b.SWITCH_ID,
		         c.dept_id,
		         c.dept_name,
		         c.SUBCOMP_ID,
		         c.SUBCOMP_NAME,
		         c.REPORT_ID ) d
				on a.switch_id=d.switch_id
				where 1=1 
					<include refid="sf-konkaMobileSailDataBillSw" />
		 <isNotEmpty prepend=" and "  property="map.subcomp_id">d.subcomp_id=#map.subcomp_id# </isNotEmpty>
	</select>


	<select id="selectKonkaMobileSailDataBillSwAndBillForSwitchedPaginatedList" resultMap="konkaMobileSailDataBillSwAndBillForSwitchedResult" parameterClass="konkaMobileSailDataBillSw" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
			select a.*, 
		     d.dec_money,
		       d.audit_money,
		      d.all_price,
		      d.num,
		      d.dept_id,
		      d.dept_name,
		      d.subcomp_id,
		       d.subcomp_name,
		      d.report_id,
		      d.ywy_job_id,
		      d.report_name
			from 
			KONKA_MOBILE_SAIL_DATA_BILL_sw a right join
			(SELECT 
		      b.switch_id,
		      sum (b.DEC_MONEY) dec_money,
		       sum (b.AUDIT_MONEY) audit_money,
		       sum(c.all_price) all_price,
		       sum(c.num) num,
		       c.dept_id,
		       c.dept_name,
		       c.SUBCOMP_ID,
		       c.SUBCOMP_NAME,
		       c.REPORT_ID,
		       max(d.YWY_JOB_ID) YWY_JOB_ID,
		       max (c.REPORT_NAME) report_name
		  FROM    konka_mobile_sail_data_bill b
		       LEFT JOIN
		          konka_mobile_sail_data c
		       ON b.SAIL_ID = c.ID
		             LEFT JOIN KONKA_R3_STORE d
		             ON d.STORE_ID = c.DEPT_ID
		 WHERE b.SWITCH_ID IS NOT NULL
		    <isNotEmpty prepend=" and "  property="map.subcomp_id">c.subcomp_id=#map.subcomp_id# </isNotEmpty>
		
		GROUP BY b.SWITCH_ID,
		         c.dept_id,
		         c.dept_name,
		         c.SUBCOMP_ID,
		         c.SUBCOMP_NAME,
		         c.REPORT_ID ) d
				on a.switch_id=d.switch_id
				where 1=1 
		<include refid="sf-konkaMobileSailDataBillSw" />
		 <isNotEmpty prepend=" and "  property="map.subcomp_id">d.subcomp_id=#map.subcomp_id# </isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	

	<insert id="insertKonkaMobileSailDataBillSw" parameterClass="konkaMobileSailDataBillSw">
		<selectKey resultClass="long" keyProperty="switch_id">select seq_konka_mobile_sail_date_bill_lo.nextval as switch_id from dual </selectKey>
		<![CDATA[insert into KONKA_MOBILE_SAIL_DATA_BILL_SW (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="switch_id">SWITCH_ID</isNotNull>	
			<isNotNull prepend="," property="switch_title">SWITCH_TITLE</isNotNull>	
			<isNotNull prepend="," property="switch_user_id">SWITCH_USER_ID</isNotNull>	
			<isNotNull prepend="," property="switch_user_name">SWITCH_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="final_audit_id">FINAL_AUDIT_ID</isNotNull>	
			<isNotNull prepend="," property="final_audit_name">FINAL_AUDIT_NAME</isNotNull>	
			<isNotNull prepend="," property="switch_remark">SWITCH_REMARK</isNotNull>	
			<isNotNull prepend="," property="final_audit_remark">FINAL_AUDIT_REMARK</isNotNull>	
			<isNotNull prepend="," property="switch_date">SWITCH_DATE</isNotNull>	
			<isNotNull prepend="," property="final_audit_date">FINAL_AUDIT_DATE</isNotNull>	
			<isNotNull prepend="," property="cancel_user_id">CANCEL_USER_ID</isNotNull>	
			<isNotNull prepend="," property="cancel_user_name">CANCEL_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="cancel_date">CANCEL_DATE</isNotNull>	
			<isNotNull prepend="," property="state">STATE</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="switch_id">#switch_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="switch_title">#switch_title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_user_id">#switch_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="switch_user_name">#switch_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="final_audit_id">#final_audit_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="final_audit_name">#final_audit_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_remark">#switch_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="final_audit_remark">#final_audit_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_date">#switch_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="final_audit_date">#final_audit_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="cancel_user_id">#cancel_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cancel_user_name">#cancel_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cancel_date">#cancel_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="state">#state:INTEGER#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaMobileSailDataBillSw" parameterClass="KonkaMobileSailDataBillSw">
		update KONKA_MOBILE_SAIL_DATA_BILL_SW
		<dynamic prepend="set">
			<isNotNull prepend="," property="switch_id">SWITCH_ID = #switch_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="switch_title">SWITCH_TITLE = #switch_title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_user_id">SWITCH_USER_ID = #switch_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="switch_user_name">SWITCH_USER_NAME = #switch_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="final_audit_id">FINAL_AUDIT_ID = #final_audit_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="final_audit_name">FINAL_AUDIT_NAME = #final_audit_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_remark">SWITCH_REMARK = #switch_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="final_audit_remark">FINAL_AUDIT_REMARK = #final_audit_remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="switch_date">SWITCH_DATE = #switch_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="final_audit_date">FINAL_AUDIT_DATE = #final_audit_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="cancel_user_id">CANCEL_USER_ID = #cancel_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cancel_user_name">CANCEL_USER_NAME = #cancel_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cancel_date">CANCEL_DATE = #cancel_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="state">STATE = #state:INTEGER#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="switch_id">SWITCH_ID = #switch_id#</isNotEmpty>
		<isEmpty prepend=" " property="switch_id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaMobileSailDataBillSw" parameterClass="KonkaMobileSailDataBillSw">
		delete from KONKA_MOBILE_SAIL_DATA_BILL_SW where
		<isNotEmpty prepend=" " property="switch_id">SWITCH_ID = #switch_id#</isNotEmpty>
		<isEmpty prepend=" " property="switch_id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>