<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_JXC_STORE_STATE">

	<typeAlias alias="konkaJxcStoreState" type="com.ebiz.mmt.domain.KonkaJxcStoreState" />

	

	<resultMap id="konkaJxcStoreStateResultForList" class="konkaJxcStoreState">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="STORE_ID" property="store_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE_ID" property="pd_type_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="PD_LENGTH" property="pd_length" jdbcType="DECIMAL" />
		<result column="PD_WIDTH" property="pd_width" jdbcType="DECIMAL" />
		<result column="PD_HEIGHT" property="pd_height" jdbcType="DECIMAL" />
		<result column="PD_UNIT" property="pd_unit" jdbcType="VARCHAR" />
		<result column="PD_WEIGHT" property="pd_weight" jdbcType="DECIMAL" />
		<result column="PD_WEIGHT_UNIT" property="pd_weight_unit" jdbcType="VARCHAR" />
		<result column="PD_NUM" property="pd_num" jdbcType="DECIMAL" />
		<result column="PD_BAD_NUM" property="pd_bad_num" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="UPDATE_DATE" property="update_date" jdbcType="DATETIME" />
		<result column="UPDATE_USER_ID" property="update_user_id" jdbcType="DECIMAL" />
		<result column="DEL_DATE" property="del_date" jdbcType="DATETIME" />
		<result column="DEL_USER_ID" property="del_user_id" jdbcType="DECIMAL" />
		
		<!-- add by 20111107 -->
		<result column="DEPT_NAME" property="dept_name" jdbcType="VARCHAR" />
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="CUR_COST_PRICE" property="cur_cost_price" jdbcType="DECIMAL" />
		
		<!-- add by 2011-11-10 -->
		<result column="PRICE_REF" property="price_ref" jdbcType="DECIMAL" />
		<result column="PRICE_PF" property="price_pf" jdbcType="DECIMAL" />
		<result column="PRICE_LS" property="price_ls" jdbcType="DECIMAL" />
		<result column="INIT_COUNT" property="init_count" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="stockRcjhAndRcchListForResult" class="konkaJxcStoreState">
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE_ID" property="pd_type_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="JH_COUNT" property="map.jh_count" jdbcType="DECIMAL" />
		<result column="JH_SUM_MONEY" property="map.jh_sum_money" jdbcType="DECIMAL" />
		<result column="CH_COUNT" property="map.ch_count" jdbcType="DECIMAL" />
		<result column="CH_SUM_MONEY" property="map.ch_sum_money" jdbcType="DECIMAL" />
		<result column="PC_COUNT" property="map.pc_count" jdbcType="DECIMAL" />
		<result column="PC_SUM_MONEY" property="map.pc_sum_money" jdbcType="DECIMAL" />
		<result column="THZP_COUNT" property="map.thzp_count" jdbcType="DECIMAL" />
		<result column="THZP_SUM_MONEY" property="map.thzp_sum_money" jdbcType="DECIMAL" />
		<result column="THCCP_COUNT" property="map.thccp_count" jdbcType="DECIMAL" />
		<result column="THCCP_SUM_MONEY" property="map.thccp_sum_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="stockRcjhAndRcchListForResultForStore" class="konkaJxcStoreState" extends="stockRcjhAndRcchListForResult">
		<result column="STORE_ID" property="store_id" jdbcType="DECIMAL" />
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="qcjcForStockResult" class="konkaJxcStoreState">
		<result column="QCJC_COUNT" property="map.qcjc_count" jdbcType="DECIMAL" />
		<result column="QCJC_MONEY" property="map.qcjc_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="konkaStockDetailsListForResult" class="konkaJxcStoreState">
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="MONEY" property="map.money" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="TYPE" property="map.type" jdbcType="DECIMAL"/>
		<result column="STORE_NAME" property="store_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaJxcStoreStateResult" class="konkaJxcStoreState" extends="konkaJxcStoreStateResultForList">
	</resultMap>

	<sql id="sf-konkaJxcStoreState">
		<isNotEmpty prepend=" and " property="id">a.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">a.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_id">a.STORE_ID = #store_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_id">a.PD_TYPE_ID = #pd_type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_name">a.PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">a.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name">a.BRAND_NAME = #brand_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">a.PD_ID = #pd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_name">a.PD_NAME = #pd_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_length">a.PD_LENGTH = #pd_length:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_width">a.PD_WIDTH = #pd_width:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_height">a.PD_HEIGHT = #pd_height:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_unit">a.PD_UNIT = #pd_unit:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_weight">a.PD_WEIGHT = #pd_weight:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_weight_unit">a.PD_WEIGHT_UNIT = #pd_weight_unit:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_num">a.PD_NUM = #pd_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_bad_num">a.PD_BAD_NUM = #pd_bad_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">a.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">a.UPDATE_DATE = #update_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">a.UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_date">a.DEL_DATE = #del_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_user_id">a.DEL_USER_ID = #del_user_id:DECIMAL#</isNotEmpty>
		<!-- add by 20111107 -->
		<isNotEmpty prepend=" and " property="dept_name">a.DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="store_name">a.STORE_NAME = #store_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">a.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cur_cost_price">a.CUR_COST_PRICE = #cur_cost_price:DECIMAL#</isNotEmpty>
		
		<!-- add by 2011-11-10 -->
		<isNotEmpty prepend=" and " property="price_ref">a.PRICE_REF = #price_ref:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_pf">a.PRICE_PF = #price_pf:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_ls">a.PRICE_LS = #price_ls:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="init_count">a.INIT_COUNT = #init_count:DECIMAL#</isNotEmpty>
	</sql>

	<select id="selectKonkaJxcStoreState" resultMap="konkaJxcStoreStateResult" parameterClass="konkaJxcStoreState" >
		select a.* from KONKA_JXC_STORE_STATE a where 1 = 1
		<include refid="sf-konkaJxcStoreState" />
	</select>

	<select id="selectKonkaJxcStoreStateList" resultMap="konkaJxcStoreStateResultForList" parameterClass="konkaJxcStoreState" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_JXC_STORE_STATE a where 1 = 1
		<include refid="sf-konkaJxcStoreState" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	<!-- 根据部门取列表-->
	<select id="selectStockRcjhAndRcfhList" resultMap="stockRcjhAndRcchListForResult" parameterClass="konkaJxcStoreState" >
		select b.md_name as pd_name, c.cls_name as pd_type_name ,a.* 
		  	from (select pd_id,
	              pd_type_id,
	               sum(jh_count) jh_count,
	               sum(jh_price) jh_sum_money,
	               sum(ch_count) ch_count,
	               sum(ch_price) ch_sum_money,
	               sum(pc_count) pc_count,
                   sum(pc_price) pc_sum_money,
                   sum(thzp_count) thzp_count,
                   sum(thzp_price) thzp_sum_money,
                   sum(thccp_count) thccp_count,
                   sum(thccp_price) thccp_sum_money
		         	from (select pd_id,
		                       pd_type_id,
		                       update_num jh_count,
		                       price_sum jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
                               0 pc_price,
                               0 thzp_count,
                               0 thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                  	from (select *
		                          		from KONKA_JXC_STORE_UPDATE_RECORD
		                          		where update_type = 0 and dept_id = #map.dept_id#)
		                    where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		                union all
		                select pd_id,
		                       pd_type_id,
		                       0 jh_count,
		                       0 jh_price,
		                       update_num ch_count,
		                       price_sum ch_price,
		                       0 pc_count,
                               0 pc_price,
                               0 thzp_count,
                               0 thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                  from (select *
		                           from KONKA_JXC_STORE_UPDATE_RECORD
		                           where  update_type = 1 and dept_id = #map.dept_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select   pd_id,
			                      pd_type_id,
			                      0 jh_count,
			                      0 jh_price,
			                      0 ch_count,
			                      0 ch_price,
			                      update_num pc_count,
			                      price_sum pc_price,
			                      0 thzp_count,
	                              0 thzp_price,
	                              0 thccp_count,
	                              0 thccp_price
		                 from (select * 
		                 		 from KONKA_JXC_STORE_UPDATE_RECORD
		                         where dept_id = #map.dept_id# and update_type = 3)
		                where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         	    union all
		                 select pd_id,
		                      pd_type_id,
		                       0 jh_count,
		                       0 jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
		                       0 pc_price,
		                       update_num thzp_count,
                               price_sum thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                 from (select * 
		                 	      from KONKA_JXC_STORE_UPDATE_RECORD 
		                 	      where  update_type = 2 and dept_id = #map.dept_id#)
		                where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select pd_id,
		                 		pd_type_id,
		                      0 jh_count,
		                      0 jh_price,
		                      0 ch_count,
		                      0 ch_price,
		                      0 pc_count,
		                      0 pc_price,
		                      0 thzp_count,
                              0 thzp_price,
                              update_num thccp_count,
                              price_sum thccp_price
		                 from (select * 
		                         from KONKA_JXC_STORE_UPDATE_RECORD
		                         where dept_id = #map.dept_id# and update_type = 4)
		                where 1 = 1
		                <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		<isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 )
		         group by  pd_id,pd_type_id) a 
               left join KONKA_PE_PD_MODEL b on a.pd_id = b.pd_id 
               left join KONKA_BASE_PD_CLASS c on a.pd_type_id = c.cls_id  where 1=1
  		 <isNotEmpty prepend=" and " property="map.pd_type">a.pd_type_id = #map.pd_type#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.name_like">b.md_name like '%' || #map.name_like# || '%'</isNotEmpty>
	</select>
	<!-- 根据仓库取列表-->
	<select id="selectStockRcjhAndRcfhListForStore" resultMap="stockRcjhAndRcchListForResultForStore" parameterClass="konkaJxcStoreState" >
		select a.* , b.md_name as pd_name, c.cls_name as pd_type_name , d.store_name
		  	from (select 
		  		   store_id,
		  		   pd_id,
	               pd_type_id,
	               sum(jh_count) jh_count,
	               sum(jh_price) jh_sum_money,
	               sum(ch_count) ch_count,
	               sum(ch_price) ch_sum_money,
	               sum(pc_count) pc_count,
                   sum(pc_price) pc_sum_money,
                   sum(thzp_count) thzp_count,
                   sum(thzp_price) thzp_sum_money,
                   sum(thccp_count) thccp_count,
                   sum(thccp_price) thccp_sum_money
		         	from (select 
		         	 		   store_id,
		         			   pd_id,
		                       pd_type_id,
		                       update_num jh_count,
		                       price_sum jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
                               0 pc_price,
                               0 thzp_count,
                               0 thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                  	from (select *
		                          		from KONKA_JXC_STORE_UPDATE_RECORD
		                          		where update_type = 0 and dept_id = #map.dept_id#)
		                    where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		                union all
		                select 
		                 	   store_id,
		               		   pd_id,
		                       pd_type_id,
		                       0 jh_count,
		                       0 jh_price,
		                       update_num ch_count,
		                       price_sum ch_price,
		                       0 pc_count,
                               0 pc_price,
                               0 thzp_count,
                               0 thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                  from (select *
		                           from KONKA_JXC_STORE_UPDATE_RECORD
		                           where  update_type = 1 and dept_id = #map.dept_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select   store_id,
		                 		  pd_id,
			                      pd_type_id,
			                      0 jh_count,
			                      0 jh_price,
			                      0 ch_count,
			                      0 ch_price,
			                      update_num pc_count,
			                      price_sum pc_price,
			                      0 thzp_count,
	                              0 thzp_price,
	                              0 thccp_count,
	                              0 thccp_price
		                 from (select * 
		                 		 from KONKA_JXC_STORE_UPDATE_RECORD
		                         where dept_id = #map.dept_id# and update_type = 3)
		                where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         	    union all
		                 select  store_id,
		                 	   pd_id,
		                       pd_type_id,
		                       0 jh_count,
		                       0 jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
		                       0 pc_price,
		                       update_num thzp_count,
                               price_sum thzp_price,
                               0 thccp_count,
                               0 thccp_price
		                 from (select * 
		                 	      from KONKA_JXC_STORE_UPDATE_RECORD 
		                 	      where  update_type = 2 and dept_id = #map.dept_id#)
		                where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select  store_id,
		                 	  pd_id,
		                 	  pd_type_id,
		                      0 jh_count,
		                      0 jh_price,
		                      0 ch_count,
		                      0 ch_price,
		                      0 pc_count,
		                      0 pc_price,
		                      0 thzp_count,
                              0 thzp_price,
                              update_num thccp_count,
                              price_sum thccp_price
		                 from (select * 
		                         from KONKA_JXC_STORE_UPDATE_RECORD
		                         where dept_id = #map.dept_id# and update_type = 4)
		                where 1 = 1
		                <isNotEmpty prepend=" and " property="map.add_date_st"><![CDATA[ add_date >= to_date(#map.add_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		<isNotEmpty prepend=" and " property="map.add_date_en"><![CDATA[ add_date <= to_date(#map.add_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 )
		         group by  store_id,pd_id,pd_type_id) a 
               left join KONKA_PE_PD_MODEL b on a.pd_id = b.pd_id 
               left join KONKA_BASE_PD_CLASS c on a.pd_type_id = c.cls_id  
               left join KONKA_JXC_STORE_INFO d on a.store_id = d.id
               where 1=1
  		 <isNotEmpty prepend=" and " property="map.pd_type">a.pd_type_id = #map.pd_type#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.name_like">b.md_name like '%' || #map.name_like# || '%'</isNotEmpty>
		order by a.store_id desc , a.pd_id desc
	</select>
	
	<select id="selectQcjcForStockState" resultMap="qcjcForStockResult" parameterClass="konkaJxcStoreState" >
		select (x.qc_count + y.jh_count + q.pc_count + m.thzp_count ) - z.xs_count as qcjc_count,
		       (x.qc_money + y.jh_money + q.pc_money + m.thzp_money ) - z.xs_money as qcjc_money
  		  from (select decode(sum(a.init_count * a.cur_cost_price),null,0,sum(a.init_count * a.cur_cost_price)) as qc_money, decode(sum(a.init_count),null,0,sum(a.init_count)) as qc_count
                  from KONKA_JXC_STORE_STATE a
         		 where 1=1 
         		 <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ a.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id">a.STORE_ID= #store_id:DECIMAL#</isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id_is_null">a.STORE_ID is null</isNotEmpty>
         		 and pd_id = #map.pd_id# and a.dept_id = #map.dept_id#) x,
       		   (select decode(sum(b.price_sum), null, 0, sum(b.price_sum)) as jh_money, decode(sum(b.update_num), null, 0, sum(b.update_num)) as jh_count
          		  from KONKA_JXC_STORE_UPDATE_RECORD b 
         		 where 1 = 1
           		   <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ b.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
           		   <isNotEmpty prepend=" and " property="map.store_id">b.STORE_ID= #store_id:DECIMAL#</isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id_is_null">b.STORE_ID is null</isNotEmpty>
           		   and b.pd_id = #map.pd_id# and b.update_type = 0 and b.dept_id = #map.dept_id#) y,
       		   (select decode(sum(d.update_num * d.cur_cost_price), null, 0, sum(d.update_num * d.cur_cost_price)) as xs_money, decode(sum(d.update_num), null, 0, sum(d.update_num)) as xs_count
          		 from KONKA_JXC_STORE_UPDATE_RECORD d 
         		where 1 = 1
           		  <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ d.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
           		 <isNotEmpty prepend=" and " property="map.store_id">d.STORE_ID= #store_id:DECIMAL#</isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id_is_null">d.STORE_ID is null</isNotEmpty>
           		  and d.pd_id = #map.pd_id# and d.update_type = 1 and d.dept_id = #map.dept_id#) z,
           	   (select decode(sum(e.update_num * e.cur_cost_price), null, 0, sum(e.update_num * e.cur_cost_price)) as pc_money, decode(sum(e.update_num), null, 0, sum(e.update_num)) as pc_count
          			from KONKA_JXC_STORE_UPDATE_RECORD e
         			where 1 = 1 
         		 <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ e.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty> 
				 <isNotEmpty prepend=" and " property="map.store_id">e.STORE_ID= #store_id:DECIMAL#</isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id_is_null">e.STORE_ID is null</isNotEmpty>	  
					   and e.pd_id = #map.pd_id# and e.update_type = 3 and e.dept_id = #map.dept_id#) q,
			   (select decode(sum(f.price_sum), null, 0, sum(f.price_sum)) as thzp_money, decode(sum(f.update_num), null, 0, sum(f.update_num)) as thzp_count
          			from KONKA_JXC_STORE_UPDATE_RECORD f
         			where 1 = 1 
         		 <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ f.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty> 
				<isNotEmpty prepend=" and " property="map.store_id">f.STORE_ID= #store_id:DECIMAL#</isNotEmpty>
         		 <isNotEmpty prepend=" and " property="map.store_id_is_null">f.STORE_ID is null</isNotEmpty>	
					   and f.pd_id = #map.pd_id# and f.update_type = 2 and f.dept_id = #map.dept_id#) m
	</select>
	
	<select id="selectKonkaJXCStockDetailsList" resultMap="konkaStockDetailsListForResult" parameterClass="konkaJxcStoreState" >
		select a.update_num as count,
       		   a.price_sum as money,
       		   price as price,
       		   a.add_date,
       		   0 as type,
       		   a.store_name
  		  from KONKA_JXC_STORE_UPDATE_RECORD a
 		 where 1=1 and a.update_type = 0 and a.dept_id = #map.dept_id# and a.pd_id = #map.pd_id#
 		   <isNotEmpty prepend=" and " property="map.store_id">a.STORE_ID= #map.store_id:DECIMAL#</isNotEmpty>
           <isNotEmpty prepend=" and " property="map.store_id_is_null">a.STORE_ID is null</isNotEmpty>	
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ a.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ a.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	       union all
	    select b.update_num as count,
       		   b.price_sum as money,
       		   cur_cost_price as price,
       		   b.add_date,
       		   1 as type,
       		   b.store_name
  		  from KONKA_JXC_STORE_UPDATE_RECORD b
	     where  1=1 and b.update_type = 1 and b.dept_id = #map.dept_id# and b.pd_id = #map.pd_id#
	       <isNotEmpty prepend=" and " property="map.store_id">b.STORE_ID= #map.store_id:DECIMAL#</isNotEmpty>
           <isNotEmpty prepend=" and " property="map.store_id_is_null">b.STORE_ID is null</isNotEmpty>	
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ b.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ b.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	   		union all
		select c.update_num as count,
       		   c.price_sum as money,
       		   price as price,
       		   c.add_date,
       		   2 as type,
       		   c.store_name
  		  from KONKA_JXC_STORE_UPDATE_RECORD c
	     where  1=1 and c.update_type = 2 and c.dept_id = #map.dept_id# and c.pd_id = #map.pd_id#
	       <isNotEmpty prepend=" and " property="map.store_id">c.STORE_ID= #map.store_id:DECIMAL#</isNotEmpty>
           <isNotEmpty prepend=" and " property="map.store_id_is_null">c.STORE_ID is null</isNotEmpty>	
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ c.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ c.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty> 
		  union all
		   select d.update_num as count,
       		   d.price_sum as money,
       		   cur_cost_price as price,
       		   d.add_date,
       		   3 as type,
       		   d.store_name
  		  from KONKA_JXC_STORE_UPDATE_RECORD d
	     where  1=1 and d.update_type = 3 and d.dept_id = #map.dept_id# and d.pd_id = #map.pd_id#
	       <isNotEmpty prepend=" and " property="map.store_id">d.STORE_ID= #map.store_id:DECIMAL#</isNotEmpty>
           <isNotEmpty prepend=" and " property="map.store_id_is_null">d.STORE_ID is null</isNotEmpty>	
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ d.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ d.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty> 
		   order by add_date asc
	</select>
	
	<select id="selectKonkaJxcStoreStateCount" resultClass="long" parameterClass="konkaJxcStoreState" >
		select count(*) from KONKA_JXC_STORE_STATE a where 1 = 1
		<include refid="sf-konkaJxcStoreState" />
	</select>

	<select id="selectKonkaJxcStoreStatePaginatedList" resultMap="konkaJxcStoreStateResult" parameterClass="konkaJxcStoreState" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.* from KONKA_JXC_STORE_STATE a where 1 = 1
		<include refid="sf-konkaJxcStoreState" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaJxcStoreState" parameterClass="konkaJxcStoreState">
		<selectKey resultClass="long" keyProperty="id">select SEQ_KONKA_JXC.nextval as id from dual</selectKey>
		<![CDATA[insert into KONKA_JXC_STORE_STATE (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="store_id">STORE_ID</isNotNull>	
			<isNotNull prepend="," property="pd_type_id">PD_TYPE_ID</isNotNull>	
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME</isNotNull>	
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>	
			<isNotNull prepend="," property="brand_name">BRAND_NAME</isNotNull>	
			<isNotNull prepend="," property="pd_id">PD_ID</isNotNull>	
			<isNotNull prepend="," property="pd_name">PD_NAME</isNotNull>	
			<isNotNull prepend="," property="pd_length">PD_LENGTH</isNotNull>	
			<isNotNull prepend="," property="pd_width">PD_WIDTH</isNotNull>	
			<isNotNull prepend="," property="pd_height">PD_HEIGHT</isNotNull>	
			<isNotNull prepend="," property="pd_unit">PD_UNIT</isNotNull>	
			<isNotNull prepend="," property="pd_weight">PD_WEIGHT</isNotNull>	
			<isNotNull prepend="," property="pd_weight_unit">PD_WEIGHT_UNIT</isNotNull>	
			<isNotNull prepend="," property="pd_num">PD_NUM</isNotNull>	
			<isNotNull prepend="," property="pd_bad_num">PD_BAD_NUM</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="update_date">UPDATE_DATE</isNotNull>	
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID</isNotNull>	
			<isNotNull prepend="," property="del_date">DEL_DATE</isNotNull>	
			<isNotNull prepend="," property="del_user_id">DEL_USER_ID</isNotNull>
			
			<isNotNull prepend="," property="dept_name">DEPT_NAME</isNotNull>
			<isNotNull prepend="," property="store_name">STORE_NAME</isNotNull>
			<isNotNull prepend="," property="price">PRICE</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">CUR_COST_PRICE</isNotNull>
			
			<isNotNull prepend="," property="price_ref">PRICE_REF</isNotNull>
			<isNotNull prepend="," property="price_pf">PRICE_PF</isNotNull>
			<isNotNull prepend="," property="price_ls">PRICE_LS</isNotNull>
			<isNotNull prepend="," property="init_count">INIT_COUNT</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="store_id">#store_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_id">#pd_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">#pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">#brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_id">#pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_name">#pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_length">#pd_length:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_width">#pd_width:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_height">#pd_height:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_unit">#pd_unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_weight">#pd_weight:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_weight_unit">#pd_weight_unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_num">#pd_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_bad_num">#pd_bad_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_date">#update_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="update_user_id">#update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">#del_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="del_user_id">#del_user_id:DECIMAL#</isNotNull>
			
			<isNotNull prepend="," property="dept_name">#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="store_name">#store_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">#cur_cost_price:DECIMAL#</isNotNull>
			
			<isNotNull prepend="," property="price_ref">#price_ref:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_pf">#price_pf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_ls">#price_ls:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="init_count">#init_count:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaJxcStoreState" parameterClass="konkaJxcStoreState">
		update KONKA_JXC_STORE_STATE
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="store_id">STORE_ID = #store_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_id">PD_TYPE_ID = #pd_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_length">PD_LENGTH = #pd_length:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_width">PD_WIDTH = #pd_width:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_height">PD_HEIGHT = #pd_height:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_unit">PD_UNIT = #pd_unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_weight">PD_WEIGHT = #pd_weight:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_weight_unit">PD_WEIGHT_UNIT = #pd_weight_unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_num">PD_NUM = #pd_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_bad_num">PD_BAD_NUM = #pd_bad_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_date">UPDATE_DATE = #update_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="del_date">DEL_DATE = #del_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="del_user_id">DEL_USER_ID = #del_user_id:DECIMAL#</isNotNull>
			
			<isNotNull prepend="," property="dept_name">DEPT_NAME=#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="store_name">STORE_NAME=#store_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="price">PRICE=#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">CUR_COST_PRICE=#cur_cost_price:DECIMAL#</isNotNull>
			
			<isNotNull prepend="," property="price_ref">PRICE_REF=#price_ref:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_pf">PRICE_PF=#price_pf:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_ls">PRICE_LS=#price_ls:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="init_count">INIT_COUNT=#init_count:DECIMAL#</isNotNull>
		</dynamic>
		where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id">BRAND_ID = #map.brand_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_id">PD_ID = #map.pd_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.store_id">STORE_ID = #map.store_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_id">PD_TYPE_ID = #map.pd_type_id#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">DEPT_ID = #map.dept_id#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaJxcStoreState" parameterClass="konkaJxcStoreState">
		delete from KONKA_JXC_STORE_STATE where 1 = 1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" and " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>