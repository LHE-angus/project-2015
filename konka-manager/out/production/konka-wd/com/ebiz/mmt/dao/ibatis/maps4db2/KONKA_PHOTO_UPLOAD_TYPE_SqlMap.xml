<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_PHOTO_UPLOAD_TYPE">

	<typeAlias alias="konkaPhotoUploadType" type="com.ebiz.mmt.domain.KonkaPhotoUploadType" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaPhotoUploadType" />
		<flushOnExecute statement="updateKonkaPhotoUploadType" />
		<flushOnExecute statement="deleteKonkaPhotoUploadType" />
	</cacheModel>

	<resultMap id="konkaPhotoUploadTypeResultForList" class="konkaPhotoUploadType">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="TYPE_TILTE" property="type_tilte" jdbcType="VARCHAR" />
		<result column="TYPE_MEMO" property="type_memo" jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="ADD_USER_NAME" property="add_user_name" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="UPDATE_USER_ID" property="update_user_id" jdbcType="DECIMAL" />
		<result column="UPDATE_USER_NAME" property="update_user_name" jdbcType="VARCHAR" />
		<result column="UPDATE_DATE" property="update_date" jdbcType="TIMESTAMP" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
	</resultMap>
	


	<resultMap id="konkaPhotoUploadTypeResult" class="konkaPhotoUploadType" extends="konkaPhotoUploadTypeResultForList">
	</resultMap>
	
	<resultMap id="konkaPhotoUploadTypeForDeptResult" class="konkaPhotoUploadType" extends="konkaPhotoUploadTypeResultForList">
	<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="konkaPhotoUploadTypeForDept" class="konkaPhotoUploadType" extends="konkaPhotoUploadTypeResultForList">
	<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
	</resultMap>
	

	<sql id="sf-konkaPhotoUploadType">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_tilte">TYPE_TILTE = #type_tilte:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_memo">TYPE_MEMO = #type_memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_name">UPDATE_USER_NAME = #update_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">STATE = #state:DECIMAL#</isNotEmpty>
	</sql>
	
	<sql id="sf-konkaPhotoUploadType-a">
		<isNotEmpty prepend=" and " property="id">type.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_tilte">type.TYPE_TILTE = #type_tilte:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_memo">type.TYPE_MEMO = #type_memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remark">type.REMARK = #remark:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">type.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">type.ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">type.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_id">type.UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_user_name">type.UPDATE_USER_NAME = #update_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="update_date">type.UPDATE_DATE = #update_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">type.STATE = #state:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.add_date_s"><![CDATA[ type.ADD_DATE >= to_date(#map.add_date_s#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_e"><![CDATA[ type.ADD_DATE <= to_date(#map.add_date_e#,'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.type_tilte_like">type.TYPE_TILTE like '%'|| #map.type_tilte_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_name">type.DEPT_NAME like '%'|| #map.dept_name# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_id">dept.DEPT_ID = #map.dept_id:DECIMAL#</isNotEmpty>
	</sql>

	<select id="selectKonkaPhotoUploadType" resultMap="konkaPhotoUploadTypeResult" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		select * from KONKA_PHOTO_UPLOAD_TYPE where 1 = 1
		<include refid="sf-konkaPhotoUploadType" />
	</select>

	<select id="selectKonkaPhotoUploadTypeList" resultMap="konkaPhotoUploadTypeResultForList" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_PHOTO_UPLOAD_TYPE where 1 = 1
		<include refid="sf-konkaPhotoUploadType" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaPhotoUploadTypeCount" resultClass="long" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		select count(*) from KONKA_PHOTO_UPLOAD_TYPE where 1 = 1
		<include refid="sf-konkaPhotoUploadType" />
	</select>

	<select id="selectKonkaPhotoUploadTypePaginatedList" resultMap="konkaPhotoUploadTypeResult" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_PHOTO_UPLOAD_TYPE where 1 = 1
		<include refid="sf-konkaPhotoUploadType" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaPhotoUploadTypeForDept" resultMap="konkaPhotoUploadTypeForDept" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		SELECT type.*,(select
		listagg(f.DEPT_NAME, ',') within group (order by
		f.TYPE_ID)
		from
		KONKA_PHOTO_UPLOAD_TYPE_DEPT f
		where
		f.TYPE_ID=type.ID
		group by
		TYPE_ID)dept_name from KONKA_PHOTO_UPLOAD_TYPE type where 1=1
		<include refid="sf-konkaPhotoUploadType-a" />
	</select>
	
	<select id="selectKonkaPhotoUploadTypeForDeptPaginatedListCount" resultClass="long" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		select count(*) from(
		SELECT type1.*,(select
		listagg(f.DEPT_NAME, ',') within group (order by
		f.TYPE_ID)
		from
		KONKA_PHOTO_UPLOAD_TYPE_DEPT f
		where
		f.TYPE_ID=type1.ID
		group by
		TYPE_ID)dept_name from KONKA_PHOTO_UPLOAD_TYPE type1) type 
<!--		left join KONKA_PHOTO_UPLOAD_TYPE_DEPT dept on type.ID=dept.TYPE_ID -->
		where 1=1
		<include refid="sf-konkaPhotoUploadType-a" />
	</select>
	
	<select id="selectKonkaPhotoUploadTypeForDeptPaginatedList" resultMap="konkaPhotoUploadTypeForDeptResult" parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select type.* from(
		SELECT type1.*,(select
		listagg(f.DEPT_NAME, ',') within group (order by
		f.TYPE_ID)
		from
		KONKA_PHOTO_UPLOAD_TYPE_DEPT f
		where
		f.TYPE_ID=type1.ID
		group by
		TYPE_ID)dept_name from KONKA_PHOTO_UPLOAD_TYPE type1) type 
<!--		left join KONKA_PHOTO_UPLOAD_TYPE_DEPT dept on type.ID=dept.TYPE_ID -->
		where 1=1
		<include refid="sf-konkaPhotoUploadType-a" />
		 order by type.ADD_DATE desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

    <!--根据当前用户的部门查找可视拍照类型-->
	<select id="selectVisiblePhotoType" resultClass="HashMap"
		parameterClass="konkaPhotoUploadType" cacheModel="oneDayCache">
		SELECT type.ID, type.TYPE_TILTE
		  FROM    KONKA_PHOTO_UPLOAD_TYPE type
		       LEFT JOIN
		          KONKA_PHOTO_UPLOAD_TYPE_DEPT pd
		       ON type.ID = pd.TYPE_ID
		 WHERE 1=1
		        <isNotEmpty  prepend=" and " property="map.state">
		            type.state=0
		        </isNotEmpty>
				<isNotEmpty prepend=" and " property="map.dept_id">
					pd.DEPT_ID=#map.dept_id:DECIMAL#
		        </isNotEmpty>
		GROUP BY type.ID, type.TYPE_TILTE
	</select>


	<insert id="insertKonkaPhotoUploadType" parameterClass="konkaPhotoUploadType">
		<selectKey resultClass="long" keyProperty="id">select KONKA_PHOTO_UPLOAD_TYPE_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into KONKA_PHOTO_UPLOAD_TYPE (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="type_tilte">TYPE_TILTE</isNotNull>	
			<isNotNull prepend="," property="type_memo">TYPE_MEMO</isNotNull>	
			<isNotNull prepend="," property="remark">REMARK</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID</isNotNull>	
			<isNotNull prepend="," property="update_user_name">UPDATE_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="update_date">UPDATE_DATE</isNotNull>	
			<isNotNull prepend="," property="state">STATE</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="type_tilte">#type_tilte:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_memo">#type_memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="remark">#remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">#add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">#update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_user_name">#update_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">#update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="state">#state:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaPhotoUploadType" parameterClass="KonkaPhotoUploadType">
		update KONKA_PHOTO_UPLOAD_TYPE
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="type_tilte">TYPE_TILTE = #type_tilte:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_memo">TYPE_MEMO = #type_memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="remark">REMARK = #remark:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="update_user_id">UPDATE_USER_ID = #update_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="update_user_name">UPDATE_USER_NAME = #update_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="update_date">UPDATE_DATE = #update_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="state">STATE = #state:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaPhotoUploadType" parameterClass="KonkaPhotoUploadType">
		delete from KONKA_PHOTO_UPLOAD_TYPE where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>