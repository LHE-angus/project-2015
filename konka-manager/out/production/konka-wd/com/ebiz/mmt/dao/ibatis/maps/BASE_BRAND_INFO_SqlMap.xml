<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="BASE_BRAND_INFO">
	<typeAlias alias="baseBrandInfo" type="com.ebiz.mmt.domain.BaseBrandInfo" />
	<resultMap id="baseBrandInfoResultForList" class="baseBrandInfo">
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="BRAND_LOGO" property="brand_logo" jdbcType="VARCHAR" />
		<result column="BRAND_NAME_CN" property="brand_name_cn" jdbcType="VARCHAR" />
		<result column="BRAND_NAME_EN" property="brand_name_en" jdbcType="VARCHAR" />
		<result column="ORDER_SORT" property="order_sort" jdbcType="DECIMAL" />
		<result column="IS_LOCK" property="is_lock" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
		<result column="SUM_HAVE" property="sum_have" jdbcType="DECIMAL" />
		<result column="SUM_WANT" property="sum_want" jdbcType="DECIMAL" />
		<result column="SUM_SCAN" property="sum_scan" jdbcType="DECIMAL" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="STD_BRAND_ID" property="std_brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_SN" property="brand_sn" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="baseBrandInfoResult" class="baseBrandInfo" extends="baseBrandInfoResultForList"></resultMap>
	<resultMap id="baseBrandInfoForEntpProdResult" class="baseBrandInfo" extends="baseBrandInfoResultForList">
		<result column="entp_name" property="map.entp_name" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="baseBrandInfoForEntpShop" class="baseBrandInfo" extends="baseBrandInfoResultForList">
		<result column="shop_name" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="pd_type_sign" property="map.pd_type_sign" jdbcType="VARCHAR" />
		<result column="add_date" property="map.add_date" jdbcType="DATE" />
	</resultMap>
	<resultMap id="baseBrandInfoForjoinEntpProdResult" class="baseBrandInfo">
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="prod_name" property="map.prod_name" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="sf-baseBrandInfo">
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name_cn">BRAND_NAME_CN = #brand_name_cn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name_en">BRAND_NAME_EN = #brand_name_en:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_name_like">BRAND_NAME like '%' || #map.brand_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_logo">BRAND_LOGO = #brand_logo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_sort">ORDER_SORT = #order_sort:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_lock">IS_LOCK = #is_lock:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="birthday">BIRTHDAY = #birthday:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sum_have">SUM_HAVE = #sum_have:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sum_want">SUM_WANT = #sum_want:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sum_scan">SUM_SCAN = #sum_scan:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="std_brand_id">STD_BRAND_ID = #std_brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_sn">BRAND_SN = #brand_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign">BRAND_ID in (select distinct brand_id from koka_base_brand t where
			t.del_mark=0 and t.pd_type in (
			select distinct t1.pd_type from konka_base_pd_type t1 where
			t1.pd_type_sign=#map.pd_type_sign:VARCHAR#
			))
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type">BRAND_ID in (select distinct brand_id from konka_base_brand t
			where t.del_mark=0 and t.pd_type = #map.pd_type:DECIMAL#)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_big_type">BRAND_ID in (
			select brand_id from konka_mv_pd_type_join_brand t
			where t.pd_type = #map.pd_big_type:DECIMAL#
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id_in">
			BRAND_ID in
			<iterate close=")" open="(" conjunction="," property="map.brand_id_in">#map.brand_id_in[]#</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.en_name_by_letter">UPPER(substr(BRAND_NAME_EN,1,1)) = #map.en_name_by_letter:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_name_like">BRAND_NAME like '%' || #map.brand_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.have_logo">BRAND_LOGO is not null</isNotEmpty>
	</sql>
	<select id="selectBaseBrandInfo" resultMap="baseBrandInfoResult" parameterClass="baseBrandInfo">
		select * from KONKA_BASE_BRAND_INFO where 1 = 1
		<include refid="sf-baseBrandInfo" />
	</select>
	<select id="selectBaseBrandInfoByPdType" resultMap="baseBrandInfoResult" parameterClass="baseBrandInfo">
		SELECT
		*
		FROM
		KONKA_BASE_BRAND_INFO
		WHERE
		1 = 1
		<include refid="sf-baseBrandInfo" />
		AND (brand_id in (select brand_id from konka_base_brand where pd_type in (select pd_type from konka_base_pd_type where is_model = 0
		<isNotEmpty prepend=" AND " property="map.mTypes">pd_type_sign = #map.mTypes#</isNotEmpty>
		<isEmpty prepend=" AND " property="map.mTypes">pd_type_sign in null</isEmpty>
		))
		<isNotEmpty prepend=" and " property="map.en_name_by_letter">UPPER(substr(BRAND_NAME_EN,1,1)) = #map.en_name_by_letter:VARCHAR#</isNotEmpty>
		)
	</select>
	<select id="selectBaseBrandInfoList" resultMap="baseBrandInfoResultForList" parameterClass="baseBrandInfo">
		<isNotEmpty property="row.count">
      <![CDATA[select * from (]]>
		</isNotEmpty>
		select * from
		<isNotEmpty prepend=" " property="map.MMTDBUser">chea_fill.BASE_BRAND_INFO</isNotEmpty>
		<isEmpty prepend=" " property="map.MMTDBUser">KONKA_BASE_BRAND_INFO</isEmpty>
		where 1 = 1
		<include refid="sf-baseBrandInfo" />
		order by order_sort desc nulls last , brand_name, brand_id desc
		<isNotEmpty property="row.count">
      <![CDATA[) where rownum <= #row.count#]]>
		</isNotEmpty>
	</select>
	<select id="selectBaseBrandInfoForEntpShopList" resultMap="baseBrandInfoForEntpShop" parameterClass="baseBrandInfo">
		<isNotEmpty property="row.count">
      <![CDATA[select * from (]]>
		</isNotEmpty>
		select * from(
		select distinct t2.shop_name, t2.pd_type_sign,t2.add_date , t3.* from
		ENTP_SHOP t1,
		KONKA_ENTP_SHOP_BRAND t2,
		KONKA_BASE_BRAND_INFO t3
		where 1=1
		<isNotEmpty prepend=" and " property="map.shop_type">t1.shop_type=#map.shop_type#</isNotEmpty>
		and t1.state = 0
		and t2.is_del = 0
		and t3.IS_DEL = 0
		and t1.shop_id = t2.shop_id
		and t2.brand_id = t3.brand_id
		<isNotEmpty prepend=" and " property="map.pd_type_sign">t2.pd_type_sign =#map.pd_type_sign#</isNotEmpty>
		) order by order_sort desc nulls last , add_date desc
		<isNotEmpty property="row.count">
      <![CDATA[) where rownum <= #row.count#]]>
		</isNotEmpty>
	</select>
	<select id="selectBaseBrandInfoCount" resultClass="long" parameterClass="baseBrandInfo">
		select count(*) from KONKA_BASE_BRAND_INFO where 1 = 1
		<include refid="sf-baseBrandInfo" />
	</select>
	<select id="selectBaseBrandInfoPaginatedList" resultMap="baseBrandInfoResult" parameterClass="baseBrandInfo">
    <![CDATA[select * from ( select t_.*, rownum rn_ from (]]>
		select * from KONKA_BASE_BRAND_INFO where 1 = 1
		<include refid="sf-baseBrandInfo" />
		order by order_sort desc nulls last , brand_name, brand_id desc
    <![CDATA[) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1)]]>
	</select>

	<!-- MMT后台管理 品牌生产企业管理 coding by Chen,LiLin 2011-1-24 -->
	<select id="selectBaseBrandInfoForjoinEntpProdCount" resultClass="long" parameterClass="baseBrandInfo">select count(*) from (
		select count(1)
		from konka_base_brand_info b
		full join std_entp_prod_join_brand_id j on b.brand_id = j.brand_id
		left join konka_std_entp_prod s on j.entp_id = s.entp_id
		and j.own_sys =
		s.own_sys
		where b.brand_id is not null and s.entp_id is not null and s.entp_name is not null
		group by b.brand_id,b.brand_name )
	</select>

	<!-- MMT后台管理 品牌生产企业管理 coding by Du,HongGang 2010-10-25 -->
	<select id="selectBaseBrandInfoForjoinEntpProdList" resultMap="baseBrandInfoForjoinEntpProdResult" parameterClass="baseBrandInfo">
    <![CDATA[select * from ( select t_.*, rownum rn_ from (]]>
		select b.brand_id,b.brand_name,to_char(wm_concat(s.entp_name)) as prod_name,to_char(wm_concat(s.entp_id)) as prod_entp_ids
		from konka_base_brand_info b
		full join std_entp_prod_join_brand_id j on b.brand_id = j.brand_id
		left join konka_std_entp_prod s on j.entp_id = s.entp_id
		and j.own_sys = s.own_sys
		where b.brand_id is not null and s.entp_id is not null and s.entp_name is not null
		group by b.brand_id,b.brand_name
		order by prod_name,b.brand_id
    <![CDATA[) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1)]]>
	</select>
	<select id="selectBaseBrandInfoForjoinEntpProd" resultMap="baseBrandInfoForjoinEntpProdResult" parameterClass="baseBrandInfo">
		select b.brand_id,b.brand_name,to_char(wm_concat(s.entp_name)) as prod_name,to_char(wm_concat(s.entp_id)) as prod_entp_ids
		from konka_base_brand_info b
		full join std_entp_prod_join_brand_id j on b.brand_id = j.brand_id
		left join konka_std_entp_prod s on j.entp_id = s.entp_id
		and j.own_sys = s.own_sys
		where 1 = 1
		<isNotEmpty prepend=" and " property="brand_id">b.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		group by b.brand_id,b.brand_name
	</select>

	<!-- MMT分析系统 家电品牌排行 coding by Du,HongGang 2010-11-16 -->
	<select id="selectBaseBrandInfoForPopList" resultMap="baseBrandInfoResultForList" parameterClass="baseBrandInfo">
		<isNotEmpty property="row.count">
      <![CDATA[select * from (]]>
		</isNotEmpty>
		select b.*
		from konka_base_brand_info b
		right join (select brand_id, sales
		from (select pd_type, brand_id, sum(m.brand_sales) as sales
		from mdas_shop_brand_sales m
		where m.brand_id is not null
		<isNotEmpty prepend=" and " property="map.pd_type">m.pd_type = #map.pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.c_year">m.c_year = #map.c_year:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.c_month">m.c_month = #map.c_month:VARCHAR#</isNotEmpty>
		group by pd_type, brand_id
		order by sales desc)
    <![CDATA[where rownum <= 10]]>
		) br on br.brand_id = b.brand_id where b.brand_id is not null
		order by sales desc
		<isNotEmpty property="row.count">
      <![CDATA[) where rownum <= #row.count#]]>
		</isNotEmpty>
	</select>
	<insert id="insertBaseBrandInfo" parameterClass="baseBrandInfo">
		<selectKey resultClass="long" keyProperty="brand_id">select brand_sequence.nextval as brand_id from dual</selectKey>
    <![CDATA[insert into KONKA_BASE_BRAND_INFO (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME</isNotNull>
			<isNotNull prepend="," property="brand_name_cn">BRAND_NAME_CN</isNotNull>
			<isNotNull prepend="," property="brand_name_en">BRAND_NAME_EN</isNotNull>
			<isNotNull prepend="," property="brand_logo">BRAND_LOGO</isNotNull>
			<isNotNull prepend="," property="order_sort">ORDER_SORT</isNotNull>
			<isNotNull prepend="," property="is_lock">IS_LOCK</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>
			<isNotNull prepend="," property="birthday">BIRTHDAY</isNotNull>
			<isNotNull prepend="," property="sum_have">SUM_HAVE</isNotNull>
			<isNotNull prepend="," property="sum_want">SUM_WANT</isNotNull>
			<isNotNull prepend="," property="sum_scan">SUM_SCAN</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>
			<isNotNull prepend="," property="std_brand_id">STD_BRAND_ID</isNotNull>
			<isNotNull prepend="," property="brand_sn">BRAND_SN</isNotNull>
		</dynamic>
    <![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">#brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name_cn">#brand_name_cn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name_en">#brand_name_en:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_logo">#brand_logo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_sort">#order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_lock">#is_lock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="birthday">#birthday:DATE#</isNotNull>
			<isNotNull prepend="," property="sum_have">#sum_have:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_want">#sum_want:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_scan">#sum_scan:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="std_brand_id">#std_brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_sn">#brand_sn:VARCHAR#</isNotNull>
		</dynamic>
    <![CDATA[)]]>
	</insert>
	<update id="updateBaseBrandInfo" parameterClass="baseBrandInfo">
		update KONKA_BASE_BRAND_INFO
		<dynamic prepend="set">
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name_cn">BRAND_NAME_CN = #brand_name_cn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_name_en">BRAND_NAME_EN = #brand_name_en:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_logo">BRAND_LOGO = #brand_logo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="order_sort">ORDER_SORT = #order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_lock">IS_LOCK = #is_lock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="birthday">BIRTHDAY = #birthday:DATE#</isNotNull>
			<isNotNull prepend="," property="sum_have">SUM_HAVE = #sum_have:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_want">SUM_WANT = #sum_want:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sum_scan">SUM_SCAN = #sum_scan:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="std_brand_id">STD_BRAND_ID = #std_brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_sn">BRAND_SN = #brand_sn:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="brand_id">BRAND_ID = #brand_id#</isNotEmpty>
		<isEmpty prepend=" " property="brand_id">
			<isNotEmpty prepend=" " property="map.pks">
				BRAND_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>
	<delete id="deleteBaseBrandInfo" parameterClass="baseBrandInfo">
		update KONKA_BASE_BRAND_INFO set is_del=1 where
		<isNotEmpty prepend=" " property="brand_id">BRAND_ID = #brand_id#</isNotEmpty>
		<isEmpty prepend=" " property="brand_id">
			<isNotEmpty prepend=" " property="map.pks">
				BRAND_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
</sqlMap>
