<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="EC_BCOMP_PD_REBATES">

	<typeAlias alias="ecBcompPdRebates" type="com.ebiz.mmt.domain.EcBcompPdRebates" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertEcBcompPdRebates" />
		<flushOnExecute statement="updateEcBcompPdRebates" />
		<flushOnExecute statement="deleteEcBcompPdRebates" />
	</cacheModel>

	<resultMap id="ecBcompPdRebatesResultForList" class="ecBcompPdRebates">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="GOODS_ID" property="goods_id" jdbcType="DECIMAL" />
		<result column="B_TYPE" property="b_type" jdbcType="DECIMAL" />
		<result column="B_VALUE" property="b_value" jdbcType="DECIMAL" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ADD_U_ID" property="add_u_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="MODIFY_U_ID" property="modify_u_id" jdbcType="DECIMAL" />
		<result column="MODIFY_DATE" property="modify_date" jdbcType="TIMESTAMP" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="C_ID" property="c_id" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="ecBcompPdRebatesResult" class="ecBcompPdRebates" extends="ecBcompPdRebatesResultForList">
	</resultMap>
	
	<resultMap id="ecBcompPdRebatesResultForPdList" class="ecBcompPdRebates" extends="ecBcompPdRebatesResultForList">
		<result column="PD_SN" property="map.pd_sn" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-ecBcompPdRebates">
		<isNotEmpty prepend=" and " property="id">t.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_id">t.GOODS_ID = #goods_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="b_type">t.B_TYPE = #b_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="b_value">t.B_VALUE = #b_value:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">t.REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">t.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_u_id">t.ADD_U_ID = #add_u_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">t.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="modify_u_id">t.MODIFY_U_ID = #modify_u_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="modify_date">t.MODIFY_DATE = #modify_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">t.OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">t.C_ID = #c_id:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.dept_sn">a.DEPT_SN = #map.dept_sn#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.dept_sn_in">a.DEPT_SN in ($map.dept_sn_in$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_sn_like">a.PD_SN like '%' || #map.pd_sn_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_name_like">a.PD_NAME like '%' || #map.pd_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.own_sys">a.OWN_SYS = #map.own_sys#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.state">a.STATE = #map.state#</isNotEmpty>
	
	</sql>

	<select id="selectEcBcompPdRebates" resultMap="ecBcompPdRebatesResult" parameterClass="ecBcompPdRebates" cacheModel="oneDayCache">
		select t.* from EC_BCOMP_PD_REBATES t where 1 = 1
		<include refid="sf-ecBcompPdRebates" />
	</select>

	<select id="selectEcBcompPdRebatesList" resultMap="ecBcompPdRebatesResultForList" parameterClass="ecBcompPdRebates" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select t.* from EC_BCOMP_PD_REBATES t where 1 = 1
		<include refid="sf-ecBcompPdRebates" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectEcBcompPdRebatesCount" resultClass="long" parameterClass="ecBcompPdRebates" cacheModel="oneDayCache">
		select count(t.id) from EC_BCOMP_PD_REBATES t, KONKA_BCOMP_PD a where 1 = 1 and t.GOODS_ID = a.ID
		<include refid="sf-ecBcompPdRebates" />
		<isNotEmpty prepend=" and " property="map.own_sys_in_01">
		 t.goods_id in(select BCOMP_PD_ID from EC_BCOMP_PD_UP u where u.own_sys=1 and u.ADDED_DEPT_ID = 0
			 <isNotEmpty  prepend=" and "  property="map.is_upSelf">
			<![CDATA[ u.down_time > sysdate ]]>
			</isNotEmpty>
		 )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.own_sys_eq">
			a.own_sys = #map.own_sys_eq#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_name_eq">
			upper(a.pd_sn) = upper(#map.pd_name_eq#)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_name_not_eq">
			1=2
		</isNotEmpty>
	</select>

	<select id="selectEcBcompPdRebatesPaginatedList" resultMap="ecBcompPdRebatesResultForPdList" parameterClass="ecBcompPdRebates" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,a.pd_sn,a.pd_name from EC_BCOMP_PD_REBATES t, KONKA_BCOMP_PD a where 1 = 1 and t.GOODS_ID = a.ID
		<include refid="sf-ecBcompPdRebates" />
		<isNotEmpty prepend=" and " property="map.own_sys_in_01">
		 t.goods_id in(select BCOMP_PD_ID from EC_BCOMP_PD_UP u where u.own_sys=1 and u.ADDED_DEPT_ID = 0
			 <isNotEmpty  prepend=" and "  property="map.is_upSelf">
			<![CDATA[ u.down_time > sysdate ]]>
			</isNotEmpty>
		 )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.own_sys_eq">
			a.own_sys = #map.own_sys_eq#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_name_eq">
			upper(a.pd_sn) = upper(#map.pd_name_eq#)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_name_not_eq">
			1=2
		</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<insert id="insertEcBcompPdRebates" parameterClass="ecBcompPdRebates">
		<selectKey resultClass="long" keyProperty="id">select SHOP_SEQUENCE.nextval as id from dual </selectKey>
		<![CDATA[insert into EC_BCOMP_PD_REBATES (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="goods_id">GOODS_ID</isNotNull>	
			<isNotNull prepend="," property="b_type">B_TYPE</isNotNull>	
			<isNotNull prepend="," property="b_value">B_VALUE</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="add_u_id">ADD_U_ID</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="modify_u_id">MODIFY_U_ID</isNotNull>	
			<isNotNull prepend="," property="modify_date">MODIFY_DATE</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID</isNotNull>		
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_id">#goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="b_type">#b_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="b_value">#b_value:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_u_id">#add_u_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="modify_u_id">#modify_u_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="modify_date">#modify_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">#c_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateEcBcompPdRebates" parameterClass="EcBcompPdRebates">
		update EC_BCOMP_PD_REBATES
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_id">GOODS_ID = #goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="b_type">B_TYPE = #b_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="b_value">B_VALUE = #b_value:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_u_id">ADD_U_ID = #add_u_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="modify_u_id">MODIFY_U_ID = #modify_u_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="modify_date">MODIFY_DATE = #modify_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID = #c_id:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteEcBcompPdRebates" parameterClass="EcBcompPdRebates">
		delete from EC_BCOMP_PD_REBATES where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>