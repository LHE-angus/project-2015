<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_XX_ZMD">

	<typeAlias alias="konkaXxZmd" type="com.ebiz.mmt.domain.KonkaXxZmd" />

	<resultMap id="konkaXxZmdResultForList" class="konkaXxZmd">
		<result column="ZMD_ID" property="zmd_id" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="ZMD_SN" property="zmd_sn" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="ADDR" property="addr" jdbcType="VARCHAR" />
		<result column="R3_ID" property="r3_id" jdbcType="VARCHAR" />
		<result column="BUSI_AREA" property="busi_area" jdbcType="DECIMAL" />
		<result column="RENT_START" property="rent_start" jdbcType="DATETIME" />
		<result column="RENT_END" property="rent_end" jdbcType="DATETIME" />
		<result column="RENT_FEE" property="rent_fee" jdbcType="DECIMAL" />
		<result column="BUSI_TYPE" property="busi_type" jdbcType="DECIMAL" />
		<result column="MONEY_OF_SELL_BY_YEAR_PLAN" property="money_of_sell_by_year_plan" jdbcType="DECIMAL" />
		<result column="HOST_ID" property="host_id" jdbcType="DECIMAL" />
		<result column="HOST_NAME" property="host_name" jdbcType="VARCHAR" />
		<result column="HOST_PHONE" property="host_phone" jdbcType="VARCHAR" />
		<result column="DEPT_LEADER_NAME" property="dept_leader_name" jdbcType="VARCHAR" />
		<result column="DEPT_LEADER_PHONE" property="dept_leader_phone" jdbcType="VARCHAR" />
		<result column="MONEY_OF_DCRT_APPLY" property="money_of_dcrt_apply" jdbcType="DECIMAL" />
		<result column="PUT_RES_PLAN" property="put_res_plan" jdbcType="VARCHAR" />
		<result column="MONEY_OF_DM_APPLY" property="money_of_dm_apply" jdbcType="DECIMAL" />
		<result column="PUT_DM_PLAN" property="put_dm_plan" jdbcType="VARCHAR" />
		<result column="DEPT_MAIN_MAN" property="dept_main_man" jdbcType="VARCHAR" />
		<result column="DEPT_FNC_MAN" property="dept_fnc_man" jdbcType="VARCHAR" />
		<result column="BUSI_USER_ID" property="busi_user_id" jdbcType="DECIMAL" />
		<result column="WRITE_MAN_ID" property="write_man_id" jdbcType="DECIMAL" />
		<result column="WRITE_MAN" property="write_man" jdbcType="VARCHAR" />
		<result column="APPLY_DATE" property="apply_date" jdbcType="DATETIME" />
		<result column="ARC_STATE" property="arc_state" jdbcType="DECIMAL" />
		<result column="AUDIT_USER_ID" property="audit_user_id" jdbcType="DECIMAL" />
		<result column="AUDIT_USER_NAME" property="audit_user_name" jdbcType="VARCHAR" />
		<result column="AUDIT_DATE" property="audit_date" jdbcType="DATETIME" />
		<result column="AUDIT_COMMENT" property="audit_comment" jdbcType="VARCHAR" />
		<result column="MONEY_OF_DCRT" property="money_of_dcrt" jdbcType="DECIMAL" />
		<result column="FIXED_ASSET" property="fixed_asset" jdbcType="VARCHAR" />
		<result column="MONEY_OF_DEPOSIT" property="money_of_deposit" jdbcType="DECIMAL" />
		<result column="IS_OPEN" property="is_open" jdbcType="DECIMAL" />
	    <result column="RESERVERD_STOCK" property="reserverd_stock" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ATT_FILE_PATH" property="att_file_path" jdbcType="VARCHAR" />
		<result column="ATT_FILE_NAME" property="att_file_name" jdbcType="VARCHAR" />
		<result column="POS_SN" property="pos_sn" jdbcType="VARCHAR" />
		<result column="CUR_CREDIT_LINE" property="cur_credit_line" jdbcType="DECIMAL" />
		<result column="TOTAL_CREDIT_LINE" property="total_credit_line" jdbcType="DECIMAL" />
		<result column="R3_NAME" property="r3_name" jdbcType="VARCHAR" />
		<result column="R3_SEND_NUM" property="r3_send_num" jdbcType="VARCHAR" />
		<result column="BUSI_MOD" property="busi_mod" jdbcType="DECIMAL" />
		<result column="PUT_RES_ID" property="put_res_id" jdbcType="DECIMAL" />
		<result column="ZMD_STATUS" property="zmd_status" jdbcType="DECIMAL" />
		<result column="ZMD_USER_ID" property="zmd_user_id" jdbcType="DECIMAL" />
		<result column="CREDIT_ID" property="credit_id" jdbcType="DECIMAL" />
		<result column="AREA_ID" property="area_id" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="konkaXxZmdResult" class="konkaXxZmd" extends="konkaXxZmdResultForList">
	</resultMap>
	
	<!-- @author ,JiangJiaYong @version 2012-01-09  -->
	<resultMap id="konkaXxZmdResultIncludeRelevanceInfo" class="konkaXxZmd" extends="konkaXxZmdResultForList">
		<result column="dept_name" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="type_name" property="map.type_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- @author ,Hu,Hao @version 2013-06-20  -->
	<resultMap id="konkaXxZmdForUsersResult" class="konkaXxZmd" extends="konkaXxZmdResultForList">
		<result column="user_name" property="map.user_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- @author ,ZhengKun @version 2012-01-12  -->
	<resultMap id="konkaXxZmdResultClerk" class="konkaXxZmd" >
		<result column="user_id" property="map.user_id" jdbcType="DECIMAL" />
		<result column="real_name" property="map.real_name" jdbcType="VARCHAR" />
		<result column="role_id" property="map.role_id" jdbcType="DECIMAL" />
		<result column="role_name" property="map.role_name" jdbcType="VARCHAR" />
		<result column="zmd_sn" property="zmd_sn" jdbcType="VARCHAR" />
	</resultMap>
	
		<resultMap id="konkaXxZmdAndManagerResultForList" class="konkaXxZmd" extends="konkaXxZmdResultForList">
		<result column="user_id" property="map.manager_id" jdbcType="VARCHAR" />
	</resultMap>


	<sql id="sf-konkaXxZmd">
		<isNotEmpty prepend=" and " property="zmd_id">ZMD_ID = #zmd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_sn">ZMD_SN = #zmd_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="addr">ADDR = #addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_id">R3_ID = #r3_id:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="busi_area">BUSI_AREA = #busi_area:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="rent_start">RENT_START = #rent_start:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="rent_end">RENT_END = #rent_end:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="rent_fee">RENT_FEE = #rent_fee:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="busi_type">BUSI_TYPE = #busi_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money_of_sell_by_year_plan">MONEY_OF_SELL_BY_YEAR_PLAN = #money_of_sell_by_year_plan:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="host_id">HOST_ID = #host_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="host_name">HOST_NAME = #host_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="host_phone">HOST_PHONE = #host_phone:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_leader_name">DEPT_LEADER_NAME = #dept_leader_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_leader_phone">DEPT_LEADER_PHONE = #dept_leader_phone:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money_of_dcrt_apply">MONEY_OF_DCRT_APPLY = #money_of_dcrt_apply:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="put_res_plan">PUT_RES_PLAN = #put_res_plan:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money_of_dm_apply">MONEY_OF_DM_APPLY = #money_of_dm_apply:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="put_dm_plan">PUT_DM_PLAN = #put_dm_plan:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_main_man">DEPT_MAIN_MAN = #dept_main_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_fnc_man">DEPT_FNC_MAN = #dept_fnc_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="busi_user_id">BUSI_USER_ID = #busi_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="write_man_id">WRITE_MAN_ID = #write_man_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="write_man">WRITE_MAN = #write_man:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="apply_date">APPLY_DATE = #apply_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="arc_state">ARC_STATE = #arc_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_user_id">AUDIT_USER_ID = #audit_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_user_name">AUDIT_USER_NAME = #audit_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_date">AUDIT_DATE = #audit_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_comment">AUDIT_COMMENT = #audit_comment:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money_of_dcrt">MONEY_OF_DCRT = #money_of_dcrt:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="fixed_asset">FIXED_ASSET = #fixed_asset:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="money_of_deposit">MONEY_OF_DEPOSIT = #money_of_deposit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_open">IS_OPEN = #is_open:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="reserverd_stock">RESERVERD_STOCK = #reserverd_stock:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="att_file_path">ATT_FILE_PATH = #att_file_path:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="att_file_name">ATT_FILE_NAME = #att_file_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pos_sn">POS_SN = #pos_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cur_credit_line">CUR_CREDIT_LINE = #cur_credit_line:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="total_credit_line">TOTAL_CREDIT_LINE = #total_credit_line:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_name">R3_NAME = #r3_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_send_num">R3_SEND_NUM = #r3_send_num:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="busi_mod">BUSI_MOD = #busi_mod:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="put_res_id">PUT_RES_ID = #put_res_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_status">ZMD_STATUS = #zmd_status:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_user_id">ZMD_USER_ID = #zmd_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="credit_id">CREDIT_ID = #credit_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="area_id">AREA_ID = #area_id:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.zmd_sn_like">UPPER(ZMD_SN) like '%' || UPPER(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.arc_states">$map.arc_states$</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.user_id_eq">zmd_id in (select zmd_id from konka_xx_zmd_users where user_id = #map.user_id_eq:DECIMAL#)</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.is_not_arc_state">UPPER(arc_state) <![CDATA[<>]]> #map.is_not_arc_state#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.audit_date_start"><![CDATA[ to_char(AUDIT_DATE,'yyyy-mm-dd') >= #map.audit_date_start:VARCHAR# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.audit_date_end"><![CDATA[ to_char(AUDIT_DATE,'yyyy-mm-dd') <= #map.audit_date_end:VARCHAR# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmds">
				ZMD_ID in
				<iterate close=")" open="(" conjunction="," property="map.zmds">#map.zmds[]#</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.posNotNull">POS_SN is not null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.posIsNull">POS_SN is null</isNotEmpty>
		<isNotEmpty prepend=" or " property="map.posIn">ZMD_ID = #map.posIn#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.notIncZmd">ZMD_ID not in ($map.notIncZmd$)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pos_sn_like">POS_SN like '%' || #map.pos_sn_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmdIdNotIn">zmd_id not in (select zmd_id from konka_xx_zmd_credit_apply)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.zmdNotIn">zmd_id not in (select zmd_id from konka_xx_zmd_credit_apply where dept_id = #map.zmdNotIn#)</isNotEmpty>
	</sql>

	<select id="selectKonkaXxZmd" resultMap="konkaXxZmdResult" parameterClass="konkaXxZmd" >
		select * from KONKA_XX_ZMD where 1 = 1
		<include refid="sf-konkaXxZmd" />
	</select>

	<select id="selectKonkaXxZmdList" resultMap="konkaXxZmdResultForList" parameterClass="konkaXxZmd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_XX_ZMD where 1 = 1
		<include refid="sf-konkaXxZmd" />
		 order by ZMD_SN asc,ZMD_ID asc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaXxZmdAndManagerList" resultMap="konkaXxZmdAndManagerResultForList" parameterClass="konkaXxZmd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select t1.*,t2.user_id from konka_xx_zmd t1
		left join konka_xx_zmd_users t2 on t1.zmd_id = t2.zmd_id
		left join konka_pe_role_user t3 on t2.user_id = t3.user_id
		where t3.role_id >= 400
		<isNotEmpty prepend=" and " property="zmd_id">t1.ZMD_ID = #zmd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t1.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="zmd_sn">t1.ZMD_SN = #zmd_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">t1.P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaXxZmdCount" resultClass="long" parameterClass="konkaXxZmd" >
		select count(*) from KONKA_XX_ZMD where 1 = 1
		<include refid="sf-konkaXxZmd" />
	</select>
	
	<!--Hu,Hao  2013-06-19-->
	<select id="selectKonkaXxZmdForRoleCount" resultClass="long" parameterClass="konkaXxZmd" >
		select count(1)
  			 from konka_xx_zmd tt
  			 left join konka_xx_zmd_users t3 on tt.zmd_id = t3.zmd_id
  			 left join konka_pe_prod_user t4 on t3.user_id = t4.id
			 where 1 = 1
			 <isNotEmpty prepend=" and " property="map.zmd_fp_1"> 
			 tt.zmd_id not in
			       (select t.zmd_id
			          from konka_xx_zmd t,
			           konka_xx_zmd_users t1, 
			           konka_pe_prod_user t2,
			           konka_r3_shop t0
			           where t.zmd_id = t1.zmd_id
			           and t1.user_id = t2.id
			           and t0.id = t2.cust_id
			           )
			</isNotEmpty> 
			<isNotEmpty prepend=" and " property="map.zmd_fp_2"> 
			 tt.zmd_id in
			       (select t.zmd_id
			          from konka_xx_zmd t,
			           konka_xx_zmd_users t1, 
			           konka_pe_prod_user t2,
			           konka_r3_shop t0
			           where t.zmd_id = t1.zmd_id
			           and t1.user_id = t2.id
			           and t0.id = t2.cust_id
			           )
			  and t4.cust_id is not null
			</isNotEmpty> 
			  and r3_id is not null
			<isNotEmpty prepend=" and " property="dept_id">tt.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.zmd_sn_like">UPPER(tt.ZMD_SN) like '%' || UPPER(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
	</select>
	
	<!--Hu,Hao  2013-06-19-->
	<select id="selectKonkaXxZmdForRolePaginatedList" resultMap="konkaXxZmdForUsersResult" parameterClass="konkaXxZmd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select tt.*,t4.user_name
  			 from konka_xx_zmd tt
  			 left join konka_xx_zmd_users t3 on tt.zmd_id = t3.zmd_id
  			 left join konka_pe_prod_user t4 on t3.user_id = t4.id
			 where 1 = 1
			 <isNotEmpty prepend=" and " property="map.zmd_fp_1"> 
			 tt.zmd_id not in
			       (select t.zmd_id
			          from konka_xx_zmd t,
			           konka_xx_zmd_users t1, 
			           konka_pe_prod_user t2,
			           konka_r3_shop t0
			           where t.zmd_id = t1.zmd_id
			           and t1.user_id = t2.id
			           and t0.id = t2.cust_id
			           )
			</isNotEmpty> 
			<isNotEmpty prepend=" and " property="map.zmd_fp_2"> 
			 tt.zmd_id in
			       (select t.zmd_id
			          from konka_xx_zmd t,
			           konka_xx_zmd_users t1, 
			           konka_pe_prod_user t2,
			           konka_r3_shop t0
			           where t.zmd_id = t1.zmd_id
			           and t1.user_id = t2.id
			           and t0.id = t2.cust_id
			           )
			   and t4.cust_id is not null
			</isNotEmpty> 
			  and r3_id is not null
			<isNotEmpty prepend=" and " property="map.zmd_sn_like">UPPER(tt.ZMD_SN) like '%' || UPPER(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
		    <isNotEmpty prepend=" and " property="dept_id">tt.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		 <!-- order by ID asc -->
		 order by audit_date desc
		 <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaXxZmdPaginatedList" resultMap="konkaXxZmdResult" parameterClass="konkaXxZmd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_XX_ZMD where 1 = 1
		<include refid="sf-konkaXxZmd" />
		<isNotEmpty property="map.apply_date_desc">
		order by apply_date desc
		</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- @author ,JiangJiaYong @version 2012-01-09  -->
	<select id="selectKonkaXxZmdPaginatedListIncludeRelevanceInfo" resultMap="konkaXxZmdResultIncludeRelevanceInfo" parameterClass="konkaXxZmd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t1.*, t2.dept_name , t3.type_name
		  from (
		  		select * from KONKA_XX_ZMD where 1 = 1
				<include refid="sf-konkaXxZmd" />
		       ) t1
		  left join konka_dept t2
		    on t1.dept_id = t2.dept_id
		  left join konka_xx_base_type t3
		    on t1.busi_type = t3.type_id
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	
	<!-- @author ,Zhengkun @version 2012-01-12  -->
	<select id="selectKonkaXxZmdForClerkPaginatedList" resultMap="konkaXxZmdResultClerk" parameterClass="konkaXxZmd" >
			<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
			select user_id, real_name, role_id, role_name, wm_concat(zmd_sn) zmd_sn from (
			 select t2.id  as user_id,
                    t2.real_name ,
                    t4.role_id   ,
                    t4.role_name ,
                    t3.zmd_sn    
				 from  konka_xx_zmd   t3,
				       konka_xx_zmd_users t1,
				       konka_pe_prod_user t2,
				       konka_pe_role_info t4,
				       konka_pe_role_user t5
				   where t1.zmd_id = t3.zmd_id
				     and t1.user_id = t2.id
				     and t2.id = t5.user_id
				     and t5.role_id = t4.role_id
				     and t4.role_id in (400, 390) 
		  <isNotEmpty prepend=" and " property="dept_id">t3.dept_id = #dept_id:DECIMAL#</isNotEmpty>   
		  <isNotEmpty prepend=" and " property="map.user_id">t1.user_id = #map.user_id:DECIMAL#</isNotEmpty>   
		  <isNotEmpty prepend=" and " property="map.real_name_like">upper(t2.real_name) like '%' || upper(#map.real_name_like:VARCHAR#) || '%'</isNotEmpty>
		   and t3.arc_state = 20300 and t3.is_del = 0
		   )
		   group by user_id, real_name, role_id, role_name
		   <![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- @author ,Zhengkun @version 2012-01-12  -->
	<select id="selectKonkaXxZmdForClerkCount" resultClass="long" parameterClass="konkaXxZmd" >
			select count(distinct(t2.id || t2.real_name || t4.role_id || t4.role_name))
				 from  konka_xx_zmd   t3,
				       konka_xx_zmd_users t1,
				       konka_pe_prod_user t2,
				       konka_pe_role_info t4,
				       konka_pe_role_user t5
				   where t1.zmd_id = t3.zmd_id
				     and t1.user_id = t2.id
				     and t2.id = t5.user_id
				     and t5.role_id = t4.role_id
				     and t4.role_id in (400, 390) 
		 <isNotEmpty prepend=" and " property="dept_id">t3.dept_id = #dept_id:DECIMAL#</isNotEmpty>          
		 <isNotEmpty prepend=" and " property="map.zmd_sn_like">upper(t3.zmd_sn) like '%' || upper(#map.zmd_sn_like:VARCHAR#) || '%'</isNotEmpty>
		   and t3.arc_state = 20300 and t3.is_del = 0  
		   order by t3.apply_date desc
	</select>

	<insert id="insertKonkaXxZmd" parameterClass="konkaXxZmd">
		<selectKey resultClass="long" keyProperty="zmd_id">select KONKA_XX_BASE_SEQ.nextval as zmd_id from dual </selectKey>
		<![CDATA[insert into KONKA_XX_ZMD (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="zmd_id">ZMD_ID</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="zmd_sn">ZMD_SN</isNotNull>	
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>	
			<isNotNull prepend="," property="addr">ADDR</isNotNull>	
			<isNotNull prepend="," property="r3_id">R3_ID</isNotNull>	
			<isNotNull prepend="," property="busi_area">BUSI_AREA</isNotNull>	
			<isNotNull prepend="," property="rent_start">RENT_START</isNotNull>	
			<isNotNull prepend="," property="rent_end">RENT_END</isNotNull>	
			<isNotNull prepend="," property="rent_fee">RENT_FEE</isNotNull>	
			<isNotNull prepend="," property="busi_type">BUSI_TYPE</isNotNull>	
			<isNotNull prepend="," property="money_of_sell_by_year_plan">MONEY_OF_SELL_BY_YEAR_PLAN</isNotNull>	
			<isNotNull prepend="," property="host_id">HOST_ID</isNotNull>	
			<isNotNull prepend="," property="host_name">HOST_NAME</isNotNull>	
			<isNotNull prepend="," property="host_phone">HOST_PHONE</isNotNull>	
			<isNotNull prepend="," property="dept_leader_name">DEPT_LEADER_NAME</isNotNull>	
			<isNotNull prepend="," property="dept_leader_phone">DEPT_LEADER_PHONE</isNotNull>	
			<isNotNull prepend="," property="money_of_dcrt_apply">MONEY_OF_DCRT_APPLY</isNotNull>	
			<isNotNull prepend="," property="put_res_plan">PUT_RES_PLAN</isNotNull>	
			<isNotNull prepend="," property="money_of_dm_apply">MONEY_OF_DM_APPLY</isNotNull>	
			<isNotNull prepend="," property="put_dm_plan">PUT_DM_PLAN</isNotNull>	
			<isNotNull prepend="," property="dept_main_man">DEPT_MAIN_MAN</isNotNull>	
			<isNotNull prepend="," property="dept_fnc_man">DEPT_FNC_MAN</isNotNull>	
			<isNotNull prepend="," property="busi_user_id">BUSI_USER_ID</isNotNull>	
			<isNotNull prepend="," property="write_man_id">WRITE_MAN_ID</isNotNull>	
			<isNotNull prepend="," property="write_man">WRITE_MAN</isNotNull>	
			<isNotNull prepend="," property="apply_date">APPLY_DATE</isNotNull>	
			<isNotNull prepend="," property="arc_state">ARC_STATE</isNotNull>	
			<isNotNull prepend="," property="audit_user_id">AUDIT_USER_ID</isNotNull>	
			<isNotNull prepend="," property="audit_user_name">AUDIT_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="audit_date">AUDIT_DATE</isNotNull>	
			<isNotNull prepend="," property="audit_comment">AUDIT_COMMENT</isNotNull>	
			<isNotNull prepend="," property="money_of_dcrt">MONEY_OF_DCRT</isNotNull>	
			<isNotNull prepend="," property="fixed_asset">FIXED_ASSET</isNotNull>	
			<isNotNull prepend="," property="money_of_deposit">MONEY_OF_DEPOSIT</isNotNull>	
			<isNotNull prepend="," property="is_open">IS_OPEN</isNotNull>	
			<isNotNull prepend="," property="reserverd_stock">RESERVERD_STOCK</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="att_file_path">ATT_FILE_PATH</isNotNull>	
			<isNotNull prepend="," property="att_file_name">ATT_FILE_NAME</isNotNull>	
			<isNotNull prepend="," property="pos_sn">POS_SN</isNotNull>	
			<isNotNull prepend="," property="cur_credit_line">CUR_CREDIT_LINE</isNotNull>	
			<isNotNull prepend="," property="total_credit_line">TOTAL_CREDIT_LINE</isNotNull>
			<isNotNull prepend="," property="r3_name">R3_NAME</isNotNull>
			<isNotNull prepend="," property="r3_send_num">R3_SEND_NUM</isNotNull>	
			<isNotNull prepend="," property="busi_mod">BUSI_MOD</isNotNull>	
			<isNotNull prepend="," property="put_res_id">PUT_RES_ID</isNotNull>	
			<isNotNull prepend="," property="zmd_status">ZMD_STATUS</isNotNull>	
			<isNotNull prepend="," property="zmd_user_id">ZMD_USER_ID</isNotNull>
			<isNotNull prepend="," property="credit_id">CREDIT_ID</isNotNull>
			<isNotNull prepend="," property="area_id">AREA_ID</isNotNull>		
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="zmd_id">#zmd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_sn">#zmd_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="addr">#addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_id">#r3_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_area">#busi_area:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="rent_start">#rent_start:DATETIME#</isNotNull>
			<isNotNull prepend="," property="rent_end">#rent_end:DATETIME#</isNotNull>
			<isNotNull prepend="," property="rent_fee">#rent_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="busi_type">#busi_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="money_of_sell_by_year_plan">#money_of_sell_by_year_plan:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="host_id">#host_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="host_name">#host_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="host_phone">#host_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_leader_name">#dept_leader_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_leader_phone">#dept_leader_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dcrt_apply">#money_of_dcrt_apply:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_res_plan">#put_res_plan:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dm_apply">#money_of_dm_apply:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_dm_plan">#put_dm_plan:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_main_man">#dept_main_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_fnc_man">#dept_fnc_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_user_id">#busi_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="write_man_id">#write_man_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="write_man">#write_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="apply_date">#apply_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="arc_state">#arc_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_user_id">#audit_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_user_name">#audit_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="audit_date">#audit_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="audit_comment">#audit_comment:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dcrt">#money_of_dcrt:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fixed_asset">#fixed_asset:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_deposit">#money_of_deposit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_open">#is_open:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="reserverd_stock">#reserverd_stock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="att_file_path">#att_file_path:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="att_file_name">#att_file_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pos_sn">#pos_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cur_credit_line">#cur_credit_line:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="total_credit_line">#total_credit_line:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_name">#r3_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_send_num">#r3_send_num:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_mod">#busi_mod:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_res_id">#put_res_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_status">#zmd_status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_user_id">#zmd_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="credit_id">#credit_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="area_id">#area_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaXxZmd" parameterClass="KonkaXxZmd">
		update KONKA_XX_ZMD
		<dynamic prepend="set">
			<isNotNull prepend="," property="zmd_id">ZMD_ID = #zmd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_sn">ZMD_SN = #zmd_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="addr">ADDR = #addr:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_id">R3_ID = #r3_id:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_area">BUSI_AREA = #busi_area:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="rent_start">RENT_START = #rent_start:DATETIME#</isNotNull>
			<isNotNull prepend="," property="rent_end">RENT_END = #rent_end:DATETIME#</isNotNull>
			<isNull prepend="," property="rent_start">RENT_START = null </isNull>
			<isNull prepend="," property="rent_end">RENT_END = null </isNull>
			<isNotNull prepend="," property="rent_fee">RENT_FEE = #rent_fee:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="busi_type">BUSI_TYPE = #busi_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="money_of_sell_by_year_plan">MONEY_OF_SELL_BY_YEAR_PLAN = #money_of_sell_by_year_plan:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="host_id">HOST_ID = #host_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="host_name">HOST_NAME = #host_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="host_phone">HOST_PHONE = #host_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_leader_name">DEPT_LEADER_NAME = #dept_leader_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_leader_phone">DEPT_LEADER_PHONE = #dept_leader_phone:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dcrt_apply">MONEY_OF_DCRT_APPLY = #money_of_dcrt_apply:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_res_plan">PUT_RES_PLAN = #put_res_plan:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dm_apply">MONEY_OF_DM_APPLY = #money_of_dm_apply:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_dm_plan">PUT_DM_PLAN = #put_dm_plan:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_main_man">DEPT_MAIN_MAN = #dept_main_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_fnc_man">DEPT_FNC_MAN = #dept_fnc_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_user_id">BUSI_USER_ID = #busi_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="write_man_id">WRITE_MAN_ID = #write_man_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="write_man">WRITE_MAN = #write_man:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="apply_date">APPLY_DATE = #apply_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="arc_state">ARC_STATE = #arc_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_user_id">AUDIT_USER_ID = #audit_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="audit_user_name">AUDIT_USER_NAME = #audit_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="audit_date">AUDIT_DATE = #audit_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="audit_comment">AUDIT_COMMENT = #audit_comment:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_dcrt">MONEY_OF_DCRT = #money_of_dcrt:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="fixed_asset">FIXED_ASSET = #fixed_asset:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="money_of_deposit">MONEY_OF_DEPOSIT = #money_of_deposit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_open">IS_OPEN = #is_open:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="reserverd_stock">RESERVERD_STOCK = #reserverd_stock:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="att_file_path">ATT_FILE_PATH = #att_file_path:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="att_file_name">ATT_FILE_NAME = #att_file_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pos_sn">POS_SN = #pos_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="cur_credit_line">CUR_CREDIT_LINE = #cur_credit_line:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="total_credit_line">TOTAL_CREDIT_LINE = #total_credit_line:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="r3_name">R3_NAME = #r3_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_send_num">R3_SEND_NUM = #r3_send_num:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="busi_mod">BUSI_MOD = #busi_mod:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="put_res_id">PUT_RES_ID = #put_res_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_status">ZMD_STATUS = #zmd_status:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="zmd_user_id">ZMD_USER_ID = #zmd_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="credit_id">CREDIT_ID = #credit_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="area_id">AREA_ID = #area_id:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="zmd_id">ZMD_ID = #zmd_id#</isNotEmpty>
		<isEmpty prepend=" " property="zmd_id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>
	
	<!-- 专卖店信用额度增减, Ren zhong, 2012-04-06 -->
	<update id="updateKonkaXxZmdForCreditLine" parameterClass="KonkaXxZmd">
		update KONKA_XX_ZMD
		<dynamic prepend="set">
		    <isNotNull prepend="," property="credit_id">CREDIT_ID = #credit_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cur_credit_line">CUR_CREDIT_LINE = #cur_credit_line:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="map.add_total_credit_line">TOTAL_CREDIT_LINE = TOTAL_CREDIT_LINE + #map.add_total_credit_line#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="zmd_id">ZMD_ID = #zmd_id#</isNotEmpty>
	</update>
	
	<delete id="deleteKonkaXxZmd" parameterClass="KonkaXxZmd">
		delete from KONKA_XX_ZMD where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
	
	<delete id="deleteKonkaXxZmdForPosAllocation" parameterClass="KonkaXxZmd">
		update KONKA_XX_ZMD set pos_sn = '' where
		<isNotEmpty prepend=" " property="zmd_id">ZMD_ID = #zmd_id#</isNotEmpty>
		<isEmpty prepend=" " property="zmd_id">
			<isNotEmpty prepend=" " property="map.pks">
				ZMD_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>