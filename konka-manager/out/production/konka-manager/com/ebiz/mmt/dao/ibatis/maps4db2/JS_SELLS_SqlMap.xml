<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JS_SELLS">

	<typeAlias alias="jsSells" type="com.ebiz.mmt.domain.JsSells" />

	<resultMap id="jsSellsResultForList" class="jsSells">
		<result column="ID" property="id" jdbcType="BIGINT" />
		<result column="SELL_COUNT" property="sell_count" jdbcType="BIGINT" />
		<result column="SELL_MONEY" property="sell_money" jdbcType="DECIMAL" />
		<result column="SELL_PRICE" property="sell_price" jdbcType="DECIMAL" />
		<result column="SELL_DATE" property="sell_date" jdbcType="TIMESTAMP" />
		<result column="TOTAL_COST" property="total_cost" jdbcType="DECIMAL" />
		<result column="C_ID" property="c_id" jdbcType="BIGINT" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="SELL_TYPE" property="sell_type" jdbcType="SMALLINT" />
		<result column="LINK_ID" property="link_id" jdbcType="BIGINT" />
		<result column="LINK_TAB" property="link_tab" jdbcType="VARCHAR" />
		<result column="S_ID" property="s_id" jdbcType="BIGINT" />
	</resultMap>

	<resultMap id="jsSellsResult" class="jsSells" extends="jsSellsResultForList">
	</resultMap>
	
	<resultMap id="jsSellsResultForPaginatedList" class="jsSells" extends="jsSellsResultForList">
		<result column="C_NAME" property="map.c_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="jsSellsResultListForML" class="jsSells">
		<result column="SELL_COUNT" property="sell_count" jdbcType="BIGINT" />
		<result column="SELL_MONEY" property="sell_money" jdbcType="DECIMAL" />
		<result column="TOTAL_COST" property="total_cost" jdbcType="DECIMAL" />
		<result column="C_ID" property="c_id" jdbcType="BIGINT" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="C_NAME" property="map.c_name" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-jsSells">
		<isNotEmpty prepend=" and " property="id">ID = #id:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_count">SELL_COUNT = #sell_count:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_money">SELL_MONEY = #sell_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_price">SELL_PRICE = #sell_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_date">SELL_DATE = #sell_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="total_cost">TOTAL_COST = #total_cost:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">C_ID = #c_id:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">MD_NAME = #md_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_type">SELL_TYPE = #sell_type:SMALLINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_id">LINK_ID = #link_id:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_tab">LINK_TAB = #link_tab:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="s_id">S_ID = #s_id:BIGINT#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.md_name_like">MD_NAME like '%' || #map.md_name_like# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_ge"><![CDATA[ SELL_DATE >= to_date(#map.sell_date_ge# || '00:00:00','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.sell_date_le"><![CDATA[ SELL_DATE <= to_date(#map.sell_date_le# || '23:59:59','yyyy-mm-dd hh24:mi:ss' ) ]]></isNotEmpty>
	</sql>

	<select id="selectJsSells" resultMap="jsSellsResult" parameterClass="jsSells">
		select * from JS_SELLS where 1 = 1
		<include refid="sf-jsSells" />
	</select>

	<select id="selectJsSellsList" resultMap="jsSellsResultForList" parameterClass="jsSells">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from JS_SELLS where 1 = 1
		<include refid="sf-jsSells" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJsSellsCount" resultClass="long" parameterClass="jsSells">
		select count(*) from JS_SELLS where 1 = 1
		<include refid="sf-jsSells" />
	</select>

	<select id="selectJsSellsPaginatedList" resultMap="jsSellsResultForPaginatedList" parameterClass="jsSells">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select ID,SELL_COUNT,SELL_PRICE,SELL_MONEY,SELL_DATE,TOTAL_COST,C_ID,MD_NAME,SELL_TYPE,LINK_ID,LINK_TAB,S_ID
		<![CDATA[ ,(select k.CUSTOMER_NAME from KONKA_R3_SHOP k where k.id = c_id and rownum < 2) as c_name from JS_SELLS where 1 = 1 ]]>
		<include refid="sf-jsSells" />
		order by ID asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectJsSellsListForML" resultMap="jsSellsResultListForML" parameterClass="jsSells">
		select C_ID,MD_NAME,
		<![CDATA[ (select k.CUSTOMER_NAME from KONKA_R3_SHOP k where k.id = c_id and rownum < 2) as c_name, ]]>
		value(sum(SELL_COUNT),0) as SELL_COUNT,
		value(sum(SELL_MONEY),0) as SELL_MONEY,
		value(sum(TOTAL_COST),0) TOTAL_COST 
		from JS_SELLS where 1 = 1
		<include refid="sf-jsSells" />
		group by C_ID,MD_NAME
		<!-- order by ID asc -->
	</select>

	<insert id="insertJsSells" parameterClass="jsSells">
		<selectKey resultClass="long" keyProperty="id">select SEQ_JS_SELLS.nextval as id from dual </selectKey>
		<![CDATA[insert into JS_SELLS (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="sell_count">SELL_COUNT</isNotNull>	
			<isNotNull prepend="," property="sell_money">SELL_MONEY</isNotNull>	
			<isNotNull prepend="," property="sell_price">SELL_PRICE</isNotNull>	
			<isNotNull prepend="," property="sell_date">SELL_DATE</isNotNull>	
			<isNotNull prepend="," property="total_cost">TOTAL_COST</isNotNull>	
			<isNotNull prepend="," property="c_id">C_ID</isNotNull>	
			<isNotNull prepend="," property="md_name">MD_NAME</isNotNull>	
			<isNotNull prepend="," property="sell_type">SELL_TYPE</isNotNull>	
			<isNotNull prepend="," property="link_id">LINK_ID</isNotNull>	
			<isNotNull prepend="," property="link_tab">LINK_TAB</isNotNull>
			<isNotNull prepend="," property="s_id">S_ID</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="sell_count">#sell_count:BIGINT#</isNotNull>
			<isNotNull prepend="," property="sell_money">#sell_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_price">#sell_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_date">#sell_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="total_cost">#total_cost:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">#c_id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="md_name">#md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="sell_type">#sell_type:SMALLINT#</isNotNull>
			<isNotNull prepend="," property="link_id">#link_id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="link_tab">#link_tab:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="s_id">#s_id:BIGINT#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJsSells" parameterClass="JsSells">
		update JS_SELLS
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="sell_count">SELL_COUNT = #sell_count:BIGINT#</isNotNull>
			<isNotNull prepend="," property="sell_money">SELL_MONEY = #sell_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_price">SELL_PRICE = #sell_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="sell_date">SELL_DATE = #sell_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="total_cost">TOTAL_COST = #total_cost:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID = #c_id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="md_name">MD_NAME = #md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="sell_type">SELL_TYPE = #sell_type:SMALLINT#</isNotNull>
			<isNotNull prepend="," property="link_id">LINK_ID = #link_id:BIGINT#</isNotNull>
			<isNotNull prepend="," property="link_tab">LINK_TAB = #link_tab:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="s_id">S_ID = #s_id:BIGINT#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJsSells" parameterClass="JsSells">
		delete from JS_SELLS where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>