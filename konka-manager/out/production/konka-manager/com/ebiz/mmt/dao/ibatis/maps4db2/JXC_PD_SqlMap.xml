<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="JXC_PD">

	<typeAlias alias="jxcPd" type="com.ebiz.mmt.domain.JxcPd" />

	

	<resultMap id="jxcPdResultForList" class="jxcPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="SHOP_P_INDEX" property="shop_p_index" jdbcType="DECIMAL" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="UNIT" property="unit" jdbcType="VARCHAR" />
		<result column="INIT_COUNT" property="init_count" jdbcType="DECIMAL" />
		<result column="COUNT" property="count" jdbcType="DECIMAL" />
		<result column="MIN_COUNT" property="min_count" jdbcType="DECIMAL" />
		<result column="REF_PRICE" property="ref_price" jdbcType="DECIMAL" />
		<result column="PF_PRICE" property="pf_price" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="OUT_SYS_ID" property="out_sys_id" jdbcType="DECIMAL" />
		<result column="INIT_COST_PRICE" property="init_cost_price" jdbcType="DECIMAL" />
		<result column="CUR_COST_PRICE" property="cur_cost_price" jdbcType="DECIMAL" />
		<result column="JXC_PD_TYPE_ID" property="jxc_pd_type_id" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="jxcPdResultForListJX" class="jxcPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="UNIT" property="unit" jdbcType="VARCHAR" />
		<result column="COUNT" property="count" jdbcType="DECIMAL" />
		<result column="MIN_COUNT" property="min_count" jdbcType="DECIMAL" />
		<result column="REF_PRICE" property="ref_price" jdbcType="DECIMAL" />
		<result column="PF_PRICE" property="pf_price" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="jxcPdResult" class="jxcPd" extends="jxcPdResultForList">
	</resultMap>

	<sql id="sf-jxcPd">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_p_index">SHOP_P_INDEX = #shop_p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="name">NAME = #name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="unit">UNIT = #unit:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="init_count">INIT_COUNT = #init_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="count">COUNT = #count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="min_count">MIN_COUNT = #min_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="ref_price">REF_PRICE = #ref_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pf_price">PF_PRICE = #pf_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="out_sys_id">OUT_SYS_ID = #out_sys_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.date_st">ADD_DATE >= to_date(#map.date_st#,'yyyy-MM-dd')</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.count_gt">count > 0</isNotEmpty>
		<isNotEmpty prepend=" and " property="init_cost_price">INIT_COST_PRICE = #init_cost_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="cur_cost_price">CUR_COST_PRICE = #cur_cost_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="jxc_pd_type_id">JXC_PD_TYPE_ID = #jxc_pd_type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.validateNameWithNotInID">ID not in($map.validateNameWithNotInID$)</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.add_date_lt">ADD_DATE between #map.add_date_lt:DATETIME# and #map.add_date_gt:DATETIME#</isNotEmpty>
	</sql>

	<select id="selectJxcPd" resultMap="jxcPdResult" parameterClass="jxcPd" >
		select * from JXC_PD where 1 = 1
		<include refid="sf-jxcPd" />
	</select>

	<select id="selectJxcPdList" resultMap="jxcPdResultForList" parameterClass="jxcPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from JXC_PD where 1 = 1
		<include refid="sf-jxcPd" />
		order by add_date desc, ID desc 
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectJxcPdCount" resultClass="long" parameterClass="jxcPd" >
		select count(*) from JXC_PD where 1 = 1
		<include refid="sf-jxcPd" />
	</select>

	<select id="selectJxcPdPaginatedList" resultMap="jxcPdResult" parameterClass="jxcPd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from JXC_PD where 1 = 1
		<include refid="sf-jxcPd" />
		 order by add_date desc, ID desc 
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!-- 进销存 进货销售产品list  coding by Du,HongGang 2011-03-03 -->
	<select id="selectJxcPdListForJX" resultMap="jxcPdResultForListJX" parameterClass="jxcPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select ID, NAME || decode(OWN_SYS, 1, '[下乡产品编号:' || OUT_SYS_ID || ']', '') NAME, BRAND_NAME,PD_TYPE,PD_TYPE_NAME,UNIT,COUNT,MIN_COUNT,REF_PRICE,PF_PRICE,PRICE from JXC_PD where 1 = 1
		<include refid="sf-jxcPd" />
		order by add_date desc, ID desc 
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- 进销存 实时库存list  coding by Ren zhong 2011-03-07 -->
	<resultMap id="qcjcForStockResult" class="jxcPd">
		<result column="QCJC_COUNT" property="map.qcjc_count" jdbcType="DECIMAL" />
		<result column="QCJC_MONEY" property="map.qcjc_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectQcjcForStock" resultMap="qcjcForStockResult" parameterClass="jxcPd" >
		select (x.init_count + y.jh_count + q.pc_count) - z.xs_count as qcjc_count,
		       (x.qc_money + y.jh_money + q.pc_money) - z.xs_money as qcjc_money
  		  from (select a.init_count * a.init_cost_price as qc_money, a.init_count
                  from jxc_pd a
         		 where a.id = #map.pd_id#) x,
       		   (select decode(sum(b.count * b.price), null, 0, sum(b.count * b.price)) as jh_money, decode(sum(b.count), null, 0, sum(b.count)) as jh_count
          		  from JXC_STOCK_BILL_DETAILS b
         		 where 1 = 1
           		   <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ b.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
           		   and b.pd_id = #map.pd_id#) y,
       		   (select decode(sum(d.count * d.cost_price), null, 0, sum(d.count * d.cost_price)) as xs_money, decode(sum(d.count), null, 0, sum(d.count)) as xs_count
          		 from JXC_SELL_BILL_DETAILS d
         		where 1 = 1
           		  <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ d.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
           		  and d.pd_id = #map.pd_id#) z,
           	   (select decode(sum(e.py_pk_num * e.cur_cost_price), null, 0, sum(e.py_pk_num * e.cur_cost_price)) as pc_money, decode(sum(e.py_pk_num), null, 0, sum(e.py_pk_num)) as pc_count
          			from konka_jxc_pc_info e
         			where 1 = 1 
         		 <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ e.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty> 
					   and e.pd_id = #map.pd_id# and pc_type = 0) q
	</select>
	
	<resultMap id="rcjhForStockResult" class="jxcPd">
		<result column="RCJH_COUNT" property="map.rcjh_count" jdbcType="DECIMAL" />
		<result column="RCJH_MONEY" property="map.rcjh_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectRcjhForStock" resultMap="rcjhForStockResult" parameterClass="jxcPd" >
		select sum(a.count * a.price) as rcjh_money,sum(a.count) as rcjh_count
  		  from JXC_STOCK_BILL_DETAILS a
  		  left join JXC_STOCK_BILL b on a.stock_bill_id = b.id
  		 where a.pd_id = #map.pd_id#
 		   <isNotEmpty prepend=" and " property="map.rcjh_date_st"><![CDATA[ b.in_date >= to_date(#map.rcjh_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.rcjh_date_en"><![CDATA[ b.in_date <= to_date(#map.rcjh_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	</select>
	
	<resultMap id="rcchForStockResult" class="jxcPd">
		<result column="RCCH_COUNT" property="map.rcch_count" jdbcType="DECIMAL" />
		<result column="RCCH_MONEY" property="map.rcch_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectRcchForStock" resultMap="rcchForStockResult" parameterClass="jxcPd" >
	  select sum(a.count*a.price) as rcch_money,sum(a.count) as rcch_count
         from JXC_SELL_BILL_DETAILS a
         left join JXC_SELL_BILL b on a.sell_bill_id = b.id
        where a.pd_id = #map.pd_id#
 		   <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ b.sell_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ b.sell_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	</select>
	
	<resultMap id="sskcDetailsForStork"  class="jxcPd">
		<result column="SN" property="map.sn" jdbcType="VARCHAR" />
		<result column="PD_TYPE_NAME" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="IN_DATE" property="map.in_date" jdbcType="DATE" />
		<result column="PAY_MONEY" property="map.pay_money" jdbcType="DECIMAL" />
		<result column="PAID_MONEY" property="map.paid_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectSskcDetailsForStork" resultMap="sskcDetailsForStork" parameterClass="jxcPd" >
		select b.sn,a.pd_type_name,a.brand_name,a.pd_name,a.count,a.price,b.in_date,b.pay_money,b.paid_money
  		  from JXC_STOCK_BILL_DETAILS a
  		  left join JXC_STOCK_BILL b on b.id = a.stock_bill_id
 		 where a.pd_id = #map.pd_id#
 		   and b.shop_id = #map.shop_id#
 		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ b.in_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ b.in_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
 		   
	</select>
	
	<resultMap id="ssxsDetailsForStork" class="jxcPd">
		<result column="SN" property="map.sn" jdbcType="VARCHAR" />
		<result column="PD_TYPE_NAME" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="SELL_DATE" property="map.sell_date" jdbcType="DATE" />
		<result column="MONEY" property="map.money" jdbcType="DECIMAL" />
		<result column="PAY_MONEY" property="map.pay_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectSsxsDetailsForStork" resultMap="ssxsDetailsForStork" parameterClass="jxcPd" >
		select b.sn,a.pd_type_name,a.brand_name,a.pd_name,a.count,a.price,b.sell_date,b.money,b.pay_money
  		  from JXC_SELL_BILL_DETAILS a
  		  left join JXC_SELL_BILL b on b.id = a.sell_bill_id
  		 where a.pd_id = #map.pd_id#
  		   and b.shop_id = #map.shop_id#
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ b.sell_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ b.sell_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	</select>
	<resultMap id="stockDetailsListForResultPc" class="jxcPd">
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="COST_PRICE" property="map.cost_price" jdbcType="DECIMAL" />
		<result column="BIZ_DATE" property="map.biz_date" jdbcType="DATE" />
		<result column="NAME" property="map.name" jdbcType="VARCHAR" />
		<result column="TYPE" property="map.type" jdbcType="DECIMAL"/>
	</resultMap>
	<resultMap id="stockDetailsListForResult" class="jxcPd">
		<result column="SN" property="map.sn" jdbcType="VARCHAR" />
		<result column="PD_TYPE_NAME" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="COST_PRICE" property="map.cost_price" jdbcType="DECIMAL" />
		<result column="BIZ_DATE" property="map.biz_date" jdbcType="DATE" />
		<result column="NAME" property="map.name" jdbcType="VARCHAR" />
		<result column="THEORY_MONEY" property="map.theory_money" jdbcType="DECIMAL" />
		<result column="ACTUAL_MONEY" property="map.actual_money" jdbcType="DECIMAL" />
		<result column="TYPE" property="map.type" jdbcType="DECIMAL"/>
	</resultMap>
	
	<select id="selectStockDetailsList" resultMap="stockDetailsListForResult" parameterClass="jxcPd" >
		select x.sn,
       		   c.pd_type_name,
       		   c.brand_name,
       		   c.pd_name,
       		   c.count,
       		   c.price,
       		   null as cost_price,
       		   x.add_date as biz_date,
       		   x.name,
       		   x.pay_money as theory_money,
       		   x.paid_money as actual_money,
       		   0 as type
  		  from JXC_STOCK_BILL_DETAILS c
  		  left join (select a.*, b.name
               		   from JXC_STOCK_BILL a
               		   left join JXC_SUPPLIER b on a.supplier_id = b.id) x on c.stock_bill_id = x.id
 		 where c.pd_id = #map.pd_id#
   		   and x.shop_id = #map.shop_id#
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ x.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ x.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	       union all
	    select y.sn,
       		   d.pd_type_name,
       		   d.brand_name,
       		   d.pd_name,
       		   d.count,
       		   d.price,
       		   d.cost_price,
       		   y.add_date as biz_date,
       		   y.name,
       		   y.money as theory_money,
       		   y.pay_money as actual_money,
       		   1 as type
  		  from JXC_SELL_BILL_DETAILS d
  		  left join (select e.*, f.name
               		   from JXC_SELL_BILL e
               		   left join JXC_CUSTOMER f on e.customer_id = f.id) y on d.sell_bill_id = y.id
	     where d.pd_id = #map.pd_id#
   		   and y.shop_id = #map.shop_id#
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ y.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ y.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
   		 order by biz_date asc
	</select>
	
	<select id="selectStockDetailsListForPc" resultMap="stockDetailsListForResultPc" parameterClass="jxcPd" >
		select c.count,
       		   c.price,
       		   null as cost_price,
       		   x.add_date as biz_date,
       		   x.name,
       		   0 as type
  		  from JXC_STOCK_BILL_DETAILS c
  		  left join (select a.*, b.name
               		   from JXC_STOCK_BILL a
               		   left join JXC_SUPPLIER b on a.supplier_id = b.id) x on c.stock_bill_id = x.id
 		 where c.pd_id = #map.pd_id#
   		   and x.shop_id = #map.shop_id#
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ x.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ x.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	       union all
	    select d.count,
       		   d.price,
       		   d.cost_price ,
       		   y.add_date as biz_date,
       		   y.name,
       		   decode(d.sell_src, 3, 3, 1) as type
  		  from JXC_SELL_BILL_DETAILS d
  		  left join (select e.*, f.name
               		   from JXC_SELL_BILL e
               		   left join JXC_CUSTOMER f on e.customer_id = f.id) y on d.sell_bill_id = y.id
	     where d.pd_id = #map.pd_id#
   		   and y.shop_id = #map.shop_id#
		   <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ y.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ y.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
	   		union all
		select t.py_pk_num as count,
		       t.cur_cost_price as price,
		       t.cur_cost_price as cost_price,
		       t.add_date as biz_date,
		       '盘存' as name,
		       2 as type
		  from konka_jxc_pc_info t
		 where t.pd_id = #map.pd_id#
   		   and t.shop_id = #map.shop_id#
		   and t.pc_type = 0
		  <isNotEmpty prepend=" and " property="map.date_st"><![CDATA[ t.add_date >= to_date(#map.date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		   <isNotEmpty prepend=" and " property="map.date_en"><![CDATA[ t.add_date <= to_date(#map.date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty> 
		   order by biz_date asc
	</select>
	<resultMap id="stockRcjhAndRcchListForResult" class="jxcPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE_NAME" property="pd_type_name" jdbcType="VARCHAR" />
		<result column="UNIT" property="unit" jdbcType="VARCHAR" />
		<result column="JH_COUNT" property="map.jh_count" jdbcType="DECIMAL" />
		<result column="JH_SUM_MONEY" property="map.jh_sum_money" jdbcType="DECIMAL" />
		<result column="CH_COUNT" property="map.ch_count" jdbcType="DECIMAL" />
		<result column="CH_SUM_MONEY" property="map.ch_sum_money" jdbcType="DECIMAL" />
		<result column="PC_COUNT" property="map.pc_count" jdbcType="DECIMAL" />
		<result column="PC_SUM_MONEY" property="map.pc_sum_money" jdbcType="DECIMAL" />
	</resultMap>
	
	<!--@2011-11-22 Zhang,Xufeng 经营情况 统计报表	-->
	<select id="selectShopSellStatisticsList" resultMap="stockRcjhAndRcchListForResult" parameterClass="jxcPd" >
		select b.id id,
		       b.name || decode(b.own_sys, 1, '[下乡]', '') NAME,
		       b.pd_type_name,
		       b.brand_name,
		       b.unit,
		       a.jh_count,
		       a.jh_sum_money,
		       a.ch_count,
		       a.ch_sum_money,
		       a.pc_count,
      		   a.pc_sum_money,
		       b.add_date
		  from (select * from JXC_PD where shop_id = #map.shop_id# and is_del = 0) b 
		  		left join 
		  	   (select pd_id,
		               sum(jh_count) jh_count,
		               sum(jh_count * jh_price) jh_sum_money,
		               sum(ch_count) ch_count,
		               sum(ch_count * ch_price) ch_sum_money,
		               sum(pc_count) pc_count,
                       sum(pc_count * pc_price) pc_sum_money
		          from (select pd_id,
		                       count jh_count,
		                       price jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
                               0 pc_price
		                  from (select *
		                          from JXC_STOCK_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		                union all
		                select pd_id,
		                       0 jh_count,
		                       0 jh_price,
		                       count ch_count,
		                       cost_price ch_price,
		                       0 pc_count,
                               0 pc_price
		                  from (select *
		                          from JXC_SELL_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select pd_id,
		                      0 jh_count,
		                      0 jh_price,
		                      0 ch_count,
		                      0 ch_price,
		                      py_pk_num pc_count,
		                      cur_cost_price pc_price
		                 from (select * from konka_jxc_pc_info t where shop_id = #map.shop_id#)
		                where 1 = 1
		                and pc_type = 0 
		                <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		<isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 )
		         group by pd_id) a
		   on a.pd_id = b.id where 1 = 1
		   <isNotEmpty prepend=" and " property="map.jxc_pd_id">
			  	a.pd_id = #map.jxc_pd_id#
			</isNotEmpty>
  		 <isNotEmpty prepend=" and " property="map.pd_type">b.pd_type = #map.pd_type#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.brand_name_like">b.brand_name like '%' || #map.brand_name_like# || '%'</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.name_like">b.name like '%' || #map.name_like# || '%'</isNotEmpty>
		 order by b.add_date desc, id desc
	</select>
	
	<!--@2011-11-22	张续峰  经营情况 统计报表 [期初库存]-->
	<select id="selectQcjcForShopSellStatistics" resultMap="qcjcForStockResult" parameterClass="jxcPd" >
		select (x.init_count + y.jh_count + q.pc_count) - z.xs_count as qcjc_count,
		       (x.qc_money + y.jh_money + q.pc_money) - z.xs_money as qcjc_money
	 		  from (select a.init_count * a.init_cost_price as qc_money, a.init_count
	                 from jxc_pd a
	        		 where a.id = #map.pd_id#) x,
	      		   (select decode(sum(b.count * b.price), null, 0, sum(b.count * b.price)) as jh_money, decode(sum(b.count), null, 0, sum(b.count)) as jh_count
	         		  from JXC_STOCK_BILL_DETAILS b
	        		 where 1 = 1
	          		   <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ b.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
	          		   and b.pd_id = #map.pd_id#) y,
	      		   (select decode(sum(d.count * d.cost_price), null, 0, sum(d.count * d.cost_price)) as xs_money, decode(sum(d.count), null, 0, sum(d.count)) as xs_count
	         		 from JXC_SELL_BILL_DETAILS d
	        		where 1 = 1
	          		  <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ d.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty>
	          		  and d.pd_id = #map.pd_id#) z,
	          	   (select decode(sum(e.py_pk_num * e.cur_cost_price), null, 0, sum(e.py_pk_num * e.cur_cost_price)) as pc_money, decode(sum(e.py_pk_num), null, 0, sum(e.py_pk_num)) as pc_count
	         			from konka_jxc_pc_info e
	        			where 1 = 1 
	        		 <isNotEmpty prepend=" and " property="map.qcjc_date"><![CDATA[ e.add_date < to_date(#map.qcjc_date#,'yyyy-mm-dd') ]]></isNotEmpty> 
					   and e.pd_id = #map.pd_id# and pc_type = 0) q
	</select>
	
	<select id="selectStockRcjhAndRcchList" resultMap="stockRcjhAndRcchListForResult" parameterClass="jxcPd" >
		select b.id id,
		       b.name || decode(b.own_sys, 1, '[下乡]', '') NAME,
		       b.pd_type_name,
		       b.brand_name,
		       b.unit,
		       a.jh_count,
		       a.jh_sum_money,
		       a.ch_count,
		       a.ch_sum_money,
		       a.pc_count,
      		   a.pc_sum_money,
		       b.add_date
		  from (select * from JXC_PD where shop_id = #map.shop_id# and is_del = 0) b 
		  		left join 
		  	   (select pd_id,
		               sum(jh_count) jh_count,
		               sum(jh_count * jh_price) jh_sum_money,
		               sum(ch_count) ch_count,
		               sum(ch_count * ch_price) ch_sum_money,
		               sum(pc_count) pc_count,
                       sum(pc_count * pc_price) pc_sum_money
		          from (select pd_id,
		                       count jh_count,
		                       price jh_price,
		                       0 ch_count,
		                       0 ch_price,
		                       0 pc_count,
                               0 pc_price
		                  from (select *
		                          from JXC_STOCK_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		                union all
		                select pd_id,
		                       0 jh_count,
		                       0 jh_price,
		                       count ch_count,
		                       cost_price ch_price,
		                       0 pc_count,
                               0 pc_price
		                  from (select *
		                          from JXC_SELL_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 union all
		                 select pd_id,
		                      0 jh_count,
		                      0 jh_price,
		                      0 ch_count,
		                      0 ch_price,
		                      py_pk_num pc_count,
		                      cur_cost_price pc_price
		                 from (select * from konka_jxc_pc_info t where shop_id = #map.shop_id#)
		                where 1 = 1
		                and pc_type = 0 
		                <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		<isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 )
		         group by pd_id) a
		   on a.pd_id = b.id where 1 = 1
  		 <isNotEmpty prepend=" and " property="map.pd_type">b.pd_type = #map.pd_type#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.brand_name_like">b.brand_name like '%' || #map.brand_name_like# || '%'</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.name_like">b.name like '%' || #map.name_like# || '%'</isNotEmpty>
		 order by b.add_date desc, id desc
	</select>
	
	<select id="selectStockRcjhAndRcchCount" resultClass="long" parameterClass="jxcPd" >
		select b.id id,
		       b.name || decode(b.own_sys, 1, '[下乡]', '') NAME,
		       b.pd_type_name,
		       b.brand_name,
		       b.unit,
		       a.jh_count,
		       a.jh_sum_money,
		       a.ch_count,
		       a.ch_sum_money,
		       b.add_date
		  from (select * from JXC_PD where shop_id = #map.shop_id# and is_del = 0) b 
		  		left join 
		  	   (select pd_id,
		               sum(jh_count) jh_count,
		               sum(jh_count * jh_price) jh_sum_money,
		               sum(ch_count) ch_count,
		               sum(ch_count * ch_price) ch_sum_money
		          from (select pd_id,
		                       count jh_count,
		                       price jh_price,
		                       0 ch_count,
		                       0 ch_price
		                  from (select *
		                          from JXC_STOCK_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		                union all
		                select pd_id,
		                       0 jh_count,
		                       0 jh_price,
		                       count ch_count,
		                       price ch_price
		                  from (select *
		                          from JXC_SELL_BILL_DETAILS
		                         where shop_id = #map.shop_id#)
		                 where 1 = 1
		                 <isNotEmpty prepend=" and " property="map.rcch_date_st"><![CDATA[ add_date >= to_date(#map.rcch_date_st#,'yyyy-mm-dd') ]]></isNotEmpty>
		         		 <isNotEmpty prepend=" and " property="map.rcch_date_en"><![CDATA[ add_date <= to_date(#map.rcch_date_en# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
		         		 )
		         group by pd_id) a
		   on a.pd_id = b.id where 1 = 1
  		 <isNotEmpty prepend=" and " property="map.pd_type">b.pd_type = #map.pd_type#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.brand_name_like">b.brand_name like '%' || #map.brand_name_like# || '%'</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.name_like">b.name like '%' || #map.name_like# || '%'</isNotEmpty>)p
	</select>
	
		
	<!-- 进销存 库存增减 coding by Chen,LiLin 2011-03-07 -->
	<update id="updateJxcPdCount" parameterClass="jxcPd">
		update JXC_PD 
		<dynamic prepend="set">
			<isNotNull prepend="," property="map.count_add_num">COUNT = COUNT + #map.count_add_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="map.count_reduce_num">COUNT = COUNT - #map.count_reduce_num:DECIMAL#</isNotNull>
		</dynamic>
		where
		shop_id = #shop_id#
		and out_sys_id = #out_sys_id#
		and own_sys = #own_sys#
		and is_del = #is_del#
	</update>
	
	<!-- 买卖通超级管理后台，进销存网点使用统计（按省查询）， Ren Zhong， 2011-06-30 BEGIN-->
	<resultMap id="jxcShopUsedStatisticsResult" class="jxcPd">
		<result column="P_INDEX" property="map.p_index" jdbcType="DECIMAL" />
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
		<result column="JDXX_SHOP_COUNT" property="map.jdxx_shop_count" jdbcType="DECIMAL" />			
		<result column="JXC_SHOP_COUNT" property="map.jxc_shop_count" jdbcType="DECIMAL" />
		<result column="NOT_JD_SHOP_COUNT" property="map.not_jd_shop_count" jdbcType="DECIMAL" />
	</resultMap>
	
	<select id="selectJxcShopUsedStatisticsResultForList" resultMap="jxcShopUsedStatisticsResult" parameterClass="jxcPd" >
	<!-- Zheng,Kun， 2011-07-06 
		select 
			   t3.p_name         as p_name,
		       t3.p_index        as p_index,
		       t1.jdxx_count     as jdxx_count,
		       t4.jdxx_reg_count as jdxx_reg_count
		
		  from (select substr(t.p_index, 0, 2) || '0000' p_index,
		               sum(decode(t.own_sys, 1, 1, 0)) jdxx_count
		          from std_entp_main t
		         group by substr(t.p_index, 0, 2)) t1
		
		  left join ( select substr(t.p_index, 0, 2) || '0000' p_index,
		                     sum(decode(t.bid_type, 1, 1, 0)) jdxx_reg_count
		               from entp_user_reg t
		              group by substr(t.p_index, 0, 2)) t4 on t4.p_index =
		                                                      t1.p_index
		  left join base_province_list t3 on t3.p_index = t1.p_index
		 where 1 = 1
				<isNotEmpty prepend=" and " property="map.p_index">t3.p_index = #map.p_index#</isNotEmpty>
		 order by t3.p_index
	</select>-->
		select p.p_index, p.p_name, 
			   decode(t1.jdxx_shop_count, null, 0, t1.jdxx_shop_count) as jdxx_shop_count,
		       decode(t2.jxc_shop_count, null, 0, t2.jxc_shop_count) as jxc_shop_count,
		       decode(t3.not_jd_shop_count, null, 0, t3.not_jd_shop_count) as not_jd_shop_count
		  from BASE_PROVINCE_LIST p
		  left join (
		  			 <!-- select substr(s.p_index, 0, 2) || '0000' p_index, count(distinct s.shop_id) as jdxx_shop_count
		               from std_entp_main s
		              where s.own_sys = 1
		              group by substr(s.p_index, 0, 2) || '0000'-->
						select substr(p_index, 0, 2) || '0000' p_index, count(id) as jdxx_shop_count
						  from (select min(sem.id) as id,
						                       sem.entp_name,
						                       sem.p_index as p_index,
						                       min(seu.add_date) as add_date,
						                       min(seu.own_sys) as own_sys,
						                       min(seu.user_type) as user_type
						                  from STD_ENTP_MAIN sem,
						                       (select t.entp_id,
						                               min(t.add_date) as add_date,
						                               min(t.own_sys) as own_sys,
						                               min(t.user_type) as user_type
						                          from STD_ENTP_USER t
						                         where 1 = 1
						                           and t.mmt_user is not null
						                           and t.own_sys = 1
						                         group by t.entp_id) seu
						                 where seu.entp_id = sem.entp_id
						                 <!-- 2011-8-11 巨丰收提出业务需求 -->
						                 <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[seu.add_date >= to_date(#map.begin_date# || '00:00:00', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
						                 <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[seu.add_date <= to_date(#map.end_date# || '23:59:59','yyyy-mm-dd hh24:mi:ss') ]]></isNotEmpty>
						                 group by sem.entp_name, sem.p_index
						        )
						group by substr(p_index, 0, 2) || '0000'
					 ) t1 on p.p_index = t1.p_index
		  left join (select substr(j.shop_p_index, 0, 2) || '0000' p_index, count(distinct j.shop_id) as jxc_shop_count
		               from JXC_PD j
		              where 1 = 1
		              <!-- 2011-8-11 巨丰收提出业务需求 -->
		              <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[j.add_date >= to_date(#map.begin_date# || '00:00:00', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		              <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[j.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
		              group by substr(j.shop_p_index, 0, 2) || '0000'
		             
		             ) t2 on p.p_index = t2.p_index
		  left join (select substr(p.shop_p_index, 0, 2) || '0000' p_index, count(distinct p.shop_id) as not_jd_shop_count
               		   from JXC_PD p
              		  where p.shop_id in (select distinct (d.shop_id) 
              		  						from JXC_SELL_BILL_DETAILS d 
              		  					   where d.sell_src = 0 
              		  					   <!-- 2011-8-11 巨丰收提出业务需求 -->
              		  					   <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[d.add_date >= to_date(#map.begin_date# || '00:00:00', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
              		  					   <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[d.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
              		  					   )
              		  group by substr(p.shop_p_index, 0, 2) || '0000'
  					 ) t3 on p.p_index = t3.p_index
		 where p.p_level = 1
		 order by p.p_index
		 <isNotEmpty prepend=" and " property="map.p_index">p.p_index = #map.p_index#</isNotEmpty>
	</select>
	<!-- 买卖通超级管理后台，进销存网点使用统计（按省查询）， Ren Zhong， 2011-06-30 END-->
	
	<!-- 买卖通超级管理后台，进销存网点使用统计（按省查询详细信息）， Ren Zhong， 2011-08-12 BEGIN-->
	<resultMap id="jxcPdDetailsByProvinceResultList" class="jxcPd">
		<result column="P_FULL_NAME" property="map.p_full_name" jdbcType="VARCHAR" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="SHOP_ID" property="map.shop_id" jdbcType="DECIMAL" />			
		<result column="P_INDEX" property="map.p_index" jdbcType="DECIMAL" />
		<result column="WH_COUNT" property="map.wh_count" jdbcType="DECIMAL" />
		<result column="XL" property="map.xl" jdbcType="DECIMAL" />
		<result column="XE" property="map.xe" jdbcType="DECIMAL" />
		<!-- <result column="PD_TYPE_NAME" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" /> -->
	</resultMap>
	
	<select id="selectJxcPdDetailsByProvinceCount" resultClass="long" parameterClass="jxcPd" >
		select count(*) from (
			select mb.p_full_name,
				   es.shop_name, 
				    x.shop_id,
				    x.p_index, 
				    x.wh_count,
				    y.xl, 
				    y.xe 
				    <!-- y.pd_type_name, --> 
				    <!-- y.brand_name -->
		      from (select jp.shop_id, 
		      			   jp.shop_p_index p_index, 
		      			   count(jp.shop_id) wh_count
	  		  		  from JXC_PD jp
	 		 		 where 1 = 1
	 		 	     <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[jp.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
	   		   		 <isNotEmpty prepend=" and " property="map.p_index">substr(jp.shop_p_index, 0, 2) || '0000' = #map.p_index#</isNotEmpty>
	 		 		 group by jp.shop_id, jp.shop_p_index) x 
	 		   left join entp_shop es on es.shop_id = x.shop_id
	 		   left join MV_BASE_PROVINCE_LIST mb on x.p_index = mb.p_index
	 		   left join (select b.shop_id,
	                    		 b.shop_p_index p_index,
	                    		 sum(d.count) xl,
	                    		 sum(d.count * d.price) xe
	               		    from JXC_SELL_BILL_DETAILS d
	               			left join JXC_SELL_BILL b on d.sell_bill_id = b.id
	              		   where 1 = 1
	                		 <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[b.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
	                		 <isNotEmpty prepend=" and " property="map.p_index">substr(b.shop_p_index, 0, 2) || '0000' = #map.p_index#</isNotEmpty>
	              		   group by b.shop_id, b.shop_p_index)y on y.shop_id = x.shop_id
	 		  where 1 = 1
	 		  <isNotEmpty prepend=" and " property="map.shop_name_like">es.shop_name like '%' || #map.shop_name_like# || '%'</isNotEmpty>
 		   ) 
	</select>

	<select id="selectJxcPdDetailsByProvincePaginatedList" resultMap="jxcPdDetailsByProvinceResultList" parameterClass="jxcPd" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select mb.p_full_name,
			   es.shop_name, 
			    x.shop_id,
			    x.p_index, 
			    x.wh_count,
			    value(y.xl, 0) xl, 
			    value(y.xe, 0) xe 
			    <!-- y.pd_type_name, --> 
			    <!-- y.brand_name --> 
	      from (select jp.shop_id, 
	      			   jp.shop_p_index p_index, 
	      			   count(jp.shop_id) wh_count
  		  		  from JXC_PD jp
 		 		 where 1 = 1
 		 	     <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[jp.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
   		   		 <isNotEmpty prepend=" and " property="map.p_index">substr(jp.shop_p_index, 0, 2) || '0000' = #map.p_index#</isNotEmpty>
 		 		 group by jp.shop_id, jp.shop_p_index) x 
 		   left join entp_shop es on es.shop_id = x.shop_id
 		   left join MV_BASE_PROVINCE_LIST mb on x.p_index = mb.p_index
 		   left join (select b.shop_id,
                    		 b.shop_p_index p_index,
                    		 sum(d.count) xl,
                    		 sum(d.count * d.price) xe
               		    from JXC_SELL_BILL_DETAILS d
               			left join JXC_SELL_BILL b on d.sell_bill_id = b.id
              		   where 1 = 1
                		 <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[b.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-mm-dd hh24:mi:ss')]]></isNotEmpty>
                		 <isNotEmpty prepend=" and " property="map.p_index">substr(b.shop_p_index, 0, 2) || '0000' = #map.p_index#</isNotEmpty>
              		   group by b.shop_id, b.shop_p_index)y on y.shop_id = x.shop_id
 		  where 1 = 1
 		  <isNotEmpty prepend=" and " property="map.shop_name_like">es.shop_name like '%' || #map.shop_name_like# || '%'</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	<!-- 买卖通超级管理后台，进销存网点使用统计（按省查询详细信息）， Ren Zhong， 2011-08-12 END-->
	
	<!-- 买卖通超级管理后台，进销存网点销量分品类统计（按省查询详细信息）， Ren Zhong， 2011-08-29 BEGIN-->
	<resultMap id="jxcShopSalesPdTypeStatisticsResult" class="jxcPd">
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
		<result column="count_bx" property="map.count_bx" jdbcType="DECIMAL" />			
		<result column="count_cd" property="map.count_cd" jdbcType="DECIMAL" />			
		<result column="count_sj" property="map.count_sj" jdbcType="DECIMAL" />			
		<result column="count_xyj" property="map.count_xyj" jdbcType="DECIMAL" />			
		<result column="count_jsj" property="map.count_jsj" jdbcType="DECIMAL" />			
		<result column="count_tk" property="map.count_tk" jdbcType="DECIMAL" />			
		<result column="count_rsq" property="map.count_rsq" jdbcType="DECIMAL" />			
		<result column="count_wbl" property="map.count_wbl" jdbcType="DECIMAL" />			
		<result column="count_dcl" property="map.count_dcl" jdbcType="DECIMAL" />			
		<result column="count_cyyj" property="map.count_cyyj" jdbcType="DECIMAL" />			
		<result column="count_ddzxc" property="map.count_ddzxc" jdbcType="DECIMAL" />			
		<result column="count_dvd" property="map.count_dvd" jdbcType="DECIMAL" />			
		<result column="count_dfb" property="map.count_dfb" jdbcType="DECIMAL" />			
		<result column="count_rqz" property="map.count_rqz" jdbcType="DECIMAL" />			
		<result column="count_dylg" property="map.count_dylg" jdbcType="DECIMAL" />			
		<result column="count_qt" property="map.count_qt" jdbcType="DECIMAL" />			
	</resultMap>
	
	<select id="selectJxcShopSalesPdTypeStatisticsResultForList" resultMap="jxcShopSalesPdTypeStatisticsResult" parameterClass="jxcPd" >
		select mb.p_name,
		       value(y."冰箱-销量", 0) count_bx,
		       value(y."彩电-销量", 0) count_cd,
		       value(y."手机-销量", 0) count_sj,
		       value(y."洗衣机-销量", 0) count_xyj,
		       value(y."计算机-销量", 0) count_jsj,
		       value(y."空调-销量", 0) count_tk,
		       value(y."热水器-销量", 0) count_rsq,
		       value(y."微波炉-销量", 0) count_wbl,
		       value(y."电磁炉-销量", 0) count_dcl,
		       value(y."抽油烟机-销量", 0) count_cyyj,
		       value(y."电动自行车-销量", 0) count_ddzxc,
		       value(y."DVD影碟机-销量", 0) count_dvd,
		       value(y."电饭煲-销量", 0) count_dfb,
		       value(y."燃气灶-销量", 0) count_rqz,
		       value(y."电压力锅-销量", 0) count_dylg,
		       value(y."其他-销量", 0) count_qt
		  from MV_BASE_PROVINCE_LIST mb 
		  left join(select substr(x.p_index, 0, 2) || '0000' p_index,
		               value(sum(decode(x.pd_type, 1, x.count)), 0) "冰箱-销量",
		               value(sum(decode(x.pd_type, 2, x.count)), 0) "彩电-销量",
		               value(sum(decode(x.pd_type, 3, x.count)), 0) "手机-销量",
		               value(sum(decode(x.pd_type, 4, x.count)), 0) "洗衣机-销量",
		               value(sum(decode(x.pd_type, 5, x.count)), 0) "计算机-销量",
		               value(sum(decode(x.pd_type, 6, x.count)), 0) "空调-销量",
		               value(sum(decode(x.pd_type, 7, x.count)), 0) "热水器-销量",
		               value(sum(decode(x.pd_type, 8, x.count)), 0) "微波炉-销量",
		               value(sum(decode(x.pd_type, 9, x.count)), 0) "电磁炉-销量",
		               value(sum(decode(x.pd_type, 1010, x.count)), 0) "抽油烟机-销量",
		               value(sum(decode(x.pd_type, 1011, x.count)), 0) "电动自行车-销量",
		               value(sum(decode(x.pd_type, 1012, x.count)), 0) "DVD影碟机-销量",
		               value(sum(decode(x.pd_type, 1013, x.count)), 0) "电饭煲-销量",
		               value(sum(decode(x.pd_type, 1014, x.count)), 0) "燃气灶-销量",
		               value(sum(decode(x.pd_type, 1015, x.count)), 0) "电压力锅-销量",
		               value(sum(decode(x.pd_type, 0, x.count)), 0) "其他-销量"
		          from (select b.shop_p_index p_index, d.pd_id, d.count, p.pd_type, p.pd_type_name, d.add_date
		                  from JXC_SELL_BILL_DETAILS d
		                  left join JXC_SELL_BILL b on d.sell_bill_id = b.id
		                  left join JXC_PD p on p.id = d.pd_id
		                 where 1 = 1
		                   <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[d.add_date >= to_date(#map.begin_date# || '00:00:00', 'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		                   <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[d.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		                   <isNotEmpty prepend=" and " property="map.sell_src">d.sell_src = #map.sell_src#</isNotEmpty>) x
		         group by substr(x.p_index, 0, 2)) y on y.p_index = mb.p_index
		  where mb.del_mark = 0
		    and mb.p_level = 1
		  order by mb.p_index
	</select>
	<!-- 买卖通超级管理后台，进销存网点销量分品类统计（按省查询详细信息）， Ren Zhong， 2011-08-29 BEGIN-->
	
	<!-- 买卖通超级管理后台，进销存产品(非下乡)销售明细统计， Ren Zhong， 2011-09-01 BEGIN-->
	<resultMap id="jxcShopSalesNotJDXXDetailsResult" class="jxcPd">
		<result column="AREA" property="map.area" jdbcType="VARCHAR" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE_NAME" property="map.pd_type_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
		<result column="COUNT" property="map.count" jdbcType="DECIMAL" />
		<result column="PRICE" property="map.price" jdbcType="DECIMAL" />
		<result column="XE" property="map.xe" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="map.add_date" jdbcType="DATETIME" />
	</resultMap>
	
	<select id="selectJxcShopSalesNotJDXXDetailsResultForList" resultMap="jxcShopSalesNotJDXXDetailsResult" parameterClass="jxcPd" >
		select mb.p_full_name area, 
		       es.shop_name,
		       t.pd_type_name,
		       t.brand_name,
		       t.pd_name,
		       t.count,
		       t.price,
		       t.count*t.price xe,
		       t.add_date
		  from (select d.pd_id, 
		               d.pd_type, 
		               d.pd_type_name, 
		               d.brand_id, 
		               d.brand_name, 
		               d.pd_name, 
		               d.shop_id, 
		               b.shop_p_index,
		               d.count,
		               d.price,
		               d.add_date
		          from JXC_SELL_BILL_DETAILS d
		          left join JXC_SELL_BILL b on d.sell_bill_id = b.id
		         where 1 = 1
		           <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[d.add_date >= to_date(#map.begin_date# || '00:00:00', 'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		           <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[d.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-MM-dd hh24:mi:ss')]]></isNotEmpty>
		           and d.sell_src = 0
		           and b.is_del = 0) t
		  left join MV_BASE_PROVINCE_LIST mb on t.shop_p_index = mb.p_index
		  left join entp_shop es on es.shop_id = t.shop_id
		  order by t.add_date
	</select>
	
	<!-- 买卖通超级管理后台，进销存产品(非下乡)销售明细统计， Ren Zhong， 2011-09-01 END-->
		
	<insert id="insertJxcPd" parameterClass="jxcPd">
		<selectKey resultClass="long" keyProperty="id">select JXC_PD_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into JXC_PD (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>	
			<isNotNull prepend="," property="shop_p_index">SHOP_P_INDEX</isNotNull>	
			<isNotNull prepend="," property="name">NAME</isNotNull>	
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>	
			<isNotNull prepend="," property="brand_name">BRAND_NAME</isNotNull>	
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>	
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME</isNotNull>	
			<isNotNull prepend="," property="unit">UNIT</isNotNull>	
			<isNotNull prepend="," property="init_count">INIT_COUNT</isNotNull>	
			<isNotNull prepend="," property="count">COUNT</isNotNull>	
			<isNotNull prepend="," property="min_count">MIN_COUNT</isNotNull>	
			<isNotNull prepend="," property="ref_price">REF_PRICE</isNotNull>	
			<isNotNull prepend="," property="pf_price">PF_PRICE</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>	
			<isNotNull prepend="," property="out_sys_id">OUT_SYS_ID</isNotNull>
			<isNotNull prepend="," property="init_cost_price">INIT_COST_PRICE</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">CUR_COST_PRICE</isNotNull>	
			<isNotNull prepend="," property="jxc_pd_type_id">JXC_PD_TYPE_ID</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_p_index">#shop_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="name">#name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">#brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">#pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="unit">#unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="init_count">#init_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="count">#count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="min_count">#min_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ref_price">#ref_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pf_price">#pf_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="out_sys_id">#out_sys_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="init_cost_price">#init_cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">#cur_cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jxc_pd_type_id">#jxc_pd_type_id:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateJxcPd" parameterClass="JxcPd">
		update JXC_PD
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_p_index">SHOP_P_INDEX = #shop_p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="name">NAME = #name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_name">BRAND_NAME = #brand_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_name">PD_TYPE_NAME = #pd_type_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="unit">UNIT = #unit:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="init_count">INIT_COUNT = #init_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="count">COUNT = #count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="min_count">MIN_COUNT = #min_count:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="ref_price">REF_PRICE = #ref_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pf_price">PF_PRICE = #pf_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="out_sys_id">OUT_SYS_ID = #out_sys_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="init_cost_price">INIT_COST_PRICE = #init_cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="cur_cost_price">CUR_COST_PRICE = #cur_cost_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="jxc_pd_type_id">JXC_PD_TYPE_ID = #jxc_pd_type_id:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteJxcPd" parameterClass="JxcPd">
		update JXC_PD set is_del = 1 where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>