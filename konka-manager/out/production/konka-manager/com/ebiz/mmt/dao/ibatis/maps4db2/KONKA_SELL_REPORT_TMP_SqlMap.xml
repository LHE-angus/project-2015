<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KonkaSellReportTmp">

    <typeAlias alias="konkaSellReportTmp" type="com.ebiz.mmt.domain.KonkaSellReportTmp" />

	
	
    <resultMap id="konkaSellReportTmpResult" class="konkaSellReportTmp">
		<result property="shop_code" column="SHOP_CODE" jdbcType="VARCHAR" />
		<result property="pd_id" column="PD_ID" jdbcType="DECIMAL" />
		<result property="pd_name" column="PD_NAME" jdbcType="VARCHAR" />
		<result property="pd_type_id" column="PD_TYPE_ID" jdbcType="DECIMAL" />
		<result property="pd_type" column="PD_TYPE" jdbcType="VARCHAR" />
		<result property="a_num" column="A_NUM" jdbcType="DECIMAL" />
		<result property="a_price" column="A_PRICE" jdbcType="DECIMAL" />
		<result property="a_all" column="A_ALL" jdbcType="DECIMAL" />
		<result property="stock_id" column="STOCK_ID" jdbcType="DECIMAL" />
		<result property="gen_date" column="GEN_DATE" jdbcType="DATETIME" />
		<result property="c_num" column="C_NUM" jdbcType="DECIMAL" />
		<result property="c_all" column="C_ALL" jdbcType="DECIMAL" />
    </resultMap>

	<sql id="sf-konkaSellReportTmp">
		<isNotEmpty prepend=" and " property="shop_code">a.SHOP_CODE = #shop_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">a.PD_ID = #pd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_name">a.PD_NAME = #pd_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type_id">a.PD_TYPE_ID = #pd_type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">a.PD_TYPE = #pd_type:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="a_num">a.A_NUM = #a_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="a_price">a.A_PRICE = #a_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="a_all">a.A_ALL = #a_all:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="stock_id">a.STOCK_ID = #stock_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="gen_date">a.GEN_DATE = #gen_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_num">a.C_NUM = #c_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_all">a.C_ALL = #c_all:DECIMAL#</isNotEmpty>
	</sql>
	
	<select id="selectKonkaSellReportTmp" resultMap="konkaSellReportTmpResult" parameterClass="konkaSellReportTmp" >
		select * from KONKA_SELL_REPORT_TMP a where 1=1
		<include refid="sf-konkaSellReportTmp" />
	</select>
	
	<select id="selectKonkaSellReportTmpList" resultMap="konkaSellReportTmpResult" parameterClass="konkaSellReportTmp" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select * from KONKA_SELL_REPORT_TMP a where 1=1
		<include refid="sf-konkaSellReportTmp" />
		<!-- order by a.ID desc -->
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>
	</select>
	
	<select id="selectKonkaSellReportTmpCount" resultClass="long" parameterClass="konkaSellReportTmp" >
		select count(*) from KONKA_SELL_REPORT_TMP a where 1 = 1
		<include refid="sf-konkaSellReportTmp" />
		<isNotNull prepend=" and " property="map.date_like">
			<![CDATA[TO_CHAR(a.GEN_DATE, 'yyyymmdd') = #map.date_like:VARCHAR#]]>
		</isNotNull>
	</select>
	
	<select id="selectKonkaSellReportTmpPaginatedList" resultMap="konkaSellReportTmpResult" parameterClass="konkaSellReportTmp" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_SELL_REPORT_TMP a where 1=1
		<include refid="sf-konkaSellReportTmp" />
		<!-- order by a.ID desc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaSellReportTmpPlus" resultClass="long" parameterClass="konkaSellReportTmp" >
		SELECT (SELECT COUNT(*)
		          FROM CHANNEL_DATA_IMPORT A
		         WHERE 1 = 1
		  <![CDATA[AND TO_CHAR(A.COLUMN_7, 'yyyymmdd') <= #map.date_like:VARCHAR#)]]>
		   -
		       (SELECT COUNT(*)
		          FROM KONKA_SELL_DETAILS A
		          LEFT JOIN KONKA_SELL B ON A.S_ID = B.S_ID
		         WHERE 1 = 1
		  <![CDATA[AND TO_CHAR(B.SELL_DATE, 'yyyymmdd') <= #map.date_like:VARCHAR#)]]>
  		  FROM DUAL
		<include refid="sf-konkaSellReportTmp" />
		   	<isNotEmpty prepend=" and " property="map.shop_code_like">A.SHOP_CODE LIKE '%' || #map.shop_code_like:VARCHAR# || '%'</isNotEmpty>
	</select>
	
	<select id="selectKonkaSellReportTmpForRNCount" resultClass="long" parameterClass="konkaSellReportTmp" >
		SELECT COUNT(*)
			   FROM KONKA_SELL_REPORT_TMP A1
			   LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE = A2.SHOP_CODE
			                                     AND A1.PD_ID = A2.PD_ID
	 <![CDATA[WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') = #map.date_start:VARCHAR#
	   			AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') = #map.date_end:VARCHAR#]]>
	   	<isNotEmpty prepend=" and " property="map.shop_code_like">A1.SHOP_CODE LIKE '%' || #map.shop_code_like:VARCHAR# || '%'</isNotEmpty>
		<include refid="sf-konkaSellReportTmp" />
	</select>
	
	<select id="selectKonkaSellReportTmpForRN" resultClass="HashMap" parameterClass="konkaSellReportTmp" >
	<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
	<![CDATA[SELECT    SHOP_CODE,
				       PD_ID,
				       PD_NAME,
				       A_NUM,
				       A_PRICE,
				       A_ALL,
				       B_NUM,
				       B_ALL / B_NUM AS B_PRICE,
				       B_ALL,
				       C_NUM,
				       C_ALL / C_NUM AS C_PRICE,
				       C_ALL,
				       C_S_ALL / C_NUM AS C_S_PRICE,
				       C_S_ALL,
				       E_NUM,
				       E_ALL / E_NUM AS E_PRICE,
				       E_ALL,
				       D_NUM,
				       D_PRICE,
				       D_ALL
				  FROM (SELECT
				         A1.SHOP_CODE,
				         A1.PD_ID,
				         A1.PD_NAME,
				         A1.A_NUM AS A_NUM,
				         A1.A_PRICE AS A_PRICE,
				         A1.A_ALL AS A_ALL,
				         (SELECT SUM(B1.COLUMN_12)
				            FROM CHANNEL_DATA_IMPORT B1
				           WHERE B1.COLUMN_11 = A1.PD_NAME
				             AND B1.COLUMN_1 = A1.SHOP_CODE
				             AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') >= #map.date_start:VARCHAR#
				             AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS B_NUM,
				         (SELECT SUM(B2.COLUMN_14)
				            FROM CHANNEL_DATA_IMPORT B2
				           WHERE B2.COLUMN_11 = A1.PD_NAME
				             AND B2.COLUMN_1 = A1.SHOP_CODE
				             AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') >= #map.date_start:VARCHAR#
				             AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS B_ALL,
				         (SELECT SUM(C11.SELL_COUNT)
				            FROM KONKA_SELL_DETAILS C11
				            LEFT JOIN KONKA_SELL C12 ON C11.S_ID = C12.S_ID
				           WHERE C12.CUS_SN = A1.SHOP_CODE
				             AND C11.PD_ID = A1.PD_ID
				             AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR#
				             AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_NUM,
		                 (SELECT SUM(A3.C_ALL)
		                    FROM KONKA_SELL_REPORT_TMP A3
		                   WHERE A3.SHOP_CODE = A1.SHOP_CODE
		                     AND A3.PD_ID = A1.PD_ID
		                     AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR#
		                     AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_ALL,
				         (SELECT SUM(C11.SELL_MONEY * C11.SELL_COUNT)
				            FROM KONKA_SELL_DETAILS C11
				            LEFT JOIN KONKA_SELL C12 ON C11.S_ID = C12.S_ID
				           WHERE C12.CUS_SN = A1.SHOP_CODE
				             AND C11.PD_ID = A1.PD_ID
				             AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR#
				             AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_S_ALL,
				         A2.A_NUM   AS D_NUM,
				         A2.A_PRICE AS D_PRICE,
				         A2.A_ALL   AS D_ALL
				          FROM KONKA_SELL_REPORT_TMP A1
				          LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE = A2.SHOP_CODE
				                                            AND A1.PD_ID = A2.PD_ID
				         WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') = #map.date_start:VARCHAR#
				           AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') = #map.date_end:VARCHAR#]]>
				        <isNotEmpty prepend=" and " property="map.md_name_like">A1.PD_NAME LIKE '%' || #map.md_name_like:VARCHAR# || '%'</isNotEmpty>
				        <isNotEmpty prepend=" and " property="map.shop_code_like">A1.SHOP_CODE LIKE '%' || #map.shop_code_like:VARCHAR# || '%'</isNotEmpty>
						<include refid="sf-konkaSellReportTmp" />
						)
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaSellReportTmpForRNALL" resultClass="HashMap" parameterClass="konkaSellReportTmp" >
		SELECT SUM(A_ALL), SUM(B_ALL), SUM(C_ALL), SUM(C_S_ALL), SUM(D_ALL), SUM(E_ALL)
		  FROM (SELECT A1.SHOP_CODE,
		               A1.PD_ID,
		               A1.PD_NAME,
		               A1.A_NUM AS A_NUM,
		               A1.A_PRICE AS A_PRICE,
		               A1.A_ALL AS A_ALL,
		               (SELECT SUM(B1.COLUMN_12)
		                  FROM CHANNEL_DATA_IMPORT B1
		                 WHERE B1.COLUMN_11 = A1.PD_NAME
		                   AND B1.COLUMN_1 = A1.SHOP_CODE
		          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') >= #map.date_start:VARCHAR# ]]>
		          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS B_NUM, ]]>
		               (SELECT SUM(B2.COLUMN_14)
		                  FROM CHANNEL_DATA_IMPORT B2
		                 WHERE B2.COLUMN_11 = A1.PD_NAME
		                   AND B2.COLUMN_1 = A1.SHOP_CODE
		          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') >= #map.date_start:VARCHAR# ]]>
		          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS B_ALL, ]]>
		               (SELECT SUM(C11.SELL_COUNT)
		                  FROM KONKA_SELL_DETAILS C11
		                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID = C12.S_ID
		                 WHERE C12.CUS_SN = A1.SHOP_CODE
		                   AND C11.PD_ID = A1.PD_ID
		          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR# ]]>
		          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_NUM, ]]>
                       (SELECT SUM(A3.C_ALL)
                          FROM KONKA_SELL_REPORT_TMP A3
                         WHERE A3.SHOP_CODE = A1.SHOP_CODE
                           AND A3.PD_ID = A1.PD_ID
                  <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR# ]]>
                  <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_ALL, ]]>
		               (SELECT SUM(C11.SELL_MONEY * C11.SELL_COUNT)
		                  FROM KONKA_SELL_DETAILS C11
		                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID = C12.S_ID
		                 WHERE C12.CUS_SN = A1.SHOP_CODE
		                   AND C11.PD_ID = A1.PD_ID
		          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >= #map.date_start:VARCHAR# ]]>
		          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <= #map.date_end:VARCHAR#) AS C_S_ALL, ]]>
		               A2.A_NUM AS D_NUM,
		               A2.A_PRICE AS D_PRICE,
		               A2.A_ALL AS D_ALL
		          FROM KONKA_SELL_REPORT_TMP A1
		          LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE = A2.SHOP_CODE
		                                            AND A1.PD_ID = A2.PD_ID
		         WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') = #map.date_start:VARCHAR#
		           AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') = #map.date_end:VARCHAR#)
	</select>
	
	<select id="selectKonkaSellReportTmpForJBCount" resultClass="long" parameterClass="konkaSellReportTmp" >
		SELECT COUNT(1)
		  FROM (SELECT PD_ID, PD_NAME
		          FROM (SELECT A1.SHOP_CODE, A1.PD_ID, A1.PD_NAME
		                  FROM KONKA_SELL_REPORT_TMP A1
		                  LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE =
		                                                        A2.SHOP_CODE
		                                                    AND A1.PD_ID = A2.PD_ID
		        <![CDATA[WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') = #map.date_start:VARCHAR# ]]>
		        <![CDATA[  AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') = #map.date_end:VARCHAR#) A, ]]>
		               KONKA_R3_SHOP B
		         WHERE A.SHOP_CODE = B.R3_CODE
				<isNotEmpty prepend=" and " property="map.handle_name">B.HANDLE_NAME = #map.handle_name:VARCHAR#</isNotEmpty>
				<isNotEmpty prepend=" and " property="map.fg">B.BRANCH_AREA_NAME = #map.fg:VARCHAR#</isNotEmpty>
		         GROUP BY A.PD_ID, PD_NAME)
	</select>
	
	<select id="selectKonkaSellReportTmpForJB" resultClass="HashMap" parameterClass="konkaSellReportTmp" >
	<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
				SELECT PD_ID,
				       PD_NAME,
				       A_NUM,
				       DIVIDER_ZERO(A_ALL, A_NUM) AS A_PRICE,
				       A_ALL,
				       B_NUM,
				       DIVIDER_ZERO(B_ALL, B_NUM) AS B_PRICE,
				       B_ALL,
				       C_NUM,
				       DIVIDER_ZERO(C_ALL, C_NUM) AS C_PRICE,
				       C_ALL,
				       DIVIDER_ZERO(C_S_ALL, C_NUM) AS C_S_PRICE,
				       C_S_ALL,
				       E_NUM,
				       DIVIDER_ZERO(E_ALL, E_NUM) AS E_PRICE,
				       E_ALL,
				       D_NUM,
				       DIVIDER_ZERO(D_ALL, D_NUM) AS D_PRICE,
				       D_ALL
				  FROM (SELECT PD_ID,
				               PD_NAME,
				               SUM(A_NUM) AS A_NUM,
				               SUM(A_ALL) AS A_ALL,
				               SUM(B_NUM) AS B_NUM,
				               SUM(B_ALL) AS B_ALL,
				               SUM(C_NUM) AS C_NUM,
				               SUM(C_ALL) AS C_ALL,
				               SUM(C_S_ALL) AS C_S_ALL,
				               SUM(D_NUM) AS D_NUM,
				               SUM(D_ALL) AS D_ALL,
				               SUM(E_NUM) AS E_NUM,
				               SUM(E_ALL) AS E_ALL
				          FROM (SELECT SHOP_CODE,
				                       PD_ID,
				                       PD_NAME,
				                       A_NUM,
				                       A_PRICE,
				                       A_ALL,
				                       B_NUM,
				                       B_ALL / B_NUM AS B_PRICE,
				                       B_ALL,
				                       C_NUM,
				                       C_ALL / C_NUM AS C_PRICE,
				                       C_ALL,
				                       C_S_ALL / C_NUM AS C_S_PRICE,
				                       C_S_ALL,
				                       E_NUM,
				                       E_ALL / E_NUM AS E_PRICE,
				                       E_ALL,
				                       D_NUM,
				                       D_PRICE,
				                       D_ALL
				                  FROM (SELECT A1.SHOP_CODE,
				                               A1.PD_ID,
				                               A1.PD_NAME,
				                               A1.A_NUM AS A_NUM,
				                               A1.A_PRICE AS A_PRICE,
				                               A1.A_ALL AS A_ALL,
				                               (SELECT SUM(B1.COLUMN_12)
				                                  FROM CHANNEL_DATA_IMPORT B1
				                                 WHERE B1.COLUMN_11 = A1.PD_NAME
				                                   AND B1.COLUMN_1 = A1.SHOP_CODE
				                          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') >=]]>
				                                       #map.date_start:VARCHAR#
				                          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') <=]]>
				                                       #map.date_end:VARCHAR#) AS B_NUM,
				                               (SELECT SUM(B2.COLUMN_14)
				                                  FROM CHANNEL_DATA_IMPORT B2
				                                 WHERE B2.COLUMN_11 = A1.PD_NAME
				                                   AND B2.COLUMN_1 = A1.SHOP_CODE
				                          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') >=]]>
				                                       #map.date_start:VARCHAR#
				                          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') <=]]>
				                                       #map.date_end:VARCHAR#) AS B_ALL,
				                               (SELECT SUM(C11.SELL_COUNT)
				                                  FROM KONKA_SELL_DETAILS C11
				                                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID =
				                                                              C12.S_ID
				                                 WHERE C12.CUS_SN = A1.SHOP_CODE
				                                   AND C11.PD_ID = A1.PD_ID
				                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >=]]>
				                                       #map.date_start:VARCHAR#
				                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <=]]>
				                                       #map.date_end:VARCHAR#) AS C_NUM,
				                               (SELECT SUM(A3.C_ALL)
				                                  FROM KONKA_SELL_REPORT_TMP A3
				                                 WHERE A3.SHOP_CODE = A1.SHOP_CODE
				                                   AND A3.PD_ID = A1.PD_ID
				                          <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') >=]]>
				                                       #map.date_start:VARCHAR#
				                          <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') <=]]>
				                                       #map.date_end:VARCHAR#) AS C_ALL,
				                               (SELECT SUM(C11.SELL_MONEY * C11.SELL_COUNT)
				                                  FROM KONKA_SELL_DETAILS C11
				                                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID =
				                                                              C12.S_ID
				                                 WHERE C12.CUS_SN = A1.SHOP_CODE
				                                   AND C11.PD_ID = A1.PD_ID
				                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >=]]>
				                                       #map.date_start:VARCHAR#
				                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <=]]>
				                                       #map.date_end:VARCHAR#) AS C_S_ALL,
				                               A2.A_NUM AS D_NUM,
				                               A2.A_PRICE AS D_PRICE,
				                               A2.A_ALL AS D_ALL
				                          FROM KONKA_SELL_REPORT_TMP A1
				                          LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE =
				                                                                A2.SHOP_CODE
				                                                            AND A1.PD_ID =
				                                                                A2.PD_ID
				                         WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') =
				                               #map.date_start:VARCHAR#
				                           AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') =
				                               #map.date_end:VARCHAR#)) A,
				               KONKA_R3_SHOP B
				         WHERE A.SHOP_CODE = B.R3_CODE
				         <isNotEmpty prepend=" and " property="map.handle_name">B.HANDLE_NAME = #map.handle_name:VARCHAR#</isNotEmpty>
				         <isNotEmpty prepend=" and " property="map.fg">B.BRANCH_AREA_NAME = #map.fg:VARCHAR#</isNotEmpty>
				         GROUP BY A.PD_ID, PD_NAME)
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectKonkaSellReportTmpForJBALL" resultClass="HashMap" parameterClass="konkaSellReportTmp" >
		SELECT SUM(A_ALL), SUM(B_ALL), SUM(C_ALL), SUM(C_S_ALL), SUM(D_ALL), SUM(E_ALL)
			  FROM (SELECT PD_ID,
			               PD_NAME,
			               SUM(A_NUM) AS A_NUM,
			               SUM(A_ALL) AS A_ALL,
			               SUM(B_NUM) AS B_NUM,
			               SUM(B_ALL) AS B_ALL,
			               SUM(C_NUM) AS C_NUM,
			               SUM(C_ALL) AS C_ALL,
			               SUM(C_S_ALL) AS C_S_ALL,
			               SUM(D_NUM) AS D_NUM,
			               SUM(D_ALL) AS D_ALL,
			               SUM(E_NUM) AS E_NUM,
			               SUM(E_ALL) AS E_ALL
			          FROM (SELECT SHOP_CODE,
			                       PD_ID,
			                       PD_NAME,
			                       A_NUM,
			                       A_PRICE,
			                       A_ALL,
			                       B_NUM,
			                       B_ALL / B_NUM AS B_PRICE,
			                       B_ALL,
			                       C_NUM,
			                       C_ALL / C_NUM AS C_PRICE,
			                       C_ALL,
			                       C_S_ALL / C_NUM AS C_S_PRICE,
			                       C_S_ALL,
			                       E_NUM,
			                       E_ALL / E_NUM AS E_PRICE,
			                       E_ALL,
			                       D_NUM,
			                       D_PRICE,
			                       D_ALL
			                  FROM (SELECT A1.SHOP_CODE,
			                               A1.PD_ID,
			                               A1.PD_NAME,
			                               A1.A_NUM AS A_NUM,
			                               A1.A_PRICE AS A_PRICE,
			                               A1.A_ALL AS A_ALL,
			                               (SELECT SUM(B1.COLUMN_12)
			                                  FROM CHANNEL_DATA_IMPORT B1
			                                 WHERE B1.COLUMN_11 = A1.PD_NAME
			                                   AND B1.COLUMN_1 = A1.SHOP_CODE
			                          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') >=]]>
			                                       #map.date_start:VARCHAR#
			                          <![CDATA[AND TO_CHAR(B1.COLUMN_7, 'yyyy-mm-dd') <=]]>
			                                       #map.date_end:VARCHAR#) AS B_NUM,
			                               (SELECT SUM(B2.COLUMN_14)
			                                  FROM CHANNEL_DATA_IMPORT B2
			                                 WHERE B2.COLUMN_11 = A1.PD_NAME
			                                   AND B2.COLUMN_1 = A1.SHOP_CODE
			                          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') >=]]>
			                                       #map.date_start:VARCHAR#
			                          <![CDATA[AND TO_CHAR(B2.COLUMN_7, 'yyyy-mm-dd') <=]]>
			                                       #map.date_end:VARCHAR#) AS B_ALL,
			                               (SELECT SUM(C11.SELL_COUNT)
			                                  FROM KONKA_SELL_DETAILS C11
			                                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID =
			                                                              C12.S_ID
			                                 WHERE C12.CUS_SN = A1.SHOP_CODE
			                                   AND C11.PD_ID = A1.PD_ID
			                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >=]]>
			                                       #map.date_start:VARCHAR#
			                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <=]]>
			                                       #map.date_end:VARCHAR#) AS C_NUM,
			                               (SELECT SUM(A3.C_ALL)
			                                  FROM KONKA_SELL_REPORT_TMP A3
			                                 WHERE A3.SHOP_CODE = A1.SHOP_CODE
			                                   AND A3.PD_ID = A1.PD_ID
			                          <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') >=]]>
			                                       #map.date_start:VARCHAR#
			                          <![CDATA[AND TO_CHAR(A3.GEN_DATE, 'yyyy-mm-dd') <=]]>
			                                       #map.date_end:VARCHAR#) AS C_ALL,
			                               (SELECT SUM(C11.SELL_MONEY * C11.SELL_COUNT)
			                                  FROM KONKA_SELL_DETAILS C11
			                                  LEFT JOIN KONKA_SELL C12 ON C11.S_ID =
			                                                              C12.S_ID
			                                 WHERE C12.CUS_SN = A1.SHOP_CODE
			                                   AND C11.PD_ID = A1.PD_ID
			                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') >=]]>
			                                       #map.date_start:VARCHAR#
			                          <![CDATA[AND TO_CHAR(C12.SELL_DATE, 'yyyy-mm-dd') <=]]>
			                                       #map.date_end:VARCHAR#) AS C_S_ALL,
			                               A2.A_NUM AS D_NUM,
			                               A2.A_PRICE AS D_PRICE,
			                               A2.A_ALL AS D_ALL
			                          FROM KONKA_SELL_REPORT_TMP A1
			                          LEFT JOIN KONKA_SELL_REPORT_TMP A2 ON A1.SHOP_CODE =
			                                                                A2.SHOP_CODE
			                                                            AND A1.PD_ID =
			                                                                A2.PD_ID
			                         WHERE TO_CHAR(A1.GEN_DATE, 'yyyy-mm-dd') =
			                               #map.date_start:VARCHAR#
			                           AND TO_CHAR(A2.GEN_DATE, 'yyyy-mm-dd') =
			                               #map.date_end:VARCHAR#)) A,
			               KONKA_R3_SHOP B
			         WHERE A.SHOP_CODE = B.R3_CODE
         <isNotEmpty prepend=" and " property="map.handle_name">B.HANDLE_NAME = #map.handle_name:VARCHAR#</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.fg">a.BRANCH_AREA_NAME = #map.fg:VARCHAR#</isNotEmpty>)
	</select>

	<insert id="insertKonkaSellReportTmp" parameterClass="konkaSellReportTmp">
		<![CDATA[insert into KONKA_SELL_REPORT_TMP (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="shop_code">SHOP_CODE</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID</isNotNull>
			<isNotNull prepend="," property="pd_name">PD_NAME</isNotNull>
			<isNotNull prepend="," property="pd_type_id">PD_TYPE_ID</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>
			<isNotNull prepend="," property="a_num">A_NUM</isNotNull>
			<isNotNull prepend="," property="a_price">A_PRICE</isNotNull>
			<isNotNull prepend="," property="a_all">A_ALL</isNotNull>
			<isNotNull prepend="," property="stock_id">STOCK_ID</isNotNull>
			<isNotNull prepend="," property="gen_date">GEN_DATE</isNotNull>
			<isNotNull prepend="," property="c_num">C_NUM</isNotNull>
			<isNotNull prepend="," property="c_all">C_ALL</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="shop_code">#shop_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_id">#pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_name">#pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type_id">#pd_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="a_num">#a_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="a_price">#a_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="a_all">#a_all:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_id">#stock_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="gen_date">#gen_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="c_num">#c_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_all">#c_all:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>
	
	<update id="updateKonkaSellReportTmp" parameterClass="konkaSellReportTmp">
		update KONKA_SELL_REPORT_TMP
		<dynamic prepend="set">
			<isNotNull prepend="," property="shop_code">SHOP_CODE = #shop_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_name">PD_NAME = #pd_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type_id">PD_TYPE_ID = #pd_type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="a_num">A_NUM = #a_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="a_price">A_PRICE = #a_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="a_all">A_ALL = #a_all:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_id">STOCK_ID = #stock_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="gen_date">GEN_DATE = #gen_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="c_num">C_NUM = #c_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_all">C_ALL = #c_all:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaSellReportTmp" parameterClass="konkaSellReportTmp">
		delete from KONKA_SELL_REPORT_TMP a where 1 = 1
		<isNotNull prepend=" and " property="map.date_like">
			<![CDATA[TO_CHAR(a.GEN_DATE, 'yyyymmdd') = #map.date_like:VARCHAR#]]>
		</isNotNull>
	</delete>
</sqlMap>
