<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="EC_GOODS_PRICE">

	<typeAlias alias="ecGoodsPrice" type="com.ebiz.mmt.domain.EcGoodsPrice" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertEcGoodsPrice" />
		<flushOnExecute statement="updateEcGoodsPrice" />
		<flushOnExecute statement="deleteEcGoodsPrice" />
	</cacheModel>

	<resultMap id="ecGoodsPriceResultForList" class="ecGoodsPrice">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="GOODS_ID" property="goods_id" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="DEPT_ID" property="dept_id" jdbcType="DECIMAL" />
		<result column="PRICE_TYPE" property="price_type" jdbcType="DECIMAL" />
		<result column="START_TIME" property="start_time" jdbcType="TIMESTAMP" />
		<result column="END_TIME" property="end_time" jdbcType="TIMESTAMP" />
		<result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
		<result column="IS_DEL" property="is_del" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="ORIGINAL_PRICE" property="original_price" jdbcType="DECIMAL" />
		<result column="PRICE2" property="price2" jdbcType="DECIMAL" />
		<result column="PRICE3" property="price3" jdbcType="DECIMAL" />
		<result column="PRICE4" property="price4" jdbcType="DECIMAL" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="C_ID" property="c_id" jdbcType="DECIMAL" />
		<result column="PLAT_SYS" property="plat_sys" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="ecGoodsPriceResult" class="ecGoodsPrice" extends="ecGoodsPriceResultForList">
	</resultMap>
	
	<!-- add by Jiang,JiaYong 2013-09-14 -->
	<resultMap id="ecGoodsPriceIncludePindexResultList" class="ecGoodsPrice" extends="ecGoodsPriceResultForList">
		<result column="PINDEX_ID" property="map.pindex_id" jdbcType="DECIMAL" />
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="ecGoodsPriceForDeptNameAndPdNameResult" class="ecGoodsPrice" extends="ecGoodsPriceResultForList">
		<result column="DEPT_NAME" property="map.dept_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
	</resultMap>
	
		
	<resultMap id="ecGoodsPriceForDeptNameAndPdNameNewResult" class="ecGoodsPrice" extends="ecGoodsPriceResultForList">
		<result column="GROUP_NAME" property="map.group_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
	</resultMap>
	
	

	<sql id="sf-ecGoodsPrice">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_id">GOODS_ID = #goods_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_type">PRICE_TYPE = #price_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="start_time">START_TIME = #start_time:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_time">END_TIME = #end_time:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="original_price">ORIGINAL_PRICE = #original_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price2">PRICE2 = #price2:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price3">PRICE3 = #price3:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price4">PRICE4 = #price4:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">C_ID = #c_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="plat_sys">PLAT_SYS = #plat_sys:DECIMAL#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.dept_id_is_null">DEPT_ID is null</isNotEmpty>
	</sql>

	<sql id="sf-ecGoodsPrice-t">
		<isNotEmpty prepend=" and " property="id">t.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="goods_id">t.GOODS_ID = #goods_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">t.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_type">t.PRICE_TYPE = #price_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="start_time">t.START_TIME = #start_time:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_time">t.END_TIME = #end_time:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="remarks">t.REMARKS = #remarks:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">t.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">t.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="original_price">t.ORIGINAL_PRICE = #original_price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price2">t.PRICE2 = #price2:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price3">t.PRICE3 = #price3:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price4">t.PRICE4 = #price4:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">t.OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">t.C_ID = #c_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="plat_sys">t.PLAT_SYS = #plat_sys:DECIMAL#</isNotEmpty>
	
		<isNotEmpty prepend=" and " property="map.dept_id_is_null">t.DEPT_ID is null</isNotEmpty>
	</sql>
	
	<select id="selectEcGoodsPrice" resultMap="ecGoodsPriceResult" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select * from EC_GOODS_PRICE where 1 = 1
		<include refid="sf-ecGoodsPrice" />
	</select>

	<select id="selectEcGoodsPriceList" resultMap="ecGoodsPriceResultForList" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from EC_GOODS_PRICE where 1 = 1
		<include refid="sf-ecGoodsPrice" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- add by Jiang,JiaYong 2013-09-10 -->
	<select id="selectEcGoodsPriceWithGoodsIdAndPindexList" resultMap="ecGoodsPriceIncludePindexResultList" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
			SELECT *
			  FROM (SELECT t1.*, t2.PINDEX_ID, t2.P_NAME FROM EC_GOODS_PRICE t1, EC_GOODS_PRICE_AREA t2 WHERE t1.IS_DEL = 0 AND t2.IS_DEL = 0 AND t1.ID = t2.PRICE_ID AND t1.PRICE_TYPE = 3 
			         		<isNotEmpty prepend=" and " property="map.own_sys_in_01"> t1.own_sys =1 and t1.dept_id is null</isNotEmpty>
			         		<isNotEmpty prepend=" and " property="map.own_sys_in_05"> t1.own_sys =1 and t1.dept_id= #map.dept_id#</isNotEmpty>
					        <isNotEmpty prepend=" and " property="map.own_sys_in_02"> t1.own_sys =2 and t1.dept_id= #map.dept_id# </isNotEmpty>
			         	   AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_3_in">#map.pindex_type_3_in[]#</iterate>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, t2.PINDEX_ID, t2.P_NAME FROM EC_GOODS_PRICE t1, EC_GOODS_PRICE_AREA t2 WHERE t1.IS_DEL = 0 AND t2.IS_DEL = 0 AND t1.ID = t2.PRICE_ID AND t1.PRICE_TYPE = 2 
				           <isNotEmpty prepend=" and " property="map.own_sys_in_01">
					        t1.own_sys =1  AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_2_in">#map.pindex_type_2_in[]#</iterate>
			         	   </isNotEmpty>
			         	   <isNotEmpty prepend=" and " property="map.own_sys_in_05">
					        t1.own_sys =1 and t1.dept_id= #map.dept_id# AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_2_in">#map.pindex_type_2_in[]#</iterate>
			         	   </isNotEmpty>
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">
					        t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#
					        AND (select count(*) from konka_dept where  dept_type =3 and dept_id= #map.dept_id:DECIMAL# and <iterate close=")" open="(" conjunction=" or " property="map.pindex_type_2_in">m_areas_ids like '%' || #map.pindex_type_2_in[]# || '%'</iterate>) > 0
					       </isNotEmpty>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 0  AND t1.GOODS_ID = #goods_id:DECIMAL#
					       <isNotEmpty prepend=" and " property="map.own_sys_in_01">t1.own_sys =1 and t1.dept_id is null</isNotEmpty>
					       <isNotEmpty prepend=" and " property="map.own_sys_in_05">t1.own_sys =1 and t1.dept_id= #map.dept_id:DECIMAL#</isNotEmpty>
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#</isNotEmpty>
					<isNotEmpty prepend=" " property="map.c_id">
						UNION
                          SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 4 AND t1.GOODS_ID = #goods_id:DECIMAL#
						  <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id= #map.dept_id# and t1.c_id= #map.c_id#  </isNotEmpty>
					</isNotEmpty>
			        ) t
			ORDER BY t.PRICE_TYPE DESC
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	
	
	<select id="selectEcGoodsPriceWithGoodsIdAndPindexNewList" resultMap="ecGoodsPriceIncludePindexResultList" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
			SELECT *
			  FROM (
			  <isNotEmpty property="map.plat_sys_eq_1">
			  		 <isNotEmpty prepend=" " property="map.c_id">
                          SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 4 AND t1.GOODS_ID = #goods_id:DECIMAL# and t1.plat_sys = 1
						  <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id= #map.dept_id# and t1.c_id= #map.c_id#  </isNotEmpty>
					UNION
					</isNotEmpty>	
			         SELECT t1.*, t2.PINDEX_ID, t2.P_NAME FROM EC_GOODS_PRICE t1, EC_GOODS_PRICE_AREA t2 WHERE t1.IS_DEL = 0 AND t2.IS_DEL = 0 AND t1.ID = t2.PRICE_ID AND t1.PRICE_TYPE = 3 and t1.plat_sys = 1
					        <isNotEmpty prepend=" and " property="map.own_sys_in_02"> t1.own_sys =2 and t1.dept_id= #map.dept_id# </isNotEmpty>
			         	   AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_3_in">#map.pindex_type_3_in[]#</iterate>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			         SELECT t1.*, '' as PINDEX_ID, '' as P_NAME  FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0  AND t1.PRICE_TYPE = 2 and t1.plat_sys = 1
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">
					        t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#
					       </isNotEmpty>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 0 and t1.plat_sys = 1 AND t1.GOODS_ID = #goods_id:DECIMAL#
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id = 0</isNotEmpty>
					UNION
			        SELECT t1.*, t2.PINDEX_ID, t2.P_NAME FROM EC_GOODS_PRICE t1, EC_GOODS_PRICE_AREA t2 WHERE t1.IS_DEL = 0 AND t2.IS_DEL = 0 AND t1.ID = t2.PRICE_ID AND t1.PRICE_TYPE = 3 and t1.plat_sys = 0
					        <isNotEmpty prepend=" and " property="map.own_sys_in_02"> t1.own_sys =2 and t1.dept_id= #map.dept_id# </isNotEmpty>
			         	   AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_3_in">#map.pindex_type_3_in[]#</iterate>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME  FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0  AND t1.PRICE_TYPE = 2 and t1.plat_sys = 0
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">
					        t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#
					       </isNotEmpty>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME  FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 0 and t1.plat_sys = 0
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">
					        t1.own_sys =2 and t1.dept_id= 0
					       </isNotEmpty>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
							<![CDATA[ and (select count(*) from EC_GOODS_PRICE where dept_id=#map.dept_id:DECIMAL# and goods_id=#goods_id:DECIMAL# AND PRICE_TYPE = 0 )<1 ]]>
			</isNotEmpty>
			 <isNotEmpty property="map.plat_sys_eq_0">
			 		<isNotEmpty prepend=" " property="map.c_id">
                    SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 4 AND t1.GOODS_ID = #goods_id:DECIMAL# and t1.plat_sys = 0
						 <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id= #map.dept_id# and t1.c_id= #map.c_id#  </isNotEmpty>
						  UNION
					</isNotEmpty>
			        SELECT t1.*, t2.PINDEX_ID, t2.P_NAME FROM EC_GOODS_PRICE t1, EC_GOODS_PRICE_AREA t2 WHERE t1.IS_DEL = 0 AND t2.IS_DEL = 0 AND t1.ID = t2.PRICE_ID AND t1.PRICE_TYPE = 3 and t1.plat_sys = 0
					        <isNotEmpty prepend=" and " property="map.own_sys_in_02"> t1.own_sys =2 and t1.dept_id= #map.dept_id# </isNotEmpty>
			         	   AND t2.PINDEX_ID in <iterate close=")" open="(" conjunction="," property="map.pindex_type_3_in">#map.pindex_type_3_in[]#</iterate>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME  FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0  AND t1.PRICE_TYPE = 2 and t1.plat_sys = 0
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">
					        t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#
					       </isNotEmpty>
			         	   AND t1.GOODS_ID = #goods_id:DECIMAL#
			        UNION
			        SELECT t1.*, '' as PINDEX_ID, '' as P_NAME FROM EC_GOODS_PRICE t1 WHERE t1.IS_DEL = 0 AND t1.PRICE_TYPE = 0 and t1.plat_sys = 0 AND t1.GOODS_ID = #goods_id:DECIMAL#
					       <isNotEmpty prepend=" and " property="map.own_sys_in_02">t1.own_sys =2 and t1.dept_id= #map.dept_id:DECIMAL#</isNotEmpty>
					
			</isNotEmpty>
					
			        ) t
			  ORDER BY t.plat_sys DESC , t.PRICE_TYPE DESC  
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	
	
	
	<select id="selectEcGoodsPriceForDeptNameAndPdNameNewList" resultMap="ecGoodsPriceForDeptNameAndPdNameNewResult" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,a.pd_name as pd_name, b.group_name as group_name from ec_goods_price t 
      	 left join konka_bcomp_pd a on t.goods_id = a.id  LEFT JOIN ec_group b
                          ON t.dept_id = b.id where 1 = 1
		<include refid="sf-ecGoodsPrice-t" />
		<isNotEmpty prepend=" and " property="map.is_fgs">t.PLAT_SYS=1 and t.PRICE_TYPE=0 and t.DEPT_ID = 0 </isNotEmpty>
		<isNotEmpty prepend="" property="map.is_fgs">
		     UNION
		SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a ON t.goods_id = a.id
           LEFT JOIN ec_group b
                          ON t.dept_id = b.id LEFT JOIN EC_GOODS_PRICE_AREA c ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=2 and  t.dept_id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>
             UNION
		SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a
             ON t.goods_id = a.id LEFT JOIN ec_group b
                          ON t.dept_id = b.id LEFT JOIN EC_GOODS_PRICE_AREA c  ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=3  and  t.dept_id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>
               UNION
                SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name
                  FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a  ON t.goods_id = a.id LEFT JOIN ec_group b
                          ON t.dept_id = b.id
                   WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=4 
         <isNotEmpty prepend=" and " property="map.c_ids">
            		t.c_id IN 
            <iterate close=")" open="(" conjunction="," property="map.c_ids">#map.c_ids[]#</iterate>
         </isNotEmpty>
		</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectEcGoodsPriceForDeptNameAndPdNameNewCount" resultClass="long" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select count(*) from (
		select t.*,a.pd_name as pd_name, b.group_name as group_name from ec_goods_price t 
      	 left join konka_bcomp_pd a on t.goods_id = a.id  LEFT JOIN ec_group b
                          ON t.dept_id = b.id where 1 = 1
		<include refid="sf-ecGoodsPrice-t" />
		<isNotEmpty prepend=" and " property="map.is_fgs">t.PLAT_SYS=1 and t.PRICE_TYPE=0 and t.DEPT_ID = 0 </isNotEmpty>
		<isNotEmpty prepend="" property="map.is_fgs">
		     UNION
		SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a ON t.goods_id = a.id
           LEFT JOIN ec_group b
                          ON t.dept_id = b.id LEFT JOIN EC_GOODS_PRICE_AREA c ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=2 and  t.dept_id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>
             UNION
		SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a
             ON t.goods_id = a.id LEFT JOIN ec_group b
                          ON t.dept_id = b.id LEFT JOIN EC_GOODS_PRICE_AREA c  ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=3 and t.dept_id in <iterate close=")" open="(" conjunction="," property="map.is_fgs">#map.is_fgs[]#</iterate>
               UNION
                SELECT t.*, a.pd_name AS pd_name, b.group_name as group_name
                  FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a  ON t.goods_id = a.id LEFT JOIN ec_group b
                          ON t.dept_id = b.id
                   WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PLAT_SYS=1 and t.PRICE_TYPE=4 
         <isNotEmpty prepend=" and " property="map.c_ids">
            		t.c_id IN 
            <iterate close=")" open="(" conjunction="," property="map.c_ids">#map.c_ids[]#</iterate>
         </isNotEmpty>
         
		</isNotEmpty>
		)
	</select>
	
	
	<select id="selectEcGoodsPriceForDeptNameAndPdNameList" resultMap="ecGoodsPriceForDeptNameAndPdNameResult" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.*,a.pd_name as pd_name, b.dept_name as dept_name from ec_goods_price t 
      	 left join konka_bcomp_pd a on t.goods_id = a.id left join konka_dept b on t.dept_id = b.dept_id where 1 = 1
		<include refid="sf-ecGoodsPrice-t" />
		<isNotEmpty prepend=" and " property="map.own_sys_in">t.own_sys in $map.own_sys_in$</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_fgs">t.dept_id=#map.is_fgs#</isNotEmpty>
		<isNotEmpty prepend="" property="map.is_fgs">
              UNION
		SELECT t.*, a.pd_name AS pd_name, b.dept_name AS dept_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a ON t.goods_id = a.id
           LEFT JOIN konka_dept b ON t.dept_id = b.dept_id LEFT JOIN EC_GOODS_PRICE_AREA c ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PRICE_TYPE=3 
              <isNotEmpty prepend=" and " property="map.own_sys_in"> t.own_sys in $map.own_sys_in$ </isNotEmpty>
              <isNotEmpty prepend=" and " property="map.pindex_ids">
              		substr ( c.PINDEX_ID, 0, 4) IN  <iterate close=")" open="(" conjunction="," property="map.pindex_ids">#map.pindex_ids[]#</iterate>
              </isNotEmpty>
                UNION
                SELECT t.*, a.pd_name AS pd_name, b.dept_name AS dept_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a ON t.goods_id = a.id LEFT JOIN konka_dept b ON t.dept_id = b.dept_id
                WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PRICE_TYPE=4 
         <isNotEmpty prepend=" and " property="map.own_sys_in"> t.own_sys in $map.own_sys_in$ </isNotEmpty>
         <isNotEmpty prepend=" and " property="map.c_ids">
            		t.c_id IN  <iterate close=")" open="(" conjunction="," property="map.c_ids">#map.c_ids[]#</iterate>
         </isNotEmpty>
              
		</isNotEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectEcGoodsPriceForDeptNameAndPdNameCount" resultClass="long" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select count(*) from (
		select t.*,a.pd_name as pd_name, b.dept_name as dept_name from ec_goods_price t 
      	 left join konka_bcomp_pd a on t.goods_id = a.id  left join konka_dept b on t.dept_id = b.dept_id  where 1 = 1
		<include refid="sf-ecGoodsPrice-t" />
		<isNotEmpty prepend=" and " property="map.own_sys_in">t.own_sys in $map.own_sys_in$</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_fgs">t.dept_id=#map.is_fgs#</isNotEmpty>
		<isNotEmpty prepend="" property="map.is_fgs">
              UNION
		SELECT t.*, a.pd_name AS pd_name, b.dept_name AS dept_name FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a
             ON t.goods_id = a.id LEFT JOIN konka_dept b ON t.dept_id = b.dept_id LEFT JOIN EC_GOODS_PRICE_AREA c  ON t.ID=c.PRICE_ID
              WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PRICE_TYPE=3 
         <isNotEmpty prepend=" and " property="map.own_sys_in">t.own_sys in $map.own_sys_in$</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.pindex_ids">
          		substr ( c.PINDEX_ID, 0, 4) IN <iterate close=")" open="(" conjunction="," property="map.pindex_ids">#map.pindex_ids[]#</iterate>
         </isNotEmpty>
               UNION
                SELECT t.*, a.pd_name AS pd_name, b.dept_name AS dept_name
                  FROM ec_goods_price t LEFT JOIN konka_bcomp_pd a  ON t.goods_id = a.id LEFT JOIN konka_dept b  ON t.dept_id = b.dept_id
                   WHERE 1 = 1 <include refid="sf-ecGoodsPrice-t" /> AND t.PRICE_TYPE=4 
         <isNotEmpty prepend=" and " property="map.own_sys_in">t.own_sys in $map.own_sys_in$</isNotEmpty>
         <isNotEmpty prepend=" and " property="map.c_ids">
            		t.c_id IN 
            <iterate close=")" open="(" conjunction="," property="map.c_ids">#map.c_ids[]#</iterate>
         </isNotEmpty>
         
		</isNotEmpty>
		)
	</select>
	
	<!-- Pan,Gang -->
	<select id="selectEcGoodsPriceAndAreaCount" resultClass="long" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select count(*) from ec_goods_price t left join ec_goods_price_area a  on t.id= a.price_id   where 1 = 1
		<include refid="sf-ecGoodsPrice-t" />
		<isNotEmpty prepend="and" property="map.pindex_id">
			a.pindex_id = #map.pindex_id#
		</isNotEmpty>
	</select>

	<select id="selectEcGoodsPriceCount" resultClass="long" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select count(*) from EC_GOODS_PRICE where 1 = 1
		<include refid="sf-ecGoodsPrice" />
	</select>

	<select id="selectEcGoodsPricePaginatedList" resultMap="ecGoodsPriceResult" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from EC_GOODS_PRICE where 1 = 1
		<include refid="sf-ecGoodsPrice" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- TUDP 2014-03-19 -->
	<select id="selectEcGoodsPriceForCoustomerPrice" resultMap="ecGoodsPriceResult" parameterClass="ecGoodsPrice" cacheModel="oneDayCache">
		select * from (
		select * from EC_GOODS_PRICE t where t.GOODS_ID = #goods_id:DECIMAL# 
		<isNotEmpty prepend=" and " property="dept_id">t.DEPT_ID = #dept_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">t.OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_id">(t.C_ID = #c_id:DECIMAL# or t.C_ID is null)</isNotEmpty>
		order by t.C_ID,t.ID
		)<![CDATA[ where rownum <2  ]]>
	</select>
	
	<insert id="insertEcGoodsPrice" parameterClass="ecGoodsPrice">
		<selectKey resultClass="long" keyProperty="id">select PSHOW_BASE_SEQ.nextval as id from dual </selectKey>
		<![CDATA[insert into EC_GOODS_PRICE (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="goods_id">GOODS_ID</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="dept_id">DEPT_ID</isNotNull>	
			<isNotNull prepend="," property="price_type">PRICE_TYPE</isNotNull>	
			<isNotNull prepend="," property="start_time">START_TIME</isNotNull>	
			<isNotNull prepend="," property="end_time">END_TIME</isNotNull>	
			<isNotNull prepend="," property="remarks">REMARKS</isNotNull>	
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>
			<isNotNull prepend="," property="original_price">ORIGINAL_PRICE</isNotNull>	
			<isNotNull prepend="," property="price2">PRICE2</isNotNull>
			<isNotNull prepend="," property="price3">PRICE3</isNotNull>
			<isNotNull prepend="," property="price4">PRICE4</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID</isNotNull>
			<isNotNull prepend="," property="plat_sys">PLAT_SYS</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_id">#goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">#dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_type">#price_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="start_time">#start_time:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="end_time">#end_time:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="remarks">#remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="original_price">#original_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price2">#price2:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price3">#price3:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price4">#price4:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>	
			<isNotNull prepend="," property="c_id">#c_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="plat_sys">#plat_sys:DECIMAL#</isNotNull>	
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateEcGoodsPrice" parameterClass="EcGoodsPrice">
		update EC_GOODS_PRICE
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="goods_id">GOODS_ID = #goods_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="dept_id">DEPT_ID = #dept_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_type">PRICE_TYPE = #price_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="start_time">START_TIME = #start_time:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="end_time">END_TIME = #end_time:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="remarks">REMARKS = #remarks:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="original_price">ORIGINAL_PRICE = #original_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price2">PRICE2 = #price2:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price3">PRICE3 = #price3:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price4">PRICE4 = #price4:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="c_id">C_ID = #c_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="plat_sys">PLAT_SYS = #plat_sys:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteEcGoodsPrice" parameterClass="EcGoodsPrice">
		delete from EC_GOODS_PRICE  where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>