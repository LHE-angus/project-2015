<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="MDAS_MOD_PERMISSION">

	<typeAlias alias="mdasModPermission" type="com.ebiz.mmt.domain.MdasModPermission" />

	

	<resultMap id="mdasModPermissionResultForList" class="mdasModPermission">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="USER_ID" property="user_id" jdbcType="DECIMAL" />
		<result column="MDAS_MOD_ID" property="mdas_mod_id" jdbcType="DECIMAL" />
		<result column="VIEW_TYPE" property="view_type" jdbcType="DECIMAL" />
		<result column="VIEW_DATE_START" property="view_date_start" jdbcType="DATE" />
		<result column="VIEW_DATE_END" property="view_date_end" jdbcType="DATE" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="PD_TYPE_SIGN" property="pd_type_sign" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="mdasModPermissionResult" class="mdasModPermission" extends="mdasModPermissionResultForList">
	</resultMap>
	
	<resultMap id="mdasModPermissionWithPNameResult" class="mdasModPermission" extends="mdasModPermissionResultForList">
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="mdasModPermissionWithBrandNameResult" class="mdasModPermission" extends="mdasModPermissionResultForList">
		<result column="Brand_NAME" property="map.brand_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap class="mdasModPermission" id="mdasTimeLimitResult" extends="mdasModPermissionResultForList">
	    <result column="MOD_NAME" property="map.mdas_mod_name" jdbcType="VARCHAR" />
	    <result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="mdasAreaLimitResult" class="mdasModPermission">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="USER_ID" property="user_id" jdbcType="DECIMAL" />
		<result column="MDAS_MOD_ID" property="mdas_mod_id" jdbcType="DECIMAL" />
		<result column="P_NAME" property="map.p_name" jdbcType="VARCHAR" />
		<result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
		<result column="MOD_NAME" property="map.mod_name" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-mdasModPermission">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_id">USER_ID = #user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mdas_mod_id">MDAS_MOD_ID = #mdas_mod_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="view_type">VIEW_TYPE = #view_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="view_date_start">VIEW_DATE_START = #view_date_start:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="view_date_end">VIEW_DATE_END = #view_date_end:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.province">A.P_INDEX = #map.province:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id_not_null">BRAND_ID is not null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_is_not_null">P_INDEX IS NOT NULL</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.user_name_like">
			USER_ID in (select mui.ID from chea_fill.MDAS_USER_INFO mui where upper(mui.USER_NAME) like '%' || upper(#map.user_name_like#) || '%')
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mdas_mod_name_like">
			MDAS_MOD_ID in (select msm.MDAS_MOD_ID from chea_fill.MDAS_SYS_MODULE msm where upper(msm.MOD_NAME) like '%' || upper(#map.mdas_mod_name_like#) || '%')
		</isNotEmpty>	
		<isNotEmpty prepend=" and " property="map.brand_id_is_null">BRAND_ID is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_type_is_null">VIEW_TYPE is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_start_is_null">VIEW_DATE_START is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_end_is_null">VIEW_DATE_END is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_is_null">P_INDEX is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_is_null">PD_TYPE_SIGN is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_type_is_not_null">
		view_type is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_is_not_null">
		pd_type_sign is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_start_is_not_null">
		view_date_start is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_end_is_not_null">
		view_date_end is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id_is_not_null">
		brand_id is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_is_not_null">
		p_index is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_name_like">
			upper(BRAND_NAME) like '%' || upper(#map.brand_name_like#) || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type">
			brand_id in (select brand_id
	          from chea_fill.BASE_BRAND m
	          left join (select *
	                      from BASE_PD_TYPE t
	                     where t.pd_type_sign =
	                           (select pd_type_sign
	                              from BASE_PD_TYPE
	                             where pd_type = #map.pd_type#
	                               and is_model = 1
	                               and del_mark = 0)
	                       and t.is_model = 0
	                       and t.del_mark = 0) n on m.PD_TYPE = n.PD_TYPE)
		</isNotEmpty>
	</sql>

	<select id="selectMdasModPermission" resultMap="mdasModPermissionResult" parameterClass="mdasModPermission" >
		select * from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
	</select>
	
	<select id="selectMdasModPermissionAndUserName" resultMap="mdasTimeLimitResult" parameterClass="mdasModPermission" >
		select a.*,b.user_name,c.mod_name from chea_fill.MDAS_MOD_PERMISSION a left join MDAS_USER_INFO b  on a.user_id = b.id
		left join chea_fill.MDAS_SYS_MODULE c on a.mdas_mod_id =c.mdas_mod_id
		where 1=1 and view_type is null and pd_type_sign is null
		 and view_date_start is null and view_date_end is null
		 and brand_id is null and p_index is null 
		<include refid="sf-mdasModPermission" />
		order by b.user_name
	</select>

	<select id="selectMdasModPermissionList" resultMap="mdasModPermissionResultForList" parameterClass="mdasModPermission" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.view_type_is_not_null">
		view_type is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_is_not_null">
		pd_type_sign is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_start_is_not_null">
		view_date_start is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.view_date_end_is_not_null">
		view_date_end is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.brand_id_is_not_null">
		brand_id is not null
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index_is_not_null">
		p_index is not null
		</isNotEmpty>
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectMdasModPermissionByUserName" resultMap="mdasTimeLimitResult" parameterClass="mdasModPermission" >
	<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*,b.user_name,c.mod_name from chea_fill.MDAS_MOD_PERMISSION a left join MDAS_USER_INFO b  on a.user_id = b.id
		left join chea_fill.MDAS_SYS_MODULE c on a.mdas_mod_id = c.mdas_mod_id
		where 1=1 and view_type is null and pd_type_sign is null
		 and view_date_start is null and view_date_end is null
		 and brand_id is null and p_index is null 
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.user_name">b.user_name = #map.user_name#</isNotEmpty>
		<!-- order by ID asc -->
		order by b.user_name
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectMdasModPermissionByUserNameCount" resultClass="long" parameterClass="mdasModPermission" >
		select count(*) from chea_fill.MDAS_MOD_PERMISSION a left join MDAS_USER_INFO b  on a.user_id = b.id
		left join chea_fill.MDAS_SYS_MODULE c on a.mdas_mod_id =c.mdas_mod_id
		where 1=1 and view_type is null and pd_type_sign is null
		 and view_date_start is null and view_date_end is null
		 and brand_id is null and p_index is null 
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.user_name">b.user_name = #map.user_name#</isNotEmpty>
	</select>
	

	<select id="selectMdasModPermissionCount" resultClass="long" parameterClass="mdasModPermission" >
		select count(*) from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
	</select>
	
    <select id="selectAreaLimitCount" resultClass="long" parameterClass="mdasModPermission" >
		SELECT
		    count(*)
		FROM
		    chea_fill.MDAS_MOD_PERMISSION A left join chea_fill.BASE_PROVINCE_LIST B on A.P_INDEX =  B.P_INDEX left join chea_fill.MDAS_USER_INFO C on A.USER_ID = C.ID left join chea_fill.MDAS_SYS_MODULE D on A.MDAS_MOD_ID = D.MDAS_MOD_ID
		    where 1 = 1
		    and A.view_type is null and A.pd_type_sign is null
		    and A.view_date_start is null and A.view_date_end is null
		    and A.brand_id is null and A.p_index is null 
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.user_name">
			C.ID in (select mui.ID from chea_fill.MDAS_USER_INFO mui where upper(mui.USER_NAME) like '%' || upper(#map.user_name#) || '%')
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mdas_mod_name">
			D.MDAS_MOD_ID in (select msm.MDAS_MOD_ID from chea_fill.MDAS_SYS_MODULE msm where upper(msm.MOD_NAME) like '%' || upper(#map.mdas_mod_name#) || '%')
		</isNotEmpty>
	</select>

	<select id="selectMdasModPermissionWithPNameList" resultMap="mdasModPermissionWithPNameResult" parameterClass="mdasModPermission" >
		select * from (select m.*,t.p_name from chea_fill.MDAS_MOD_PERMISSION m left join chea_fill.BASE_PROVINCE_LIST t  
    	on m.p_index = t.p_index)
		where 1 = 1
		<include refid="sf-mdasModPermission" />
	</select>
	
	<select id="selectMdasModPermissionWithBrandNameCount" resultClass="long" parameterClass="mdasModPermission" >
		select count(*) from (select * from (select m.*,t.brand_name from chea_fill.MDAS_MOD_PERMISSION m left join chea_fill.BASE_BRAND_INFO t 
    	on m.brand_id = t.brand_id)
		where 1 = 1
		<include refid="sf-mdasModPermission" />
		)
	</select>
	
	<select id="selectMdasModPermissionWithBrandNameList" resultMap="mdasModPermissionWithBrandNameResult" parameterClass="mdasModPermission" >
		select * from (select m.*,t.brand_name from chea_fill.MDAS_MOD_PERMISSION m left join chea_fill.BASE_BRAND_INFO t  
    	on m.brand_id = t.brand_id)
		where 1 = 1
		<include refid="sf-mdasModPermission" />
		<!-- order by ID asc -->
	</select>
	
	<select id="selectMdasModPermissionWithBrandNamePaginatedList" resultMap="mdasModPermissionWithBrandNameResult" parameterClass="mdasModPermission" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from (select m.*,t.brand_name from chea_fill.MDAS_MOD_PERMISSION m left join chea_fill.BASE_BRAND_INFO t  
    	on m.brand_id = t.brand_id)
		where 1 = 1
		<include refid="sf-mdasModPermission" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectMdasModPermissionPaginatedList" resultMap="mdasModPermissionResult" parameterClass="mdasModPermission" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectAreaLimitPaginatedList" resultMap="mdasAreaLimitResult" parameterClass="mdasModPermission" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		SELECT
		    A.ID,
		    A.USER_ID,
		    A.MDAS_MOD_ID,
		    B.P_NAME,
		    C.USER_NAME,
		    D.MOD_NAME
		FROM
		    chea_fill.MDAS_MOD_PERMISSION A left join chea_fill.BASE_PROVINCE_LIST B on A.P_INDEX =  B.P_INDEX left join chea_fill.MDAS_USER_INFO C on A.USER_ID = C.ID left join chea_fill.MDAS_SYS_MODULE D on A.MDAS_MOD_ID = D.MDAS_MOD_ID
		WHERE
		    1 = 1
		    and A.view_type is null and A.pd_type_sign is null
		    and A.view_date_start is null and A.view_date_end is null
		    and A.brand_id is null and A.p_index is null 
		    <include refid="sf-mdasModPermission" />
			<isNotEmpty prepend=" and " property="map.user_name">
				C.ID in (select mui.ID from chea_fill.MDAS_USER_INFO mui where upper(mui.USER_NAME) like '%' || upper(#map.user_name#) || '%')
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="map.mdas_mod_name">
				D.MDAS_MOD_ID in (select msm.MDAS_MOD_ID from chea_fill.MDAS_SYS_MODULE msm where upper(msm.MOD_NAME) like '%' || upper(#map.mdas_mod_name#) || '%')
			</isNotEmpty>
			<!-- order by ID asc -->
			order by c.user_name
			<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertMdasModPermission" parameterClass="mdasModPermission">
		<selectKey resultClass="long" keyProperty="id">select MDAS_SEQUENCE.nextval as id from chea_fill.dual </selectKey>
		<![CDATA[insert into chea_fill.MDAS_MOD_PERMISSION (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="user_id">USER_ID</isNotNull>	
			<isNotNull prepend="," property="mdas_mod_id">MDAS_MOD_ID</isNotNull>	
			<isNotNull prepend="," property="view_type">VIEW_TYPE</isNotNull>	
			<isNotNull prepend="," property="view_date_start">VIEW_DATE_START</isNotNull>	
			<isNotNull prepend="," property="view_date_end">VIEW_DATE_END</isNotNull>	
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>	
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>
			<isNotNull prepend="," property="pd_type_sign">PD_TYPE_SIGN</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">#user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mdas_mod_id">#mdas_mod_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="view_type">#view_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="view_date_start">#view_date_start:DATE#</isNotNull>
			<isNotNull prepend="," property="view_date_end">#view_date_end:DATE#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_type_sign">#pd_type_sign:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateMdasModPermission" parameterClass="MdasModPermission">
		update chea_fill.MDAS_MOD_PERMISSION
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_id">USER_ID = #user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mdas_mod_id">MDAS_MOD_ID = #mdas_mod_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="view_type">VIEW_TYPE = #view_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="view_date_start">VIEW_DATE_START = #view_date_start:DATE#</isNotNull>
			<isNotNull prepend="," property="view_date_end">VIEW_DATE_END = #view_date_end:DATE#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteMdasModPermission" parameterClass="MdasModPermission">
		delete from chea_fill.MDAS_MOD_PERMISSION where 1=1
		<isNotEmpty prepend=" and " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend="  " property="id">
			<isNotEmpty prepend=" and " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
		<include refid="sf-mdasModPermission" />
	</delete>
	
	<delete id="deleteMdasModPermissionNotInModIds" parameterClass="MdasModPermission">
		delete from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.mdas_mod_id_not_in">
			MDAS_MOD_ID  not in
			<iterate close=")" open="(" conjunction="," property="map.mdas_mod_id_not_in">#map.mdas_mod_id_not_in[]#</iterate>
		</isNotEmpty>
	</delete>
	
	<delete id="deleteMdasModPermissionInModIds" parameterClass="MdasModPermission">
		delete from chea_fill.MDAS_MOD_PERMISSION where 1 = 1
		<include refid="sf-mdasModPermission" />
		<isNotEmpty prepend=" and " property="map.mdas_mod_id_in">
			MDAS_MOD_ID   in
			<iterate close=")" open="(" conjunction="," property="map.mdas_mod_id_in">#map.mdas_mod_id_in[]#</iterate>
		</isNotEmpty>
	</delete>

</sqlMap>