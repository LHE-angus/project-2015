<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SHOP_PD">

	<typeAlias alias="shopPd" type="com.ebiz.mmt.domain.ShopPd" />

	

	<resultMap id="shopPdResultForList" class="shopPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="MD_SNAME" property="md_sname" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="CATEGORY_ID" property="category_id" jdbcType="DECIMAL" />
		<result column="SERIES_ID" property="series_id" jdbcType="DECIMAL" />
		<result column="SERIES_NAME" property="series_name" jdbcType="DECIMAL" />
		<result column="IS_COUNTRY" property="is_country" jdbcType="DECIMAL" />
		<result column="IS_OLDTONEW" property="is_oldtonew" jdbcType="DECIMAL" />
		<result column="IS_LOW_ENERGY" property="is_low_energy" jdbcType="DECIMAL" />
		<result column="IS_TOPIC_ONSALE" property="is_topic_onsale" jdbcType="DECIMAL" />
		<result column="TOPIC_ONSALE_ID" property="topic_onsale_id" jdbcType="DECIMAL" />
		<result column="IS_PRICE_BATCH" property="is_price_batch" jdbcType="DECIMAL" />
		<result column="IS_AUCTION" property="is_auction" jdbcType="DECIMAL" />
		<result column="IS_RECOMMEND" property="is_recommend" jdbcType="DECIMAL" />
		<result column="IS_ONSALE" property="is_onsale" jdbcType="DECIMAL" />
		<result column="IS_HOT_SALE" property="is_hot_sale" jdbcType="DECIMAL" />
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="PRICE_LIMIT" property="price_limit" jdbcType="DECIMAL" />
		<result column="MMT_PRICE" property="mmt_price" jdbcType="DECIMAL" />
		<result column="PRICE_TYPE" property="price_type" jdbcType="DECIMAL" />
		<result column="PRICE_AUDIT_STATE" property="price_audit_state" jdbcType="DECIMAL" />
		<result column="MAIN_PIC" property="main_pic" jdbcType="VARCHAR" />
		<result column="ACCESS_NUM" property="access_num" jdbcType="DECIMAL" />
		<result column="EXCELLENT_NUM" property="excellent_num" jdbcType="DECIMAL" />
		<result column="GOOD_NUM" property="good_num" jdbcType="DECIMAL" />
		<result column="NORMAL_NUM" property="normal_num" jdbcType="DECIMAL" />
		<result column="POOR_NUM" property="poor_num" jdbcType="DECIMAL" />
		<result column="BAD_NUM" property="bad_num" jdbcType="DECIMAL" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="DEL_DATE" property="del_date" jdbcType="DATE" />
		<result column="SELL_START_DATE" property="sell_start_date" jdbcType="DATETIME" />
		<result column="SELL_END_DATE" property="sell_end_date" jdbcType="DATETIME" />
		<result column="ORDER_SORT" property="order_sort" jdbcType="DECIMAL" />
		<result column="STOCK_STATE" property="stock_state" jdbcType="DECIMAL" />
		<result column="DISV_LIMIT_MAX" property="disv_limit_max" jdbcType="DECIMAL" />
		<result column="PD_NUM" property="pd_num" jdbcType="DECIMAL" />
		<result column="P_DESC" property="p_desc" jdbcType="VARCHAR" />
		<result column="IS_NEW" property="is_new" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="shopPdResult" class="shopPd" extends="shopPdResultForList">
		<result column="PD_REMARK" property="pd_remark" jdbcType="CLOB" />
		<result column="PD_TYPE_SIGN" property="pd_type_sign" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="pd_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="brand_name" jdbcType="VARCHAR" />
		<result column="SALE_SERVICE" property="sale_service" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="shopPdResultWithBrandNameList" class="shopPd" extends="shopPdResultForList">
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="shopPdResultListWithShopName" class="shopPd" extends="shopPdResultForList">
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="shopPdResultListWithShopNameAndPdName" class="shopPd" extends="shopPdResultForList">
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="PD_NAME" property="map.pd_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="shopPdResultListForShopPdContrast" class="shopPd" extends="shopPdResultForList">
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="pdTypeResult" class="shopPd">
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="brandIdResult" class="shopPd">
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="productCenterShowResultForList" class="shopPd" extends="shopPdResultForList">
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="map.p_index" jdbcType="DECIMAL" />
		<result column="HOST_ID" property="map.host_id" jdbcType="DECIMAL" />
	</resultMap>
	
	<resultMap id="shopPdRank" class="shopPd">
		<result column="cou" property="map.cou" jdbcType="VARCHAR" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="shopPdIndexResultList" class="shopPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="MMT_PRICE" property="mmt_price" jdbcType="DECIMAL" />
		<result column="MAIN_PIC" property="main_pic" jdbcType="VARCHAR" />
		<result column="P_DESC" property="p_desc" jdbcType="VARCHAR" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="mmtProductList" class="shopPd">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="PD_ID" property="pd_id" jdbcType="DECIMAL" />
		<result column="BRAND_ID" property="brand_id" jdbcType="DECIMAL" />
		<result column="MD_NAME" property="md_name" jdbcType="VARCHAR" />
		<result column="PD_TYPE" property="pd_type" jdbcType="DECIMAL" />
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="MAIN_PIC" property="main_pic" jdbcType="VARCHAR" />
		<result column="PRICE" property="price" jdbcType="DECIMAL" />
		<result column="MMT_PRICE" property="mmt_price" jdbcType="DECIMAL" />
		<result column="PRICE_VALUE" property="map.price_value" jdbcType="DECIMAL" />
		<result column="SP_PRICE_VALUE" property="map.sp_price_value" jdbcType="DECIMAL" />
		<result column="SHOP_NAME" property="map.shop_name" jdbcType="VARCHAR" />
		<result column="USER_NAME" property="map.user_name" jdbcType="VARCHAR" />
		<result column="BRAND_NAME" property="map.brand_name" jdbcType="VARCHAR" />
		<result column="P_DESC" property="p_desc" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="sf-shopPd">
		<isNotEmpty prepend=" and " property="id">a.ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_id">a.PD_ID = #pd_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">a.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_name">UPPER(a.MD_NAME) like '%' || UPPER(#md_name:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.key_word">
			UPPER(a.MD_SNAME) like '%' || UPPER(#map.key_word:VARCHAR#) || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.key_word_productShow">
			(
				UPPER(a.MD_SNAME) like '%' || UPPER(#map.key_word_productShow:VARCHAR#) || '%'
				or
				brand_id in (select distinct bbi.brand_id from base_brand_info bbi where bbi.is_del = 0 and UPPER(bbi.brand_name) like '%' || UPPER(#map.key_word_productShow:VARCHAR#) || '%')
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="md_sname">UPPER(a.MD_SNAME) like '%' || UPPER(#md_sname:VARCHAR#) || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">a.PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="category_id">a.CATEGORY_ID = #category_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="series_id">a.SERIES_ID = #series_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="series_name">a.SERIES_NAME = #series_name:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_country">a.IS_COUNTRY = #is_country:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_recommend">a.IS_RECOMMEND = #is_recommend:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_onsale">a.IS_ONSALE = #is_onsale:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_hot_sale">a.IS_HOT_SALE = #is_hot_sale:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_new">a.IS_NEW = #is_new:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_id">a.ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price">a.PRICE = #price:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_limit">a.PRICE_LIMIT = #price_limit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="main_pic">a.MAIN_PIC = #main_pic:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="access_num">a.ACCESS_NUM = #access_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="price_audit_state">a.PRICE_AUDIT_STATE = #price_audit_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="excellent_num">a.EXCELLENT_NUM = #excellent_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="good_num">a.GOOD_NUM = #good_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="normal_num">a.NORMAL_NUM = #normal_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="poor_num">a.POOR_NUM = #poor_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="bad_num">a.BAD_NUM = #bad_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">a.STATE = #state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_date">a.DEL_DATE = #del_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_start_date">a.SELL_START_DATE = #sell_start_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="sell_end_date">a.SELL_END_DATE = #sell_end_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_sort">a.ORDER_SORT = #order_sort:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="disv_limit_max">a.DISV_LIMIT_MAX = #disv_limit_max:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_num">a.PD_NUM = #pd_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_price_ge"><![CDATA[ a.MMT_PRICE >= #map.mmt_price_ge:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_price_le"><![CDATA[ a.MMT_PRICE <= #map.mmt_price_le:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_price_lt"><![CDATA[ a.MMT_PRICE < #map.mmt_price_lt:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mmt_price_gt"><![CDATA[ a.MMT_PRICE > #map.mmt_price_gt:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.price_ge"><![CDATA[ a.PRICE >= #map.price_ge:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.price_le"><![CDATA[ a.PRICE <= #map.price_le:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.price_gt"><![CDATA[ a.PRICE > #map.price_gt:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.price_lt"><![CDATA[ a.PRICE < #map.price_lt:DECIMAL# ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.isAuthedShop">b.IS_AUTH = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.down">
			<![CDATA[(a.SELL_END_DATE < sysdate or a.SELL_END_DATE is null or a.SELL_START_DATE is null or a.pd_num = 0)]]>
		</isNotEmpty>	
		<isNotEmpty prepend=" and " property="map.city_id">
			b.P_INDEX in (select t2.p_index from base_province_list t2
			where t2.del_mark = 0 start with t2.p_index = #map.city_id:DECIMAL#
			connect by prior t2.p_index = t2.par_index )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.mul_properties_sql">a.PD_ID IN ($map.mul_properties_sql$)</isNotEmpty>
		<isNotEmpty prepend=" " property="map.pd_tag">
			<isNotEmpty prepend=" and " property="pd_type">
				a.PD_ID IN (select pt.pd_id from pd_tag pt where pt.del_mark = 0 and
				pt.id = #map.pd_tag:DECIMAL# and
				pt.pd_type = #pd_type:DECIMAL#)
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.have_saled">
			a.id in (select t.p_id from user_order_success t where t.shop_id = a.shop_id )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map._sell_start_date">
			<isEmpty property="map._sell_end_date">
				<![CDATA[to_char(a.SELL_START_DATE,'yyyy-MM-dd HH:mm') >= #map._sell_start_date#]]>
			</isEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map._sell_end_date">
			<isEmpty property="map._sell_start_date">
			<![CDATA[to_char(a.SELL_END_DATE,'yyyy-MM-dd HH:mm') <= #map._sell_end_date#]]>
			</isEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map._sell_end_date">
			<isNotEmpty property="map._sell_start_date">
				<![CDATA[to_char(a.SELL_END_DATE,'yyyy-MM-dd HH:mm') >= #map._sell_start_date# and to_char(a.SELL_START_DATE,'yyyy-MM-dd HH:mm') <= #map._sell_end_date#]]>
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stock_state">a.stock_state = #stock_state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_country">a.IS_COUNTRY = #is_country:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_oldtonew">a.IS_OLDTONEW = #is_oldtonew:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_low_energy">a.IS_LOW_ENERGY = #is_low_energy:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_price_batch">a.IS_PRICE_BATCH = #is_price_batch:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_auction">a.IS_AUCTION = #is_auction:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.topic_onsale_id">
			a.id not in (select t1.p_id
			from topic_onsale_pd t1
			where t1.shop_id = a.shop_id
			and t1.is_del = 0
			and t1.topic_onsale_id = #map.topic_onsale_id:DECIMAL#
			<isNotEmpty prepend=" and " property="map.selfPdId">t1.id != #map.selfPdId:DECIMALS#</isNotEmpty>
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_v2"> a.PD_TYPE in 
		  <iterate open="(" close=")" conjunction="," property="map.pd_type_sign_v2">#map.pd_type_sign_v2[]#</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_start_date"><![CDATA[ to_char(a.ADD_DATE, 'yyyy-mm-dd') >= #map.add_start_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_end_date"><![CDATA[ to_char(a.ADD_DATE, 'yyyy-mm-dd') <= #map.add_end_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.week_hot_start_date"><![CDATA[ to_char(a.SELL_START_DATE, 'yyyy-mm-dd') >= #map.week_hot_start_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.week_hot_end_date"><![CDATA[ to_char(a.SELL_START_DATE, 'yyyy-mm-dd') <= #map.week_hot_end_date#]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_home_page">a.pd_type in
		       (
		       		select pd_type from base_pd_type
		         	where pd_type_sign = #map.pd_type_sign_home_page:VARCHAR#
		           	and is_model = 0
		       )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign_xjd_home_page">a.pd_type in
		       (
		       		select pd_type from base_pd_type
		         	where 1 = 1 and ( pd_type_sign = 'WH' or pd_type_sign = 'MO' or pd_type_sign = 'IC')
		           	and is_model = 0
		       )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.id_not_in">
			a.ID not in
		    <iterate close=")" open="(" conjunction="," property="map.id_not_in">#map.id_not_in[]#</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.id_in">
			ID in 
			<iterate close=")" open="(" conjunction="," property="map.id_in">#map.id_in[]#</iterate>
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_name">a.SHOP_ID in (select es.SHOP_ID from entp_shop es where
			es.STATE =0 and
			UPPER(es.SHOP_NAME) like '%' || UPPER(#map.shop_name:VARCHAR#) || '%' )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_is_mmt">a.SHOP_ID in (select es.SHOP_ID from entp_shop es where
			es.STATE = 0 and
			es.SHOP_TYPE = 0 )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_oldtonew_eq_1">a.is_oldtonew = 1 and a.SHOP_ID in (select es.SHOP_ID from entp_shop es where
			es.SHOP_ID = a.SHOP_ID and
			es.STATE = 0 and
			es.IS_OTN = 1 )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_country_eq_1">a.is_country = 1 and a.SHOP_ID in (select es.SHOP_ID from entp_shop es where
			es.SHOP_ID = a.SHOP_ID and
			es.STATE = 0 and
			es.IS_RURAL = 1 )
		</isNotEmpty>
		
		<!-- 
			关于在前台显示出来的产品（也叫橱柜中的产品、正在发布的产品）应满足的基本条件：
				1．	产品未删除
				2．	产品未过期，即访问时间应在产品的上架时间和下架时间之内（包括端点值）
				3．	产品所在商铺未删除
				4．	产品所在商铺已成功绑定了支付宝账号
				5．	产品价格审核通过，即价格审核状态为1
				6．	产品买卖提价格/参考价格不能为空，且必须不能为负数
				7．	产品库存大于0
		 -->
		 
		<!--
		<isNotEmpty prepend=" and " property="map.publishing">
		<![CDATA[
			a.STATE = 0
			and a.SELL_END_DATE >= sysdate and a.SELL_START_DATE <= sysdate
			and a.SHOP_ID is not null 
			
			and a.SHOP_ID in (
				select es.SHOP_ID from ENTP_SHOP es where es.STATE = 0 and es.ALIPAY_EMAIL is not null
			)
			
			and a.PRICE_AUDIT_STATE = 1
			and (a.MMT_PRICE > 0 or a.PRICE > 0)
			and a.PD_NUM > 0
		]]>
		</isNotEmpty>		
		-->
		
		<isNotEmpty prepend=" and " property="map.publishing">
		<![CDATA[
			a.STATE = 0
			and a.SHOP_ID is not null 
			and a.PRICE_AUDIT_STATE = 1
			and (a.MMT_PRICE > 0 or a.PRICE > 0)
		]]>
		</isNotEmpty>
		
	</sql>

	<select id="selectShopPd" resultMap="shopPdResult" parameterClass="shopPd" >
		select t.*,b.pd_remark, c.PD_NAME, c.PD_TYPE_SIGN, d.BRAND_NAME,e.content as SALE_SERVICE
		  from (select a.* from SHOP_PD a where 1=1
		  <include refid="sf-shopPd" />
		  ) t           
		  left join BASE_PD_TYPE c on t.pd_type = c.pd_type   
		  left join BASE_BRAND_INFO d on t.brand_id = d.brand_id        
		  left join SHOP_PD_CONTENT b on t.ID = b.ID
		  left join SHOP_PD_SALE_SERVICE e on t.ID = e.ID
	</select>

	<select id="selectShopPdList" resultMap="shopPdResultWithBrandNameList" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.*,b.brand_name from SHOP_PD a left join  BASE_BRAND_INFO b on a.brand_id = b.brand_id
		where 1 = 1
		<include refid="sf-shopPd" />
		<isNotEmpty prepend=" and " property="map.containsPdType"> a.pd_type in (select pd_type from BASE_PD_TYPE where pd_type_sign = #map.containsPdType# and is_model = 0 and del_mark = 0)</isNotEmpty>
		order by  
		<isNotEmpty property="map.add_date_desc"> a.add_date desc, a.ID asc,</isNotEmpty>
		<isNotEmpty property="map.price_order_desc">a.mmt_price desc ,</isNotEmpty>
		<isNotEmpty property="map.price_order_asc">a.mmt_price asc ,</isNotEmpty>
		<isNotEmpty property="map.access_num_order_desc">access_num desc,</isNotEmpty>
		a.add_date desc, a.ORDER_SORT asc, a.sell_start_date desc, a.ID asc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectShopPdFoIndexv3List" resultMap="shopPdResultForList" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.* from SHOP_PD a 
		where 1 = 1
		<include refid="sf-shopPd" />
		order by a.ID desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectShopPdFoIndexv4List" resultMap="shopPdResultForList" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.* from SHOP_PD a 
		where 1 = 1
		<include refid="sf-shopPd" />
		order by a.ORDER_SORT desc 
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectShopPdListByBrandName" resultMap="shopPdResultForList" parameterClass="shopPd"
		>
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from SHOP_PD a where a.state = 0 and a.is_country = 1 and a.brand_id in (select t.brand_id from
		base_brand t where t.del_mark = 0 
		<isNotEmpty prepend=" and " property="brand_name">t.brand_name = #brand_name:VARCHAR#</isNotEmpty>
		)
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectShopPdIndexList" resultMap="shopPdIndexResultList" parameterClass="shopPd"
		>
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.id, a.shop_id, a.main_pic, a.mmt_price, a.md_name, a.brand_id, a.pd_type,a.p_desc,a.price,
		b.brand_name 
		from SHOP_PD a
		left join 
  		(
  			select bbi.brand_id, bbi.brand_name from BASE_BRAND_INFO bbi
            where bbi.is_del = 0) b on a.brand_id = b.brand_id
		where 1 = 1
		<include refid="sf-shopPd" />
		order by  
		<isNotEmpty property="map.add_date_desc"> a.add_date desc, a.ID asc,</isNotEmpty>
		<isNotEmpty property="map.price_order_desc">a.mmt_price desc ,</isNotEmpty>
		<isNotEmpty property="map.price_order_asc">a.mmt_price asc ,</isNotEmpty>
		<isNotEmpty property="map.access_num_order_desc">access_num desc,</isNotEmpty>
		a.ORDER_SORT desc , a.add_date desc, a.sell_start_date desc, a.ID asc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectShopPdCount" resultClass="long" parameterClass="shopPd" >
		select count(a.ID) from SHOP_PD a, ENTP_SHOP b where a.shop_id = b.shop_id
		<include refid="sf-shopPd" />
		<isNotEmpty prepend=" and " property="map.pd_type_sign">
		a.pd_type in (
       		select b3.pd_type from base_pd_type b3 where 
      	 	b3.pd_type_sign = #map.pd_type_sign:VARCHAR#
         )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.p_index">
			b.P_INDEX IN 
			( select t2.p_index from base_province_list t2
			where t2.del_mark = 0 start with t2.p_index = #map.p_index:DECIMAL#
			connect by prior t2.p_index = t2.par_index )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_is_not_mmt">b.SHOP_TYPE is null</isNotEmpty>
	</select>
	
	<select id="selectShopPdOnlyCount" resultClass="long" parameterClass="shopPd" >
		select count(a.ID) from SHOP_PD a
		<include refid="sf-shopPd" />
	</select>

	<select id="selectShopPdPaginatedList" resultMap="shopPdResultListWithShopName" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*, b.shop_name from SHOP_PD a, ENTP_SHOP b where a.shop_id = b.shop_id
		<include refid="sf-shopPd" />
		order by  
		<isNotEmpty property="map.order_value_asc">a.ORDER_SORT asc,</isNotEmpty>
		<isNotEmpty property="map.order_value_desc">a.ORDER_SORT desc,</isNotEmpty>
		<isNotEmpty property="map.price_asc">a.MMT_PRICE asc,</isNotEmpty>
		<isNotEmpty property="map.price_desc">a.MMT_PRICE desc,</isNotEmpty>
		a.ORDER_SORT desc , a.add_date desc, b.shop_name, a.sell_start_date desc,a.ID asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- 买卖通销售产品 List -->
	<select id="selectShopPdForMmtongPaginatedList" resultMap="shopPdResultListWithShopNameAndPdName" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*, b.shop_name, b2.pd_name from SHOP_PD a, ENTP_SHOP b , base_pd_type b1, base_pd_type b2
		  where a.shop_id = b.shop_id
		   and a.pd_type = b1.pd_type
   		   and b1.pd_type_sign = b2.pd_type_sign
  		   and b2.is_model = 1
		<include refid="sf-shopPd" />
		<isNotEmpty prepend=" and " property="map.pd_type_sign">
		a.pd_type in (
       		select b3.pd_type from base_pd_type b3 where 
      	 	b3.pd_type_sign = #map.pd_type_sign:VARCHAR#
         )
		</isNotEmpty>
		order by  
		<isNotEmpty property="map.order_value_asc">a.ORDER_SORT asc,</isNotEmpty>
		<isNotEmpty property="map.order_value_desc">a.ORDER_SORT desc,</isNotEmpty>
		<isNotEmpty property="map.price_asc">a.MMT_PRICE asc,</isNotEmpty>
		<isNotEmpty property="map.price_desc">a.MMT_PRICE desc,</isNotEmpty>
		a.ORDER_SORT desc , a.add_date desc, b.shop_name, a.sell_start_date desc,a.ID asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectShopPdForContrastPaginatedList" resultMap="shopPdResultListForShopPdContrast" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a1.*,c.brand_name  from (
		select a.*, b.shop_name from SHOP_PD a, ENTP_SHOP b where a.shop_id = b.shop_id
		<isNotEmpty prepend=" and " property="map.p_index">
			b.P_INDEX IN 
			( select t2.p_index from base_province_list t2
			where t2.del_mark = 0 start with t2.p_index = #map.p_index:DECIMAL#
			connect by prior t2.p_index = t2.par_index )
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shop_is_not_mmt">b.SHOP_TYPE is null</isNotEmpty>
		<include refid="sf-shopPd" /> ) a1
		left join BASE_BRAND_INFO c on a1.brand_id = c.brand_id
		order by  
		<isNotEmpty property="map.contrst_price_asc">a1.PRICE asc,</isNotEmpty>
		<isNotEmpty property="map.contrst_price_desc">a1.PRICE desc,</isNotEmpty>
		<isNotEmpty property="map.contrst_sales_asc"></isNotEmpty>
		<isNotEmpty property="map.contrst_sales_desc"></isNotEmpty>
		a1.ORDER_SORT desc , a1.add_date desc, a1.ID asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<!-- 以旧换新首页 List -->
	<select id="selectShopPdWithBrandNameList" resultMap="shopPdResultForList" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		<!-- SQL优化 2011-04-22 select b.brand_name, a.* from SHOP_PD a, BASE_BRAND_INFO b where a.brand_id = b.brand_id  -->
		select a.* from SHOP_PD a where 1= 1
		<include refid="sf-shopPd" />
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- 以旧换新分页Count -->
	<select id="selectShopPdWithBrandNameCount" resultClass="long" parameterClass="shopPd" >
		select count(a.ID) from SHOP_PD a where 1 = 1 
		<include refid="sf-shopPd" />
	</select>
	
	<!-- 以旧换新分页List -->
	<select id="selectShopPdWithBrandNamePaginatedList" resultMap="shopPdResultWithBrandNameList" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select b.brand_name, a.*
		from SHOP_PD a
		left join (select * from BASE_BRAND_INFO where is_del = 0) b on a.brand_id = b.brand_id  where 1 = 1
		<include refid="sf-shopPd" />
		order by a.add_date desc, a.ORDER_SORT asc, a.sell_start_date desc,a.ID asc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectAllPdType" resultMap="pdTypeResult" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select distinct a.PD_TYPE from SHOP_PD a where 1 = 1
		<include refid="sf-shopPd" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectMmtProductList" resultMap="mmtProductList" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select t.id, t.pd_id, t.brand_id, t.md_name, t.pd_type, t.shop_id, t.main_pic, t.mmt_price, t.price, t.p_desc,
		b.sp_price_value, 
		c.price_value,
		d.shop_name,
		d.user_name,
		e.brand_name
  		from shop_pd t
  		left join 
  		(
  			select * from SHOP_PD_SALE_PRICE spsp
            where <![CDATA[ spsp.sp_start_date <= sysdate 
            and spsp.sp_end_date >= sysdate ]]>) b on t.id = b.p_id
  		left join 
  		(
  			select * from SHOP_PD_PRICE spp
            where <![CDATA[ spp.start_date <= sysdate
            and spp.end_date >= sysdate ]]>
            and spp.price_type = 0
            and spp.is_del = 0) c on t.id = c.p_id
		left join
		(
			select es.shop_id, es.entp_id, es.shop_name,ui.user_name
            from entp_shop es 
            left join 
            (
            	select id, user_name from user_info where user_state = 0) ui on es.host_id = ui.id
            where es.state = 0) d on t.shop_id = d.shop_id
        left join 
  		(
  			select bbi.brand_id, bbi.brand_name from BASE_BRAND_INFO bbi
            where bbi.is_del = 0) e on t.brand_id = e.brand_id
		where t.state = 0 and t.price_audit_state = 1
		<isNotEmpty prepend=" and " property="map.is_oldtonew">t.is_oldtonew = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_low_energy">t.is_low_energy = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_country">t.is_country = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">t.PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">t.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">t.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign">t.pd_type in
		       (
		       		select pd_type from base_pd_type
		         	where pd_type_sign = #map.pd_type_sign:VARCHAR#
		           	and is_model = 0
		       )
		</isNotEmpty>
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectMmtProductCount" resultClass="long" parameterClass="shopPd" >
		select count(t.id) from shop_pd t
  		left join 
  		(
  			select * from SHOP_PD_SALE_PRICE spsp
            where <![CDATA[ spsp.sp_start_date <= sysdate 
            and spsp.sp_end_date >= sysdate ]]>) b on t.id = b.p_id
  		left join 
  		(
  			select * from SHOP_PD_PRICE spp
            where <![CDATA[ spp.start_date <= sysdate
            and spp.end_date >= sysdate ]]>
            and spp.price_type = 0
            and spp.is_del = 0) c on t.id = c.p_id
		left join
		(
			select es.shop_id, es.entp_id, es.shop_name,ui.user_name
            from entp_shop es 
            left join 
            (
            	select id, user_name from user_info where user_state = 0) ui on es.host_id = ui.id
            where es.state = 0) d on t.shop_id = d.shop_id
                left join 
  		(
  			select bbi.brand_id, bbi.brand_name from BASE_BRAND_INFO bbi
            where bbi.is_del = 0) e on t.brand_id = e.brand_id
		where t.state = 0 and t.price_audit_state = 1
		<isNotEmpty prepend=" and " property="map.is_oldtonew">t.is_oldtonew = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_low_energy">t.is_low_energy = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_country">t.is_country = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">t.PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">t.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">t.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign">t.pd_type in
		       (
		       		select pd_type from base_pd_type
		         	where pd_type_sign = #map.pd_type_sign:VARCHAR#
		           	and is_model = 0
		       )
		</isNotEmpty>
	</select>

	<select id="selectMmtProductPaginatedList" resultMap="mmtProductList" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select t.id, t.pd_id, t.brand_id, t.md_name, t.pd_type, t.shop_id, t.main_pic, t.mmt_price, t.price, t.p_desc,
		b.sp_price_value, 
		c.price_value,
		d.shop_name,
		d.user_name,
		e.brand_name
  		from shop_pd t
  		left join 
  		(
  			select * from SHOP_PD_SALE_PRICE spsp
            where <![CDATA[ spsp.sp_start_date <= sysdate 
            and spsp.sp_end_date >= sysdate ]]>) b on t.id = b.p_id
  		left join 
  		(
  			select * from SHOP_PD_PRICE spp
            where <![CDATA[ spp.start_date <= sysdate
            and spp.end_date >= sysdate ]]>
            and spp.price_type = 0
            and spp.is_del = 0) c on t.id = c.p_id
		left join
		(
			select es.shop_id, es.entp_id, es.shop_name,ui.user_name
            from entp_shop es 
            left join 
            (
            	select id, user_name from user_info where user_state = 0) ui on es.host_id = ui.id
            where es.state = 0) d on t.shop_id = d.shop_id
                left join 
  		(
  			select bbi.brand_id, bbi.brand_name from BASE_BRAND_INFO bbi
            where bbi.is_del = 0) e on t.brand_id = e.brand_id
		where t.state = 0 and t.price_audit_state = 1
		<isNotEmpty prepend=" and " property="map.is_oldtonew">t.is_oldtonew = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_low_energy">t.is_low_energy = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_country">t.is_country = 1</isNotEmpty>
		<isNotEmpty prepend=" and " property="pd_type">t.PD_TYPE = #pd_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="brand_id">t.BRAND_ID = #brand_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_id">t.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.pd_type_sign">t.pd_type in
		       (
		       		select pd_type from base_pd_type
		         	where pd_type_sign = #map.pd_type_sign:VARCHAR#
		           	and is_model = 0
		       )
		</isNotEmpty>
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>
	
	<select id="selectAllBrandId" resultMap="brandIdResult" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select distinct a.BRAND_ID, a.PD_TYPE from SHOP_PD a where 1 = 1
		<include refid="sf-shopPd" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectProductCenterShowCount" resultClass="long" parameterClass="shopPd" >
		select count(a.ID) from SHOP_PD a ,ENTP_SHOP b where a.shop_id = b.shop_id
		<include refid="sf-shopPd" />
		<isNotEmpty prepend=" and " property="map.containsPt"> a.pd_type in (select pd_type from BASE_PD_TYPE where pd_type_sign = #map.containsPt# and is_model = 0 and del_mark = 0)</isNotEmpty>
	</select>
	
<!--	产品排行榜-->
	<select id="selectProductRank" resultMap="shopPdRank" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		 select sp.pd_id, sp.md_name, count(*) as cou
		 from shop_pd sp
		 group by sp.pd_id, sp.md_name
		 order by cou desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

<!--	MMT_v3首页 产品排行榜-->
	<select id="selectProductRankForMMT_Index" resultMap="shopPdRank" parameterClass="shopPd" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		 select a.pd_id,a.md_name,sum(a.price) cou 
		 from shop_pd a 
		 where 1 = 1
		 <include refid="sf-shopPd" />
		 group by a.pd_id,a.md_name 
		 order by cou desc 
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	

	<select id="selectProductCenterShowPaginatedList" resultMap="productCenterShowResultForList" parameterClass="shopPd"
		>
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*,b.shop_name,b.p_index,b.host_id from SHOP_PD a ,ENTP_SHOP b where a.shop_id = b.shop_id
		<include refid="sf-shopPd" />
		<isNotEmpty prepend=" and " property="map.containsPt"> a.pd_type in (select pd_type from BASE_PD_TYPE where pd_type_sign = #map.containsPt# and is_model = 0 and del_mark = 0)</isNotEmpty>
		<isNotEmpty property="map.price_order_desc">order by a.mmt_price desc </isNotEmpty>
		<isEmpty property="map.price_order_desc">order by a.mmt_price asc </isEmpty>
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertShopPd" parameterClass="shopPd">
		<selectKey resultClass="long" keyProperty="id">select SHOP_SEQUENCE.nextval as id from dual</selectKey>
		<![CDATA[insert into SHOP_PD (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="pd_id">PD_ID</isNotNull>	
			<isNotNull prepend="," property="brand_id">BRAND_ID</isNotNull>	
			<isNotNull prepend="," property="md_name">MD_NAME</isNotNull>	
			<isNotNull prepend="," property="md_sname">MD_SNAME</isNotNull>	
			<isNotNull prepend="," property="pd_type">PD_TYPE</isNotNull>	
			<isNotNull prepend="," property="category_id">CATEGORY_ID</isNotNull>	
			<isNotNull prepend="," property="series_id">SERIES_ID</isNotNull>	
			<isNotNull prepend="," property="series_name">SERIES_NAME</isNotNull>	
			<isNotNull prepend="," property="is_country">IS_COUNTRY</isNotNull>	
			<isNotNull prepend="," property="is_oldtonew">IS_OLDTONEW</isNotNull>	
			<isNotNull prepend="," property="is_low_energy">IS_LOW_ENERGY</isNotNull>	
			<isNotNull prepend="," property="is_topic_onsale">IS_TOPIC_ONSALE</isNotNull>	
			<isNotNull prepend="," property="topic_onsale_id">TOPIC_ONSALE_ID</isNotNull>	
			<isNotNull prepend="," property="is_price_batch">IS_PRICE_BATCH</isNotNull>	
			<isNotNull prepend="," property="is_auction">IS_AUCTION</isNotNull>	
			<isNotNull prepend="," property="is_recommend">IS_RECOMMEND</isNotNull>	
			<isNotNull prepend="," property="is_onsale">IS_ONSALE</isNotNull>
			<isNotNull prepend="," property="is_hot_sale">IS_HOT_SALE</isNotNull>	
			<isNotNull prepend="," property="entp_id">ENTP_ID</isNotNull>	
			<isNotNull prepend="," property="shop_id">SHOP_ID</isNotNull>	
			<isNotNull prepend="," property="price">PRICE</isNotNull>	
			<isNotNull prepend="," property="price_limit">PRICE_LIMIT</isNotNull>	
			<isNotNull prepend="," property="mmt_price">MMT_PRICE</isNotNull>	
			<isNotNull prepend="," property="price_type">PRICE_TYPE</isNotNull>	
			<isNotNull prepend="," property="price_audit_state">PRICE_AUDIT_STATE</isNotNull>	
			<isNotNull prepend="," property="main_pic">MAIN_PIC</isNotNull>	
			<isNotNull prepend="," property="access_num">ACCESS_NUM</isNotNull>	
			<isNotNull prepend="," property="excellent_num">EXCELLENT_NUM</isNotNull>	
			<isNotNull prepend="," property="good_num">GOOD_NUM</isNotNull>	
			<isNotNull prepend="," property="normal_num">NORMAL_NUM</isNotNull>	
			<isNotNull prepend="," property="poor_num">POOR_NUM</isNotNull>	
			<isNotNull prepend="," property="bad_num">BAD_NUM</isNotNull>	
			<isNotNull prepend="," property="state">STATE</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="del_date">DEL_DATE</isNotNull>	
			<isNotNull prepend="," property="sell_start_date">SELL_START_DATE</isNotNull>	
			<isNotNull prepend="," property="sell_end_date">SELL_END_DATE</isNotNull>	
			<isNotNull prepend="," property="order_sort">ORDER_SORT</isNotNull>	
			<isNotNull prepend="," property="stock_state">STOCK_STATE</isNotNull>
			<isNotNull prepend="," property="disv_limit_max">DISV_LIMIT_MAX</isNotNull>	
			<isNotNull prepend="," property="pd_num">PD_NUM</isNotNull>	
			<isNotNull prepend="," property="p_desc">P_DESC</isNotNull>	
			<isNotNull prepend="," property="is_new">IS_NEW</isNotNull>	
			
			<isNull prepend="," property="add_date">ADD_DATE</isNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">#pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">#brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="md_name">#md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="md_sname">#md_sname:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">#pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="category_id">#category_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="series_id">#series_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="series_name">#series_name:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_country">#is_country:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_oldtonew">#is_oldtonew:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_low_energy">#is_low_energy:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_topic_onsale">#is_topic_onsale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="topic_onsale_id">#topic_onsale_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_price_batch">#is_price_batch:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_auction">#is_auction:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_recommend">#is_recommend:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_onsale">#is_onsale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_hot_sale">#is_hot_sale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">#entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">#shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">#price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_limit">#price_limit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_price">#mmt_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_type">#price_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_audit_state">#price_audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="main_pic">#main_pic:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="access_num">#access_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="excellent_num">#excellent_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="good_num">#good_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="normal_num">#normal_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="poor_num">#poor_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bad_num">#bad_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="state">#state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="del_date">#del_date:DATE#</isNotNull>
			<isNotNull prepend="," property="sell_start_date">#sell_start_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="sell_end_date">#sell_end_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="order_sort">#order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_state">#stock_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="disv_limit_max">#disv_limit_max:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_num">#pd_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_desc">#p_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_new">#is_new:DECIMAL#</isNotNull>
			
			<isNull prepend="," property="add_date">sysdate</isNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateShopPd" parameterClass="shopPd">
		update SHOP_PD
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_id">PD_ID = #pd_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="brand_id">BRAND_ID = #brand_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="md_name">MD_NAME = #md_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="md_sname">MD_SNAME = #md_sname:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="pd_type">PD_TYPE = #pd_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="category_id">CATEGORY_ID = #category_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="series_id">SERIES_ID = #series_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="series_name">SERIES_NAME = #series_name:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_country">IS_COUNTRY = #is_country:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_oldtonew">IS_OLDTONEW = #is_oldtonew:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_low_energy">IS_LOW_ENERGY = #is_low_energy:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_topic_onsale">IS_TOPIC_ONSALE = #is_topic_onsale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="topic_onsale_id">TOPIC_ONSALE_ID = #topic_onsale_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_price_batch">IS_PRICE_BATCH = #is_price_batch:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_auction">IS_AUCTION = #is_auction:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_recommend">IS_RECOMMEND = #is_recommend:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_onsale">IS_ONSALE = #is_onsale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_hot_sale">IS_HOT_SALE = #is_hot_sale:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="shop_id">SHOP_ID = #shop_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price">PRICE = #price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_limit">PRICE_LIMIT = #price_limit:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_price">MMT_PRICE = #mmt_price:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_type">PRICE_TYPE = #price_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="price_audit_state">PRICE_AUDIT_STATE = #price_audit_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="main_pic">MAIN_PIC = #main_pic:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="access_num">ACCESS_NUM = #access_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="excellent_num">EXCELLENT_NUM = #excellent_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="good_num">GOOD_NUM = #good_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="normal_num">NORMAL_NUM = #normal_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="poor_num">POOR_NUM = #poor_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="bad_num">BAD_NUM = #bad_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="state">STATE = #state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="del_date">DEL_DATE = #del_date:DATE#</isNotNull>
			<isNotNull prepend="," property="sell_start_date">SELL_START_DATE = #sell_start_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="sell_end_date">SELL_END_DATE = #sell_end_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="order_sort">ORDER_SORT = #order_sort:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="stock_state">STOCK_STATE = #stock_state:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="disv_limit_max">DISV_LIMIT_MAX = #disv_limit_max:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="pd_num">PD_NUM = #pd_num:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_desc">P_DESC = #p_desc:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="is_new">IS_NEW = #is_new:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="map.directUp">
				SELL_START_DATE = sysdate , SELL_END_DATE = sysdate + 7
			</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
			<isEmpty prepend=" " property="map.pks">
				<isNotEmpty prepend=" " property="map.update_by_pd_id">
					PD_ID = #map.update_by_pd_id:DECIMAL#				
				</isNotEmpty>
			</isEmpty>
		</isEmpty>
	</update>

	<delete id="deleteShopPd" parameterClass="shopPd">
		delete from SHOP_PD where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
	
	<update id="updateShopPdDown" parameterClass="shopPd">
		update SHOP_PD  set sell_end_date = sysdate - 1/24/60 where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>
	
</sqlMap>