<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KonkaMobileStorages">

    <typeAlias alias="konkaMobileStorages" type="com.ebiz.mmt.domain.KonkaMobileStorages" />

	
	
    <resultMap id="konkaMobileStoragesResult" class="konkaMobileStorages">
		<result property="storage_id" column="STORAGE_ID" jdbcType="DECIMAL" />
		<result property="storage_name" column="STORAGE_NAME" jdbcType="VARCHAR" />
		<result property="storage_areacom" column="STORAGE_AREACOM" jdbcType="DECIMAL" />
		<result property="storage_com" column="STORAGE_COM" jdbcType="DECIMAL" />
		<result property="par_id" column="PAR_ID" jdbcType="DECIMAL" />
		<result property="storage_type" column="STORAGE_TYPE" jdbcType="DECIMAL" />
		<result property="is_del" column="IS_DEL" jdbcType="DECIMAL" />
		
    </resultMap>

	<resultMap id="konkaMobileStoragesResultForList" class="konkaMobileStorages" extends="konkaMobileStoragesResult">
		<result property="map.dept_name" column="DEPT_NAME" jdbcType="VARCHAR" />
		<result property="map.par_name" column="PAR_NAME" jdbcType="VARCHAR" />
		<result property="map.type_name" column="TYPE_NAME" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="konkaMobileStoragesResultForView" class="konkaMobileStorages" extends="konkaMobileStoragesResult">
		<result property="map.dept_name" column="DEPT_NAME" jdbcType="VARCHAR" />
		<result property="map.par_name" column="PAR_NAME" jdbcType="VARCHAR" />
		<result property="map.par_type" column="PAR_TYPE" jdbcType="DECIMAL" />
		<result property="map.type_name" column="TYPE_NAME" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="sf-konkaMobileStorages">
		<isNotEmpty prepend=" and " property="storage_id">a.STORAGE_ID = #storage_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="storage_name">a.STORAGE_NAME like '%' || #storage_name:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="storage_areacom">a.STORAGE_AREACOM = #storage_areacom:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="storage_com">a.STORAGE_COM = #storage_com:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="par_id">a.PAR_ID = #par_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="storage_type">a.STORAGE_TYPE = #storage_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_del">a.IS_DEL = #is_del:DECIMAL#</isNotEmpty>
	</sql>
	
	<select id="selectKonkaMobileStorages" resultMap="konkaMobileStoragesResultForView" parameterClass="konkaMobileStorages" >
	select a.*,b.dept_name,t.storage_name as par_name,t.storage_type as par_type,c.type_name as type_name
   from KONKA_MOBILE_STORAGES a
   left join KONKA_DEPT b on a.storage_areacom = b.dept_id
   left join KONKA_MOBILE_STORAGES t on a.par_id = t.storage_id
   left join import_data_types c on a.storage_com = c.id and c.data_type = 5
	 where 1 = 1
		<include refid="sf-konkaMobileStorages" />
	</select>
	
	<select id="selectKonkaMobileStoragesList" resultMap="konkaMobileStoragesResult" parameterClass="konkaMobileStorages" >
		<isNotEmpty property="row.count"><![CDATA[ select * from ( ]]></isNotEmpty>
		select * from KONKA_MOBILE_STORAGES a where 1=1
		<include refid="sf-konkaMobileStorages" />
		<!-- order by a.ID desc -->
		<isNotEmpty property="row.count"><![CDATA[ ) where rownum<=#row.count# ]]></isNotEmpty>
	</select>
	
	<select id="selectKonkaMobileStoragesCount" resultClass="long" parameterClass="konkaMobileStorages" >
	  select count(*) 
      from KONKA_MOBILE_STORAGES a
      left join KONKA_DEPT b 
      on a.storage_areacom=b.dept_id
      left join KONKA_MOBILE_STORAGES t 
      on a.par_id = t.storage_id
      left join  import_data_types c 
      on a.storage_com = c.id
      and c.data_type=5
      where 1 = 1
	    <isNotEmpty prepend=" and " property="map.is_fgs">a.STORAGE_TYPE in (2)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_storages">a.STORAGE_TYPE in (1,2)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_child">a.STORAGE_TYPE in (3)</isNotEmpty>
		<include refid="sf-konkaMobileStorages" />
	</select>
	
	<select id="selectKonkaMobileStoragesPaginatedList" resultMap="konkaMobileStoragesResultForList" parameterClass="konkaMobileStorages" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
	 select a.*,b.dept_name,t.storage_name as par_name,c.type_name as type_name
      from KONKA_MOBILE_STORAGES a
      left join KONKA_DEPT b 
      on a.storage_areacom=b.dept_id
      left join KONKA_MOBILE_STORAGES t 
      on a.par_id = t.storage_id
      left join  import_data_types c 
      on a.storage_com = c.id
      and c.data_type=5
     where 1 = 1
		 <isNotEmpty prepend=" and " property="map.is_fgs">a.STORAGE_TYPE in (2)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_storages">a.STORAGE_TYPE in (1,2)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_child">a.STORAGE_TYPE in (3)</isNotEmpty>
		<include refid="sf-konkaMobileStorages" />
		<!-- order by a.ID desc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaMobileStorages" parameterClass="konkaMobileStorages">
		<selectKey resultClass="long" keyProperty="storage_id">select KONKA_MOBILE_STORAGES_SEQ.nextval as storage_id from dual</selectKey>
		<![CDATA[insert into KONKA_MOBILE_STORAGES (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="storage_id">STORAGE_ID</isNotNull>
			<isNotNull prepend="," property="storage_name">STORAGE_NAME</isNotNull>
			<isNotNull prepend="," property="storage_areacom">STORAGE_AREACOM</isNotNull>
			<isNotNull prepend="," property="storage_com">STORAGE_COM</isNotNull>
			<isNotNull prepend="," property="par_id">PAR_ID</isNotNull>
			<isNotNull prepend="," property="storage_type">STORAGE_TYPE</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL</isNotNull>
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="storage_id">#storage_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_name">#storage_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="storage_areacom">#storage_areacom:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_com">#storage_com:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_id">#par_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_type">#storage_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">#is_del:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>
	
	<update id="updateKonkaMobileStorages" parameterClass="konkaMobileStorages">
		update KONKA_MOBILE_STORAGES
		<dynamic prepend="set">
			<isNotNull prepend="," property="storage_id">STORAGE_ID = #storage_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_name">STORAGE_NAME = #storage_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="storage_areacom">STORAGE_AREACOM = #storage_areacom:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_com">STORAGE_COM = #storage_com:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="par_id">PAR_ID = #par_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="storage_type">STORAGE_TYPE = #storage_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="is_del">IS_DEL = #is_del:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="storage_id">STORAGE_ID = #storage_id#</isNotEmpty>
		<isEmpty prepend=" " property="storage_id">
			<isNotEmpty prepend=" " property="map.pks">
				STORAGE_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaMobileStorages" parameterClass="konkaMobileStorages">
		delete from KONKA_MOBILE_STORAGES where
		<isNotEmpty prepend=" " property="storage_id">STORAGE_ID = #storage_id#</isNotEmpty>
		<isEmpty prepend=" " property="storage_id">
			<isNotEmpty prepend=" " property="map.pks">
				STORAGE_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>
</sqlMap>
