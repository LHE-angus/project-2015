<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KONKA_ACT_INFO">

	<typeAlias alias="konkaActInfo" type="com.ebiz.mmt.domain.KonkaActInfo" />

	<cacheModel id="oneDayCache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertKonkaActInfo" />
		<flushOnExecute statement="updateKonkaActInfo" />
		<flushOnExecute statement="deleteKonkaActInfo" />
	</cacheModel>

	<resultMap id="konkaActInfoResultForList" class="konkaActInfo">
		<result column="ACT_ID" property="act_id" jdbcType="DECIMAL" />
		<result column="ACT_SN" property="act_sn" jdbcType="VARCHAR" />
		<result column="TITLE" property="title" jdbcType="VARCHAR" />
		<result column="TYPE_ID" property="type_id" jdbcType="DECIMAL" />
		<result column="START_DATE" property="start_date" jdbcType="TIMESTAMP" />
		<result column="END_DATE" property="end_date" jdbcType="TIMESTAMP" />
		<result column="DEPT_SN" property="dept_sn" jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="dept_name" jdbcType="VARCHAR" />
		<result column="R3_CODE" property="r3_code" jdbcType="VARCHAR" />
		<result column="C_NAME" property="c_name" jdbcType="VARCHAR" />
		<result column="C_LINK_NAME" property="c_link_name" jdbcType="VARCHAR" />
		<result column="C_TEL" property="c_tel" jdbcType="VARCHAR" />
		<result column="ADD_USER_ID" property="add_user_id" jdbcType="DECIMAL" />
		<result column="ADD_USER_NAME" property="add_user_name" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="TIMESTAMP" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="TARGET_MONEY" property="target_money" jdbcType="DECIMAL" />
		<result column="DONE_MONEY" property="done_money" jdbcType="DECIMAL" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="konkaActInfoResult" class="konkaActInfo" extends="konkaActInfoResultForList">
	</resultMap>
	
	<resultMap id="konkaActInfoAndSaleDatasResult" class="konkaActInfo" extends="konkaActInfoResultForList">
		<result column="MODEL_NAME" property="map.model_name" jdbcType="VARCHAR" />
		<result column="NUM" property="map.num" jdbcType="DECIMAL" />
		<result column="SINGLE_PRICE" property="map.single_price" jdbcType="DECIMAL" />
		<result column="ALL_PRICE" property="map.all_price" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-konkaActInfo">
		<isNotEmpty prepend=" and " property="act_id">ACT_ID = #act_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="act_sn">ACT_SN = #act_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="title">TITLE = #title:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_id">TYPE_ID = #type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="start_date">START_DATE = #start_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">END_DATE = #end_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_sn">DEPT_SN = #dept_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_code">R3_CODE = #r3_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_name">C_NAME = #c_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_link_name">C_LINK_NAME = #c_link_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_tel">C_TEL = #c_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">MEMO = #memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="target_money">TARGET_MONEY = #target_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="done_money">DONE_MONEY = #done_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="status">STATUS = #status:DECIMAL#</isNotEmpty>
	
		<isNotEmpty prepend=" and " property="map.r3_code_like">R3_CODE like '%' || #map.r3_code_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.c_name_like">C_NAME like '%' || #map.c_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_user_name_like">ADD_USER_NAME like '%' || #map.add_user_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.start_time_start"><![CDATA[ START_DATE >= to_date(#map.start_time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.start_time_end"><![CDATA[ START_DATE <= to_date(#map.start_time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
	</sql>
	
	<sql id="sf-konkaActInfo-t">
		<isNotEmpty prepend=" and " property="act_id">t.ACT_ID = #act_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="act_sn">t.ACT_SN = #act_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="title">t.TITLE = #title:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="type_id">t.TYPE_ID = #type_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="start_date">t.START_DATE = #start_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_date">t.END_DATE = #end_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_sn">t.DEPT_SN = #dept_sn:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="dept_name">t.DEPT_NAME = #dept_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="r3_code">t.R3_CODE = #r3_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_name">t.C_NAME = #c_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_link_name">t.C_LINK_NAME = #c_link_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_tel">t.C_TEL = #c_tel:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_id">t.ADD_USER_ID = #add_user_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_user_name">t.ADD_USER_NAME = #add_user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">t.ADD_DATE = #add_date:TIMESTAMP#</isNotEmpty>
		<isNotEmpty prepend=" and " property="memo">t.MEMO = #memo:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="target_money">t.TARGET_MONEY = #target_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="done_money">t.DONE_MONEY = #done_money:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="status">t.STATUS = #status:DECIMAL#</isNotEmpty>
	
		<isNotEmpty prepend=" and " property="map.r3_code_like">t.R3_CODE like '%' || #map.r3_code_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.c_name_like">t.C_NAME like '%' || #map.c_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_user_name_like">t.ADD_USER_NAME like '%' || #map.add_user_name_like:VARCHAR# || '%'</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.start_time_start"><![CDATA[ t.START_DATE >= to_date(#map.start_time_start#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.start_time_end"><![CDATA[ t.START_DATE <= to_date(#map.start_time_end#,'yyyy-MM-dd hh24:mi:ss') ]]></isNotEmpty>
	</sql>

	<select id="selectKonkaActInfo" resultMap="konkaActInfoResult" parameterClass="konkaActInfo" cacheModel="oneDayCache">
		select * from KONKA_ACT_INFO where 1 = 1
		<include refid="sf-konkaActInfo" />
	</select>

	<select id="selectKonkaActInfoList" resultMap="konkaActInfoResultForList" parameterClass="konkaActInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from KONKA_ACT_INFO where 1 = 1
		<include refid="sf-konkaActInfo" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<select id="selectKonkaActInfoAndSaleDatasList" resultMap="konkaActInfoAndSaleDatasResult" parameterClass="konkaActInfo" cacheModel="oneDayCache">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		SELECT t.*,
       z.model_name AS model_name,
       z.num AS num,
       z.SINGLE_PRICE AS single_price,
       z.ALL_PRICE AS all_price
  FROM    (SELECT *
             FROM KONKA_ACT_INFO a, KONKA_MOBILE_SAIL_DATA b
            WHERE     a.R3_CODE = b.CUSTOMER_R3_CODE
                 <![CDATA[ AND b.REPORT_DATE >= a.START_DATE
                  AND b.REPORT_DATE <= a.END_DATE ]]>) z
       RIGHT JOIN
          KONKA_ACT_INFO t
       ON t.ACT_ID = z.act_id 
		<include refid="sf-konkaActInfo-t" />
		order by t.ADD_DATE desc
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<select id="selectKonkaActInfoCount" resultClass="long" parameterClass="konkaActInfo" cacheModel="oneDayCache">
		select count(*) from KONKA_ACT_INFO where 1 = 1
		<include refid="sf-konkaActInfo" />
	</select>
	
	<select id="selectKonkaActInfoNoMax" resultClass="long" parameterClass="konkaActInfo" >
		select max(substr(act_sn,7)) from KONKA_ACT_INFO where 1=1 
		<include refid="sf-konkaActInfo" />
		<isNotEmpty prepend=" and " property="map.file_no_lm">
			substr(act_sn,0,6)=#map.file_no_lm#
		</isNotEmpty>
	</select>

	<select id="selectKonkaActInfoPaginatedList" resultMap="konkaActInfoResult" parameterClass="konkaActInfo" cacheModel="oneDayCache">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from KONKA_ACT_INFO where 1 = 1
		<include refid="sf-konkaActInfo" />
		 order by ADD_DATE desc 
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertKonkaActInfo" parameterClass="konkaActInfo">
		<selectKey resultClass="long" keyProperty="act_id">select KONKAOA_FILES_SEQ.nextval as act_id from dual </selectKey>
		<![CDATA[insert into KONKA_ACT_INFO (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="act_id">ACT_ID</isNotNull>	
			<isNotNull prepend="," property="act_sn">ACT_SN</isNotNull>	
			<isNotNull prepend="," property="title">TITLE</isNotNull>	
			<isNotNull prepend="," property="type_id">TYPE_ID</isNotNull>	
			<isNotNull prepend="," property="start_date">START_DATE</isNotNull>	
			<isNotNull prepend="," property="end_date">END_DATE</isNotNull>	
			<isNotNull prepend="," property="dept_sn">DEPT_SN</isNotNull>	
			<isNotNull prepend="," property="dept_name">DEPT_NAME</isNotNull>	
			<isNotNull prepend="," property="r3_code">R3_CODE</isNotNull>	
			<isNotNull prepend="," property="c_name">C_NAME</isNotNull>	
			<isNotNull prepend="," property="c_link_name">C_LINK_NAME</isNotNull>	
			<isNotNull prepend="," property="c_tel">C_TEL</isNotNull>	
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID</isNotNull>	
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="memo">MEMO</isNotNull>	
			<isNotNull prepend="," property="target_money">TARGET_MONEY</isNotNull>	
			<isNotNull prepend="," property="done_money">DONE_MONEY</isNotNull>	
			<isNotNull prepend="," property="status">STATUS</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="act_id">#act_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="act_sn">#act_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="title">#title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_id">#type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="start_date">#start_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="end_date">#end_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="dept_sn">#dept_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_name">#dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_code">#r3_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_name">#c_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_link_name">#c_link_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_tel">#c_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">#add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">#add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">#add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="memo">#memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="target_money">#target_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="done_money">#done_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="status">#status:DECIMAL#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateKonkaActInfo" parameterClass="KonkaActInfo">
		update KONKA_ACT_INFO
		<dynamic prepend="set">
			<isNotNull prepend="," property="act_id">ACT_ID = #act_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="act_sn">ACT_SN = #act_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="title">TITLE = #title:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="type_id">TYPE_ID = #type_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="start_date">START_DATE = #start_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="end_date">END_DATE = #end_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="dept_sn">DEPT_SN = #dept_sn:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="dept_name">DEPT_NAME = #dept_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="r3_code">R3_CODE = #r3_code:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_name">C_NAME = #c_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_link_name">C_LINK_NAME = #c_link_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="c_tel">C_TEL = #c_tel:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_user_id">ADD_USER_ID = #add_user_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="add_user_name">ADD_USER_NAME = #add_user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:TIMESTAMP#</isNotNull>
			<isNotNull prepend="," property="memo">MEMO = #memo:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="target_money">TARGET_MONEY = #target_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="done_money">DONE_MONEY = #done_money:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="status">STATUS = #status:DECIMAL#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="act_id">ACT_ID = #act_id#</isNotEmpty>
		<isEmpty prepend=" " property="act_id">
			<isNotEmpty prepend=" " property="map.pks">
				ACT_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteKonkaActInfo" parameterClass="KonkaActInfo">
		delete from KONKA_ACT_INFO where
		<isNotEmpty prepend=" " property="act_id">ACT_ID = #act_id#</isNotEmpty>
		<isEmpty prepend=" " property="act_id">
			<isNotEmpty prepend=" " property="map.pks">
				ACT_ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>