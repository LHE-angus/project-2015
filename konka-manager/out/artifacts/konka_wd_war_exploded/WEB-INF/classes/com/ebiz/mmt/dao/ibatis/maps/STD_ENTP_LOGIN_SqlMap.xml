<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="STD_ENTP_LOGIN">

	<typeAlias alias="stdEntpLogin" type="com.ebiz.mmt.domain.StdEntpLogin" />

	

	<resultMap id="stdEntpLoginResultForList" class="stdentplogin">
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="USER_NAME" property="user_name" jdbcType="VARCHAR" />
		<result column="USER_TYPE" property="user_type" jdbcType="DECIMAL" />
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="OWN_SYS" property="own_sys" jdbcType="DECIMAL" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="MMT_USER" property="mmt_user" jdbcType="VARCHAR" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATETIME" />
		<result column="CLIENT_IP" property="client_ip" jdbcType="VARCHAR" />
		<result column="CLIENT_VERSIONS" property="client_versions" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="stdEntpLoginResult" class="stdEntpLogin" extends="stdEntpLoginResultForList">
	</resultMap>
	
	<resultMap id="stdEntpLoginNumPerDayResult" class="stdEntpLogin">
		<result column="DAY_NUM" property="map.day_num" jdbcType="DECIMAL" />
		<result column="PROVINCE_SHOP_NUM" property="map.province_shop_num" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- @author:Jiang,JiaYong   @version:2010-12-23 -->
	<resultMap id="stdEntpLoginResultGroupByVersionForList" class="stdEntpLogin">
		<result column="CLIENT_VERSIONS" property="client_versions" jdbcType="VARCHAR" />
		<result column="ENTPCOUNT" property="map.entp_count" jdbcType="DECIMAL" />
	</resultMap>

	<sql id="sf-stdEntpLogin">
		<isNotEmpty prepend=" and " property="id">ID = #id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_name">USER_NAME = #user_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="user_type">USER_TYPE = #user_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mmt_user">MMT_USER = #mmt_user:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">ADD_DATE = #add_date:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="client_ip">CLIENT_IP = #client_ip:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="client_versions">CLIENT_VERSIONS = #client_versions:VARCHAR#</isNotEmpty>
		
		<isNotEmpty prepend=" and " property="map.add_date_gt">ADD_DATE &gt; #map.add_date_gt:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.add_date_lt">ADD_DATE &lt; #map.add_date_lt:DATETIME#</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.entp_ids">ENTP_ID in 
			<iterate close=")" open="(" conjunction="," property="map.entp_ids">#map.entp_ids[]#</iterate>
		</isNotEmpty>
	</sql>

	<select id="selectStdEntpLogin" resultMap="stdEntpLoginResult" parameterClass="stdEntpLogin" >
		select * from CHEA_FILL.STD_ENTP_LOGIN where 1 = 1
		<include refid="sf-stdEntpLogin" />
	</select>

	<select id="selectStdEntpLoginList" resultMap="stdEntpLoginResultForList" parameterClass="stdEntpLogin" >
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select * from CHEA_FILL.STD_ENTP_LOGIN where 1 = 1
		<include refid="sf-stdEntpLogin" />
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>
	
	<!-- @author:Jiang,JiaYong   @version:2010-12-23 -->
	<select id="selectStdEntpLoginGroupByVersionList" resultMap="stdEntpLoginResultGroupByVersionForList" parameterClass="stdEntpLogin" >
		select t.client_versions, count(t.entp_id) as entpcount
		  from CHEA_FILL.STD_ENTP_LOGIN t
		 where t.add_date > = add_months(sysdate, #map.months:DECIMAL#)
		 group by t.client_versions
	</select>
	
	<!-- @desc:进销存统计某个月每天的登录的网点数   @author:Wu,ShangLong @version:2011-07-06 -->
	<select id="selectStdEntpLoginNumPerDayList" resultMap="stdEntpLoginNumPerDayResult" parameterClass="stdEntpLogin" >
		select cc.day_num,to_char(wm_concat(cc.province || '-' || cc.shop_num)) province_shop_num  from(
			select bb.day_num, bb.province, count(1) shop_num
			          from (select aa.entp_id, aa.own_sys, aa.province, count(1) day_num
			                  from (select distinct t.entp_id,
			                                        t.own_sys,
			                                        substr(t.p_index, 1, 2) || '0000' province,
			                                        trunc(t.add_date, 'dd') my_day
			                          from CHEA_FILL.STD_ENTP_LOGIN t
			                         where 1 = 1
			                           <isNotEmpty prepend=" and " property="map.yyyy_mm_dd_ge"><![CDATA[
						t.add_date >= to_date(#map.yyyy_mm_dd_ge# || '00:00:00', 'yyyymmdd hh24:mi:ss')
						]]></isNotEmpty>
						<isNotEmpty prepend=" and " property="map.yyyy_mm_dd_lt"><![CDATA[
						    t.add_date < to_date(#map.yyyy_mm_dd_lt# || '00:00:00', 'yyyymmdd hh24:mi:ss')
						]]></isNotEmpty>
						) aa
			            group by aa.entp_id, aa.own_sys, aa.province) bb
			            where 1 = 1
			            <isNotEmpty prepend=" and " property="map.province">
							bb.province = #map.province#
						</isNotEmpty>
			         group by bb.day_num, bb.province 
			         order by bb.province) cc
			where 1 = 1
			<isNotEmpty prepend=" and " property="map.days">
				cc.day_num = #map.days#
			</isNotEmpty>
			group by cc.day_num
			order by cc.day_num desc
	</select>

	<select id="selectStdEntpLoginCount" resultClass="long" parameterClass="stdEntpLogin" >
		select count(*) from CHEA_FILL.STD_ENTP_LOGIN where 1 = 1
		<include refid="sf-stdEntpLogin" />
	</select>

	<select id="selectStdEntpLoginPaginatedList" resultMap="stdEntpLoginResult" parameterClass="stdEntpLogin" >
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select * from CHEA_FILL.STD_ENTP_LOGIN where 1 = 1
		<include refid="sf-stdEntpLogin" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<!-- 每日登录买卖商通的网点数 @author:Ren,Zhong @version:2011-7-6 BEGIN-->
	<resultMap id="stdEntpLoginShopCountResult" class="stdEntpLogin">
		<result column="shop_counts" property="map.shop_counts" jdbcType="DECIMAL" />
		<result column="login_date" property="map.login_date" jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="selectEveryDayLoginShopCountForResultList" resultMap="stdEntpLoginShopCountResult" parameterClass="stdEntpLogin" >
		select count(distinct(t.own_sys || '-' || t.entp_id)) as shop_counts, to_char(t.add_date, 'yyyy-MM-dd') as login_date
		  from CHEA_FILL.STD_ENTP_LOGIN t
		  where 1 = 1
		  <isNotEmpty prepend=" and " property="map.begin_date"><![CDATA[t.add_date >= to_date(#map.begin_date#, 'yyyy-MM-dd HH24:MI:SS')]]></isNotEmpty>
		  <isNotEmpty prepend=" and " property="map.end_date"><![CDATA[t.add_date <= to_date(#map.end_date# || '23:59:59', 'yyyy-MM-dd HH24:MI:SS')]]></isNotEmpty>
		 group by to_char(t.add_date, 'yyyy-MM-dd')
		 order by to_char(t.add_date, 'yyyy-MM-dd') asc
	</select>		
	<!-- 每日登录买卖商通的网点数 @author:Ren,Zhong @version:2011-7-6 END-->
	
	<insert id="insertStdEntpLogin" parameterClass="stdEntpLogin">
		<selectKey resultClass="long" keyProperty="id">select CHEA_FILL.MMT_SEQUENCE.nextval as id from dual </selectKey>
		<![CDATA[insert into CHEA_FILL.STD_ENTP_LOGIN (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">ID</isNotNull>	
			<isNotNull prepend="," property="user_name">USER_NAME</isNotNull>	
			<isNotNull prepend="," property="user_type">USER_TYPE</isNotNull>	
			<isNotNull prepend="," property="entp_id">ENTP_ID</isNotNull>	
			<isNotNull prepend="," property="own_sys">OWN_SYS</isNotNull>	
			<isNotNull prepend="," property="p_index">P_INDEX</isNotNull>	
			<isNotNull prepend="," property="mmt_user">MMT_USER</isNotNull>	
			<isNotNull prepend="," property="add_date">ADD_DATE</isNotNull>	
			<isNotNull prepend="," property="client_ip">CLIENT_IP</isNotNull>	
			<isNotNull prepend="," property="client_versions">CLIENT_VERSIONS</isNotNull>	
		</dynamic>
		<![CDATA[) values (]]>
		<dynamic prepend=" ">
			<isNotNull prepend="," property="id">#id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">#user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_type">#user_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">#entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">#own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_index">#p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_user">#mmt_user:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">sysdate</isNotNull>
			<isNotNull prepend="," property="client_ip">#client_ip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="client_versions">#client_versions:VARCHAR#</isNotNull>
		</dynamic>
		<![CDATA[)]]>
	</insert>

	<update id="updateStdEntpLogin" parameterClass="StdEntpLogin">
		update CHEA_FILL.STD_ENTP_LOGIN
		<dynamic prepend="set">
			<isNotNull prepend="," property="id">ID = #id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="user_name">USER_NAME = #user_name:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="user_type">USER_TYPE = #user_type:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="entp_id">ENTP_ID = #entp_id:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="own_sys">OWN_SYS = #own_sys:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="p_index">P_INDEX = #p_index:DECIMAL#</isNotNull>
			<isNotNull prepend="," property="mmt_user">MMT_USER = #mmt_user:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="add_date">ADD_DATE = #add_date:DATETIME#</isNotNull>
			<isNotNull prepend="," property="client_ip">CLIENT_IP = #client_ip:VARCHAR#</isNotNull>
			<isNotNull prepend="," property="client_versions">CLIENT_VERSIONS = #client_versions:VARCHAR#</isNotNull>
		</dynamic>
		where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</update>

	<delete id="deleteStdEntpLogin" parameterClass="StdEntpLogin">
		delete from CHEA_FILL.STD_ENTP_LOGIN where
		<isNotEmpty prepend=" " property="id">ID = #id#</isNotEmpty>
		<isEmpty prepend=" " property="id">
			<isNotEmpty prepend=" " property="map.pks">
				ID in
				<iterate close=")" open="(" conjunction="," property="map.pks">#map.pks[]#</iterate>
			</isNotEmpty>
		</isEmpty>
	</delete>

</sqlMap>