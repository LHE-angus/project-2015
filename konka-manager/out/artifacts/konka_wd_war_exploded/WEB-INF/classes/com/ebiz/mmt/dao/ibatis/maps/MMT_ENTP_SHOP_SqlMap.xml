<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<!-- Code by AutoGenerated Builder -->
<!-- AutoGenerated Builder Version 2.1 -->
<!-- @author Hui,Gang -->
<!-- @datetime 2011-09-29 15:54:30 -->
<sqlMap namespace="chea_fill.ENTP_SHOP">

	<typeAlias alias="konkaEntpShop" type="com.ebiz.mmt.domain.MmtEntpShop" />

	

	<resultMap id="konkaEntpShopResultForList" class="konkaEntpShop">
		<result column="SHOP_ID" property="shop_id" jdbcType="DECIMAL" />
		<result column="ENTP_ID" property="entp_id" jdbcType="DECIMAL" />
		<result column="SHOP_NAME" property="shop_name" jdbcType="VARCHAR" />
		<result column="SHOP_DESC" property="shop_desc" jdbcType="VARCHAR" />
		<result column="SHOP_TYPE" property="shop_type" jdbcType="DECIMAL" />
		<result column="LOGO_PIC" property="logo_pic" jdbcType="VARCHAR" />
		<result column="P_INDEX" property="p_index" jdbcType="DECIMAL" />
		<result column="C_INDEX" property="c_index" jdbcType="VARCHAR" />
		<result column="MAIN_PD" property="main_pd" jdbcType="VARCHAR" />
		<result column="IS_RURAL" property="is_rural" jdbcType="DECIMAL" />
		<result column="IS_OTN" property="is_otn" jdbcType="DECIMAL" />
		<result column="IS_AUTH" property="is_auth" jdbcType="DECIMAL" />
		<result column="IS_SALL" property="is_sall" jdbcType="DECIMAL" />
		<result column="IS_MAINT" property="is_maint" jdbcType="DECIMAL" />
		<result column="IS_CALLB" property="is_callb" jdbcType="DECIMAL" />
		<result column="CREDIT" property="credit" jdbcType="DECIMAL" />
		<result column="ACCESS_NUM" property="access_num" jdbcType="DECIMAL" />
		<result column="HOST_ID" property="host_id" jdbcType="DECIMAL" />
		<result column="ADD_DATE" property="add_date" jdbcType="DATE" />
		<result column="DEL_MAN2" property="del_man2" jdbcType="DECIMAL" />
		<result column="STATE" property="state" jdbcType="DECIMAL" />
		<result column="AUDITOR_ID" property="auditor_id" jdbcType="DECIMAL" />
		<result column="AUDIT_DATE" property="audit_date" jdbcType="DATE" />
		<result column="ONLINE_QQ" property="online_qq" jdbcType="VARCHAR" />
		<result column="ALIPAY_EMAIL" property="alipay_email" jdbcType="VARCHAR" />
		<result column="IS_COMMEND" property="is_commend" jdbcType="DECIMAL" />
		<result column="ORDER_VALUE" property="order_value" jdbcType="DECIMAL" />
		<result column="ROYALTY_RATE" property="royalty_rate" jdbcType="DECIMAL" />
		<result column="KEY_SEQUENCE" property="key_sequence" jdbcType="VARCHAR" />
		<result column="O_COUNT" property="o_count" jdbcType="DECIMAL" />
		<result column="LOGIN_SETTINGS" property="login_settings" jdbcType="VARCHAR" />
		<result column="P_COUNT" property="p_count" jdbcType="DECIMAL" />
		<result column="G_LNG" property="g_lng" jdbcType="DECIMAL" />
		<result column="G_LAT" property="g_lat" jdbcType="DECIMAL" />
		<result column="LINK_USER" property="link_user" jdbcType="VARCHAR" />
		<result column="LINK_PHONE" property="link_phone" jdbcType="VARCHAR" />
		<result column="STREET_ADDR" property="street_addr" jdbcType="VARCHAR" />
		<result column="POST_CODE" property="post_code" jdbcType="VARCHAR" />
		<result column="MAIN_PD2" property="main_pd2" jdbcType="VARCHAR" />
		<result column="STD_ENTP_MAIN_ID" property="std_entp_main_id" jdbcType="DECIMAL" />
		<result column="SHOP_LEVEL" property="shop_level" jdbcType="DECIMAL" />
		<result column="G_LAT_T" property="g_lat_t" jdbcType="DECIMAL" />
		<result column="G_LNG_T" property="g_lng_t" jdbcType="DECIMAL" />
		<result column="G_IS_AUDIT" property="g_is_audit" jdbcType="DECIMAL" />
		<result column="G_RE_COUNT" property="g_re_count" jdbcType="DECIMAL" />
		<result column="MMT" property="mmt" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="konkaEntpShopResult" class="konkaEntpShop" extends="konkaEntpShopResultForList">
	</resultMap>

	<sql id="sf-konkaEntpShop">
		<isNotEmpty prepend=" and " property="shop_id">a.SHOP_ID = #shop_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="entp_id">a.ENTP_ID = #entp_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_name">a.SHOP_NAME = #shop_name:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_desc">a.SHOP_DESC = #shop_desc:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_type">a.SHOP_TYPE = #shop_type:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="logo_pic">a.LOGO_PIC = #logo_pic:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_index">a.P_INDEX = #p_index:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="c_index">a.C_INDEX = #c_index:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="main_pd">a.MAIN_PD = #main_pd:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_rural">a.IS_RURAL = #is_rural:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_otn">a.IS_OTN = #is_otn:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_auth">a.IS_AUTH = #is_auth:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_sall">a.IS_SALL = #is_sall:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_maint">a.IS_MAINT = #is_maint:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_callb">a.IS_CALLB = #is_callb:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="credit">a.CREDIT = #credit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="access_num">a.ACCESS_NUM = #access_num:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="host_id">a.HOST_ID = #host_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="add_date">a.ADD_DATE = #add_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="del_man2">a.DEL_MAN2 = #del_man2:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="state">a.STATE = #state:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="auditor_id">a.AUDITOR_ID = #auditor_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="audit_date">a.AUDIT_DATE = #audit_date:DATE#</isNotEmpty>
		<isNotEmpty prepend=" and " property="online_qq">a.ONLINE_QQ = #online_qq:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="alipay_email">a.ALIPAY_EMAIL = #alipay_email:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="is_commend">a.IS_COMMEND = #is_commend:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="order_value">a.ORDER_VALUE = #order_value:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="royalty_rate">a.ROYALTY_RATE = #royalty_rate:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="key_sequence">a.KEY_SEQUENCE = #key_sequence:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="o_count">a.O_COUNT = #o_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="login_settings">a.LOGIN_SETTINGS = #login_settings:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="p_count">a.P_COUNT = #p_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_lng">a.G_LNG = #g_lng:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_lat">a.G_LAT = #g_lat:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_user">a.LINK_USER = #link_user:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="link_phone">a.LINK_PHONE = #link_phone:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="street_addr">a.STREET_ADDR = #street_addr:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="post_code">a.POST_CODE = #post_code:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="main_pd2">a.MAIN_PD2 = #main_pd2:VARCHAR#</isNotEmpty>
		<isNotEmpty prepend=" and " property="std_entp_main_id">a.STD_ENTP_MAIN_ID = #std_entp_main_id:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="shop_level">a.SHOP_LEVEL = #shop_level:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_lat_t">a.G_LAT_T = #g_lat_t:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_lng_t">a.G_LNG_T = #g_lng_t:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_is_audit">a.G_IS_AUDIT = #g_is_audit:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="g_re_count">a.G_RE_COUNT = #g_re_count:DECIMAL#</isNotEmpty>
		<isNotEmpty prepend=" and " property="mmt">a.MMT = #mmt:DECIMAL#</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.key_word">
			(a.SHOP_NAME like '%' || #map.key_word:VARCHAR# || '%')
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.selects">
			a.SHOP_ID in ($map.selects$)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.not_selects">
			a.SHOP_ID not in ($map.not_selects$)
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.is_developed">
			a.SHOP_ID in (select shop_id from KONKA_SHOP_DEVELOP where
			shop_id in ($map.is_developed$) )
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.not_developed">
			a.SHOP_ID in (select shop_id from KONKA_SHOP_DEVELOP where
			shop_id not in ($map.not_developed$) )
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.not_direct"> b.mmt_shop_id is null </isNotEmpty>

		<!-- for 代理商 网点关系 -->
		<isNotEmpty prepend=" and " property="map.shopDispach">
			A.SHOP_ID NOT IN (SELECT B.SHOP_ID FROM
			KONKA_AGENTS_SHOP_REL B)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.shopDispached">
			A.SHOP_ID IN (SELECT B.SHOP_ID FROM KONKA_AGENTS_SHOP_REL B
			WHERE B.AGENTS_ID = #map.shopDispached:DECIMAL#)
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.is_not_link">c.shop_id is null</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.m_areas_ids">
			(a.p_index in ($map.m_areas_ids$) or a.p_index in (select p_index from chea_fill.base_province_list where
			par_index in ($map.m_areas_ids$))
			<isNotEmpty prepend=" or  " property="map.is_fengongsi"> a.shop_id in (select mmt_shop_id from KONKA_BRANCH_ASSIGN
				where konka_r3_id = -1 and dept_id = #map.dept_id#)</isNotEmpty>
			)
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_jyb"> a.shop_id in (select mmt_shop_id from KONKA_BRANCH_ASSIGN
			where konka_r3_id = -1 and dept_id = #map.dept_id#)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_ywy"> a.shop_id in (select mmt_shop_id from KONKA_BRANCH_ASSIGN
			where konka_r3_id = -1 and dept_id = #map.dept_id#)</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.is_agents"><![CDATA[ (select count(*) from KONKA_BRANCH_CATEGORY where category_id = 20 and mmt_shop_id =  a.shop_id) > 0]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="map.link_user_like">LINK_USER like '%' || #map.link_user_like:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="map.link_phone_like">LINK_PHONE like '%' || #map.link_phone_like:VARCHAR# || '%'
		</isNotEmpty>


		<!-- for 加盟信息 根据地区选择网点 -->
		<isNotEmpty prepend=" and " property="map.areas_ids4join">
			b.par_index in ($map.areas_ids4join$)
		</isNotEmpty>

		<isNotEmpty prepend=" and " property="map.mmtShopIds">
			a.SHOP_ID in
			<iterate close=")" open="(" conjunction="," property="map.mmtShopIds">#map.mmtShopIds[]#</iterate>
		</isNotEmpty>
	</sql>

	<select id="selectMmtEntpShop" resultMap="konkaEntpShopResult" parameterClass="konkaEntpShop"
		 remapResults="false">
		select a.* from entp_shop a where 1 = 1
		<include refid="sf-konkaEntpShop" />
	</select>

	<select id="selectMmtEntpShopList" resultMap="konkaEntpShopResultForList" parameterClass="konkaEntpShop"
		 remapResults="false">
		<isNotEmpty property="row.count">
			<![CDATA[ select * from ( ]]>
		</isNotEmpty>
		select a.*, b.par_index
		from entp_shop a
		left join chea_fill.base_province_list b
		on a.p_index = b.p_index
		<isNotEmpty property="map.is_wdqd"> left join entp_shop c on a.shop_id = c.shop_id</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.p_index">a.p_index in (select t.p_index from konka_base_province_list
			t where 1 = 1
			start with p_index =#map.p_index# connect by prior t.p_index = t.par_index )
		</isNotEmpty>
		<include refid="sf-konkaEntpShop" />
		<isNotEmpty property="map.is_wdqd"> and c.shop_id is null</isNotEmpty>
		<!-- order by ID asc -->
		<isNotEmpty property="row.count">
			<![CDATA[ ) where rownum <= #row.count# ]]>
		</isNotEmpty>
	</select>

	<!--@2011-11-24 Zhang,Xufeng -->
	<select id="selectMmtEntpShopNotRepeatCount" resultClass="long" parameterClass="konkaEntpShop"
		 remapResults="false">
		select count(*)
		from entp_shop a
		where 1 = 1
		<include refid="sf-konkaEntpShop" />
	</select>

	<!--@2011-11-24 Zhang,Xufeng -->
	<select id="selectMmtEntpShopNotRepeatPaginatedList" resultMap="konkaEntpShopResultForList"
		parameterClass="konkaEntpShop"  remapResults="false">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*
		from entp_shop a
		where 1 = 1
		<include refid="sf-konkaEntpShop" />
		order by a.add_date desc,a.SHOP_ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectMmtEntpShopCount" resultClass="long" parameterClass="konkaEntpShop" 
		remapResults="false">
		select count(*)
		from entp_shop a
		left join KONKA_R3_MMT_MATCH b
		on a.shop_id = b.mmt_shop_id
		left join KONKA_AGENTS_SHOP_REL c
		on a.shop_id = c.shop_id
		where 1 = 1
		<include refid="sf-konkaEntpShop" />
		<isNotEmpty prepend=" and " property="map.p_index">a.p_index in (select t.p_index from konka_base_province_list
			t where 1 = 1
			start with p_index =#map.p_index# connect by prior t.p_index = t.par_index )
		</isNotEmpty>
	</select>

	<select id="selectMmtEntpShop2Count" resultClass="long" parameterClass="konkaEntpShop" 
		remapResults="false">
		select count(*)
		from (select a.*, b.par_index
		from entp_shop a
		left join chea_fill.base_province_list b
		on a.p_index = b.p_index
		<isNotEmpty property="map.is_wdqd"> left join entp_shop c on a.shop_id = c.shop_id</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.p_index">a.p_index in (select t.p_index from konka_base_province_list
			t where 1 = 1
			start with p_index =#map.p_index# connect by prior t.p_index = t.par_index )
		</isNotEmpty>
		) a
		where 1 = 1
		<include refid="sf-konkaEntpShop" />

	</select>

	<select id="selectMmtEntpShopPaginatedList" resultMap="konkaEntpShopResultForList" parameterClass="konkaEntpShop"
		 remapResults="false">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*
		from entp_shop a
		left join KONKA_R3_MMT_MATCH b
		on a.shop_id = b.mmt_shop_id
		left join KONKA_AGENTS_SHOP_REL c
		on a.shop_id = c.shop_id
		where 1 = 1
		<include refid="sf-konkaEntpShop" />
		<isNotEmpty prepend=" and " property="map.p_index">a.p_index in (select t.p_index from konka_base_province_list
			t where 1 = 1
			start with p_index =#map.p_index# connect by prior t.p_index = t.par_index )
		</isNotEmpty>
		order by a.add_date desc,a.SHOP_ID desc
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<select id="selectMmtEntpShopPaginatedListForSelect" resultMap="konkaEntpShopResultForList"
		parameterClass="konkaEntpShop"  remapResults="false">
		<![CDATA[ select * from ( select t_.*, rownum rn_ from ( ]]>
		select a.*, b.par_index
		from entp_shop a
		left join chea_fill.base_province_list b
		on a.p_index = b.p_index
		<isNotEmpty property="map.is_wdqd"> left join entp_shop c on a.shop_id = c.shop_id</isNotEmpty>
		where 1 = 1
		<isNotEmpty prepend=" and " property="map.p_index">a.p_index in (select t.p_index from konka_base_province_list
			t where 1 = 1
			start with p_index =#map.p_index# connect by prior t.p_index = t.par_index )
		</isNotEmpty>
		<include refid="sf-konkaEntpShop" />
		<!-- order by ID asc -->
		<![CDATA[ ) t_ where rownum <= (#row.first# + #row.count#)) where rn_ >= (#row.first# + 1) ]]>
	</select>

	<insert id="insertMmtEntpShop" parameterClass="konkaEntpShop">
	</insert>

	<update id="updateMmtEntpShop" parameterClass="konkaEntpShop">
	</update>

	<delete id="deleteMmtEntpShop" parameterClass="konkaEntpShop">
	</delete>

</sqlMap>