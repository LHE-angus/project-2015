<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head xmlns="">
<title>数据上报</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0;user-scalable=0;" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
</head>
<body>
<!--head start -->
<div class="top4 head_class">
  <div class="jiantou"><a ><img src="images/jiantou_09.jpg" onclick="javascript:history.back();" /></a></div>
  <div class="topzi" style="float:left; display:inline; width:100px; padding-left:15%"><img src="images/shujushagnb.png" /></div>
</div>
<form action="#" name="temp_form" id="temp_form" style="margin:0px;padding:0px;" method="post" enctype="multipart/form-data">
<input type="hidden" name="method" value="SaveAttachmentForBill1" />
<input type="hidden" id="lid" name="lid" value="" />
<input type="hidden" id="username" name="username" value="" />
<input type="hidden" id="userpass" name="userpass" value="" />
<input type="hidden" id="ext_url" name="ext_url" value="shuj_bill_audit_wap_his.html" />
<table width="100%" border="0" class="rtab3">
  <tr>
    <th colspan="2" align="right"><span id="sj_his" style="cursor:pointer;">历史记录　</span></th>
  </tr>
  <tr>
    <td width="25%" align="center" nowrap="nowrap">零上报</td>
    <td width="75%" align="left" nowrap="nowrap">
    	<input type="checkbox" id="t1" align="top" />
    </td>
  </tr>
  <tr>
    <td width="25%" align="center" nowrap="nowrap">门店</td>
    <td width="75%" align="left" nowrap="nowrap">
    	<select id="store_id" class="text01" onmouseover="this.style.width='180px';" onchange="this.style.width='180px';" onblur="this.style.width='180px';">
              <option value="">-请选择-</option>
         </select><span class="red16px">*</span><br />
    </td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">型号</td>
    <td align="left" nowrap="nowrap">
    	<input type="hidden" name="select-choice-2" id="select-choice-2" value="" />
    	<input class="selblue422" type="text" name="select-choice-1" id="select-choice-1" maxlength="50" />
    	<br />
    </td>
  </tr>
  
  <tr>
    <td align="center" nowrap="nowrap">数量</td>
    <td align="left" nowrap="nowrap"><input class="selblue41" type="text" name="sales_count" id="sales_count" value="" onfocus="javascript:setOnlyNum(this);" maxlength="4" />
      台 <span class="red16px">*</span><br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">单价</td>
    <td align="left" nowrap="nowrap"><input class="selblue41" type="text" name="single_price" id="single_price" value="" onfocus="javascript:setOnlyNum(this);" maxlength="8" />
      元 <span class="red16px">*</span><br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">金额</td>
    <td align="left" nowrap="nowrap"><input class="selblue411" type="text" name="sales_price" disabled="disabled" id="sales_price" value="" onfocus="javascript:setOnlyNum(this);" maxlength="9" />
      元 <span class="red16px">*</span><br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">备注</td>
    <td align="left" nowrap="nowrap"><textarea name="memo" id="memo" cols="5" rows="5" class="qs1"></textarea>
    <div id="info_tip" style="color:#0066FF;font-size:12px;display:none"><img src="images/tishi.gif" style="vertical-align:middle;" /></div>
      <br /></td>
  </tr>
<!--  <tr>-->
<!--  <td align="center" nowrap="nowrap" >样机类型</td>-->
<!--  <td>-->
<!--  <select name="report_type" id="report_type" style="width:100px;">-->
<!--  <option  value="0">空间充足</option>-->
<!--  <option  value="1">样机取代</option>-->
<!--  </select>-->
<!--  </td> -->
<!--  </tr>-->
  <tr>
    <td align="center" nowrap="nowrap">顾客姓名</td>
    <td align="left" nowrap="nowrap"><input class="selblue42" type="text" name="realname" id="realname" maxlength="20" />
      <br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">顾客电话</td>
    <td align="left" nowrap="nowrap"><input class="selblue42" type="text" name="phonenum" id="phonenum" maxlength="50" />
      <br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">顾客地址</td>
    <td align="left" nowrap="nowrap"><input class="selblue4" type="text" name="addresss" id="addresss" maxlength="100" />
      <br /></td>
  </tr>
  <tr>
    <td align="center" nowrap="nowrap">顾客身份证 </td>
    <td align="left" nowrap="nowrap"><input class="selblue4" type="text" name="mastercode" id="mastercode" maxlength="18" />
      <br /></td>
  </tr>
  <tr>
      <td align="center" nowrap="nowrap">上传附件</td>
      <td idth="100%">
      <input type="text" style="display: none;" id="stocks_bill_flag" value="1"/>
      <table id ="fjtable" border="0" class="rtab3" width="100%">
      <tr ><td width="80%" >发票(<span id="check_bill_but" style="cursor:pointer;"><font color="red">检查票号</font></span>)</td>
      <td width="20%"><img src="../../images/+.gif" style="vertical-align:middle; cursor: pointer;" id="imgAddTr" title="再添加一个" /></td></tr>
       <tr id="hiddenTR"  style="display: none;">
     <td width="80%"> <input name="file_show" type="file" id="file_show" class="file_show" style="width: 150px;" /><br />
            发票号:<input name="bill_no" type="text" id="bill_no" class="bill_no" style="width: 100px;" /><span></span><br />
            提成金额: <input class="selblue411" name="dec_money" type="text" id="dec_money" style="width: 50px;" onfocus="javascript:setOnlyNum(this);" /><br />
           备注: <input name="bill_mem" type="text" id="bill_mem"  class="bill_mem" style="width: 50px;" /><br />
           参与提成核算  <select name="is_valid_for_pay" class="is_valid_for_pay" id="is_valid_for_pay"><option value="0">是</option><option value="1">否</option></select>
    </td>
     <td width="20%"> <img src="../../images/x.gif" style="vertical-align:middle; cursor: pointer;" id="imgDelTr" title="删除"/>
     </td>
       </tr>
      </table>
      </td>
  </tr>
</table>
<div class="xt_fenye1"><a  id="btn_sub"><img src="images/shagnbao.jpg" alt="" width="93" height="38" /></a>　　 
<a  onclick="document.temp_form.reset();"><img src="images/xt_chongzhi.jpg" alt="" width="93" height="38" /></a></div>
</form>
<!--head end --> 
<!--first start -->

</div>

<!-- footer start--> 
<!-- footer end-->
<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="js/lhgdialog.min.js?skin=idialog"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/validator.js"></script>
<script type="text/javascript" src="js/jquery.textbox.js"></script>
<script type="text/javascript"><!--//<![CDATA[
// 防止缓存每次都加载JS                                     
document.write("<s" + "cript type='text/javascript' src='js/base-data.js?" + Math.random() + "'></scr" + "ipt>");

$(document).ready(function(){
   // 定义AJAX获取的型号信息
	var pd_module_data;
	
	// 浏览器参数获取用户名和密码
	var username  = getQueryString("username");
	var userpass = getQueryString("userpass");
	var from_pc = getQueryString("from_pc");
	
	// 如果是pc端需要隐藏头部
	if(1 == from_pc){
		$(".head_class").hide();
	}

	// 如果访问地址携带用户名和密码则初始化相关信息
	if(username != null && userpass != null && username != "null" && userpass != "null" && username != "" && userpass != ""){
		// 初始化门店信息 
		store_init(username, userpass);

		// 初始化品牌
		pd_module_init(username, userpass);
	} else { // 否则强制要求输入用户和密码
		show_login();
	}


	$("#t1").click(function(){
		if($(this).attr("checked")=="checked"){
			$("#select-choice-1").removeAttr("dataType", "Require");
			$("#single_price"       ).removeAttr("dataType","Require");
			$("#sales_price"        ).removeAttr("dataType","Require");
			$("#sales_count"        ).removeAttr("dataType","Require");
			//$("#select-choice-2").val("");
			//$("#select-choice-1").val("");
			$("#sales_count").val("0");
			$("#single_price").val("0");
			$("#sales_price").val("0");
		}else{
			$("#select-choice-1").attr("dataType", "Require").attr("msg", "请选择型号！");
			$("#sales_count").val("");
			$("#single_price").val("");
			$("#sales_price").val("");
		}
	});
	
	$("#store_id"       ).attr("dataType", "Require").attr("msg", "请选择门店！");
	$("#sales_count"    ).attr("dataType", "Require").attr("msg", "请填写数量！");
	$("#single_price"   ).attr("dataType", "Require").attr("msg", "请填写单价！");
	$("#sales_price"    ).attr("dataType", "Require").attr("msg", "请填写金额！");
	

	
	$("#btn_sub").click(function(){
		// 判断是否有用户名和密码
		if(username == null || userpass == null || username == "null" || userpass == "null" || username == "" || userpass == ""){
			show_login();
			return false;
		}
		var sub_count=0;
		if(Validator.Validate($("#temp_form")[0], 2)){
		  var id  = $("#id").val();
		  var store_id  = $("#store_id").val();
		  var select_choice_2 = $("#select-choice-2").val();
		  var sales_count = $("#sales_count").val();
		  var sales_price = $("#sales_price").val();
		  var single_price = $("#single_price").val();
		  var memo = $("#memo").val();
		  var realname = $("#realname").val();
		  var phonenum = $("#phonenum").val();
		  var addresss = $("#addresss").val();
		  var mastercode = $("#mastercode").val();
		  if($("#t1").attr("checked")!="checked"){
		    //  if (sales_count<=0){
			//      alert("数量必须大于0！");
			//      return ;
			//      }
		    //  if(sales_price<=0){
			//      alert("金额必须大于0！");
			//      return;
		    //      }
		      if(single_price<=0){
			      alert("单价必须大于0！");
			      return;
		          }
          }



		  var stocks_bill_flag = $("#stocks_bill_flag").val();
		  if(null==stocks_bill_flag || ""==stocks_bill_flag){
			  alert("没有检查发票号的唯一性");
				return;
			  }else if(0==stocks_bill_flag){
				  alert("有发票号检查不通过");
					return;
			}

          
		    // 正在加载数据层
		    if(sub_count==0){
		    sub_count++;
		    var load_data = $.dialog({content: '正在提交数据...', max: false, min: false, icon: 'loading.gif', title: '提示！'});
		  
			$.ajax({
				type: "POST",
				url: host_url + "/MobileSubmit.do?method=DoSubmit01&from_html=1",
				data: {
					"username":encodeURI(username), "userpass":encodeURI(userpass), "id":id, "store_id":store_id, "select-choice-2":select_choice_2, "sales_count":sales_count,
					"single_price":single_price, "sales_price":sales_price, "memo":encodeURI(memo), "realname":encodeURI(realname), "phonenum":phonenum, "addresss":encodeURI(addresss), "mastercode":mastercode,
					"timestamp":new Date().getTime()
				},
				dataType: "jsonp",
				jsonp: "jsonpcallback",
				//sync: false, // jsonp不支持同步
				error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！"); },
				success: function(result) {
					var strs= new Array();
					strs=result.msg.split(":");
				  // 关闭-正在加载数据层
			  	//  load_data.close();

				  if (result.msg.indexOf('success')>-1){
					  /**  $.dialog({
				        	max: false, min: false, fixed: true,
						    content: '恭喜，数据上报成功！',
						    init: function () {
						        var that = this, i = 5;
						        var fn = function () {
						            that.title(i + '秒后关闭');
						            !i && that.close();
						            i--;
						        };
						        timer = setInterval(fn, 1000);
						        fn();
						    },
						    close: function () {
						        clearInterval(timer);
						    }
						});*/
						$("#lid").val(strs[1]);	
						$("#username").val(username);	
						$("#userpass").val(userpass);	
				        document.temp_form.action=host_url +'/MobileSubmit.do';
					    document.temp_form.submit();
					   
			       } else {
						$.dialog({
						    max: false, min: false, fixed: true,
						    content: result.msg,
						    init: function () {
						        var that = this, i = 5;
						        var fn = function () {
						            that.title(i + '秒后关闭');
						            !i && that.close();
						            i--;
						        };
						        timer = setInterval(fn, 1000);
						        fn();
						    },
						    close: function () {
						        clearInterval(timer);
						    }
						});
						 sub_count=0;
						 
				   }
				}
			});}
		}
	});
      var trCount=0;
	   	 $("#imgAddTr").click(function (){
	   	        $("#hiddenTR").clone().appendTo($("#fjtable")).show();
	   	        trCount++;
	   	        resizeFrameHeight();
	   	     $("#stocks_bill_flag").val("");

	   	        
	               //拿到刚刚添加的行对象
	   		    var lastTR = $("tr:last", "#fjtable");

	   			//绑定删除按钮开始
	   	        $("td:last", lastTR).click(function (){
	                   $(this).parent().remove();
	                   trCount--;
	                   resizeFrameHeight();
	               });//绑定删除按钮结束

	             
	               var file_show=$("#file_show", lastTR);//附件
	   	    	var bill_no= $("#bill_no", lastTR);//票据编号
	   	    	var dec_money= $("#dec_money", lastTR);// 提成金额
	   	    	var bill_mem= $("#bill_mem", lastTR);/// 备注
	   	    	var is_valid_for_pay= $("#is_valid_for_pay", lastTR);//是否参与提成核算
	   	    	
	   	    	file_show.attr("name","file_show_"+trCount);
	   	    	file_show.attr("dataType", "Require").attr("msg", "请传入附件！");
	   	    	bill_no.attr("dataType", "Require").attr("msg", "请填写发票编号！");
	   	    	dec_money.attr("dataType", "Require").attr("msg", "请填写申请金额！");
	          // 	$("#bill_mem"        ).attr("dataType", "Require").attr("msg", "备注不能为空！");备注还是可以不填的，所以这边限制
	           //	$("#is_valid_for_pay"      ).attr("dataType", "Require").attr("msg", "发票号不能为空！");是否参与提成核算是下拉选择，所以不需要限制

	   	    	bill_no.change(function(){
	   			var cur_value=$(this).val();
	   			$(this).attr("class","bill_no_cur");
	   			$(".bill_no").not(bill_no).each(function(){
	                  if($(this).val()==cur_value){
	                      alert("发票号填写重复！");
	               	     bill_no.val("");
	               		$("#stocks_bill_flag").val("");
	                      }  
	   				});
	   			$(this).attr("class","bill_no");
	   		    	})

	   	        	   	 });  

	   	$("#check_bill_but").click(function(){
			var bill_nos = [];
			$(".bill_no").each(function(){
				if(""!=$(this).val() && null!=$(this).val()){
				bill_nos[bill_nos.length] = $.trim($(this).val());
				var result_span=$(this).parent().children("span");
				result_span.attr("id",$(this).val());
				}
			});
			 $.ajax({
	    			type: "POST",
	    			url: host_url + "/MobileList.do?method=CheckBillNoS&from_html=1",
	    			data: { "username":encodeURI(username), "userpass":encodeURI(userpass), "timestamp":new Date().getTime() ,"bill_no":bill_nos.join(",")},
	    			dataType: "json",
	    		//	jsonp: "jsonpcallback",
	    			error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！");},
	    			success: function(result) {

	    				var ispass = 1; // 默认所有产品都有库存
	    				for(var i = 0 ;i< result.length ;i++){
		    				if(null!=bill_nos[i]){
			    				var bill_no_cur=bill_nos[i];
	    					if(result[i][bill_no_cur] > 0){
	    							$("#"+bill_nos[i]).html("<font color='red' size='2'>发票号已经存在!</font>");
	    							ispass = ispass * 0;
	    					} else {
	    						$("#"+bill_nos[i]).html("<font color='green' size='2'>发票号可以使用!</font>");
	    					}
	    				}
	    				}
	    				$("#stocks_bill_flag").val(ispass);
	    			}
	    		});
		});

	             
	         
	       
  
	 function resizeFrameHeight(offset, min_height) {
			// frame id can be found in page /konka-wd/WebContent/manager/admin/Frames2/indexFrame.jsp, and search 'iframe' to get.
			$("#mainFrame", window.parent.document).height(Math.max((min_height || 0), $(document).find("body").height(), $(document).children().height()) + (offset || 0));
		}  
	

	// 型号改变进行注册监听
	$("#select-choice-1").bind("input propertychange", function() {
		initAutoDiv(0);
	});
	
	// 数量，单价改变计算总金额
	$("#sales_count, #single_price").change(function(){
		cal_all_price();
	});
	
	// 总价改变计算单价
	$("#sales_price").change(function(){
		cal_single_price();
	});

	// 数量或者单价改变计算总价
    function cal_all_price(){
		var sales_count = $("#sales_count").val();
		var single_price = $("#single_price").val();
		if((sales_count * single_price).toFixed(2) > 999999999 || -999999999 > (sales_count * single_price).toFixed(2)){
			 $.dialog.alert("计算金额超出范围！",function(){});
			return;
		}
		$("#sales_price").val((sales_count * single_price).toFixed(2));
		  
    }

	// 总价改变计算单价
    function cal_single_price(){
		var sales_count = $("#sales_count").val();
		var sales_price = $("#sales_price").val();
		$("#single_price").val((sales_price / sales_count).toFixed(2));
    }

	// 输入关键字搜索
	function initAutoDiv(){
		// 隐藏下拉框
		if($("#auto_prompt_div"))
	        $("#auto_prompt_div").remove();
        // 输入框有改变将型号置为空
        $("#select-choice-2").val("");
        
		if($.trim($("#select-choice-1").val()).length >= 2){
			var val = $.trim($("#select-choice-1").val());
			var count = 0;
			for(var i = 0; i < pd_module_data.length; i++){
				var id = pd_module_data[i].id;
				var name = pd_module_data[i].name;
				if(name.toLowerCase().indexOf(val.toLowerCase()) != -1)
					count++;
			}

			var top = $("#select-choice-1").offset().top;
	        var left = $("#select-choice-1").offset().left;
	        var width = $("#select-choice-1").width();
	        var auto_prompt_div = $("<div />").width(width).css("position", "absolute").css("backgroundColor", "white").css("left", left).css("top", top + $("#select-choice-1").height() + 6).css("border", "1px solid #1C86EE").attr("id", "auto_prompt_div");
	        var table = $("<table width='100%' id=\"div_table\" />").attr("cellpadding", "0").attr("cellspacing", "0");
	        
			// 满足条件控制在30个内，如果超过30个则不显示
			if(count != 0){
				for(var i = 0; i < pd_module_data.length; i++){
					var id = pd_module_data[i].id;
					var name = pd_module_data[i].name;
					if(name.toLowerCase().indexOf(val.toLowerCase()) != -1){
	                    var tr = $("<tr />").css("cursor", "pointer").attr("class", "tr_value").mouseout(function(){
	                        $(this).css("backgroundColor", "white").css("color", "black");
	                    }).mouseover(function(){
	                        $(this).css("backgroundColor", "#1C86EE").css("color", "white");
	                    }).click(function(){
	                        $("#select-choice-1").val($(this).find("td").eq(0).html());
	                        $("#select-choice-2").val($(this).find("td").eq(0).attr("id"));
	                	    $("#auto_prompt_div").remove();
	                    });
	                    var td = $("<td class=\"td_class\" />").html(name).css("fontSize", "12px").css("margin", "5px 5px 5px 5px").css("padding-left", "6px").attr("align", "left").attr("id", id);
	                    tr.append(td);
	                    table.append(tr);
				    }
				}
			} else {
                var tr = $("<tr />").css("cursor", "pointer").attr("class", "tr_value").mouseout(function(){
                    $(this).css("backgroundColor", "white").css("color", "black");
                }).mouseover(function(){
                    $(this).css("backgroundColor", "#1C86EE").css("color", "white");
                });
                var td = $("<td />").html("提示，您搜索的型号“" + val + "”，共检索到 " + count + " 条数据，请精确搜索条件！").css("fontSize", "12px").css("margin", "5px 5px 5px 5px").css("padding-left", "6px").attr("align", "left");
                tr.append(td);
                table.append(tr);
			}

			auto_prompt_div.append(table);
	        $(document.body).append(auto_prompt_div);
		}
	}

	// 历史记录
	$("#sj_his").click(function(){
		location.href = "shuj_bill_audit_wap_his.html?username=" + escape(username) + "&userpass=" + escape(userpass) + "&from_pc=" + from_pc + "&timestamp=" + new Date().getTime();		
	});

	function DBC2SBC(str){
	    var result = '';
	    for (i=0 ; i<str.length; i++){
	        code = str.charCodeAt(i);//获取当前字符的unicode编码
	        if (code >= 65281 && code <= 65373){//在这个unicode编码范围中的是所有的英文字母已及各种字符
	   			result += String.fromCharCode(str.charCodeAt(i) - 65248);//把全角字符的unicode编码转换为对应半角字符的unicode码
	  		}else if (code == 12288){//空格
	   			result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);
	  		}else{
	   			result += str.charAt(i);
	  		}
	   }
	   return result;
	}
	
	
	// 登陆层
	function show_login(){	
		// cookie, 2013-06-27
		if(cookie_enable){ // 在base-data.js中定义状态
		  var cookie_name = $.cookie("cookie_name");	
		  var cookie_pass = $.cookie("cookie_pass");	
		  if(cookie_name != null && cookie_pass != null){
			username = cookie_name;
			userpass = cookie_pass;
			
			// 初始化门店信息 
			store_init(username, userpass);

			// 初始化型号
			pd_module_init(username, userpass);
			return false;
		  }
		}
		
	  $.dialog({
			id: 'login-window',
			title: '登录',
			content: '帐&nbsp;&nbsp;号：<input id="login-na" type="text" maxlength="20" value="" />' + '<br /><br />密&nbsp;&nbsp;码：<input id="login-pw" type="password" maxlength="20" value="" />',
			initialize: function () {
				document.getElementById('login-na').focus();
			},
			fixed: true, max:false, min:false,
			ok: function () {
				var na = document.getElementById('login-na');
				var pw = document.getElementById('login-pw');
				if(na.value == ""){
					alert("提示，请填写账号！");
					na.select();
					return false;
				}
				if(pw.value == ""){
					alert("提示，请填写密码！");
					pw.select();
					return false;
				}
				// 用户和密码赋值
				username = na.value;
				userpass = pw.value;
				
				// 初始化门店信息 
				store_init(username, userpass);

				// 初始化型号
				pd_module_init(username, userpass);
				
				// cookie,2013-06-27
				if(cookie_enable){ // 在base-data.js中定义状态
					$.cookie("cookie_name", username);	
					$.cookie("cookie_pass", userpass);	
				}	
			},
			okValue: '登录',
			cancel: function () {}
		});
	}

	// 根据用户名和密码初始化型号信息
	function pd_module_init(username, userpass){
		// 正在加载数据层
		var load_data = $.dialog({content: '数据加载中...', max: false, min: false, icon: 'loading.gif', title: '提示！'});
		
		$.ajax({
			type: "POST",
			url: host_url + "/MobileList.do?method=GetList04&from_html=1",
			data: { "username":encodeURI(username), "userpass":encodeURI(userpass), "timestamp":new Date().getTime() },
			dataType: "jsonp",
			jsonp: "jsonpcallback",
			error: function (xhr, ajaxOptions, thrownError) { alert("数据加载请求失败【" + xhr.statusText + "," + xhr.responseText + "," + xhr.status + "," + thrownError +"】！");},
			success: function(result) {
			  // 关闭-正在加载数据层
		  	  load_data.close();	
				
			  if (result.status == "-1"){
			        $.dialog.alert(result.msg,function(){});
		      } else {
		    	pd_module_data = result;
			  }
			}
		});
	}
	
	$("#memo").textbox({
		maxLength: 100,
		onInput: function(event, status) {
			var img = '<img src="images/tishi.gif" style="vertical-align:middle;" />';
			$("#info_tip").slideDown("fast").html(img + " 请将字数限制在：" + status.maxLength + " 个字内，您还可以输入：<b style='color:red;'>" + status.leftLength + "</b> 个字。");
		}
	}).blur(function() {
		$("#info_tip").slideUp("normal");
	});
	 
});
function DBC2SBC(obj){
	var str =obj.value();
    var result = '';
    for (i=0 ; i<str.length; i++){
        code = str.charCodeAt(i);//获取当前字符的unicode编码
        if (code >= 65281 && code <= 65373){//在这个unicode编码范围中的是所有的英文字母已及各种字符
   			result += String.fromCharCode(str.charCodeAt(i) - 65248);//把全角字符的unicode编码转换为对应半角字符的unicode码
  		}else if (code == 12288){//空格
   			result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);
  		}else{
   			result += str.charAt(i);
  		}
   }
   return result;
}

//]]>--></script>
</body>
</html>